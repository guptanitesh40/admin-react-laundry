import{r as a,B as W,V as R,u as X,q as Z,j as e,T as ee,i as V,P as se,s as ae,b as te}from"./index-vHAOnTyK.js";import{M as T}from"./MultiSelect-Cv06liAY.js";import"./orderStatusClasses-HfHBGnti.js";const re=(p=1,d=10,c="",u,x,j,r)=>{const[E,i]=a.useState(),[P,S]=a.useState(0),[g,b]=a.useState(!1),N=async()=>{var _,v;const f=localStorage.getItem("authToken"),n=new URLSearchParams;p&&n.append("page_number",p.toString()),d&&n.append("per_page",d.toString()),c&&n.append("search",c),u&&n.append("sort_by",u),x&&n.append("order",x),j&&j.forEach(l=>n.append("user_id",l.toString())),r&&r.forEach(l=>n.append("status",l)),b(!0);try{const l=await fetch(`${W}/razorpay/transaction?${n}`,{method:"GET",headers:{Authorization:f?`Bearer ${f}`:""}}),o=await l.json();if(!l.ok){R.error(o.message,{position:"top-center"}),b(!1);return}i((_=o==null?void 0:o.data)==null?void 0:_.result),S((v=o==null?void 0:o.data)==null?void 0:v.count)}catch{R.error("Network Error : Failed to fetch payments")}finally{b(!1)}};return a.useEffect(()=>{N()},[p,d,c,u,x,j,r]),{payments:E,count:P,fetchPayments:N,loading:g}},ne=()=>{const[p,d]=a.useState(1),[c,u]=a.useState(10),[x,j]=X(),[r,E]=a.useState(null),[i,P]=a.useState(null),S=x.get("page"),g=x.get("perPage"),[b,N]=a.useState(""),[f,n]=a.useState(""),[_,v]=a.useState(""),[l,o]=a.useState([]),[$,k]=a.useState([]),[B,z]=a.useState([]),[A,D]=a.useState(""),[O,U]=a.useState([]),[Y,F]=a.useState([]),{payments:h,count:I,loading:G}=re(p,c,b,r,i,Y,O),q=[{label:"Created",value:"created"},{label:"Paid",value:"paid"},{label:"Attempted",value:"attempted"}],{fetchUsersByRole:M}=Z(),L=Math.ceil(I/c);a.useEffect(()=>{(async()=>{const t=await M(5);o((m=>m.map(y=>({label:`${y.first_name} ${y.last_name} (${y.mobile_number})`,value:y.user_id})))(t))})()},[]),a.useEffect(()=>{A?(async()=>{const w=(await M(5,A)).map(m=>({label:`${m.first_name} ${m.last_name} (${m.mobile_number})`,value:m.user_id}));z(w)})():z(l)},[A,l]),a.useEffect(()=>{S&&d(Number(S)),g&&u(Number(g))},[S,g]);const H=async s=>{s.preventDefault();try{await ae.validate({search:f},{abortEarly:!1}),N(f),v("")}catch(t){t instanceof te&&v(t.errors[0])}},C=s=>{r===s?P(i==="ASC"?"DESC":"ASC"):(E(s),P("ASC"))},J=s=>{s>=1&&s<=L&&(d(s),j({page:s.toString(),perPage:c.toString()}))},K=s=>{const t=Number(s.target.value);u(t),d(1),j({page:"1",perPage:t.toString()})},Q=(s,t)=>[...s.filter(w=>!t.some(m=>m.value===w.value)),...t];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:c,onChange:K,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-2 mb-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2.5",children:[e.jsx(T,{options:q,displayValue:"label",placeholder:"Select Payment Status",selectedValues:O,onSelect:s=>U(s.map(t=>t.value)),onRemove:s=>U(s.map(t=>t.value)),className:"min-w-[180px]",sliceCount:1}),e.jsx(T,{options:Q($,B),displayValue:"label",placeholder:"Search Customer",selectedValues:$.map(s=>s.value),onSelect:s=>{k(s),F(s.map(t=>t.value))},onRemove:s=>{k(s),F(s.map(t=>t.value))},setSearch:D,className:"sm:min-w-[320px] smmobile:min-w-[290px] smobile:min-w-[300px] vsmobile:min-w-[240px]",isSearchInput:!0})]}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:H,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:f,onChange:s=>{n(s.target.value),s.target.value===""&&N("")},placeholder:"Search...",className:"min-w-[150px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:_||"Â "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"min-w-[250px]",children:[e.jsxs("span",{className:`sort ${r==="first_name"?i==="ASC"?"asc":"desc":""}`,onClick:()=>C("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer Name"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[250px]",children:[e.jsxs("span",{className:`sort ${r==="email"?i==="ASC"?"asc":"desc":""}`,onClick:()=>C("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[130px]",children:[e.jsxs("span",{className:`sort ${r==="mobile_number"?i==="ASC"?"asc":"desc":""}`,onClick:()=>C("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile No"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[120px]",children:[e.jsxs("span",{className:`sort ${r==="razorpay_transaction_id"?i==="ASC"?"asc":"desc":""}`,onClick:()=>C("razorpay_transaction_id"),children:[e.jsx("span",{className:"sort-label",children:"Transaction Id"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsx("th",{className:"min-w-[120px]",children:"Created At"}),e.jsx("th",{className:"min-w-[60px]",children:"Status"}),e.jsx("th",{className:"min-w-[120px]",children:"Order Id"}),e.jsx("th",{className:"min-w-[60px]",children:"Currency"}),e.jsxs("th",{className:"min-w-[60px]",children:[e.jsxs("span",{className:`sort ${r==="amount"?i==="ASC"?"asc":"desc":""}`,onClick:()=>C("amount"),children:[e.jsx("span",{className:"sort-label",children:"Amount"}),e.jsx("span",{className:"sort-icon"})]})," "]})]})}),G?e.jsx(ee,{}):(h==null?void 0:h.length)>0?e.jsx("tbody",{children:h.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[s.user.first_name," ",s.user.last_name]}),e.jsx("td",{children:s.user.email}),e.jsx("td",{children:s.user.mobile_number}),e.jsx("td",{children:s.razorpay_transaction_id}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[V(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),V(s.created_at).format("hh:mm:ss A")]})}),e.jsx("td",{children:s.status}),e.jsx("td",{children:s.razorpay_order_id}),e.jsx("td",{children:s.currency}),e.jsx("td",{children:s.amount})]},s.razorpay_transaction_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No Payments data available"})})})]})}),e.jsx(se,{count:I,currentPage:p,totalRecords:h==null?void 0:h.length,perPage:c,onPageChange:J,label:"records"})]})})]})},oe=()=>e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Payments"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(ne,{})})})})]});export{oe as default};
