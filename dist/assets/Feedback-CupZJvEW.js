import{U as Z,r as l,j as e,u as k,W as ee,X as se,f as ae,g as te,b as le}from"./index-DgqFhqzz.js";import{s as ne}from"./searchSchema-CjhF6hVy.js";import{d as V}from"./dayjs.min-CdpL_Yi0.js";import{M as re}from"./MultiSelect-CuvVlQ42.js";import"./orderStatusClasses-HfHBGnti.js";const ie=()=>{const{customerRatingData:t,fetchCustomerRatingData:j}=Z(),[m,b]=l.useState([{label:"5",count:0},{label:"4",count:0},{label:"3",count:0},{label:"2",count:0},{label:"1",count:0}]),[N,f]=l.useState(0),[i,C]=l.useState(0);l.useEffect(()=>{j()},[]),l.useEffect(()=>{if(t){const n=m.map(r=>{const x=t==null?void 0:t.find(y=>y.rating.toString()===r.label);return x?{...r,count:x.count}:r});b(n);const o=t==null?void 0:t.reduce((r,x)=>r+x.rating*x.count,0),u=t==null?void 0:t.reduce((r,x)=>r+x.count,0),S=o/u;f(S),C(u)}},[t]);const c=Math.max(...m.map(n=>n.count)),v=(n,o)=>{const u=Number(n);if(o===0)return"bg-gray-200";switch(u){case 1:return"bg-red-500";case 2:return"bg-green-500";case 3:return"bg-yellow-500";case 4:return"bg-orange-500";case 5:return"bg-blue-500";default:return"bg-gray-200"}};return e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"flex flex-wrap mt-3 justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 ml-3",children:[e.jsx("div",{children:e.jsx("img",{className:"default-logo h-[55px] max-w-none",src:"/media/app/review.png"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl text-gray-700 font-bold",children:N.toFixed(2)}),e.jsxs("p",{className:"text-base font-semibold text-gray-700",children:["─ of ",i," reviews"]})]})]}),e.jsx("div",{className:"card-body flex flex-col gap-2 custom-body min-w-[250px]",children:m.map((n,o)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex justify-between text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("span",{children:n.label}),e.jsx("div",{className:"rating-label custom-rating checked",children:e.jsx("i",{className:"custom-rating-on rating-on ki-solid ki-star text-base leading-none"})},o)]})}),e.jsx("div",{className:"w-full h-[8px] bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:`${v(n.label,n.count)} rounded-full h-full transition-all duration-500`,style:{width:`${n.count/c*100}%`}})}),e.jsx("span",{className:"font-medium text-sm text-gray-600",children:n.count})]},o))})]})})})},W=t=>{switch(t){case 1:return"badge badge-danger badge-outline";case 2:return"badge badge-info badge-outline";case 3:return"badge badge-warning badge-outline";default:return""}},ce=()=>{const[t,j]=l.useState(1),[m,b]=l.useState(10),[N,f]=k(),[i,C]=l.useState(null),[c,v]=l.useState(null),n=N.get("page"),o=N.get("perPage"),[u,S]=l.useState(""),[r,x]=l.useState(""),[y,F]=l.useState(""),[_,z]=l.useState(),[R,$]=l.useState([]),[G,L]=l.useState(!1),[T,E]=l.useState([]),{feedbacks:d,count:P,fetchFeedbacks:U}=ee(t,m,u,i,c,R,_),{approveFeedback:X}=se(),w=Math.ceil(P/m);l.useEffect(()=>{U(),L(!1)},[G]),l.useEffect(()=>{if((d==null?void 0:d.length)>0){const s=d==null?void 0:d.map(a=>{var h,p,M,D,I,O,Y,B;return{first_name:(p=(h=a==null?void 0:a.order)==null?void 0:h.user)==null?void 0:p.first_name,last_name:(D=(M=a==null?void 0:a.order)==null?void 0:M.user)==null?void 0:D.last_name,order_id:a.order_id,email:(O=(I=a==null?void 0:a.order)==null?void 0:I.user)==null?void 0:O.email,created_at:a.created_at,mobile_number:(B=(Y=a==null?void 0:a.order)==null?void 0:Y.user)==null?void 0:B.mobile_number,feedback_id:a.feedback_id,is_publish:a.is_publish,comment:a.comment,rating:a.rating}});E(s)}},[d]),l.useEffect(()=>{n&&j(Number(n)),o&&b(Number(o))},[n,o]);const q=async s=>{s.preventDefault();try{await ne.validate({search:r},{abortEarly:!1}),S(r),F("")}catch(a){a instanceof le&&F(a.errors[0])}},g=s=>{i===s?v(c==="ASC"?"DESC":"ASC"):(C(s),v("ASC"))},A=s=>{s>=1&&s<=w&&(j(s),f({page:s.toString(),perPage:m.toString()}))},H=s=>{const a=Number(s.target.value);b(a),j(1),f({page:"1",perPage:a.toString()})},J=s=>Array.from({length:5}).map((a,h)=>e.jsxs("div",{className:`rating-label ${h<s?"checked":""}`,children:[e.jsx("i",{className:"rating-on custom-rating-on ki-solid ki-star text-base leading-none"}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]},h)),K=(s,a)=>{E(h=>h.map(p=>p.feedback_id===s?{...p,is_publish:a}:p)),X(s,a)},Q=Array.from({length:5},(s,a)=>({label:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-1",children:a+1}),e.jsxs("div",{className:"rating-label checked mb-1",children:[e.jsx("i",{className:"rating-on custom-rating-on ki-solid ki-star text-base leading-none"}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]})]},a),value:a+1}));if(d)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:m,onChange:H,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(re,{options:Q,displayValue:"label",placeholder:"Select Rating",selectedValues:R,onSelect:s=>$(s.map(a=>a.value)),onRemove:s=>$(s.map(a=>a.value)),className:"lgmobile:min-w-[250px] vsmobile:min-w-[235px]",sliceCount:3,isSearchInput:!1})}),e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${W(_)}`,value:_,onChange:s=>{z(Number(s.target.value))},children:[e.jsx("option",{value:"",children:"Publish Status"}),e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"Approve"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:q,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:r,onChange:s=>{x(s.target.value),s.target.value===""&&S("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"min-w-[70px]",children:[e.jsxs("span",{className:`sort ${i==="order_id"?c==="ASC"?"asc":"desc":""}`,onClick:()=>g("order_id"),children:[e.jsx("span",{className:"sort-label",children:"Order Id"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[250px]",children:[e.jsxs("span",{className:`sort ${i==="first_name"?c==="ASC"?"asc":"desc":""}`,onClick:()=>g("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer name"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${i==="email"?c==="ASC"?"asc":"desc":""}`,onClick:()=>g("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${i==="mobile_number"?c==="ASC"?"asc":"desc":""}`,onClick:()=>g("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile no"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsxs("th",{className:"min-w-[100px]",children:[e.jsxs("span",{className:`sort ${i==="rating"?c==="ASC"?"asc":"desc":""}`,onClick:()=>g("rating"),children:[e.jsx("span",{className:"sort-label",children:"Rating"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsx("th",{className:"min-w-[300px]",children:"Comment"}),e.jsxs("th",{className:"min-w-[120px]",children:[e.jsxs("span",{className:`sort ${i==="date"?c==="ASC"?"asc":"desc":""}`,onClick:()=>g("date"),children:[e.jsx("span",{className:"sort-label",children:"Date"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsx("th",{className:"min-w-[140px]",children:"Publish"})]})}),d.length>0?e.jsx("tbody",{children:T.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsxs("td",{children:[s.first_name," ",s.last_name]}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.mobile_number}),e.jsx("td",{children:e.jsx("span",{children:e.jsx("div",{className:"rating",children:J(s.rating)})})}),e.jsx("td",{children:s.comment}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[V(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),V(s.created_at).format("hh:mm:ss A")]})}),e.jsx("td",{children:e.jsx("span",{className:"menu-badge","data-tooltip":"true","data-tooltip-placement":"top",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${W(s.is_publish)}`,"data-tooltip":"true",value:s.is_publish,onChange:a=>K(s.feedback_id,a.target.value),children:[e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"Approve"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})})})]},s.feedback_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No Feedback data available"})})})]})}),P>m&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",d.length," of ",P," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:t===1,onClick:()=>A(t-1),className:`btn ${t===1?"disabled":""}`,children:e.jsx(ae,{})}),Array.from({length:w}).map((s,a)=>e.jsx("button",{className:`btn ${t===a+1?"active":""}`,onClick:()=>A(a+1),children:a+1},a)),e.jsx("button",{disabled:t===w,onClick:()=>A(t+1),className:`btn ${t===w?"disabled":""}`,children:e.jsx(te,{})})]})]})})]})})]})},ue=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Feedback And Rating"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx(ie,{})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(ce,{})})})})]});export{ue as default};
