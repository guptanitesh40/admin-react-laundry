import{r as m,_ as l,f as k,g,o as $,y as A,x as D,n as P,j as e,V as O}from"./index-CrW1VcAo.js";import{u as R}from"./useGetBranch-2Bj2i7Tv.js";const T="http://35.154.167.170:3000",U=`${T}/branches`,L=()=>{const[a,d]=m.useState(!1);return{addBranch:async n=>{const i=localStorage.getItem("authToken");d(!0),n.company_id&&typeof n.company_id!="number"&&(n.company_id=Number(n.company_id));const h={...n,company_id:parseInt(n.company_id),branch_manager_id:parseInt(n.branch_manager_id)};try{const t=await fetch(U,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!t.ok){const c=await t.json();return l.error(c.message,{position:"top-center"}),!1}const u=await t.json();return l.success(u.message,{position:"top-center"}),!0}catch(t){return l.error((t==null?void 0:t.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{d(!1)}},loading:a}},z=()=>{const[a,d]=m.useState(!1);return{updateBranch:async(n,i)=>{const h=localStorage.getItem("authToken"),t=`http://35.154.167.170:3000/branches/${n}`;d(!0);const u={...i,company_id:parseInt(i.company_id),branch_manager_id:parseInt(i.branch_manager_id)};try{const c=await fetch(t,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(c.ok){const s=await c.json();return l.success(s.message,{position:"top-center"}),!0}const x=await c.json();return l.error(x.message,{position:"top-center"}),!1}catch(c){return l.error((c==null?void 0:c.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{d(!1)}},loading:a}},M=k().shape({branch_name:g().required("Branch name is required"),branch_address:g().required("Branch address is required"),branch_manager_id:g().test("required","branch manager id is required",a=>!(a===null||a==="")).test("format","branch manager id must be a number",a=>a===null||a===""?!0:/^[0-9]+$/.test(a)),branch_phone_number:g().nullable().test("format","Phone Number must be a 10-digit number",a=>a===null||a===""?!0:/^[0-9]{10}$/.test(a)).test("required","Phone Number is required",a=>!(a===null||a==="")),branch_email:g().required("Email is required").email("Enter a valid email").test("required","Email is required",a=>!!a),branch_registration_number:g().nullable().test("required","Branch registration number is required",a=>!!a),company_id:$().typeError("Company ID must be a number").required("Company ID is required").positive("Company ID must be a positive number").integer("Company ID must be an integer").test("required","Company id must be a number",a=>!!a)}),V=()=>{var w;const{addBranch:a,loading:d}=L(),{updateBranch:N,loading:n}=z(),{id:i}=A(),{branches:h,fetchBranches:t}=R(),{companies:u,fetchCompanies:c}=D(),x=P(),[s,f]=m.useState({branch_name:"",branch_address:"",branch_manager_id:"",branch_phone_number:"",branch_email:"",branch_registration_number:"",company_id:null}),[b,v]=m.useState({}),[j,S]=m.useState(!1),[B,C]=m.useState(!1),[G,E]=m.useState("");m.useEffect(()=>{(async()=>{try{await t(),await c()}catch{l.error("Failed to fetch branch or company data.")}})()},[t,c]),m.useEffect(()=>{if(h.length>0&&i){const r=h.find(o=>o.branch_id===parseInt(i));r&&(f({branch_name:r.branch_name||"",branch_address:r.branch_address||"",branch_manager_id:r.branch_manager_id||"",branch_phone_number:r.branch_phone_number||"",branch_email:r.branch_email||"",branch_registration_number:r.branch_registration_number||"",company_id:r.company_id||null}),S(!0))}},[h,i]);const p=r=>{const{name:o,value:_}=r.target;f(y=>({...y,[o]:_}))},q=(r,o)=>{f(_=>({..._,company_id:String(r)})),E(o),C(!1)},F=async r=>{r.preventDefault();try{await M.validate(s,{abortEarly:!1}),j&&i?await N(i,s)&&(f({branch_name:"",branch_address:"",branch_manager_id:"",branch_phone_number:"",branch_email:"",branch_registration_number:"",company_id:null}),x("/branches")):await a(s)&&x("/branches")}catch(o){if(o instanceof O){const _={};o.inner.forEach(y=>{_[y.path||""]=y.message}),v(_)}else l.error("Failed to submit the form. Please try again.")}},I=()=>{x("/branches")};return e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:j?"Edit Branch":"Add Branch"}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"branch_name",children:"Branch Name"}),e.jsx("input",{type:"text",id:"branch_name",name:"branch_name",value:s.branch_name,onChange:p,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:b.branch_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"branch_address",children:"Branch Address"}),e.jsx("input",{type:"text",id:"branch_address",name:"branch_address",value:s.branch_address,onChange:p,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:b.branch_address||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"branch_manager_id",children:"Branch Manager Id"}),e.jsx("input",{type:"text",id:"branch_manager_id",name:"branch_manager_id",value:s.branch_manager_id,onChange:p,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:b.branch_manager_id||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"branch_phone_number",children:"Branch Phone Number"}),e.jsx("input",{type:"text",id:"branch_phone_number",name:"branch_phone_number",value:s.branch_phone_number,onChange:p,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:b.branch_phone_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"branch_email",children:"Branch Email"}),e.jsx("input",{type:"text",id:"branch_email",name:"branch_email",value:s.branch_email,onChange:p,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:b.branch_email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"branch_registration_number",children:"Branch Registration Number"}),e.jsx("input",{type:"text",id:"branch_registration_number",name:"branch_registration_number",value:s.branch_registration_number,onChange:p,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:b.branch_registration_number||" "})]}),e.jsxs("div",{className:"flex flex-col relative",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"company_id",children:"Company"}),e.jsxs("button",{type:"button",onClick:()=>C(!B),className:"bg-gray-200 border border-gray-300 rounded-md px-4 py-2 text-gray-700 hover:bg-gray-300 w-full text-left flex justify-between items-center",children:[e.jsx("span",{children:((w=u.find(r=>r.company_id===Number(s.company_id)))==null?void 0:w.company_name)||"Select Company"}),e.jsx("span",{className:"ml-2",children:"▾"})]}),B&&e.jsx("ul",{className:"dropdown-menu scrollable-menu absolute z-10 mt-[73px] w-full bg-white border border-gray-300 rounded-md shadow-lg",children:u.map(r=>e.jsx("li",{className:`cursor-pointer hover:bg-gray-100 ${r.company_id===Number(s.company_id)?"bg-gray-200":""}`,onClick:()=>q(r.company_id,r.company_name),children:e.jsx("div",{className:"block px-4 py-2 text-sm",children:r.company_name})},r.company_id))}),e.jsx("p",{className:"text-red-500 text-sm",children:b.company_id||" "})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary mt-5 ${d||n?"opacity-50 cursor-not-allowed":""}`,disabled:d||n,children:d||n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):j?"Update Branch":"Add Branch"}),e.jsx("button",{type:"button",className:"mx-5 btn btn-light mt-5",onClick:I,disabled:d||n,children:"Cancel"})]})]})]})};export{V as default};
