import{r as n,V as Y,i as G,k as A,j as a,D as T,l as V}from"./index-tbdUJ46r.js";import{M as b}from"./MultiSelect-BqENLvkY.js";import{u as q}from"./useGetCompanies-2UDvs5PK.js";import{u as Z}from"./useGetServices-RKoi74kz.js";import"./orderStatusClasses-HfHBGnti.js";const O=(o,m="")=>{const[w,v]=n.useState(!1),[g,j]=n.useState([]);return n.useEffect(()=>{(async()=>{const N=localStorage.getItem("authToken"),D=`http://35.154.167.170:3000/user/by-role?role_id=${o}`,p=new URLSearchParams;m&&p.append("search",m),v(!0);try{const i=await fetch(`${D}&${p}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N}`}});if(!i.ok){const y=await i.json();Y.error(y.message||"Failed to fetch users",{position:"top-center"});return}const u=await i.json();j((u==null?void 0:u.data)||[])}catch(i){Y.error((i==null?void 0:i.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{v(!1)}})()},[o,m]),{users:g,loading:w}},{RangePicker:ee}=T,ae=({reportTitle:o,index:m,dynamic_url:w})=>{const[j,k]=n.useState(""),[N,D]=n.useState("");G();const[p,i]=n.useState([]),[u,y]=n.useState([]),[_,R]=n.useState([]),[C,x]=n.useState([]),{users:M,loading:E}=O(5,j),{users:P,loading:$}=O(4,N),{companies:B,loading:L}=q(1,1e3),{branches:t,loading:c}=A(1,1e3,"","","",_),[r,d]=n.useState(!1),[h,I]=n.useState({start_time:"",end_time:""}),S="http://35.154.167.170:3000",z=localStorage.getItem("authToken"),W=n.useMemo(()=>E?[{label:"Loading...",value:0}]:M.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[M,E]),H=n.useMemo(()=>o!=="Pick Up Report"&&o!=="Delivery Report"?[]:$?[{label:"Loading...",value:0}]:P.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[o,P,$]),J=n.useMemo(()=>L?[{label:"Loading...",value:0}]:B.map(e=>({label:e.company_name,value:e.company_id})),[B,L]),K=n.useMemo(()=>c?[{label:"Loading...",value:0}]:t.map(e=>({label:e.branch_name,value:e.branch_id})),[t,c]),Q=e=>{I(e?{start_time:V(e[0]).format("DD-MM-YYYY"),end_time:V(e[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},X=e=>{switch(e){case 0:f();break;case 1:f();break;case 2:f();break;case 3:f();break;case 4:f();break;case 5:f();break;case 6:f();break;default:f()}},f=async()=>{d(!0);const e=new URLSearchParams;h.start_time&&h.end_time&&(e.append("startDate",h.start_time),e.append("endDate",h.end_time)),p.length&&p.forEach(s=>e.append("user_id",s)),u.length&&u.forEach(s=>e.append("driver_id",s)),_.length&&_.forEach(s=>e.append("company_id",s)),C.length&&C.forEach(s=>e.append("branch_id",s));try{const s=await fetch(`${S}/report/${w}?format=excel&${e}`,{headers:{Authorization:`Bearer ${z}`}}),l=await s.json();if(!s.ok)throw new Error(l.message||"Failed to download report");const F=l==null?void 0:l.url;if(!F){Y.error("Download report not found");return}const U=document.createElement("a");U.href=F,U.download=F,document.body.appendChild(U),U.click(),U.remove()}catch(s){Y.error(s.message||"Network error: Failed to download report")}finally{d(!1)}};return a.jsxs("div",{className:"card !shadow-black/10",children:[a.jsx("div",{className:"card-header",children:a.jsx("h3",{className:"card-title",children:o})}),a.jsxs("div",{className:"flex flex-col gap-3 card-body",children:[a.jsx("div",{children:a.jsx(ee,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:Q,format:"DD-MM-YYYY"})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:J,displayValue:"label",placeholder:"Select Company",selectedValues:_,onSelect:e=>{const s=e.map(l=>l.value);R(s)},onRemove:e=>{const s=e.map(l=>l.value);R(s)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:K,displayValue:"label",placeholder:"Select Branch",selectedValues:C,onSelect:e=>{const s=e.map(l=>l.value);x(s)},onRemove:e=>{const s=e.map(l=>l.value);x(s)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:W,displayValue:"label",placeholder:"Select Customer",selectedValues:p,onSelect:e=>{const s=e.map(l=>l.value);i(s)},onRemove:e=>{const s=e.map(l=>l.value);i(s)},setSearch:k,className:"w-full",isSearchInput:!0})}),(o==="Pick Up Report"||o==="Delivery Report")&&a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:H,defaultOption:"No Data Found",displayValue:"label",placeholder:o==="Pick Up Report"?"Select PickUp Boy":"Select Delivery Boy",selectedValues:u,onSelect:e=>{const s=e.map(l=>l.value);y(s)},onRemove:e=>{const s=e.map(l=>l.value);y(s)},setSearch:D,className:"w-full",isSearchInput:!0})})]}),a.jsx("div",{className:"card-footer",children:a.jsxs("button",{disabled:r,className:"relative inline-flex items-center justify-center w-full px-3 py-2 overflow-hidden btn btn-primary",onClick:()=>X(m),children:[r&&a.jsx("span",{className:"absolute inset-0 loading-bar"}),a.jsx("span",{children:r?"Downloading...":"Download"})]})})]},m)},{RangePicker:te}=T,se=({reportTitle:o,dynamic_url:m})=>{const[w,v]=n.useState([]),[g,j]=n.useState([]),[k,N]=n.useState([]),{companies:D,loading:p}=q(1,1e3),{branches:i,loading:u}=A(1,1e3,"","","",g),{services:y,loading:_}=Z(1,1e4),[R,C]=n.useState(!1),[x,M]=n.useState({start_time:"",end_time:""});G();const E=n.useMemo(()=>p?[{label:"Loading...",value:0}]:D.map(t=>({label:t.company_name,value:t.company_id})),[D,p]),P=n.useMemo(()=>u?[{label:"Loading...",value:0}]:i.map(t=>({label:t.branch_name,value:t.branch_id})),[i,u]),$=n.useMemo(()=>_?[{label:"Loading...",value:0}]:y.map(t=>({label:`${t.name}`,value:t.service_id})),[y,_]),B=t=>{M(t?{start_time:V(t[0]).format("DD-MM-YYYY"),end_time:V(t[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},L=async()=>{const t="http://35.154.167.170:3000",c=localStorage.getItem("authToken");C(!0);const r=new URLSearchParams;x.start_time&&x.end_time&&(r.append("startDate",x.start_time),r.append("endDate",x.end_time)),g.length&&g.forEach(d=>r.append("company_id",d)),k.length&&k.forEach(d=>r.append("branch_id",d)),v.length&&w.forEach(d=>r.append("service_id",d));try{const d=await fetch(`${t}/report/${m}?format=excel&${r}`,{headers:{Authorization:`Bearer ${c}`}}),h=await d.json();if(!d.ok)throw new Error(h.message||"Failed to download report");const I=h==null?void 0:h.url;if(!I){Y.error("Download report not found");return}const S=document.createElement("a");S.href=I,S.download=I,document.body.appendChild(S),S.click(),S.remove()}catch(d){Y.error(d.message||"Network error: Failed to download report")}finally{C(!1)}};return a.jsxs("div",{className:"card !shadow-black/10",children:[a.jsx("div",{className:"card-header",children:a.jsx("h3",{className:"card-title",children:o})}),a.jsxs("div",{className:"flex flex-col gap-3 card-body",children:[a.jsx("div",{children:a.jsx(te,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:B,format:"DD-MM-YYYY"})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:E,displayValue:"label",placeholder:"Select Company",selectedValues:g,onSelect:t=>{const c=t.map(r=>r.value);j(c)},onRemove:t=>{const c=t.map(r=>r.value);j(c)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:P,displayValue:"label",placeholder:"Select Branch",selectedValues:k,onSelect:t=>{const c=t.map(r=>r.value);N(c)},onRemove:t=>{const c=t.map(r=>r.value);N(c)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:$,defaultOption:"No Data Found",displayValue:"label",placeholder:"Select Service",selectedValues:w,onSelect:t=>{const c=t.map(r=>r.value);v(c)},onRemove:t=>{const c=t.map(r=>r.value);v(c)},className:"w-full",isSearchInput:!0})})]}),a.jsx("div",{className:"card-footer",children:a.jsxs("button",{disabled:R,className:"relative inline-flex items-center justify-center w-full px-3 py-2 overflow-hidden btn btn-primary",onClick:L,children:[R&&a.jsx("span",{className:"absolute inset-0 loading-bar"}),a.jsx("span",{children:R?"Downloading...":"Download"})]})})]})},ne=[{name:"Total Order Report",dynamic_url:"total-orders"},{name:"Payment Transaction Report",dynamic_url:"payment-transaction"},{name:"Refund Report",dynamic_url:"refund-report"},{name:"In Active Customer Report",dynamic_url:"inactive-customer-report"},{name:"GST Report",dynamic_url:"gst"},{name:"Service Wise Report",dynamic_url:"service-wise-report"},{name:"Pick Up Report",dynamic_url:"pickup"},{name:"Delivery Report",dynamic_url:"delivery"}],de=()=>a.jsx("main",{className:"grow content",id:"content",role:"content",children:a.jsxs("div",{className:"container-fixed",children:[a.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:a.jsx("div",{className:"flex flex-col justify-center gap-2",children:a.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Reports"})})}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start",children:ne.map((o,m)=>o.name==="Service Wise Report"?a.jsx(se,{reportTitle:o.name,dynamic_url:o.dynamic_url},m):a.jsx(ae,{reportTitle:o.name,dynamic_url:o.dynamic_url,index:m},m))})]})});export{de as default};
