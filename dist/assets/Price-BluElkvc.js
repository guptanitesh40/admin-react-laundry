import{r as a,_ as j,q as M,u as V,j as e,t as J,F as w,a as b,s as W,V as Z}from"./index-Dgee7s5W.js";import{u as H}from"./useGetProducts-B9GRAvAd.js";import{u as K}from"./useGetServices-ChUkfEPz.js";import{u as Q}from"./useGetPrice-DsQjVzX4.js";const X="http://35.154.167.170:3000/prices",Y=()=>{const[d,u]=a.useState(!1);return{addPrice:async g=>{const p=localStorage.getItem("authToken");if(g.length===0)return j.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;u(!0);try{const n={prices:g},h=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(n)});if(!h.ok){const m=(await h.json()).message;return j.error(m,{position:"top-center"}),!1}const x=await h.json();return j.success(x.message,{position:"top-center"}),!0}catch(n){return n.name==="TypeError"&&n.message.includes("Failed to fetch")?j.error("Network error: Failed to fetch.",{position:"top-center"}):j.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{u(!1)}},loading:d}},ee=({search:d,isSave:u,setIsSave:y})=>{const{categories:g,fetchCategories:p}=M(),{products:n,fetchProducts:h}=H(),{services:x,fetchServices:v}=K(),{prices:m,loading:S,fetchPrices:D}=Q(),{addPrice:L}=Y(),[$,O]=a.useState({}),[f,R]=a.useState({}),[_,E]=a.useState(new Set),P=a.useRef({}),[re,I]=V(),[c,B]=a.useState(null),[o,k]=a.useState(null);a.useEffect(()=>{(async()=>{p(),h(),v()})()},[p,h,v]);const A=a.useCallback((r,s,t,i)=>{const l=[];return r.forEach(N=>{s.forEach(F=>{t.forEach(T=>{const q=`${N.category_id}_${F.product_id}_${T.service_id}`;l.push({category:N,product:F,service:T,price:i[q]||0})})})}),l},[g,n,x,m])(g,n,x,m).filter(r=>{const s=d.toLowerCase();return r.category.name.toLowerCase().includes(s)||r.product.name.toLowerCase().includes(s)||r.service.name.toLowerCase().includes(s)}).sort((r,s)=>["category","product","service"].includes(c)?o==="ASC"?r[c].name.localeCompare(s[c].name):s[c].name.localeCompare(r[c].name):c==="price"?o==="ASC"?r.price-s.price:s.price-r.price:0),G=r=>{E(s=>{const t=new Set(s);return t.add(r),t})},z=(r,s)=>{R(t=>({...t,[r]:s}))},C=r=>{c===r?k(o==="ASC"?"DESC":"ASC"):(B(r),k("ASC"))};a.useEffect(()=>{if(u){const r={...$};A.forEach(t=>{const i=`${t.category.category_id}_${t.product.product_id}_${t.service.service_id}`;f[i]!==void 0?r[i]=f[i]:r[i]=t.price});const s=Object.keys(r).map(t=>{const[i,l,N]=t.split("_");return{category_id:parseInt(i,10),product_id:parseInt(l,10),service_id:parseInt(N,10),price:r[t]}});try{L(s),D(),E(new Set),O(r)}catch{j.error("Failed to save prices.")}y(!1)}},[u,f,$,L,D,y]);const U=r=>{E(s=>{const t=new Set(s);return t.delete(r),t})};return a.useEffect(()=>{var s;const r=Array.from(_);if(r.length>0){const t=r[0];P.current[t]&&((s=P.current[t])==null||s.focus())}},[_]),a.useEffect(()=>{I(d?{search:d}:{})},[d]),e.jsx("div",{children:S?e.jsx(J,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-12 grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:"Id"}),e.jsxs("th",{className:"min-w-[200px]",children:[e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("category"),children:["Category",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(w,{color:c==="category"&&o==="ASC"?"gray":"lightgray"}),e.jsx(b,{color:c==="category"&&o==="DESC"?"gray":"lightgray"})]})]})," "]}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("product"),children:["Product",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(w,{color:c==="product"&&o==="ASC"?"gray":"lightgray"}),e.jsx(b,{color:c==="product"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("service"),children:["Service",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(w,{color:c==="service"&&o==="ASC"?"gray":"lightgray"}),e.jsx(b,{color:c==="service"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("price"),children:["Price",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(w,{color:c==="price"&&o==="ASC"?"gray":"lightgray"}),e.jsx(b,{color:c==="price"&&o==="DESC"?"gray":"lightgray"})]})]})})]})}),e.jsx("tbody",{children:A.length>0?A.map((r,s)=>{const t=`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`,i=_.has(t);return e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:r.category.name}),e.jsx("td",{children:r.product.name}),e.jsx("td",{children:r.service.name}),e.jsx("td",{className:"relative",children:i?e.jsx("input",{ref:l=>P.current[t]=l,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:f[t]!==void 0?f[t]:r.price||"",onChange:l=>z(t,l.target.value===""?0:Number(l.target.value)),onBlur:()=>U(t)}):e.jsx("span",{className:"cursor-pointer h-full flex",onClick:()=>G(t),children:f[t]!==void 0?f[t]:r.price||"Add Price"})})]},s)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})})},ne=()=>{const[d,u]=a.useState(!1),[y,g]=a.useState(""),[p,n]=a.useState(""),[h,x]=a.useState(""),v=async m=>{m.preventDefault();try{await W.validate({search:p},{abortEarly:!1}),g(p),x("")}catch(S){S instanceof Z&&x(S.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Table"}),e.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:v,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:p,onChange:m=>n(m.target.value),className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:h||"Â "})]}),e.jsx(ee,{search:y,isSave:d,setIsSave:u})]})};export{ne as default};
