import{r as a,_ as f,q,u as M,j as e,t as V,F as N,a as w,s as J,V as W}from"./index-D8mCTybp.js";import{u as Z}from"./useGetProducts-BklZD7qo.js";import{u as H}from"./useGetServices-Perh7bHH.js";import{u as K}from"./useGetPrice-qke2Wy50.js";const Q="http://35.154.167.170:3000/prices",X=()=>{const[l,d]=a.useState(!1);return{addPrice:async u=>{const p=localStorage.getItem("authToken");if(u.length===0)return f.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;d(!0);try{const i={prices:u},h=await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(i)});if(!h.ok){const n=(await h.json()).message;return f.error(n,{position:"top-center"}),!1}const g=await h.json();return f.success(g.message,{position:"top-center"}),!0}catch(i){return i.name==="TypeError"&&i.message.includes("Failed to fetch")?f.error("Network error: Failed to fetch.",{position:"top-center"}):f.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{d(!1)}},loading:l}},Y=({search:l,isSave:d,setIsSave:y})=>{const{categories:u,fetchCategories:p}=q(),{products:i,fetchProducts:h}=Z(),{services:g,fetchServices:j}=H(),{prices:n,loading:v,fetchPrices:S}=K(),{addPrice:D}=X();a.useState({});const[x,R]=a.useState({}),[b,_]=a.useState(new Set),k=a.useRef({}),[ee,L]=M(),[c,B]=a.useState(null),[o,E]=a.useState(null);a.useEffect(()=>{(async()=>{p(),h(),j(),S()})()},[p,h,j,S]);const P=a.useCallback((r,t,s,A)=>{const m=[];return r.forEach(F=>{t.forEach(I=>{s.forEach(T=>{const U=`${F.category_id}_${I.product_id}_${T.service_id}`;m.push({category:F,product:I,service:T,price:A[U]||0})})})}),m},[u,i,g,n])(u,i,g,n),$=P.filter(r=>{const t=l.toLowerCase();return r.category.name.toLowerCase().includes(t)||r.product.name.toLowerCase().includes(t)||r.service.name.toLowerCase().includes(t)}).sort((r,t)=>["category","product","service"].includes(c)?o==="ASC"?r[c].name.localeCompare(t[c].name):t[c].name.localeCompare(r[c].name):c==="price"?o==="ASC"?r.price-t.price:t.price-r.price:0),G=r=>{_(t=>{const s=new Set(t);return s.add(r),s})},O=(r,t)=>{R(s=>({...s,[r]:t}))},C=r=>{c===r?E(o==="ASC"?"DESC":"ASC"):(B(r),E("ASC"))};a.useEffect(()=>{if(d){const r=P.map(t=>{const s=`${t.category.category_id}_${t.product.product_id}_${t.service.service_id}`;return{category_id:t.category.category_id,product_id:t.product.product_id,service_id:t.service.service_id,price:x[s]!==void 0?x[s]:t.price}}).filter(t=>t.price>0);try{D(r),S(),_(new Set)}catch{f.error("Failed to save prices.")}}y(!1)},[d,D,S,P,x]);const z=r=>{_(t=>{const s=new Set(t);return s.delete(r),s})};return a.useEffect(()=>{var t;const r=Array.from(b);if(r.length>0){const s=r[0];k.current[s]&&((t=k.current[s])==null||t.focus())}},[b]),a.useEffect(()=>{L(l?{search:l}:{})},[l]),e.jsx("div",{children:v?e.jsx(V,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-12 grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:"Id"}),e.jsxs("th",{className:"min-w-[200px]",children:[e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("category"),children:["Category",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(N,{color:c==="category"&&o==="ASC"?"gray":"lightgray"}),e.jsx(w,{color:c==="category"&&o==="DESC"?"gray":"lightgray"})]})]})," "]}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("product"),children:["Product",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(N,{color:c==="product"&&o==="ASC"?"gray":"lightgray"}),e.jsx(w,{color:c==="product"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("service"),children:["Service",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(N,{color:c==="service"&&o==="ASC"?"gray":"lightgray"}),e.jsx(w,{color:c==="service"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>C("price"),children:["Price",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(N,{color:c==="price"&&o==="ASC"?"gray":"lightgray"}),e.jsx(w,{color:c==="price"&&o==="DESC"?"gray":"lightgray"})]})]})})]})}),e.jsx("tbody",{children:$.length>0?$.map((r,t)=>{const s=`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`,A=b.has(s);return e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:r.category.name}),e.jsx("td",{children:r.product.name}),e.jsx("td",{children:r.service.name}),e.jsx("td",{className:"relative",children:A?e.jsx("input",{ref:m=>k.current[s]=m,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:x[s]!==void 0?x[s]:r.price||"",onChange:m=>O(s,m.target.value===""?0:Number(m.target.value)),onBlur:()=>z(s)}):e.jsx("span",{className:"cursor-pointer h-full flex",onClick:()=>G(s),children:x[s]!==void 0?x[s]:r.price||"Add Price"})})]},t)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})})},oe=()=>{const[l,d]=a.useState(!1),[y,u]=a.useState(""),[p,i]=a.useState(""),[h,g]=a.useState(""),j=async n=>{n.preventDefault();try{await J.validate({search:p},{abortEarly:!1}),u(p),g("")}catch(v){v instanceof W&&g(v.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Table"}),e.jsxs("button",{onClick:()=>d(!0),className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:j,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:p,onChange:n=>{i(n.target.value),n.target.value===""&&u("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:h||"Â "})]}),e.jsx(Y,{search:y,isSave:l,setIsSave:d})]})};export{oe as default};
