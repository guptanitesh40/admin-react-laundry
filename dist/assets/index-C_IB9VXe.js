import{r as l,V as h,j as e,D as C,h as v}from"./index-B_iZ5iad.js";import{M as Y}from"./MultiSelect-CYx4JFkb.js";import"./orderStatusClasses-HfHBGnti.js";const U=(c,s="")=>{const[f,g]=l.useState(!1),[x,y]=l.useState([]);return l.useEffect(()=>{(async()=>{const w=localStorage.getItem("authToken"),m=`http://35.154.167.170:3000/user/by-role?role_id=${c}`,p=new URLSearchParams;s&&p.append("search",s),g(!0);try{const a=await fetch(`${m}&${p}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`}});if(!a.ok){const d=await a.json();h.error(d.message||"Failed to fetch users",{position:"top-center"});return}const i=await a.json();y((i==null?void 0:i.data)||[])}catch(a){h.error((a==null?void 0:a.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{g(!1)}})()},[c,s]),{users:x,loading:f}},{RangePicker:$}=C,E=({reportTitle:c,index:s,dynamic_url:f})=>{const[x,y]=l.useState(""),{users:j,loading:w}=U(5,x),[m,p]=l.useState([]),[a,i]=l.useState(!1),[d,k]=l.useState({start_time:"",end_time:""});let b=[{label:"Loading...",value:0}];const N="http://35.154.167.170:3000",R=localStorage.getItem("authToken");!w&&j.length&&(b=j.map(t=>({label:`${t.first_name} ${t.last_name}`,value:t.user_id})));const S=t=>{k(t?{start_time:v(t[0]).format("DD-MM-YYYY"),end_time:v(t[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},D=t=>{switch(t){case 0:n();break;case 1:n();break;case 2:n();break;case 3:n();break;case 4:n();break;case 5:n();break;case 6:n();break;default:n()}},n=async()=>{i(!0);const t=new URLSearchParams;d.start_time&&d.end_time&&(t.append("startDate",d.start_time),t.append("endDate",d.end_time)),m.length&&m.forEach(r=>t.append("user_id",r));try{const r=await fetch(`${N}/report/${f}?format=excel&${t}`,{headers:{Authorization:`Bearer ${R}`}}),o=await r.json();if(!r.ok)throw new Error(o.message||"Failed to download report");const _=o==null?void 0:o.url;if(!_){h.error("Download report not found");return}const u=document.createElement("a");u.href=_,u.download=_,document.body.appendChild(u),u.click(),u.remove()}catch(r){h.error(r.message||"Network error: Failed to download report")}finally{i(!1)}};return e.jsxs("div",{className:"card !shadow-black/10",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:c})}),e.jsxs("div",{className:"card-body flex flex-col gap-3",children:[e.jsx("div",{children:e.jsx($,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:S,format:"DD-MM-YYYY"})}),e.jsx("div",{className:"mui-multiselect-parent",children:e.jsx(Y,{options:b,displayValue:"label",placeholder:"Search Customer",selectedValues:m,onSelect:t=>{const r=t.map(o=>o.value);p(r)},onRemove:t=>{const r=t.map(o=>o.value);p(r)},setSearch:y,className:"w-full",isSearchInput:!0})})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("button",{disabled:a,className:"w-full inline-flex items-center justify-center btn btn-primary px-3 py-2 relative overflow-hidden",onClick:()=>D(s),children:[a&&e.jsx("span",{className:"absolute inset-0 loading-bar"}),e.jsx("span",{children:a?"Downloading...":"Download"})]})})]},s)},T=[{name:"Total Order Report",dynamic_url:"total-orders"},{name:"Payment Transaction Report",dynamic_url:"payment-transaction"},{name:"Refund Report",dynamic_url:"refund-report"},{name:"In Active Customer report",dynamic_url:"inactive-customer-report"},{name:"GST Report",dynamic_url:"gst"},{name:"Pick Up Report",dynamic_url:"pickup"},{name:"Delivery Report",dynamic_url:"delivery"}],L=()=>e.jsx("main",{className:"grow content",id:"content",role:"content",children:e.jsxs("div",{className:"container-fixed",children:[e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Reports"})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map((c,s)=>e.jsx(E,{reportTitle:c.name,dynamic_url:c.dynamic_url,index:s},s))})]})});export{L as default};
