import{r as p,V as j,j as e,b as $}from"./index-DPF6S_1J.js";import{u as P,P as B,a as O,d as D}from"./index-D3LjRP3G.js";import{u as M,c as R}from"./userSchema-GWn2EBUy.js";const J=()=>{const[f,b]=p.useState([]),[g,N]=p.useState(!1);return{address:f,loading:g,fetchAddress:async y=>{var l;const v=localStorage.getItem("authToken"),h=`http://35.154.167.170:3000/address/${y}/user`;try{const o=await fetch(h,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`}});if(!o.ok){const t=await o.json();j.error(t.message,{position:"top-center"});return}const n=await o.json(),x=((l=n==null?void 0:n.data)==null?void 0:l.result)||[];b(x)}catch(o){j.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{N(!1)}}}},K=({isOpen:f,onClose:b,userId:g,setIsSubmit:N,onAddressAdded:L,fullname:y})=>{const{addAddress:v,loading:h}=P(),[l,o]=p.useState({}),[n,x]=p.useState(!1),[t,m]=p.useState({building_number:"",area:"",lat:null,long:null,landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,address_type:null,full_name:""}),[I,E]=p.useState(!1);p.useEffect(()=>{f?g&&m(r=>({...r,user_id:g,full_name:y})):(m({building_number:"",area:"",landmark:"",pincode:"",city:"",lat:null,long:null,state:"",country:"",user_id:null,address_type:null,full_name:""}),o({}))},[f,g]);const T=r=>{m({...t,area:r}),E(!0)},_=async r=>{try{const u=await D.geocodeByAddress(r),a=await D.getLatLng(u[0]),d=u[0].address_components,s=C=>{const S=d.find(A=>C.some(F=>A.types.includes(F)));return(S==null?void 0:S.long_name)||""},c=s(["locality"])||s(["administrative_area_level_2"])||s(["postal_town"]),i=s(["administrative_area_level_1"]),w=s(["country"]),k=s(["postal_code"]);m(C=>({...C,area:u[0].formatted_address,lat:a.lat,long:a.lng,city:c,state:i,country:w,pincode:k}))}catch{j.error("Failed to fetch full address details",{className:"toast-error"})}},z=async r=>{r.preventDefault();const u={...t};u.pincode||delete u.pincode,u.landmark||delete u.landmark;try{if(await O.validate(t,{abortEarly:!1}),o({}),g){const a=await v(u);a&&(L(a),b(),N(!0))}}catch(a){if(a instanceof $){const d={};a.inner.forEach(s=>{d[s.path||""]=s.message}),o(d)}else j.error("Failed to submit the form. Please try again.")}};if(f)return e.jsxs("div",{className:"fixed inset-0 z-50 grid items-center justify-center p-4 overflow-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:b}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-lg min-w-[450px] !max-w-full z-10 relative",children:[e.jsx("button",{className:"absolute top-0 right-0 mt-5 mr-5 btn btn-sm btn-icon btn-light btn-outline lg:mr-5 shadow-default",onClick:b,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"mb-6 text-2xl font-bold",children:"Add New Address"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block font-semibold text-gray-700",children:"Address Type"}),e.jsxs("select",{className:"text-sm select select-lg",onChange:r=>m({...t,address_type:Number(r.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-sm text-red-500",children:l.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block font-semibold text-gray-700",children:"Search Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(B,{value:t.area,onChange:T,onSelect:_,children:({getInputProps:r,suggestions:u,getSuggestionItemProps:a,loading:d})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...r({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>E(!0),onBlur:()=>E(!1)})}),I&&u.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[d&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!d&&u.map((s,c)=>{const{...i}=a(s);return e.jsx("li",{...i,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:s==null?void 0:s.description},c)})]})})]})})}),l.area&&e.jsx("p",{className:"w-full text-sm text-red-500",children:l.area||" "})||n&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block font-semibold text-gray-700",children:"House Number and Society"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:t.building_number,onChange:r=>m({...t,building_number:r.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:l.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block font-semibold text-gray-700",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:t.landmark,onChange:r=>m({...t,landmark:r.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:l.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block font-semibold text-gray-700",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:t.city,onChange:r=>m({...t,city:r.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:l.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block font-semibold text-gray-700",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:t.pincode,onChange:r=>m({...t,pincode:r.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:l.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block font-semibold text-gray-700",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:t.state,onChange:r=>m({...t,state:r.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:l.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block font-semibold text-gray-700",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:t.country,onChange:r=>m({...t,country:r.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:l.country||" "})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:b,className:"mr-2 btn btn-light",disabled:h,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:`btn btn-primary ${h?"opacity-50 cursor-not-allowed":""}`,children:h?"Submitting...":"Submit"})]})]})]})]})},Q=({isOpen:f,onClose:b,setIsSubmit:g,onCustomerCreated:N})=>{const{addUser:L,loading:y}=M(),{addAddress:v,loading:h}=P(),[l,o]=p.useState({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),[n,x]=p.useState({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),[t,m]=p.useState({}),[I,E]=p.useState(!1),[T,_]=p.useState(!1);p.useEffect(()=>{f||(o({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),x({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),m({}))},[f]);const z=a=>{x({...n,area:a}),_(!0)},r=async a=>{try{const d=await D.geocodeByAddress(a),s=await D.getLatLng(d[0]),c=d[0].address_components,i=A=>{const F=c.find(G=>A.some(H=>G.types.includes(H)));return(F==null?void 0:F.long_name)||""},w=i(["locality"])||i(["administrative_area_level_2"])||i(["postal_town"]),k=i(["administrative_area_level_1"]),C=i(["country"]),S=i(["postal_code"]);x(A=>({...A,area:d[0].formatted_address,lat:s.lat,long:s.lng,city:w,state:k,country:C,pincode:S}))}catch{j.error("Failed to fetch full address details",{className:"toast-error"})}},u=async a=>{a.preventDefault();try{await R().validate(l,{abortEarly:!1}),await O.validate(n,{abortEarly:!1}),m({});const d={...l};d.email||delete d.email;const s=await L(d);if(s!=null&&s.user_id){const c={...n,user_id:s.user_id,full_name:`${s.first_name} ${s.last_name}`};c.landmark||delete c.landmark,c.pincode||delete c.pincode;const i=await v(c,!1);i&&(N(s,i),b(),g(!0))}}catch(d){if(d instanceof $){const s={};d.inner.forEach(c=>{s[c.path||""]=c.message}),m(s)}else j.error("Failed to submit the form. Please try again.")}};return f?e.jsxs("div",{className:"fixed inset-0 z-50 grid items-center justify-center p-4 overflow-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:b}),e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-5xl w-full smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"absolute top-0 right-0 mt-5 mr-5 btn btn-sm btn-icon btn-light btn-outline lg:mr-5 shadow-default",onClick:b,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsxs("form",{children:[e.jsxs("div",{className:"flex flex-col gap-6 lg:flex-row",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"mb-4 text-xl font-semibold",children:"Customer Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block font-semibold text-gray-700",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",autoComplete:"off",value:l.first_name||"",onChange:a=>o({...l,first_name:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"text-sm text-red-500",children:t.first_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block font-semibold text-gray-700",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",autoComplete:"off",value:l.last_name,onChange:a=>o({...l,last_name:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"text-sm text-red-500",children:t.last_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block font-semibold text-gray-700",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:l.email,onChange:a=>o({...l,email:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"text-sm text-red-500",children:t.email||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobile_number",className:"block font-semibold text-gray-700",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:l.mobile_number,onChange:a=>o({...l,mobile_number:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"text-sm text-red-500",children:t.mobile_number||" "})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:l.gender===1,onChange:a=>o({...l,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:l.gender===2,onChange:a=>o({...l,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:l.gender===3,onChange:a=>o({...l,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-sm text-red-500",children:t.gender||" "})]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"mb-4 text-xl font-semibold",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block font-semibold text-gray-700",children:"Address Type"}),e.jsxs("select",{className:"w-full p-2 text-sm border border-gray-300 rounded-md select select-lg",onChange:a=>x({...n,address_type:Number(a.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-sm text-red-500",children:t.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block font-semibold text-gray-700",children:"Search Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(B,{value:n.area,onChange:z,onSelect:r,children:({getInputProps:a,suggestions:d,getSuggestionItemProps:s,loading:c})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...a({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>_(!0),onBlur:()=>_(!1)})}),T&&d.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[c&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!c&&d.map((i,w)=>{const{...k}=s(i);return e.jsx("li",{...k,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:i==null?void 0:i.description},w)})]})})]})})}),t.area&&e.jsx("p",{className:"w-full text-sm text-red-500",children:t.area||" "})||I&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block font-semibold text-gray-700",children:"House Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:n.building_number,onChange:a=>x({...n,building_number:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:t.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block font-semibold text-gray-700",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:n.landmark,onChange:a=>x({...n,landmark:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:t.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block font-semibold text-gray-700",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:n.city,onChange:a=>x({...n,city:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:t.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block font-semibold text-gray-700",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:n.pincode,onChange:a=>x({...n,pincode:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:t.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block font-semibold text-gray-700",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:n.state,onChange:a=>x({...n,state:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:t.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block font-semibold text-gray-700",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:n.country,onChange:a=>x({...n,country:a.target.value}),className:"w-full p-2 border border-gray-300 rounded-md input"}),e.jsx("p",{className:"w-full text-sm text-red-500",children:t.country||" "})]})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:b,className:"mr-2 btn btn-light",disabled:y||h,children:"Cancel"}),e.jsx("button",{type:"button",onClick:u,disabled:y||h,className:`btn btn-primary ${y||h?"opacity-50 cursor-not-allowed":""}`,children:y||h?"Submitting...":"Submit"})]})]})]})]}):null};export{K as A,Q as C,J as u};
