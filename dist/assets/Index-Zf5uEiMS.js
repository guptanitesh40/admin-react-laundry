import{r as n,B as T,V as w,u as F,j as e,T as I,k as R,P as Y,s as z,b as B}from"./index-BUS4H48H.js";const U=(i=1,o=10,r="",p,d)=>{console.log(i,o,r,p,d);const[b,x]=n.useState(),[N,h]=n.useState(0),[S,g]=n.useState(!1),j=async()=>{var u,f;const m=localStorage.getItem("authToken"),l=new URLSearchParams;i&&l.append("page_number",i.toString()),o&&l.append("per_page",o.toString()),r&&l.append("search",r),p&&l.append("sort_by",p),d&&l.append("order",d),g(!0);try{console.log([...l]);const a=await fetch(`${T}/user/login-logs?${l}`,{method:"GET",headers:{Authorization:m?`Bearer ${m}`:""}}),t=await a.json();a.ok||(w.error(t.message,{position:"top-center"}),g(!1)),console.log(t),x(((u=t==null?void 0:t.data)==null?void 0:u.userLogs)||[]),h((f=t==null?void 0:t.data)==null?void 0:f.count)}catch{w.error("Network Error: Failed to fetch customer log data")}finally{g(!1)}};return n.useEffect(()=>{j()},[i,o,r,p,d]),{customerLogData:b,count:N,fetchCustomerLog:j,loading:S}},V=()=>{const[i,o]=n.useState(1),[r,p]=n.useState(10),[d,b]=F(),[x,N]=n.useState(null),[h,S]=n.useState(null);d.get("page"),d.get("perPage");const[g,j]=n.useState(""),[m,l]=n.useState(""),[u,f]=n.useState(""),{customerLogData:a,count:t,loading:C}=U(i,r,g,x,h),y=Math.ceil(t/r),P=async s=>{s.preventDefault(),w(m);try{await z.validate({search:m},{abortEarly:!1}),j(m),f("")}catch(c){c instanceof B&&f(c.errors[0])}},_=s=>{s>=1&&s<=y&&(o(s),b({page:s.toString(),perPage:r.toString()}))},k=s=>{const c=Number(s.target.value);console.log(c),p(c),o(1),b({page:"1",perPage:c.toString()})},v=s=>{x===s?S(h==="ASC"?"DESC":"ASC"):(N(s),S("ASC"))};return C?e.jsx(I,{isFilters:!0,isPagination:!0,columns:4,records:10}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:r,onChange:k,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("form",{onSubmit:P,className:"flex items-center gap-2 self-end",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:m,onChange:s=>{l(s.target.value),s.target.value===""&&j("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),u&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u||"Â "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px] min-w-[75px]",children:e.jsxs("span",{className:`sort ${x==="login_id"?h==="ASC"?"asc":"desc":""}`,onClick:()=>v("login_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsxs("th",{className:"min-w-[200px] max-w-[300px] flex-grow",children:[e.jsxs("span",{className:`sort ${x==="first_name"?h==="ASC"?"asc":"desc":""}`,onClick:()=>v("first_name"),children:[e.jsx("span",{className:"sort-label",children:"User name"}),e.jsx("span",{className:"sort-icon"})]}),e.jsx("span",{className:"inline-block h-[22.5px] w-[22.5px] bg-transparent rounded-sm text-right"})]}),e.jsx("th",{className:"min-w-[200px] max-w-[300px] flex-grow",children:e.jsxs("span",{className:`sort ${x==="created_at"?h==="ASC"?"asc":"desc":""}`,onClick:()=>v("created_at"),children:[e.jsx("span",{className:"sort-label",children:"Last login time"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px] max-w-[300px] flex-grow",children:e.jsx("span",{className:"sort-label",children:"Device"})})]})}),(a==null?void 0:a.length)>0?e.jsx("tbody",{children:a==null?void 0:a.map(s=>{const{login_id:c,user:E,created_at:A,type:L}=s,{first_name:M,last_name:$}=E;return e.jsxs("tr",{children:[e.jsx("td",{children:c}),e.jsxs("td",{children:[M+" "+$,e.jsx("span",{className:"inline-block h-[22.5px] w-[22.5px] bg-transparent rounded-sm text-right"})]}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:R(A).format("DD-MM-YYYY, hh:mm A")})}),e.jsx("td",{children:L?"Mobile":"WebSite"})]},c)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"No data available"})})})]})}),e.jsx(Y,{count:t,currentPage:i,totalRecords:a==null?void 0:a.length,perPage:r,onPageChange:_,label:"records"})]})})]})},G=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Logs"})})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(V,{})})})})]});export{G as default};
