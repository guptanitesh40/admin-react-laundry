import{r as b,B as Ne,V as I,a as Pe,x as ft,m as K,d as ee,y as ve,z as xt,A as bt,C as yt,j as e,b as Ie,n as _t,t as vt,q as jt,D as Nt,v as wt,i as St,o as kt,f as Ct,L as At,E as Pt}from"./index-CA1FVl9h.js";import{u as It}from"./useGetCategories-DoIWnMy9.js";import{u as Ot}from"./useGetPrice-BoJ-6765.js";import{u as Tt}from"./useGetOrder-BulOW9P4.js";import{u as Et,c as Ft}from"./userSchema-CC1UrTg8.js";import{u as Dt}from"./useGetuser-DmRTjLoX.js";const qt=()=>{const[d,c]=b.useState(!1);return{loading:d,fetchProductsOnId:async x=>{const y=localStorage.getItem("authToken");c(!0);try{const o=await fetch(`${Ne}/category/${x}/product`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`}}),h=await o.json();if(!o.ok){I.error(h.message,{position:"top-center"}),c(!1);return}return(h==null?void 0:h.data)||[]}catch(o){return I.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{c(!1)}}}},$t=()=>{const[d,c]=b.useState(!1);return{loading:d,fetchServicesOnId:async(x,y)=>{const o=localStorage.getItem("authToken");c(!0);try{const h=await fetch(`${Ne}/category/${x}/product/${y}/service`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}}),u=await h.json();if(!h.ok){I.error(u.message,{position:"top-center"}),c(!1);return}return(u==null?void 0:u.data)||[]}catch(h){return I.error((h==null?void 0:h.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{c(!1)}}}},Lt="http://35.154.167.170:3000/admin/coupon/apply",Rt=()=>{const[d,c]=b.useState(!1);return{applyCoupon:async(x,y,o)=>{const h=localStorage.getItem("authToken");c(!0);try{const u=await fetch(Lt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({user_id:x,order_Total:y,coupon_code:o})}),i=await u.json();return u.ok?i.data:(I.error(i.message,{position:"top-center"}),!1)}catch{I.error("Unable to apply coupon code!")}finally{c(!1)}},loading:d}},Ut=()=>{const[d,c]=b.useState([]),[_,x]=b.useState(!1),y=async o=>{const h=localStorage.getItem("authToken");x(!0);try{const u=await fetch(`${Ne}/admin/valid-coupons?${o}`,{method:"GET",headers:{Authorization:h?`Bearer ${h}`:""}}),i=await u.json();if(!u.ok){I.error(i.message,{position:"top-center"}),x(!1);return}c(i==null?void 0:i.data)}catch{I.error("Network error: Failed to fetch coupons.")}finally{x(!1)}};return b.useEffect(()=>{y()},[]),{validCoupons:d,fetchValidCoupons:y,loading:_}},Mt="http://35.154.167.170:3000",Bt=`${Mt}/admin/orders`,Gt=()=>{const[d,c]=b.useState(!1);return{addOrder:async x=>{const y=localStorage.getItem("authToken");c(!0);try{const o=await fetch(Bt,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify(x)});if(!o.ok){const u=await o.json();return I.error(u.message,{position:"top-center"}),!1}const h=await o.json();return I.success(h.message,{position:"top-center"}),!0}catch(o){return I.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{c(!1)}},loading:d}},Kt=()=>{const[d,c]=b.useState(!1);return{updateOrder:async(x,y)=>{const o=localStorage.getItem("authToken"),h=`http://35.154.167.170:3000/admin/orders/${x}`;c(!0);try{const u=await fetch(h,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(y)});if(u.ok){const k=await u.json();return I.success(k.message,{position:"top-center"}),!0}const i=await u.json();return I.error(i.message,{position:"top-center"}),!1}catch(u){return I.error((u==null?void 0:u.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{c(!1)}},loading:d}},zt=()=>{const[d,c]=b.useState([]),[_,x]=b.useState(!1);return{address:d,loading:_,fetchAddress:async o=>{var i;const h=localStorage.getItem("authToken"),u=`http://35.154.167.170:3000/address/${o}/user`;try{const k=await fetch(u,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});if(!k.ok){const v=await k.json();I.error(v.message,{position:"top-center"});return}const w=await k.json(),D=((i=w==null?void 0:w.data)==null?void 0:i.result)||[];c(D)}catch(k){I.error((k==null?void 0:k.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{x(!1)}}}},Vt=Pe().shape({category_id:K().nullable().required("Please select a category").test("required","Please select a category",d=>!!d),product_id:K().nullable().required("Please select a product").test("required","Please select a product",d=>!!d),service_id:K().nullable().required("Please select a service").test("required","Please select a service",d=>!!d),price:K().nullable().when(["category_id","product_id","service_id"],([d,c,_],x)=>d&&c&&_?x.required("Price is not available for the combination, please add a price"):x.nullable())}),Ht=Pe().shape({username:ee().required("Please enter username"),address_id:K().required("Please select address").test("required","Please select address",d=>!!d),express_delivery_charges:K().typeError("Express delivery charges must be a number").min(0,"Express delivery charges must be a positive number"),shipping_charges:K().typeError("Shipping charge must be a number").min(0,"Shipping charge must be a positive number"),payment_type:K().required("Please choose payment type").test("required","Please choose payment type",d=>!!d),payment_status:K().required("Please choose payment status").test("required","Please choose payment status",d=>!!d),paid_amount:K().typeError("Paid amount must be a number").min(0,"Paid amount must be a positive number").test("max-paid","Paid amount cannot be greater than the total amount",function(d){var c;return d==null||d===0?!0:d<=((c=this.options.context)==null?void 0:c.total)}),branch_id:K().required("Please select branch").test("required","Please select branch",d=>!!d),items:ft().of(Vt)}),ze=()=>{const[d,c]=b.useState(!1);return{addAddress:async(x,y=!0)=>{var h;const o=localStorage.getItem("authToken");c(!0);try{const u=await fetch(`${Ne}/address/admin`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(x)}),i=await u.json();return u.ok?(y&&I.success(i.message,{position:"top-center"}),(h=i==null?void 0:i.data)==null?void 0:h.result):(y&&I.error(i.message,{position:"top-center"}),!1)}catch(u){return I.error((u==null?void 0:u.message)||"Error adding banner",{position:"top-center"}),!1}finally{c(!1)}},loading:d}},Ve=Pe().shape({pincode:ee().required("Pin Code is required").matches(/^[0-9]{6}$/,"Pincode must be 6 digit"),address_type:K().required("Address type is required"),building_number:ee().required("Building number is required"),area:ee().required("Area is required"),city:ee().required("City is required"),state:ee().required("State is required"),country:ee().required("Country is required"),landmark:ee().required("Landmark is required")});var W={},je={},Ae,Ue;function Wt(){if(Ue)return Ae;Ue=1;var d="Expected a function",c=NaN,_="[object Symbol]",x=/^\s+|\s+$/g,y=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,h=/^0o[0-7]+$/i,u=parseInt,i=typeof ve=="object"&&ve&&ve.Object===Object&&ve,k=typeof self=="object"&&self&&self.Object===Object&&self,w=i||k||Function("return this")(),D=Object.prototype,v=D.toString,O=Math.max,z=Math.min,j=function(){return w.Date.now()};function p(r,m,S){var E,$,J,U,M,R,P=0,pe=!1,G=!1,se=!0;if(typeof r!="function")throw new TypeError(d);m=f(m)||0,A(S)&&(pe=!!S.leading,G="maxWait"in S,J=G?O(f(S.maxWait)||0,m):J,se="trailing"in S?!!S.trailing:se);function le(F){var V=E,X=$;return E=$=void 0,P=F,U=r.apply(X,V),U}function ie(F){return P=F,M=setTimeout(te,m),pe?le(F):U}function we(F){var V=F-R,X=F-P,he=m-V;return G?z(he,J-X):he}function ge(F){var V=F-R,X=F-P;return R===void 0||V>=m||V<0||G&&X>=J}function te(){var F=j();if(ge(F))return Q(F);M=setTimeout(te,we(F))}function Q(F){return M=void 0,se&&E?le(F):(E=$=void 0,U)}function de(){M!==void 0&&clearTimeout(M),P=0,E=R=$=M=void 0}function ce(){return M===void 0?U:Q(j())}function ae(){var F=j(),V=ge(F);if(E=arguments,$=this,R=F,V){if(M===void 0)return ie(R);if(G)return M=setTimeout(te,m),le(R)}return M===void 0&&(M=setTimeout(te,m)),U}return ae.cancel=de,ae.flush=ce,ae}function A(r){var m=typeof r;return!!r&&(m=="object"||m=="function")}function t(r){return!!r&&typeof r=="object"}function s(r){return typeof r=="symbol"||t(r)&&v.call(r)==_}function f(r){if(typeof r=="number")return r;if(s(r))return c;if(A(r)){var m=typeof r.valueOf=="function"?r.valueOf():r;r=A(m)?m+"":m}if(typeof r!="string")return r===0?r:+r;r=r.replace(x,"");var S=o.test(r);return S||h.test(r)?u(r.slice(2),S?2:8):y.test(r)?c:+r}return Ae=p,Ae}var ue={},Me;function Jt(){return Me||(Me=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.compose=function(){for(var c=arguments.length,_=Array(c),x=0;x<c;x++)_[x]=arguments[x];return function(){for(var y=arguments.length,o=Array(y),h=0;h<y;h++)o[h]=arguments[h];_.forEach(function(u){return u&&u.apply(void 0,o)})}},ue.pick=function(c){for(var _=arguments.length,x=Array(_>1?_-1:0),y=1;y<_;y++)x[y-1]=arguments[y];return x.reduce(function(o,h){return c&&c.hasOwnProperty(h)&&(o[h]=c[h]),o},{})}),ue}var Be;function Qt(){if(Be)return je;Be=1,Object.defineProperty(je,"__esModule",{value:!0});var d=Object.assign||function(j){for(var p=1;p<arguments.length;p++){var A=arguments[p];for(var t in A)Object.prototype.hasOwnProperty.call(A,t)&&(j[t]=A[t])}return j},c=function(){function j(p,A){for(var t=0;t<A.length;t++){var s=A[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(p,s.key,s)}}return function(p,A,t){return A&&j(p.prototype,A),t&&j(p,t),p}}(),_=xt(),x=k(_),y=bt(),o=k(y),h=Wt(),u=k(h),i=Jt();function k(j){return j&&j.__esModule?j:{default:j}}function w(j,p){if(!(j instanceof p))throw new TypeError("Cannot call a class as a function")}function D(j,p){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p&&(typeof p=="object"||typeof p=="function")?p:j}function v(j,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);j.prototype=Object.create(p&&p.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(j,p):j.__proto__=p)}var O=function(p){return{mainText:p.main_text,secondaryText:p.secondary_text}},z=function(j){v(p,j);function p(A){w(this,p);var t=D(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,A));return t.init=function(){if(!window.google)throw new Error("[react-places-autocomplete]: Google Maps JavaScript API library must be loaded. See: https://github.com/kenny-hibino/react-places-autocomplete#load-google-library");if(!window.google.maps.places)throw new Error("[react-places-autocomplete]: Google Maps Places library must be loaded. Please add `libraries=places` to the src URL. See: https://github.com/kenny-hibino/react-places-autocomplete#load-google-library");t.autocompleteService=new window.google.maps.places.AutocompleteService,t.autocompleteOK=window.google.maps.places.PlacesServiceStatus.OK,t.setState(function(s){return s.ready?null:{ready:!0}})},t.autocompleteCallback=function(s,f){if(t.setState({loading:!1}),f!==t.autocompleteOK){t.props.onError(f,t.clearSuggestions);return}var r=t.props.highlightFirstSuggestion;t.setState({suggestions:s.map(function(m,S){return{id:m.id,description:m.description,placeId:m.place_id,active:!!(r&&S===0),index:S,formattedSuggestion:O(m.structured_formatting),matchedSubstrings:m.matched_substrings,terms:m.terms,types:m.types}})})},t.fetchPredictions=function(){var s=t.props.value;s.length&&(t.setState({loading:!0}),t.autocompleteService.getPlacePredictions(d({},t.props.searchOptions,{input:s}),t.autocompleteCallback))},t.clearSuggestions=function(){t.setState({suggestions:[]})},t.clearActive=function(){t.setState({suggestions:t.state.suggestions.map(function(s){return d({},s,{active:!1})})})},t.handleSelect=function(s,f,r){t.clearSuggestions(),t.props.onSelect?t.props.onSelect(s,f,r):t.props.onChange(s)},t.getActiveSuggestion=function(){return t.state.suggestions.find(function(s){return s.active})},t.selectActiveAtIndex=function(s){var f=t.state.suggestions.find(function(r){return r.index===s}).description;t.setActiveAtIndex(s),t.props.onChange(f)},t.selectUserInputValue=function(){t.clearActive(),t.props.onChange(t.state.userInputValue)},t.handleEnterKey=function(){var s=t.getActiveSuggestion();s===void 0?t.handleSelect(t.props.value,null,null):t.handleSelect(s.description,s.placeId,s)},t.handleDownKey=function(){if(t.state.suggestions.length!==0){var s=t.getActiveSuggestion();s===void 0?t.selectActiveAtIndex(0):s.index===t.state.suggestions.length-1?t.selectUserInputValue():t.selectActiveAtIndex(s.index+1)}},t.handleUpKey=function(){if(t.state.suggestions.length!==0){var s=t.getActiveSuggestion();s===void 0?t.selectActiveAtIndex(t.state.suggestions.length-1):s.index===0?t.selectUserInputValue():t.selectActiveAtIndex(s.index-1)}},t.handleInputKeyDown=function(s){switch(s.key){case"Enter":s.preventDefault(),t.handleEnterKey();break;case"ArrowDown":s.preventDefault(),t.handleDownKey();break;case"ArrowUp":s.preventDefault(),t.handleUpKey();break;case"Escape":t.clearSuggestions();break}},t.setActiveAtIndex=function(s){t.setState({suggestions:t.state.suggestions.map(function(f,r){return r===s?d({},f,{active:!0}):d({},f,{active:!1})})})},t.handleInputChange=function(s){var f=s.target.value;if(t.props.onChange(f),t.setState({userInputValue:f}),!f){t.clearSuggestions();return}t.props.shouldFetchSuggestions&&t.debouncedFetchPredictions()},t.handleInputOnBlur=function(){t.mousedownOnSuggestion||t.clearSuggestions()},t.getActiveSuggestionId=function(){var s=t.getActiveSuggestion();return s?"PlacesAutocomplete__suggestion-"+s.placeId:void 0},t.getIsExpanded=function(){return t.state.suggestions.length>0},t.getInputProps=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(s.hasOwnProperty("value"))throw new Error("[react-places-autocomplete]: getInputProps does not accept `value`. Use `value` prop instead");if(s.hasOwnProperty("onChange"))throw new Error("[react-places-autocomplete]: getInputProps does not accept `onChange`. Use `onChange` prop instead");var f={type:"text",autoComplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":t.getIsExpanded(),"aria-activedescendant":t.getActiveSuggestionId(),disabled:!t.state.ready};return d({},f,s,{onKeyDown:(0,i.compose)(t.handleInputKeyDown,s.onKeyDown),onBlur:(0,i.compose)(t.handleInputOnBlur,s.onBlur),value:t.props.value,onChange:function(m){t.handleInputChange(m)}})},t.getSuggestionItemProps=function(s){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.handleSuggestionMouseEnter.bind(t,s.index),m=t.handleSuggestionClick.bind(t,s);return d({},f,{key:s.id,id:t.getActiveSuggestionId(),role:"option",onMouseEnter:(0,i.compose)(r,f.onMouseEnter),onMouseLeave:(0,i.compose)(t.handleSuggestionMouseLeave,f.onMouseLeave),onMouseDown:(0,i.compose)(t.handleSuggestionMouseDown,f.onMouseDown),onMouseUp:(0,i.compose)(t.handleSuggestionMouseUp,f.onMouseUp),onTouchStart:(0,i.compose)(t.handleSuggestionTouchStart,f.onTouchStart),onTouchEnd:(0,i.compose)(t.handleSuggestionMouseUp,f.onTouchEnd),onClick:(0,i.compose)(m,f.onClick)})},t.handleSuggestionMouseEnter=function(s){t.setActiveAtIndex(s)},t.handleSuggestionMouseLeave=function(){t.mousedownOnSuggestion=!1,t.clearActive()},t.handleSuggestionMouseDown=function(s){s.preventDefault(),t.mousedownOnSuggestion=!0},t.handleSuggestionTouchStart=function(){t.mousedownOnSuggestion=!0},t.handleSuggestionMouseUp=function(){t.mousedownOnSuggestion=!1},t.handleSuggestionClick=function(s,f){f&&f.preventDefault&&f.preventDefault();var r=s.description,m=s.placeId;t.handleSelect(r,m,s),setTimeout(function(){t.mousedownOnSuggestion=!1})},t.state={loading:!1,suggestions:[],userInputValue:A.value,ready:!A.googleCallbackName},t.debouncedFetchPredictions=(0,u.default)(t.fetchPredictions,A.debounce),t}return c(p,[{key:"componentDidMount",value:function(){var t=this.props.googleCallbackName;if(t){var s=window.google&&window.google.maps&&window.google.maps.places;s?this.init():window[t]=this.init}else this.init()}},{key:"componentWillUnmount",value:function(){var t=this.props.googleCallbackName;t&&window[t]&&delete window[t]}},{key:"render",value:function(){return this.props.children({getInputProps:this.getInputProps,getSuggestionItemProps:this.getSuggestionItemProps,loading:this.state.loading,suggestions:this.state.suggestions})}}]),p}(x.default.Component);return z.propTypes={onChange:o.default.func.isRequired,value:o.default.string.isRequired,children:o.default.func.isRequired,onError:o.default.func,onSelect:o.default.func,searchOptions:o.default.shape({bounds:o.default.object,componentRestrictions:o.default.object,location:o.default.object,offset:o.default.oneOfType([o.default.number,o.default.string]),radius:o.default.oneOfType([o.default.number,o.default.string]),types:o.default.array}),debounce:o.default.number,highlightFirstSuggestion:o.default.bool,shouldFetchSuggestions:o.default.bool,googleCallbackName:o.default.string},z.defaultProps={onError:function(p,A){return console.error(`[react-places-autocomplete]: error happened when fetching data from Google Maps API.
Please check the docs here (https://developers.google.com/maps/documentation/javascript/places#place_details_responses)
Status: `,p)},searchOptions:{},debounce:200,highlightFirstSuggestion:!1,shouldFetchSuggestions:!0},je.default=z,je}var oe={},Ge;function Xt(){return Ge||(Ge=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.geocodeByAddress=function(c){var _=new window.google.maps.Geocoder,x=window.google.maps.GeocoderStatus.OK;return new Promise(function(y,o){_.geocode({address:c},function(h,u){u!==x&&o(u),y(h)})})},oe.getLatLng=function(c){return new Promise(function(_,x){try{var y={lat:c.geometry.location.lat(),lng:c.geometry.location.lng()};_(y)}catch(o){x(o)}})},oe.geocodeByPlaceId=function(c){var _=new window.google.maps.Geocoder,x=window.google.maps.GeocoderStatus.OK;return new Promise(function(y,o){_.geocode({placeId:c},function(h,u){u!==x&&o(u),y(h)})})}),oe}var Ke;function Yt(){if(Ke)return W;Ke=1,Object.defineProperty(W,"__esModule",{value:!0}),W.getLatLng=W.geocodeByPlaceId=W.geocodeByAddress=void 0;var d=Qt(),c=x(d),_=Xt();function x(y){return y&&y.__esModule?y:{default:y}}return W.geocodeByAddress=_.geocodeByAddress,W.geocodeByPlaceId=_.geocodeByPlaceId,W.getLatLng=_.getLatLng,W.default=c.default,W}var me=Yt();const He=yt(me),Zt=({isOpen:d,onClose:c,userId:_,setIsSubmit:x,onAddressAdded:y,fullname:o})=>{const{addAddress:h,loading:u}=ze(),[i,k]=b.useState({}),[w,D]=b.useState(!1),[v,O]=b.useState({building_number:"",area:"",lat:null,long:null,landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,address_type:null,full_name:""}),[z,j]=b.useState(!1);b.useEffect(()=>{d?_&&O(s=>({...s,user_id:_,full_name:o})):(O({building_number:"",area:"",landmark:"",pincode:"",city:"",lat:null,long:null,state:"",country:"",user_id:null,address_type:null,full_name:""}),k({}))},[d,_]);const p=s=>{O({...v,area:s}),j(!0)},A=async s=>{O({...v,area:s});try{const f=await me.geocodeByAddress(s),r=await me.getLatLng(f[0]);r&&O(m=>({...m,lat:r==null?void 0:r.lat,long:r==null?void 0:r.lng}))}catch{I.error("Failed to fetch address detail",{className:"toast-error"})}},t=async s=>{s.preventDefault();try{if(await Ve.validate(v,{abortEarly:!1}),_){const f=await h(v);f&&(y(f),c(),x(!0))}}catch(f){if(f instanceof Ie){const r={};f.inner.forEach(m=>{r[m.path||""]=m.message}),k(r)}else I.error("Failed to submit the form. Please try again.")}};if(d)return e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:c}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-lg max-w-lg smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:c,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Add New Address"}),e.jsxs("form",{onSubmit:t,children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm",onChange:s=>O({...v,address_type:Number(s.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"Building Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:v.building_number,onChange:s=>O({...v,building_number:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Area"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(He,{value:v.area,onChange:p,onSelect:A,children:({getInputProps:s,suggestions:f,getSuggestionItemProps:r,loading:m})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...s({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>j(!0),onBlur:()=>j(!1)})}),z&&f.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[m&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!m&&f.map((S,E)=>{const{...$}=r(S);return e.jsx("li",{...$,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:S==null?void 0:S.description},E)})]})})]})})}),i.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.area||" "})||w&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:v.landmark,onChange:s=>O({...v,landmark:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:v.pincode,onChange:s=>O({...v,pincode:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:v.city,onChange:s=>O({...v,city:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:v.state,onChange:s=>O({...v,state:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:v.country,onChange:s=>O({...v,country:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.country||" "})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:c,className:"btn btn-light mr-2",disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:`btn btn-primary ${u?"opacity-50 cursor-not-allowed":""}`,children:u?"Submitting...":"Submit"})]})]})]})]})},ea=({isOpen:d,onClose:c,setIsSubmit:_,onCustomerCreated:x})=>{const{addUser:y,loading:o}=Et(),{addAddress:h,loading:u}=ze(),[i,k]=b.useState({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),[w,D]=b.useState({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),[v,O]=b.useState({}),[z,j]=b.useState(!1),[p,A]=b.useState(!1);b.useEffect(()=>{d||(k({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),D({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),O({}))},[d]);const t=r=>{D({...w,area:r}),A(!0)},s=async r=>{D({...w,area:r});try{const m=await me.geocodeByAddress(r),S=await me.getLatLng(m[0]);S&&D(E=>({...E,lat:S==null?void 0:S.lat,long:S==null?void 0:S.lng}))}catch{I.error("Failed to fetch address detail",{className:"toast-error"})}},f=async r=>{r.preventDefault();try{await Ft().validate(i,{abortEarly:!1}),await Ve.validate(w,{abortEarly:!1});const m=await y(i);if(m!=null&&m.user_id){const S={...w,user_id:m.user_id,full_name:`${m.first_name} ${m.last_name}`},E=await h(S,!1);E&&(x(m,E),c(),_(!0))}}catch(m){if(m instanceof Ie){const S={};m.inner.forEach(E=>{S[E.path||""]=E.message}),O(S)}else I.error("Failed to submit the form. Please try again.")}};return d?e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:c}),e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-5xl w-full smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:c,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsxs("form",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Customer Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-gray-700 font-semibold",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",autoComplete:"off",value:i.first_name||"",onChange:r=>k({...i,first_name:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:v.first_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-gray-700 font-semibold",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",autoComplete:"off",value:i.last_name,onChange:r=>k({...i,last_name:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:v.last_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:i.email,onChange:r=>k({...i,email:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:v.email||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobile_number",className:"block text-gray-700 font-semibold",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:i.mobile_number,onChange:r=>k({...i,mobile_number:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:v.mobile_number||" "})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"mb-2 block text-gray-700 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:i.gender===1,onChange:r=>k({...i,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:i.gender===2,onChange:r=>k({...i,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:i.gender===3,onChange:r=>k({...i,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:v.gender||" "})]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm w-full p-2 border border-gray-300 rounded-md",onChange:r=>D({...w,address_type:Number(r.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"Building Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:w.building_number,onChange:r=>D({...w,building_number:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Area"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(He,{value:w.area,onChange:t,onSelect:s,children:({getInputProps:r,suggestions:m,getSuggestionItemProps:S,loading:E})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...r({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>A(!0),onBlur:()=>A(!1)})}),p&&m.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[E&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!E&&m.map(($,J)=>{const{...U}=S($);return e.jsx("li",{...U,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:$==null?void 0:$.description},J)})]})})]})})}),v.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.area||" "})||z&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:w.landmark,onChange:r=>D({...w,landmark:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:w.pincode,onChange:r=>D({...w,pincode:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:w.city,onChange:r=>D({...w,city:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:w.state,onChange:r=>D({...w,state:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:w.country,onChange:r=>D({...w,country:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:v.country||" "})]})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:c,className:"btn btn-light mr-2",disabled:o||u,children:"Cancel"}),e.jsx("button",{type:"button",onClick:f,disabled:o||u,className:`btn btn-primary ${o||u?"opacity-50 cursor-not-allowed":""}`,children:o||u?"Submitting...":"Submit"})]})]})]})]}):null},la=()=>{var De;const{prices:d}=Ot(),{categories:c,loading:_}=It(),{fetchProductsOnId:x,loading:y}=qt(),{fetchServicesOnId:o,loading:h}=$t(),[u,i]=b.useState(""),[k,w]=b.useState(!0),{id:D}=_t(),{updateOrder:v,loading:O}=Kt(),{addOrder:z,loading:j}=Gt(),p=Number(D),A=1e3,t=1,[s,f]=b.useState(!1),[r,m]=b.useState(!1),[S,E]=b.useState(!1),{users:$,fetchUsersByRole:J}=vt(),{validCoupons:U,fetchValidCoupons:M}=Ut(),{branches:R}=jt(t,A),{order:P,fetchOrder:pe}=Tt(),{address:G,fetchAddress:se}=zt(),{applyCoupon:le}=Rt(),{userData:ie,fetchUser:we}=Dt(),{generatePaymentLink:ge,loading:te}=Nt(),Q=ie==null?void 0:ie.user,de=wt(),ce=((De=de==null?void 0:de.state)==null?void 0:De.prevUrl)||"/orders",ae=b.useRef(null),[F,V]=b.useState({}),[X,he]=b.useState({}),Se=b.useRef(null),[Oe,Te]=b.useState(!1),[Ee,ke]=b.useState(null),fe=St(),[n,T]=b.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:1,payment_type:1,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null}),[We,Je]=b.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:null,payment_type:null,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null}),[L,Qe]=b.useState({});b.useEffect(()=>{const a=l=>{Se.current&&!Se.current.contains(l.target)&&ae.current&&!ae.current.contains(l.target)&&(w(!1),Te(!1))};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),b.useEffect(()=>{(async()=>{await pe(p)})()},[p]),b.useEffect(()=>{R&&R.length&&T(a=>({...a,branch_id:R[0].branch_id}))},[R]),b.useEffect(()=>{if(G&&G.length>0){const a=G.find(l=>l.is_default);T(l=>({...l,address_id:a?a.address_id:null}))}},[G]),b.useEffect(()=>{console.log("FormData : ",n)},[n]),b.useEffect(()=>{(async()=>{n.user_id&&(await se(n.user_id),await M(n.user_id),await we(n.user_id)),S&&(await se(n.user_id),E(!1))})()},[n.user_id,S]),b.useEffect(()=>{p||T(a=>({...a,payment_status:n.payment_type===1?1:null}))},[n.payment_type]),b.useEffect(()=>{(async()=>{Oe&&(!u||u.trim()==="")?(w(!0),await J(5)):u&&k&&await J(5,u)})()},[Oe,u,k]),b.useEffect(()=>{if(P){const a=`${P.user.first_name} ${P.user.last_name}`;i(a),w(!1);const l={coupon_code:P.coupon_code||"",coupon_discount:P.coupon_discount||null,express_delivery_charges:P.express_delivery_charges||null,normal_delivery_charges:P.normal_delivery_charges||null,payment_type:P.payment_type||null,payment_status:P.payment_status||null,sub_total:P.sub_total||0,paid_amount:P.paid_amount||null,kasar_amount:P.kasar_amount||null,transaction_id:P.transaction_id||"",address_id:P.address_id,username:a,user_id:P.user_id||null,items:P.items.map(g=>{var xe,ne,be,q;const C=g.category.category_id,N=((xe=g.product)==null?void 0:xe.product_id)||null,H=((ne=g.service)==null?void 0:ne.service_id)||null,B=((be=g.product)==null?void 0:be.name)||"",re=((q=g.service)==null?void 0:q.name)||"";return{category_id:C,product_id:N,service_id:H,product_name:B,service_name:re,description:g.description||null,price:g.price,quantity:g.quantity,item_Total:g.price*g.quantity,showDescription:!!g.description}}),total:(P.sub_total||0)+(P.express_delivery_charges||0)+(P.normal_delivery_charges||0),branch_id:P.branch_id,order_status:P.order_status};T(l),Je(l)}},[P]),b.useEffect(()=>{const a=(n.paid_amount||0)+(n.kasar_amount||0),l=n.total-a;let g=n.payment_status;n.total>0&&a===n.total?(g=2,ke(0)):a>0&&a<n.total?(g=3,ke(l)):a===0&&n.total>0&&(g=1,ke(l)),T(C=>({...C,payment_status:g}))},[n.paid_amount,n.kasar_amount,n.total]);const Xe=async a=>{a.preventDefault();try{const l=n.items.map(B=>({category_id:Number(B.category_id),product_id:Number(B.product_id),service_id:Number(B.service_id),description:B.description,price:Number(B.price),quantity:Number(B.quantity)})),g={...n,address_id:Number(n.address_id),coupon_discount:Number(n.coupon_discount),normal_delivery_charges:Number(n.normal_delivery_charges),kasar_amount:Number(n.kasar_amount),paid_amount:Number(n.paid_amount),express_delivery_charges:Number(n.express_delivery_charges),payment_type:Number(n.payment_type),payment_status:Number(n.payment_status),order_status:p?n.order_status:4,items:l},C=n.total;if(await Ht.validate(g,{abortEarly:!1,context:{total:C}}),!Object.keys(n).some(B=>n[B]!==We[B])){fe(`${ce}`);return}let H;P?H=await v(p,g):H=await z(g),H&&fe(`${ce}`)}catch(l){if(l instanceof Ie){const g={};l.inner.forEach(C=>{g[C.path||""]=C.message}),Qe(g)}else I.error("Failed to submit the form. Please try again.")}},Ye=a=>{i(a.target.value),w(!0)},Ze=a=>{const l=`${a.first_name} ${a.last_name}`;i(l),w(!1),T({...n,username:l,user_id:a.user_id})},et=()=>{fe(`${ce}`)},tt=()=>{T(a=>({...a,items:[...a.items,{category_id:null,product_id:null,product_name:"",service_id:null,service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}]}))},at=a=>{T(l=>{const g=l.items.filter((B,re)=>re!==a),C={...l,items:g,coupon_code:"",coupon_discount:0},N=Ce(C),H=N+Number(n.express_delivery_charges||0)+Number(n.normal_delivery_charges||0);return{...C,sub_total:N,total:H}})},Z=async(a,l,g)=>{["category_id","product_id","service_id","price","quantity"].includes(l)&&T(C=>({...C,coupon_code:"",coupon_discount:0})),T(C=>{const N=C.items.map((ne,be)=>{if(be===a){const q={...ne,[l]:g};l==="showDescription"&&(q.showDescription=g);const qe=Number(q.category_id),$e=Number(q.product_id),Le=Number(q.service_id),Re=Number(q.quantity)||1;if(l==="category_id"){const Y=Number(g);F[Y]||x(Y).then(ye=>{V(_e=>({..._e,[Y]:ye}))}),q.product_id=null,q.service_id=null}if(l==="product_id"){const Y=Number(ne.category_id),ye=Number(g),_e=`${Y}_${ye}`;X[_e]||o(Y,ye).then(gt=>{he(ht=>({...ht,[_e]:gt}))}),q.service_id=null}if(["category_id","product_id","service_id"].includes(l))if(qe&&$e&&Le){const Y=st(qe,$e,Le);q.price=Y,q.item_Total=Y*Re}else q.price=null,q.item_Total=null;else l==="price"?q.item_Total=g*Re:l==="quantity"&&(q.item_Total=q.price*Number(g));return q}return ne}),H={...C,items:N},re=Ce(H)-C.coupon_discount,xe=re+Number(C.express_delivery_charges||0)+Number(C.normal_delivery_charges||0);return{...H,sub_total:re,total:xe}})},st=(a,l,g)=>{const C=`${a}_${l}_${g}`;return d[C]||0},rt=async a=>{const l=Ce(n),g=await le(n.user_id,l,a),C=Number(g.finalTotal||0)+Number(n.express_delivery_charges||0)+Number(n.normal_delivery_charges||0);g&&T(N=>({...N,coupon_code:a,coupon_discount:g.discountAmount,sub_total:g.finalTotal,total:C}))},Ce=a=>a.items.reduce((l,g)=>l+(g.item_Total||0),0),Fe=(a,l)=>{T(g=>{const C={...g,[a]:l},N=Number(C.sub_total||0)+Number(C.express_delivery_charges||0)+Number(C.normal_delivery_charges||0);return{...C,total:N}})},nt=a=>{const l=a.target.value;T(g=>({...g,address_id:Number(l)}))},ot=a=>{a.preventDefault(),n.user_id?f(!0):I.error("Please select the user to add address")},lt=a=>{a.preventDefault(),m(!0)},it=()=>{fe(`/order/${p}`)},dt=async()=>{const a=[];if(n.total||a.push("item total"),n.username||a.push("customer name"),a.length>0){I.error(`Please add required fields: ${a.join(", ")}`);return}const l={amount:n.total,currency:"INR",user_id:n.user_id,customer:{name:n.username,contact:Q==null?void 0:Q.mobile_number,email:Q==null?void 0:Q.email}};await ge(l)},ct=(a,l)=>{if(a){const g=`${a.first_name} ${a.last_name}`;i(g),w(!1),T({...n,username:g,user_id:a.user_id})}l&&T(g=>({...g,address_id:l.address_id}))},ut=a=>{a&&T(l=>({...l,address_id:a.address_id}))},mt=()=>(n==null?void 0:n.items[0].item_Total)>0?n.items.length:0,pt=()=>(n==null?void 0:n.items[0].item_Total)>0?n==null?void 0:n.items.reduce((a,l)=>a+=Number(l.quantity),0):0;return e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"card max-w-5xl mx-auto p-6 bg-white shadow-md",children:[e.jsxs("div",{className:"flex",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:P?"Edit Order":"Add Order"}),!isNaN(p)&&e.jsxs("button",{className:"btn bg-gray-200 ml-4 text-gray-700 text-sm font-bold rounded-md",onClick:it,children:[e.jsx(kt,{size:20}),"View Order"]})]}),e.jsxs("form",{onSubmit:Xe,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-y-1 gap-x-6 mt-4",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"branch",className:"block text-gray-700 text-sm font-bold mb-2",children:"Branch"}),e.jsxs("select",{id:"branch",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n.branch_id||"",onChange:a=>T({...n,branch_id:a.target.value?Number(a.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch"}),R.length>0?R.map(a=>e.jsx("option",{value:a.branch_id,children:a.branch_name},a.branch_id)):e.jsx("option",{children:"No Data Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.branch_id||" "})]}),e.jsx("div",{}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer name"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6 sm:btn-lg",onClick:lt,children:"Add Customer"})]}),e.jsx("input",{type:"text",id:"username",ref:ae,autoComplete:"off",value:u||"",onChange:Ye,className:"input border border-gray-300 rounded-md p-2 w-full mb-2",placeholder:"Search customer...",onFocus:()=>{Te(!0),w(!0)}}),$&&k&&e.jsx("ul",{ref:Se,className:"absolute -mt-2 bg-white border z-10 border-gray-300 rounded-md p-2 w-full text-sm max-h-[400px] overflow-y-auto",children:$.length>0?$.map(a=>e.jsxs("li",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>Ze(a),children:[a.first_name," ",a.last_name," (",a.mobile_number,")"]},a.user_id)):e.jsx("li",{className:"p-2 text-gray-500",children:"No users found"})}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.username||" "})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"address",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer address"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6",onClick:ot,children:"Add address"})]}),e.jsxs("select",{id:"address",value:n.address_id??"",defaultValue:"",onChange:nt,className:"select border border-gray-300 rounded-md w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Address"}),G.length>0?G.map(a=>e.jsxs("option",{value:a.address_id,children:[a.building_number,", ",a.area,", ",a.landmark,","," ",a.city,", ",a.state,",",a.country,", ",a.pincode]},a.address_id)):e.jsx("option",{disabled:!0,children:"No Address Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.address_id||" "})]})]}),e.jsx("div",{className:"flex flex-wrap",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900 mt-6 mb-5 ml-1",children:"Item"})}),n.items.map((a,l)=>{var g,C;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border border-gray-200 rounded-xl mt-4 p-4 space-y-2",children:[e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-[minmax(150px,1fr)_minmax(150px,1fr)_minmax(150px,1fr)_minmax(50px,1fr)_minmax(50px,1fr)_minmax(50px,1fr)_minmax(35px,1fr)] gap-x-5 gap-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-gray-700 text-sm font-bold mb-2",children:"Category"}),e.jsxs("select",{id:"category",value:a.category_id??"",onChange:N=>Z(l,"category_id",N.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Category"}),_?e.jsx(e.Fragment,{children:e.jsx("option",{children:"Loading..."})}):c.length>0?c.map(N=>e.jsx("option",{value:N.category_id,children:N.name},N.category_id)):e.jsx("option",{children:"No Category Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L[`items[${l}].category_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"product",className:"block text-gray-700 text-sm font-bold mb-2",children:"Product"}),e.jsxs("select",{id:"product",value:a.product_id??"",onChange:N=>Z(l,"product_id",N.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Product"}),a.category_id?y?e.jsx("option",{children:"Loading..."}):((g=F[a.category_id])==null?void 0:g.length)>0?F[a.category_id].map(N=>e.jsx("option",{value:N.product_product_id,children:N.product_name},N.product_product_id)):a.product_id?e.jsx("option",{value:a.product_id,children:a.product_name},a.product_id):e.jsx("option",{children:"No Product Available"}):e.jsx("option",{disabled:!0,children:"Please select a category"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L[`items[${l}].product_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"service",className:"block text-gray-700 text-sm font-bold mb-2",children:"Service"}),e.jsxs("select",{id:"service",value:a.service_id??"",onChange:N=>Z(l,"service_id",N.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Service"}),a.product_id?h?e.jsx("option",{children:"Loading..."}):((C=X[`${a.category_id}_${a.product_id}`])==null?void 0:C.length)>0?X[`${a.category_id}_${a.product_id}`].map(N=>e.jsx("option",{value:N.service_service_id,children:N.service_name},N.service_service_id)):a.service_id?e.jsx("option",{value:a.service_id,children:a.service_name},a.service_id):e.jsx("option",{children:"No service available"}):e.jsx("option",{disabled:!0,children:"Please select a product"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L[`items[${l}].service_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Price"}),e.jsx("input",{type:"text",value:a.price||"",onChange:N=>Z(l,"price",N.target.value),className:`input border rounded-md p-2 w-full ${isNaN(p)?"border-gray-300 bg-gray-100 text-sm text-gray-600 cursor-not-allowed focus:outline-none":"border-gray-300"}`,readOnly:isNaN(p)}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L[`items[${l}].price`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"quantity",children:"Quantity"}),e.jsx("input",{type:"text",id:"quantity",autoComplete:"off",value:a.quantity??1,onChange:N=>Z(l,"quantity",N.target.value),className:"input border border-gray-300 rounded-md p-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Item total"}),e.jsx("input",{type:"text",value:a.item_Total??"",onChange:N=>Z(l,"item_Total",N.target.value),min:"0",step:"0.01",readOnly:!0,className:"input w-full border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"description_checkbox",className:"block text-gray-700 text-sm font-bold mb-2",children:"Remarks"}),e.jsx("div",{className:"h-full flex items-center",children:e.jsx("input",{className:"checkbox checkbox-lg ml-5",id:"description_checkbox","data-datatable-check":"true",type:"checkbox",checked:a.showDescription,onChange:N=>Z(l,"showDescription",N.target.checked)})})]})]})},l),e.jsxs("div",{className:"flex justify-between sm:items-center smmobile:flex-col gap-y-2 smmobile:w-full",children:[e.jsx("div",{children:a.showDescription&&e.jsx("div",{children:e.jsxs("div",{className:"flex mt-2 smmobile:w-[100%] smmobile:justify-self-start flex-col md:w-[350px] lg:w-[420px] sm:w-[300px] h-[80px] mb-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Description"}),e.jsx("textarea",{id:"description",value:a.description||"",onChange:N=>Z(l,"description",N.target.value),className:"h-full input border border-gray-300 rounded-md p-2 w-full"})]})})}),e.jsx("div",{className:"flex block-element flex-end smmobile:justify-self-end justify-end relative",children:e.jsx("div",{children:e.jsx("button",{type:"button",className:`p-2 rounded-full ${n.items.length>1?"bg-red-100 hover:bg-red-200":"bg-gray-200 cursor-not-allowed"}`,onClick:()=>at(l),disabled:n.items.length===1,children:e.jsx(Ct,{className:`${n.items.length>1?"text-red-500":"text-gray-400"}`})})})})]})]})})}),e.jsxs("div",{className:"flex items-center justify-start gap-12 flex-wrap",children:[e.jsx("button",{type:"button",onClick:tt,className:"btn btn-secondary mb-6 mt-4",children:"Add Item"}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Items : ",mt()]}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Quantity : ",pt()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"coupon_code",children:"Coupon Code"}),e.jsxs("select",{id:"coupon_code",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n.coupon_code??"",onChange:a=>{const l=U.find(g=>g.code===a.target.value);rt(l==null?void 0:l.code)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Coupon Code"}),U&&U.length>0?U.map(a=>e.jsx("option",{value:a.code,children:a.code},a.coupon_id)):e.jsx("option",{children:"No Coupons available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:L.coupon_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Coupon Discount"}),e.jsx("input",{type:"text",value:n.coupon_discount||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.coupon_discount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Sub Total"}),e.jsx("input",{type:"text",value:n.sub_total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.sub_total||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"kasar_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Kasar amount"}),e.jsx("input",{type:"text",id:"kasar_amount",autoComplete:"off",value:n.kasar_amount||"",onChange:a=>{T({...n,kasar_amount:Number(a.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"col-span-2 grid grid-cols-4 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"delivery_by",className:"block text-gray-700 text-sm font-bold mb-2",children:"Delivery By"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"delivery_by",value:n.delivery_by||"",onChange:a=>{T({...n,delivery_by:Number(a.target.value)})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Delivery By"}),e.jsx("option",{value:1,children:"Home"}),e.jsx("option",{value:2,children:"Shop"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"exp_delivery_time",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Time"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"exp_delivery_time",value:n.express_delivery_hour||"",onChange:a=>{T({...n,express_delivery_hour:Number(a.target.value)})},children:[e.jsx("option",{value:"",children:"Select Express Delivery Time"}),e.jsx("option",{value:24,children:"24 Hrs"}),e.jsx("option",{value:48,children:"48 Hrs"}),e.jsx("option",{value:72,children:"72 Hrs"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"express_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Charge"}),e.jsx("input",{type:"text",id:"express_delivery_charges",autoComplete:"off",min:"0",value:n.express_delivery_charges||"",onChange:a=>Fe("express_delivery_charges",a.target.value),className:`${n.normal_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:n.normal_delivery_charges>0}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.express_delivery_charges||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"normal_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Normal Delivery Charge"}),e.jsx("input",{type:"text",id:"normal_delivery_charges",min:"0",autoComplete:"off",value:n.normal_delivery_charges||"",onChange:a=>Fe("normal_delivery_charges",a.target.value),className:`${n.express_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:n.express_delivery_charges>0}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.normal_delivery_charges||" "})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Total"}),e.jsx("input",{type:"text",value:n.total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Method"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_method",value:n.payment_type??"",onChange:a=>T({...n,payment_type:Number(a.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Type"}),e.jsx("option",{value:1,children:"Cash on Delivery"}),e.jsx("option",{value:2,children:"Online Payment"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.payment_type||" "}),!p&&n.payment_type===2&&e.jsx("div",{children:e.jsxs("button",{type:"button",className:"relative min-w-[160px] min-h-[40px] flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 border border-blue-500 rounded-lg hover:bg-blue-100 transition disabled:opacity-50",onClick:dt,disabled:te,children:[e.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:te?e.jsx(At,{}):e.jsx(Pt,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{children:"Send Payment Link"})]})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"paid_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Paid amount"}),e.jsx("input",{type:"text",id:"paid_amount",autoComplete:"off",value:n.paid_amount||"",onChange:a=>{T({...n,paid_amount:Number(a.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.paid_amount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_status",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Status"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_status",value:n.payment_status??"",onChange:a=>T({...n,payment_status:Number(a.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Status"}),e.jsx("option",{value:1,children:"Pending"}),e.jsx("option",{value:2,children:"Received"}),e.jsx("option",{value:3,children:"Partial Received"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:L.payment_status}),n.payment_status===2&&Ee>0&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:`Remaining amount Rs ${Ee}`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"transaction_id",className:"block text-gray-700 text-sm font-bold mb-2",children:"Transaction ID"}),e.jsx("input",{type:"text",id:"transaction_id",autoComplete:"off",value:n.transaction_id??"",onChange:a=>T({...n,transaction_id:a.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${j||O?"opacity-50 cursor-not-allowed":""}`,disabled:j||O,children:j||O?j?"Adding...":"Updating...":p?"Update Order":"Add Order"}),e.jsx("button",{type:"button",onClick:et,className:"btn btn-secondary",disabled:j||O,children:"Cancel"})]})]}),e.jsx(Zt,{onAddressAdded:ut,isOpen:s,setIsSubmit:E,onClose:()=>f(!1),userId:n.user_id,fullname:n.username}),e.jsx(ea,{onCustomerCreated:ct,isOpen:r,setIsSubmit:E,onClose:()=>m(!1)})]})})};export{la as default};
