import{r,_ as S,u as R,j as e,F as U,b as z,d as M,e as G,c as H,a as P,f as O,aP as V,V as $}from"./index-ekHY3xQj.js";import{T as W,S as _}from"./TableShimmer-BaU0WSyA.js";import{F as A,a as D,s as Y}from"./searchSchema-BZfm46a9.js";import{B as Z}from"./enums-tzNm48ue.js";const J="http://35.154.167.170:3000/admin/banners",K=(l=1,t=10,o="",u,f)=>{const[a,m]=r.useState([]),[n,h]=r.useState(0),[j,s]=r.useState(!1),i=async()=>{var y,w;const k=localStorage.getItem("authToken"),c=new URLSearchParams;l&&c.append("page_number",l.toString()),t&&c.append("per_page",t.toString()),o&&c.append("search",o),u&&c.append("sort_by",u),f&&c.append("order",f),s(!0);try{const b=await fetch(`${J}?${c}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`}}),p=await b.json();if(!b.ok){S.error(p.message,{position:"top-center"});return}m(((y=p==null?void 0:p.data)==null?void 0:y.banner)||[]),h(((w=p==null?void 0:p.data)==null?void 0:w.count)||0)}catch(b){S.error((b==null?void 0:b.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{s(!1)}};return r.useEffect(()=>{i()},[l,t,o,u,f]),{banners:a,totalBanners:n,loading:j,fetchBanners:i}},Q=()=>{const[l,t]=r.useState(!1),[o,u]=r.useState(null);return{banner:o,loading:l,fetchBanner:async a=>{var h;if(!a){u(null);return}const m=localStorage.getItem("authToken"),n=`http://35.154.167.170:3000/admin/banners/${a}`;t(!0);try{const j=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}});if(!j.ok){const i=await j.json();S.error(i.message,{position:"top-center"}),t(!1);return}const s=await j.json();u((h=s==null?void 0:s.data)==null?void 0:h.banner)}catch{S.error("Network error: Failed to fetch.")}finally{t(!1)}}}},X="http://35.154.167.170:3000/admin/banners",ee=()=>{const[l,t]=r.useState(!1);return{addBanner:async u=>{const f=localStorage.getItem("authToken");t(!0);try{const a=await fetch(X,{method:"POST",headers:{Authorization:`Bearer ${f}`},body:u});if(!a.ok){const n=await a.json();return S.error(n.message,{position:"top-center"}),!1}const m=await a.json();return S.success(m.message,{position:"top-center"}),!0}catch(a){return S.error((a==null?void 0:a.message)||"Error adding banner",{position:"top-center"}),!1}finally{t(!1)}},loading:l}},te=()=>{const[l,t]=r.useState(!1);return{deleteBanner:async u=>{t(!0);const f=`http://35.154.167.170:3000/admin/banners/${u}`,a=localStorage.getItem("authToken");try{const m=await fetch(f,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),n=await m.json();return m.ok?{success:!0,message:n.message}:(S.error(n.message,{position:"top-center"}),{success:!1,message:n.message})}catch(m){return{success:!1,message:m.message}}finally{t(!1)}},loading:l}},ae=()=>{const[l,t]=r.useState(!1);return{updateBanner:async(u,f)=>{const a=localStorage.getItem("authToken"),m=`http://35.154.167.170:3000/admin/banners/${u}`;t(!0);try{const n=await fetch(m,{method:"PUT",headers:{Authorization:`Bearer ${a}`},body:f});if(n.ok){const h=await n.json();return S.success(h.message,{position:"top-center"}),!0}else{const h=await n.json();return S.error(h.message,{position:"top-center"}),!1}}catch(n){return S.error(n.message,{position:"top-center"}),!1}finally{t(!1)}},loading:l}},se=({search:l,setEditBanner:t,isSubmit:o,setIsSubmit:u})=>{const{deleteBanner:f}=te(),[a,m]=r.useState(1),[n,h]=r.useState(10),[j,s]=R(),[i,k]=r.useState(null),[c,y]=r.useState(null),w=j.get("page"),b=j.get("perPage"),{banners:p,fetchBanners:g,totalBanners:N,loading:C}=K(a,n,l,i,c),x=Math.ceil(N/n);r.useEffect(()=>{(async()=>{o&&(g(),u(!1))})()},[o]),r.useEffect(()=>{w&&m(Number(w)),b&&h(Number(b))},[w,b]),r.useEffect(()=>{l&&(m(1),s({search:l,page:"1",perPage:n.toString()}))},[l]);const B=async d=>{try{const{isConfirmed:v}=await _.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(v){const{success:I,message:F}=await f(d);I?(p.filter(q=>q.banner_id!==d).length===0&&a>1&&(m(a-1),s({page:(a-1).toString(),perPage:n.toString()})),await g(),_.fire(F)):_.fire(F)}}catch(v){_.fire({title:"Error",text:v.message,icon:"error"})}},E=d=>{i===d?y(c==="ASC"?"DESC":"ASC"):(k(d),y("ASC"))},T=d=>{d>=1&&d<=x&&(m(d),s({page:d.toString(),perPage:n.toString()}))},L=d=>{const v=Number(d.target.value);h(v),m(1),s({page:"1",perPage:v.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:n,onChange:L,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>E("banner_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(A,{color:i==="banner_id"&&c==="ASC"?"gray":"lightgray"}),e.jsx(D,{color:i==="banner_id"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between",children:["Image",e.jsx("div",{className:"flex "})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>E("title"),children:["Title",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(A,{color:i==="title"&&c==="ASC"?"gray":"lightgray"}),e.jsx(D,{color:i==="title"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[205px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>E("description"),children:["Description",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(A,{color:i==="description"&&c==="ASC"?"gray":"lightgray"}),e.jsx(D,{color:i==="description"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"w-[160px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>E("banner_type"),children:["Banner type",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(A,{color:i==="banner_type"&&c==="ASC"?"gray":"lightgray"}),e.jsx(D,{color:i==="banner_type"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"w-[125px]",children:"Actions"})]})}),C?e.jsx(W,{}):p.length>0?e.jsx("tbody",{children:p.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:d.banner_id}),e.jsx("td",{children:e.jsx("img",{className:"rounded-lg size-20 shrink-0",src:d.image})}),e.jsx("td",{children:d.title}),e.jsx("td",{className:"max-w-[105px] break-words overflow-hidden",children:d.description}),e.jsx("td",{children:Z[d.banner_type]}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>t(d.banner_id),children:e.jsx(U,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>B(d.banner_id),children:e.jsx(z,{className:"text-red-500"})})]})]},d.banner_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No banners available"})})})]})})})})}),N>n&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",p.length," of ",N," Branches"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:a===1,onClick:()=>T(a-1),className:`btn ${a===1?"disabled":""}`,children:e.jsx(M,{})}),Array.from({length:x}).map((d,v)=>e.jsx("button",{className:`btn ${a===v+1?"active":""}`,onClick:()=>T(v+1),children:v+1},v)),e.jsx("button",{disabled:a===x,onClick:()=>T(a+1),className:`btn ${a===x?"disabled":""}`,children:e.jsx(G,{})})]})]})]})},ne=l=>H().shape({title:P().required("Title is required").test("required","Title is required",t=>!!t).max(50,"Max title length exceeded by 50 characters"),description:P().required("Description is required").test("required","Description is required",t=>!!t).max(255,"Max description length exceeded by 255 characters"),image:O().test("required","Image is required",function(t){return l?!0:t instanceof File}).test("fileSize","File is too large",t=>t&&t instanceof File?t.size<=2*1024*1024:!0).test("fileType","Unsupported file format",t=>t&&t instanceof File?["image/jpeg","image/png","image/jpg"].includes(t.type):!0).nullable(),banner_type:V().required("Please select banner type")}),re=({isOpen:l,onClose:t,banner_id:o,setIsSubmit:u})=>{const{addBanner:f,loading:a}=ee(),{updateBanner:m,loading:n}=ae(),{banner:h,fetchBanner:j}=Q(),[s,i]=r.useState({title:"",description:"",image:"",banner_type:null}),[k,c]=r.useState({title:"",description:"",image:"",banner_type:null}),[y,w]=r.useState({});r.useEffect(()=>{l&&o&&j(o)},[l,o]),r.useEffect(()=>{if(l&&h&&o){const g={title:h.title,description:h.description,image:h.image,banner_type:h.banner_type};i(g),c(g)}else i({title:"",description:"",image:"",banner_type:null}),c({title:"",description:"",image:"",banner_type:null}),w({})},[l,h,o]);const b=g=>{const N=g.target;if(N instanceof HTMLInputElement){const{name:C,value:x,files:B}=N;C==="image"&&B&&B.length>0?i(E=>({...E,image:B[0]})):i(E=>({...E,[C]:x}))}else if(N instanceof HTMLTextAreaElement){const{name:C,value:x}=N;i(B=>({...B,[C]:x}))}},p=async g=>{g.preventDefault();try{if(await ne(!!o).validate(s,{abortEarly:!1}),!Object.keys(s).some(B=>B==="image"?s.image instanceof File||s.image!==k.image:s[B]!==k[B])){t();return}const x=new FormData;x.append("title",s.title),x.append("description",s.description),s.image instanceof File&&x.append("image",s.image),x.append("banner_type",s.banner_type),o?(await m(o,x),u(!0)):(await f(x),u(!0)),t()}catch(N){if(N instanceof $){const C={};N.inner.forEach(x=>{C[x.path||""]=x.message}),w(C)}else S.error("Failed to submit the form. Please try again.")}};return l?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:t}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96 z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0  mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:t,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:o?"Edit Banner":"Add Banner"}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"title",children:"Title"}),e.jsx("input",{type:"text",id:"title",name:"title",value:s.title,onChange:b,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:y.title||" "})]}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:s.description,onChange:b,className:"h-20 input border border-gray-300 rounded-md p-2",rows:5}),e.jsx("p",{className:"text-red-500 text-sm",children:y.description||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"image",children:"Image"}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:b,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:y.image?y.image:" "})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",children:"Banner type"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"banner_type",value:1,checked:s.banner_type===1,onChange:g=>i({...s,banner_type:parseInt(g.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Website"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"banner_type",value:2,checked:s.banner_type===2,onChange:g=>i({...s,banner_type:parseInt(g.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"App"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"banner_type",value:3,checked:s.banner_type===3,onChange:g=>i({...s,banner_type:parseInt(g.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Both"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:y.banner_type||" "})]})}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${a||n?"opacity-50 cursor-not-allowed":""}`,disabled:a||n,children:a||n?a?"Adding...":"Updating...":o?"Update Banner":"Add Banner"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:t,disabled:a||n,children:"Cancel"})]})]})]})]}):null},me=()=>{const[l,t]=r.useState(""),[o,u]=r.useState(""),[f,a]=r.useState(!1),[m,n]=r.useState(null),[h,j]=r.useState(!1),[s,i]=r.useState(!1),[k,c]=r.useState(""),y=async p=>{p.preventDefault();try{await Y.validate({search:o},{abortEarly:!1}),t(o),c("")}catch(g){g instanceof $&&c(g.errors[0])}},w=()=>{j(!1),a(!0),n(null)},b=p=>{j(!0),n(p),a(!0)};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Banners"}),e.jsxs("button",{onClick:w,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Banner"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:y,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:o,onChange:p=>{u(p.target.value),p.target.value===""&&t("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-primary focus:bg-white border-primary",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:k||" "})]}),e.jsx(se,{search:l,isSubmit:s,setIsSubmit:i,setEditBanner:b}),e.jsx(re,{setIsSubmit:i,isOpen:f,onClose:()=>a(!1),banner_id:m})]})};export{me as default};
