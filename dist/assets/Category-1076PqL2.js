import{r as a,c as k,V as p,j as e,a as Z,b as G,d as ee,G as O,u as te,e as R,F as ae,f as se,g as re,h as ne}from"./index-BGk8LBca.js";import{S as E}from"./sweetalert2.esm.all-B0Dix5B2.js";import{u as oe}from"./useGetCategories-DwR-9od6.js";import{s as ce}from"./searchSchema-DFHn0uxn.js";import{T as le}from"./TableShimmer-DRInDMOW.js";const ie="http://35.154.167.170:3000/admin/categories",de=()=>{const[n,c]=a.useState(!1);return{addCategory:async m=>{const s=localStorage.getItem("authToken");c(!0);try{const o=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},body:JSON.stringify({name:m})});if(!o.ok){const u=(await o.json()).message||"Failed to add category.";return k.error(u,{position:"top-center"}),{success:!1}}const r=await o.json();return k.success(r.message||"Category added successfully!",{position:"top-center"}),{success:!0}}catch(o){return o.name==="TypeError"&&o.message.includes("Failed to fetch")?k.error("Network error: Failed to fetch.",{position:"top-center"}):k.error("An unexpected error occurred.",{position:"top-center"}),{success:!1}}finally{c(!1)}},loading:n}},me=n=>{const[c,l]=a.useState(!1),[m,s]=a.useState([]);return a.useEffect(()=>{(async()=>{var u;if(!n){s(null);return}const r=localStorage.getItem("authToken"),d=`http://35.154.167.170:3000/admin/categories/${n}`;l(!0);try{const h=await fetch(d,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});if(!h.ok){const f=await h.json();p.error(f.message,{position:"top-center"}),l(!1);return}const g=await h.json();s((u=g==null?void 0:g.data)==null?void 0:u.result)}catch(h){p.error((h==null?void 0:h.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{l(!1)}})()},[n]),{category:m,loading:c}},ue=()=>{const[n,c]=a.useState(!1),l=localStorage.getItem("authToken");return{deleteCategory:async s=>{c(!0);const o=`http://35.154.167.170:3000/admin/categories/${s}`;try{const r=await fetch(o,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}),d=await r.json();return r.ok?{success:!0,message:d.message}:(p.error(d.message,{position:"top-center"}),{success:!1,message:d.message})}catch(r){return p.error("An error occurred while deleting the category.",{position:"top-center"}),{success:!1,message:r.message}}finally{c(!1)}},loading:n}},he=()=>{const[n,c]=a.useState(!1);return{updateCategory:async(m,s)=>{c(!0);const o=`http://35.154.167.170:3000/admin/categories/${m}`;try{const r=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({name:s})});if(r.ok){const d=await r.json();return p.success(d.message,{position:"top-center"}),!0}else{const d=await r.json();return p.error(d.message,{position:"top-center"}),!1}}catch(r){return p.error(r.message,{position:"top-center"}),!1}finally{c(!1)}},loading:n}},ge=Z().shape({name:ee().required("Category name is required").max(30,"Maximum length of 30 characters exceeded")}),pe=({isOpen:n,onClose:c,setIsSubmit:l})=>{const{addCategory:m,loading:s}=de(),[o,r]=a.useState({name:""}),[d,u]=a.useState({});a.useEffect(()=>{n&&(r({name:""}),u({}))},[n]);const h=async g=>{g.preventDefault();try{await ge.validate(o,{abortEarly:!1}),await m(o.name),l(!0),c()}catch(f){if(f instanceof G){const j={};f.inner.forEach(x=>{x.path&&(j[x.path]=x.message)}),u(j)}else p.error("Failed to submit the form. Please try again.")}};return n&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:c}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg min-w-96 z-10 zx:min-w-[85%] relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:c,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add Category"}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:o.name,onChange:g=>r({...o,name:g.target.value}),className:"input border border-gray-300 rounded-md p-2",disabled:s}),e.jsx("p",{className:"text-red-500 text-sm",children:d.name||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${s?"opacity-50 cursor-not-allowed":""}`,disabled:s,children:s?"Adding...":"Add Category"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:c,disabled:s,children:"Cancel"})]})]})]})]})};function fe(n){return O({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M15.854 12.854c-0-0-0-0-0-0l-4.854-4.854 4.854-4.854c0-0 0-0 0-0 0.052-0.052 0.090-0.113 0.114-0.178 0.066-0.178 0.028-0.386-0.114-0.529l-2.293-2.293c-0.143-0.143-0.351-0.181-0.529-0.114-0.065 0.024-0.126 0.062-0.178 0.114 0 0-0 0-0 0l-4.854 4.854-4.854-4.854c-0-0-0-0-0-0-0.052-0.052-0.113-0.090-0.178-0.114-0.178-0.066-0.386-0.029-0.529 0.114l-2.293 2.293c-0.143 0.143-0.181 0.351-0.114 0.529 0.024 0.065 0.062 0.126 0.114 0.178 0 0 0 0 0 0l4.854 4.854-4.854 4.854c-0 0-0 0-0 0-0.052 0.052-0.090 0.113-0.114 0.178-0.066 0.178-0.029 0.386 0.114 0.529l2.293 2.293c0.143 0.143 0.351 0.181 0.529 0.114 0.065-0.024 0.126-0.062 0.178-0.114 0-0 0-0 0-0l4.854-4.854 4.854 4.854c0 0 0 0 0 0 0.052 0.052 0.113 0.090 0.178 0.114 0.178 0.066 0.386 0.029 0.529-0.114l2.293-2.293c0.143-0.143 0.181-0.351 0.114-0.529-0.024-0.065-0.062-0.126-0.114-0.178z"},child:[]}]})(n)}function xe(n){return O({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M13.5 2l-7.5 7.5-3.5-3.5-2.5 2.5 6 6 10-10z"},child:[]}]})(n)}const be=({isSubmit:n,setIsSubmit:c})=>{const[l,m]=a.useState(1),[s,o]=a.useState(10),[r,d]=a.useState(null),[u,h]=a.useState(),[g,f]=te(),j=g.get("page"),x=g.get("perPage"),[N,D]=a.useState(null),[S,A]=a.useState(""),[y,I]=a.useState(""),[_,U]=a.useState(""),[Y,z]=a.useState(""),{categories:P,totalCategories:T,fetchCategories:v,loading:q}=oe(l,s,y,r,u),{category:C}=me(N),{deleteCategory:V}=ue(),{updateCategory:J}=he(),{hasPermission:b}=R(),w=Math.ceil(T/s);a.useEffect(()=>{n&&(v(),c(!1))},[n,v]),a.useEffect(()=>{C&&A(C.name||"")},[C]);const K=t=>{D(t)},B=async()=>{if(S.trim()===""){p.error("Category name cannot be empty.",{position:"top-center"});return}if(C&&S===C.name){$();return}try{await J(N,S)&&($(),v())}catch{p.error("An error occurred while updating the category.",{position:"top-center"})}},$=()=>{D(null),A("")},H=async t=>{try{const{isConfirmed:i}=await E.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(i){const{success:X,message:M}=await V(t);X?(await v(),E.fire(M)):E.fire(M)}}catch(i){E.fire({title:"Error",text:i.message||"An unexpected error occurred",icon:"error"})}};a.useEffect(()=>{j&&m(Number(j)),x&&o(Number(x))},[j,x]),a.useEffect(()=>{y&&(m(1),f({search:y,page:"1",perPage:s.toString()}))},[y]);const Q=async t=>{t.preventDefault();try{await ce.validate({search:y},{abortEarly:!1}),I(_),z("")}catch(i){i instanceof G&&z(i.errors[0])}},L=t=>{r===t?h(u==="ASC"?"DESC":"ASC"):(d(t),h("ASC"))},F=t=>{t>=1&&t<=w&&(m(t),f({page:t.toString(),perPage:s.toString()}))},W=t=>{const i=Number(t.target.value);o(i),m(1),f({page:"1",perPage:i.toString()})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:s,onChange:W,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:Q,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:_,onChange:t=>{U(t.target.value),t.target.value===""&&I("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:Y||" "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[30px]",children:e.jsxs("span",{className:`sort ${r==="category_id"?u==="ASC"?"asc":"desc":""}`,onClick:()=>L("category_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[780px]",children:e.jsxs("span",{className:`sort ${r==="name"?u==="ASC"?"asc":"desc":""}`,onClick:()=>L("name"),children:[e.jsx("span",{className:"sort-label",children:"Category name"}),e.jsx("span",{className:"sort-icon"})]})}),(b(5,"update")||b(5,"delete"))&&e.jsx("th",{className:"min-w-[125px]",children:"Actions"})]})}),q?e.jsx(le,{}):P.length>0?e.jsx("tbody",{children:P.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:t.category_id})}),e.jsx("td",{children:N===t.category_id?e.jsx("input",{type:"text",className:"border border-gray-300 p-2 rounded-md focus:outline-none",value:S,onChange:i=>A(i.target.value),onKeyPress:i=>{i.key==="Enter"&&B()}}):t.name}),(b(5,"update")||b(5,"delete"))&&e.jsx("td",{children:N===t.category_id?b(5,"update")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:B,"aria-label":"Save",children:e.jsx(xe,{color:"green"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:$,"aria-label":"Cancel",children:e.jsx(fe,{color:"red"})})]}):e.jsxs(e.Fragment,{children:[b(5,"update")&&e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>K(t.category_id),"aria-label":"Edit",children:e.jsx(ae,{className:"text-yellow-600"})}),b(5,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>H(t.category_id),"aria-label":"Delete",children:e.jsx(se,{className:"text-red-500"})})]})})]},t.category_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Categories available"})})})]})}),T>s&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",P.length," of ",T," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:l===1,onClick:()=>F(l-1),className:`btn ${l===1?"disabled":""}`,children:e.jsx(re,{})}),Array.from({length:w}).map((t,i)=>e.jsx("button",{className:`btn ${l===i+1?"active":""}`,onClick:()=>F(i+1),children:i+1},i)),e.jsx("button",{disabled:l===w,onClick:()=>F(l+1),className:`btn ${l===w?"disabled":""}`,children:e.jsx(ne,{})})]})]})})]})})]})},ve=()=>{const[n,c]=a.useState(!1),[l,m]=a.useState(!1),[s,o]=a.useState(!1),{hasPermission:r}=R(),d=()=>{m(!1),c(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-7.5",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Category"})}),r(5,"create")&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{onClick:d,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Category"]})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(be,{isSubmit:s,setIsSubmit:o})})})}),e.jsx(pe,{setIsSubmit:o,isOpen:n,onClose:()=>c(!1)})]})};export{ve as default};
