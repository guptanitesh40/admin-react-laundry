import{r,V as D,i as O,k as G,j as a,D as A,l as L}from"./index-C4ewyZzy.js";import{M as b}from"./MultiSelect-DHCCc8pq.js";import{u as q}from"./useGetCompanies-DkD67MOs.js";import{u as Z}from"./useGetServices-BZEp3x2U.js";import"./orderStatusClasses-HfHBGnti.js";const F=(l,d="")=>{const[y,_]=r.useState(!1),[x,w]=r.useState([]);return r.useEffect(()=>{(async()=>{const N=localStorage.getItem("authToken"),k=`http://35.154.167.170:3000/user/by-role?role_id=${l}`,S=new URLSearchParams;d&&S.append("search",d),_(!0);try{const i=await fetch(`${k}&${S}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N}`}});if(!i.ok){const h=await i.json();D.error(h.message||"Failed to fetch users",{position:"top-center"});return}const u=await i.json();w((u==null?void 0:u.data)||[])}catch(i){D.error((i==null?void 0:i.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{_(!1)}})()},[l,d]),{users:x,loading:y}},{RangePicker:ee}=A,ae=({reportTitle:l,index:d,dynamic_url:y})=>{const[w,j]=r.useState(""),[N,k]=r.useState(""),S=O(),[i,u]=r.useState([]),[h,R]=r.useState([]),[f,I]=r.useState([]),[v,C]=r.useState([]),{users:M,loading:U}=F(5,w),{users:P,loading:$}=F(4,N),{companies:B,loading:E}=q(1,1e3),{branches:s,loading:c}=G(1,1e3,"","","",f),[n,m]=r.useState(!1),[p,Y]=r.useState({start_time:"",end_time:""}),z="http://35.154.167.170:3000",T=localStorage.getItem("authToken"),W=r.useMemo(()=>U?[{label:"Loading...",value:0}]:M.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[M,U]),H=r.useMemo(()=>l!=="Pick Up Report"&&l!=="Delivery Report"?[]:$?[{label:"Loading...",value:0}]:P.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[l,P,$]),J=r.useMemo(()=>E?[{label:"Loading...",value:0}]:B.map(e=>({label:e.company_name,value:e.company_id})),[B,E]),K=r.useMemo(()=>c?[{label:"Loading...",value:0}]:s.map(e=>({label:e.branch_name,value:e.branch_id})),[s,c]),Q=e=>{Y(e?{start_time:L(e[0]).format("DD-MM-YYYY"),end_time:L(e[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},X=e=>{switch(e){case 0:g();break;case 1:g();break;case 2:g();break;case 3:g();break;case 4:g();break;case 5:g();break;case 6:g();break;default:g()}},g=async()=>{m(!0);const e=new URLSearchParams;p.start_time&&p.end_time&&(e.append("startDate",p.start_time),e.append("endDate",p.end_time)),i.length&&i.forEach(t=>e.append("user_id",t)),h.length&&h.forEach(t=>e.append("driver_id",t)),f.length&&f.forEach(t=>e.append("company_id",t)),v.length&&v.forEach(t=>e.append("branch_id",t));try{const t=await fetch(`${z}/report/${y}?format=excel&${e}`,{headers:{Authorization:`Bearer ${T}`}}),o=await t.json();if(!t.ok)throw new Error(o.message||"Failed to download report");const V=o==null?void 0:o.url;if(!V){D.error("Download report not found");return}S("/report-preview",{state:{url:V,reportTitle:l,dynamic_url:y}})}catch(t){D.error(t.message||"Network error: Failed to download report")}finally{m(!1)}};return a.jsxs("div",{className:"card !shadow-black/10",children:[a.jsx("div",{className:"card-header",children:a.jsx("h3",{className:"card-title",children:l})}),a.jsxs("div",{className:"flex flex-col gap-3 card-body",children:[a.jsx("div",{children:a.jsx(ee,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:Q,format:"DD-MM-YYYY"})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:J,displayValue:"label",placeholder:"Select Company",selectedValues:f,onSelect:e=>{const t=e.map(o=>o.value);I(t)},onRemove:e=>{const t=e.map(o=>o.value);I(t)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:K,displayValue:"label",placeholder:"Select Branch",selectedValues:v,onSelect:e=>{const t=e.map(o=>o.value);C(t)},onRemove:e=>{const t=e.map(o=>o.value);C(t)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:W,displayValue:"label",placeholder:"Select Customer",selectedValues:i,onSelect:e=>{const t=e.map(o=>o.value);u(t)},onRemove:e=>{const t=e.map(o=>o.value);u(t)},setSearch:j,className:"w-full",isSearchInput:!0})}),(l==="Pick Up Report"||l==="Delivery Report")&&a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:H,defaultOption:"No Data Found",displayValue:"label",placeholder:l==="Pick Up Report"?"Select PickUp Boy":"Select Delivery Boy",selectedValues:h,onSelect:e=>{const t=e.map(o=>o.value);R(t)},onRemove:e=>{const t=e.map(o=>o.value);R(t)},setSearch:k,className:"w-full",isSearchInput:!0})})]}),a.jsx("div",{className:"card-footer",children:a.jsxs("button",{disabled:n,className:"relative inline-flex items-center justify-center w-full px-3 py-2 overflow-hidden btn btn-primary",onClick:()=>X(d),children:[n&&a.jsx("span",{className:"absolute inset-0 loading-bar"}),a.jsx("span",{children:n?"Downloading...":"Download"})]})})]},d)},{RangePicker:se}=A,te=({reportTitle:l,dynamic_url:d})=>{const[y,_]=r.useState([]),[x,w]=r.useState([]),[j,N]=r.useState([]),{companies:k,loading:S}=q(1,1e3),{branches:i,loading:u}=G(1,1e3,"","","",x),{services:h,loading:R}=Z(1,1e4),[f,I]=r.useState(!1),[v,C]=r.useState({start_time:"",end_time:""}),M=O(),U=r.useMemo(()=>S?[{label:"Loading...",value:0}]:k.map(s=>({label:s.company_name,value:s.company_id})),[k,S]),P=r.useMemo(()=>u?[{label:"Loading...",value:0}]:i.map(s=>({label:s.branch_name,value:s.branch_id})),[i,u]),$=r.useMemo(()=>R?[{label:"Loading...",value:0}]:h.map(s=>({label:`${s.name}`,value:s.service_id})),[h,R]),B=s=>{C(s?{start_time:L(s[0]).format("DD-MM-YYYY"),end_time:L(s[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},E=async()=>{const s="http://35.154.167.170:3000",c=localStorage.getItem("authToken");I(!0);const n=new URLSearchParams;v.start_time&&v.end_time&&(n.append("startDate",v.start_time),n.append("endDate",v.end_time)),x.length&&x.forEach(m=>n.append("company_id",m)),j.length&&j.forEach(m=>n.append("branch_id",m)),_.length&&y.forEach(m=>n.append("service_id",m));try{const m=await fetch(`${s}/report/${d}?format=excel&${n}`,{headers:{Authorization:`Bearer ${c}`}}),p=await m.json();if(!m.ok)throw new Error(p.message||"Failed to download report");const Y=p==null?void 0:p.url;if(!Y){D.error("Download report not found");return}M("/report-preview",{state:{url:Y,reportTitle:l,dynamic_url:d,query:n.toString()}})}catch(m){D.error(m.message||"Network error: Failed to download report")}finally{I(!1)}};return a.jsxs("div",{className:"card !shadow-black/10",children:[a.jsx("div",{className:"card-header",children:a.jsx("h3",{className:"card-title",children:l})}),a.jsxs("div",{className:"flex flex-col gap-3 card-body",children:[a.jsx("div",{children:a.jsx(se,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:B,format:"DD-MM-YYYY"})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:U,displayValue:"label",placeholder:"Select Company",selectedValues:x,onSelect:s=>{const c=s.map(n=>n.value);w(c)},onRemove:s=>{const c=s.map(n=>n.value);w(c)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:P,displayValue:"label",placeholder:"Select Branch",selectedValues:j,onSelect:s=>{const c=s.map(n=>n.value);N(c)},onRemove:s=>{const c=s.map(n=>n.value);N(c)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(b,{options:$,defaultOption:"No Data Found",displayValue:"label",placeholder:"Select Service",selectedValues:y,onSelect:s=>{const c=s.map(n=>n.value);_(c)},onRemove:s=>{const c=s.map(n=>n.value);_(c)},className:"w-full",isSearchInput:!0})})]}),a.jsx("div",{className:"card-footer",children:a.jsxs("button",{disabled:f,className:"relative inline-flex items-center justify-center w-full px-3 py-2 overflow-hidden btn btn-primary",onClick:E,children:[f&&a.jsx("span",{className:"absolute inset-0 loading-bar"}),a.jsx("span",{children:f?"Downloading...":"Download"})]})})]})},ne=[{name:"Total Order Report",dynamic_url:"total-orders"},{name:"Payment Transaction Report",dynamic_url:"payment-transaction"},{name:"Refund Report",dynamic_url:"refund-report"},{name:"In Active Customer Report",dynamic_url:"inactive-customer-report"},{name:"GST Report",dynamic_url:"gst"},{name:"Service Wise Report",dynamic_url:"service-wise-report"},{name:"Pick Up Report",dynamic_url:"pickup"},{name:"Delivery Report",dynamic_url:"delivery"}],de=()=>a.jsx("main",{className:"grow content",id:"content",role:"content",children:a.jsxs("div",{className:"container-fixed",children:[a.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:a.jsx("div",{className:"flex flex-col justify-center gap-2",children:a.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Reports"})})}),a.jsx("div",{className:"grid items-start grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:ne.map((l,d)=>l.name==="Service Wise Report"?a.jsx(te,{reportTitle:l.name,dynamic_url:l.dynamic_url},d):a.jsx(ae,{reportTitle:l.name,dynamic_url:l.dynamic_url,index:d},d))})]})});export{de as default};
