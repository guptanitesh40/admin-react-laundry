import{r as d,B as D,V as y,u as te,i as R,e as z,h as $,j as e,T as se,y as ae,F as re,Y as oe,f as ie,P as ne,s as le,b as ce,D as k,af as _,l as w}from"./index-DPF6S_1J.js";import{u as de,a as me}from"./useDeleteUser-Y1UTV2MN.js";import{u as he}from"./useRestoreUser-DHUnH3Lr.js";import{S as x}from"./sweetalert2.esm.all-B0Dix5B2.js";import{M as pe}from"./MultiSelect-DfDMSgFB.js";import"./orderStatusClasses-HfHBGnti.js";const ue=()=>{const[o,l]=d.useState(),[a,c]=d.useState(!1);return{customerActivityData:o,loading:a,fetchCustomerActivityData:async(h,i)=>{const m=localStorage.getItem("authToken"),s=new URLSearchParams;h&&s.append("startDate",h),i&&s.append("endDate",i),c(!0);try{const r=await fetch(`${D}/report/customer-activity?${s}`,{method:"GET",headers:{Authorization:`Bearer ${m}`}}),u=await r.json();if(!r.ok){y.error(u.message,{position:"top-center"}),c(!1);return}l(u)}catch{y.error("Network error: Failed to fetch customer activity data.")}finally{c(!1)}}}},xe=()=>{const[o,l]=d.useState(),[a,c]=d.useState(!1);return{customerData:o,loading:a,fetchNewCustomerData:async(h,i)=>{const m=localStorage.getItem("authToken"),s=new URLSearchParams;h&&s.append("startDate",h),i&&s.append("endDate",i),c(!0);try{const r=await fetch(`${D}/report/new-customer-acquisition-report?${s}`,{method:"GET",headers:{Authorization:`Bearer ${m}`}}),u=await r.json();if(!r.ok){y.error(u.message,{position:"top-center"}),c(!1);return}l(u)}catch{y.error("Network error: Failed to fetch customer data.")}finally{c(!1)}}}},fe=()=>{const[o,l]=d.useState(),[a,c]=d.useState(!1);return{customerData:o,loading:a,fetchInActiveCustomerData:async(h,i)=>{const m=localStorage.getItem("authToken"),s=new URLSearchParams;h&&s.append("startDate",h),i&&s.append("endDate",i),c(!0);try{const r=await fetch(`${D}/report/inactive-customer-report?${s}`,{method:"GET",headers:{Authorization:`Bearer ${m}`}}),u=await r.json();if(!r.ok){y.error(u.message,{position:"top-center"}),c(!1);return}l(u)}catch{y.error("Failed to fetch in active customer data.")}finally{c(!1)}}}},ge=()=>{const[o,l]=d.useState(1),[a,c]=d.useState(10),[p,h]=d.useState(null),[i,m]=d.useState(),[s,r]=te(),[u,P]=d.useState([]),v=s.get("page"),C=s.get("perPage"),[j,Y]=d.useState(""),[A,L]=d.useState(""),[U,M]=d.useState(""),B=R(),I=5,{users:f,loading:G,count:F,fetchUsers:E}=de(o,a,j,p,i,u,I),{restoreUser:O}=he(),{deleteUser:V}=me(),{hasPermission:g}=z(),W=Object.entries($).filter(([t,n])=>typeof n=="number").map(([t,n])=>({label:t,value:n})),q=Math.ceil(F/a);d.useEffect(()=>{v&&l(Number(v)),C&&c(Number(C))},[v,C]),d.useEffect(()=>{l(1),r(j!==""?{search:j,page:"1",perPage:a.toString()}:{})},[j]),d.useEffect(()=>{l(1),r(j!==""?{search:j,page:"1",perPage:a.toString()}:{})},[u]);const K=async t=>{t.preventDefault();try{await le.validate({search:j},{abortEarly:!1}),Y(A),M("")}catch(n){n instanceof ce&&M(n.errors[0])}},N=t=>{p===t?m(i==="ASC"?"DESC":"ASC"):(h(t),m("ASC"))},H=t=>{t>=1&&t<=q&&(l(t),r({page:t.toString(),perPage:a.toString()}))},J=t=>{const n=Number(t.target.value);c(n),l(1),r({page:"1",perPage:n.toString()})},T=async t=>{B(`/customer/${t}`)},Q=t=>{B(`/customer/edit/${t}`)},X=async t=>{try{const{isConfirmed:n}=await x.fire({title:"Are you sure?",text:"You want to delete this customer !",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete",cancelButtonText:"No, cancel"});if(n){const{success:S,message:b}=await V(t);S?(f.filter(ee=>ee.user_id!==t).length===0&&o>1&&(l(o-1),r({page:(o-1).toString(),perPage:a.toString()})),await E(),x.fire(b)):x.fire(b)}}catch(n){x.fire({title:"Error",text:n.message,icon:"error"})}},Z=async t=>{try{if((await x.fire({title:"Are you sure?",text:"You want to restore this customer ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore",cancelButtonText:"No, cancel"})).isConfirmed){x.fire({title:"Restoring Customer...",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{x.showLoading()}});const{success:S,message:b}=await O(t);await E(),S?x.fire("Restored!",b,"success"):x.fire("Failed",b,"error")}}catch(n){x.fire({title:"Error",text:n.message,icon:"error"})}};if(f)return G?e.jsx(se,{isFilters:!0,columns:7,records:10,isPagination:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:a,onChange:J,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(pe,{options:W,displayValue:"label",placeholder:"Select Gender",selectedValues:u,onSelect:t=>P(t.map(n=>n.value)),onRemove:t=>P(t.map(n=>n.value)),className:"lgscreen:min-w-[230px] mini:min-w-[250px]",sliceCount:2})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:K,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:A,onChange:t=>{L(t.target.value),t.target.value===""&&Y("")},placeholder:"Search...",className:"mini:min-w-[185px] lgscreen:min-w-[150px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:U||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[70px]",children:e.jsxs("span",{className:`sort ${p==="user_id"?i==="ASC"?"asc":"desc":""}`,onClick:()=>N("user_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${p==="first_name"?i==="ASC"?"asc":"desc":""}`,onClick:()=>N("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Full name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${p==="email"?i==="ASC"?"asc":"desc":""}`,onClick:()=>N("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[190px]",children:e.jsxs("span",{className:`sort ${p==="mobile_number"?i==="ASC"?"asc":"desc":""}`,onClick:()=>N("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile no"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[80px]",children:"Gender"}),e.jsx("th",{className:"min-w-[150px]",children:"Total Pending Amount"}),(g(8,"read")||g(8,"update")||g(8,"delete"))&&e.jsx("th",{className:"min-w-[180px]",children:"Actions"})]})}),f.length>0?e.jsx("tbody",{children:f==null?void 0:f.map(t=>{const n=!!(t!=null&&t.deleted_at);return e.jsxs("tr",{className:`${n?"text-red-500":""}`,children:[e.jsx("td",{className:`cursor-pointer hover:underline ${n?"text-red-500":"text-blue-600"}`,onClick:()=>T(t.user_id),children:e.jsx("div",{className:"flex items-center gap-2.5",children:t.user_id})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[t.first_name," ",t.last_name]})}),e.jsx("td",{children:t.email}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-1.5",children:t.mobile_number})}),e.jsx("td",{children:$[t.gender]}),e.jsx("td",{children:t.total_due_amount}),(g(8,"read")||g(8,"update")||g(8,"delete"))&&e.jsxs("td",{className:"space-x-3",children:[g(8,"read")&&e.jsx("button",{className:"bg-yellow-100 hover:bg-yellow-200 p-[9px] rounded-full",style:{marginBottom:"-30px"},onClick:()=>T(t.user_id),children:e.jsx(ae,{size:18,className:"text-gray-600"})}),g(8,"update")&&e.jsx("button",{disabled:n,className:`p-3 rounded-full transition-all duration-200 ${n?"bg-gray-200 text-gray-400 !cursor-not-allowed":"bg-yellow-100 hover:bg-yellow-200 text-yellow-600 hover:text-yellow-700"}`,onClick:()=>Q(t.user_id),children:e.jsx(re,{})}),g(8,"delete")&&(n?e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>Z(t==null?void 0:t.user_id),children:e.jsx(oe,{className:"text-red-500 h-4.5 w-4.5"})}):e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>X(t==null?void 0:t.user_id),children:e.jsx(ie,{className:"text-red-500"})}))]})]},t.user_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No customer available"})})})]})}),e.jsx(ne,{count:F,currentPage:o,totalRecords:f==null?void 0:f.length,perPage:a,onPageChange:H,label:"customers"})]})})]})},{RangePicker:je}=k,ye=()=>{const[o,l]=d.useState({start_time:"",end_time:""}),{customerActivityData:a,fetchCustomerActivityData:c}=ue();d.useEffect(()=>{o.start_time&&o.end_time?c(o.start_time,o.end_time):c()},[o]);const p=(s,r)=>{l(s?{start_time:w(s[0]).format("DD-MM-YYYY"),end_time:w(s[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},h=(a==null?void 0:a.map(s=>s.month.split("-")[0]))||[],i=(a==null?void 0:a.map(s=>s.login_count))||[],m={series:[{name:"Login Count",data:i}],options:{chart:{type:"area",height:240,toolbar:{show:!1}},dataLabels:{enabled:!1},colors:["#4154f1"],fill:{gradient:{enabled:!0,opacityFrom:.25,opacityTo:.1}},grid:{borderColor:"rgba(0, 0, 0, 0)",strokeDashArray:5,padding:{top:0,right:0,bottom:20,left:8}},stroke:{curve:"smooth",show:!0,width:3,colors:["#4154f1"]},legend:{show:!1},xaxis:{type:"category",categories:h,labels:{show:!0,style:{colors:"#6B7280",fontSize:"12px",fontWeight:500}},axisTicks:{show:!0,color:"#D1D5DB",height:6},axisBorder:{show:!0,color:"#D1D5DB"},crosshairs:{position:"front",stroke:{color:"#3B82F6",width:1,dashArray:3}}},markers:{size:(i==null?void 0:i.length)===1?3:0,colors:"#4154f1",strokeColors:"#4154f1",strokeWidth:4,hover:{size:5}},yaxis:{min:0,tickAmount:1,axisTicks:{show:!1},labels:{style:{colors:"var(--tw-gray-500)",fontSize:"12px"},formatter:s=>s>=1e3?`₹${(s/1e3).toFixed(0)}K`:s.toString()}},responsive:[{breakpoint:480,options:{legend:{position:"bottom"}}}],tooltip:{x:{format:"MMM yyyy"}}}};return e.jsxs("div",{className:"card w-full pb-2.5 max-h-[300px] rounded-md",children:[e.jsx("div",{className:"self-end p-3 sm:mt-0",children:e.jsx(je,{className:"min-w-[80px] sm:w-[250px]",popupClassName:"custom-rangepicker-dropdown",onChange:p,format:"DD-MM-YYYY"})}),e.jsx("div",{className:"flex justify-between ml-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"card-title text-lg",children:"Activity"}),e.jsx("span",{className:"text-gray-500 font-medium",children:"Customer Login Count"})]})}),e.jsx("div",{className:"card-body flex flex-col justify-end items-stretch grow px-0 py-1",children:e.jsx(_,{options:m.options,series:m.series,type:m.options.chart.type,height:200})})]})},{RangePicker:we}=k,be=()=>{const[o,l]=d.useState({start_time:"",end_time:""}),{customerData:a,fetchNewCustomerData:c}=xe();d.useEffect(()=>{o.start_time&&o.end_time?c(o.start_time,o.end_time):c()},[o]);const p=(r,u)=>{l(r?{start_time:w(r[0]).format("DD-MM-YYYY"),end_time:w(r[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},h=(a==null?void 0:a.map(r=>r.month.split("-")[0]))||[],i=(a==null?void 0:a.map(r=>r.customer_count))||[],m=a==null?void 0:a.reduce((r,u)=>r+Number(u.customer_count),0),s={series:[{name:"New Customer",data:i}],options:{chart:{fontFamily:"inherit",type:"bar",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"40%",borderRadius:5}},legend:{show:!1},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:"blue"},xaxis:{type:"category",categories:h,labels:{show:!0,style:{colors:"#6B7280",fontSize:"12px",fontWeight:500}},axisTicks:{show:!0,color:"#D1D5DB",height:6},axisBorder:{show:!0,color:"#D1D5DB"},crosshairs:{position:"front",stroke:{color:"#3B82F6",width:1,dashArray:3}}},yaxis:{min:0,tickAmount:5,axisTicks:{show:!1},labels:{style:{colors:"var(--tw-gray-500)",fontSize:"12px"},formatter:r=>r>=1e3?`₹${(r/1e3).toFixed(0)}K`:r.toString()}},fill:{opacity:1},states:{normal:{filter:{type:"none",value:0}},hover:{filter:{type:"none",value:0}},active:{allowMultipleDataPointsSelection:!1,filter:{type:"none",value:0}}},tooltip:{style:{fontSize:"12px"}},colors:["#ECE852"],grid:{strokeDashArray:4,yaxis:{lines:{show:!0}}}}};return e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"card w-full rounded-md",children:[e.jsx("div",{className:"self-end p-3 sm:mt-0",children:e.jsx(we,{className:"min-w-[80px] sm:w-[250px]",popupClassName:"custom-rangepicker-dropdown",onChange:p,format:"DD-MM-YYYY"})}),e.jsxs("div",{className:"card-header pt-0  border-none",children:[e.jsx("div",{className:"flex flex-col justify-between",children:e.jsx("h3",{className:"card-title",children:"New Customer"})}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"p-3 bg-red-50 rounded-md relative text-gray-500 semibold",children:["+",m]})})]}),e.jsx("div",{className:"card-body flex flex-col justify-end items-stretch grow px-0 py-1",children:e.jsx(_,{options:s.options,series:s.series,type:s.options.chart.type,height:163})})]})})},{RangePicker:Ne}=k,ve=()=>{const[o,l]=d.useState({start_time:"",end_time:""}),{customerData:a,fetchInActiveCustomerData:c}=fe();d.useEffect(()=>{o.start_time&&o.end_time?c(o.start_time,o.end_time):c()},[o]);const p=(s,r)=>{l(s?{start_time:w(s[0]).format("DD-MM-YYYY"),end_time:w(s[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},h=(a==null?void 0:a.map(s=>s.month.split("-")[0]))||[],i=(a==null?void 0:a.map(s=>s.not_active_count))||[],m={series:[{name:"No Active Customer",data:i}],options:{chart:{type:"area",height:200,toolbar:{show:!1}},dataLabels:{enabled:!1},colors:["#4154f1"],fill:{gradient:{enabled:!0,opacityFrom:.25,opacityTo:.1}},grid:{borderColor:"rgba(0, 0, 0, 0)",strokeDashArray:5,padding:{top:0,right:0,bottom:2,left:8}},stroke:{curve:"smooth",show:!0,width:3,colors:["#4154f1"]},legend:{show:!1},xaxis:{type:"category",categories:h,labels:{show:!0,style:{colors:"#6B7280",fontSize:"12px",fontWeight:500}},axisTicks:{show:!0,color:"#D1D5DB",height:6},axisBorder:{show:!0,color:"#D1D5DB"},crosshairs:{position:"front",stroke:{color:"#3B82F6",width:1,dashArray:3}}},markers:{size:(i==null?void 0:i.length)===1?3:0,colors:"#4154f1",strokeColors:"#4154f1",strokeWidth:4,hover:{size:5}},yaxis:{min:0,tickAmount:1,axisTicks:{show:!1},labels:{style:{colors:"var(--tw-gray-500)",fontSize:"12px"},formatter:s=>s>=1e3?`₹${(s/1e3).toFixed(0)}K`:s.toString()}},tooltip:{x:{format:"MMM yyyy"}}}};return e.jsxs("div",{className:"card w-full pb-2.5 max-h-[300px] rounded-md",children:[e.jsx("div",{className:"self-end p-3 sm:mt-0",children:e.jsx(Ne,{className:"min-w-[80px] sm:w-[250px]",popupClassName:"custom-rangepicker-dropdown",onChange:p,format:"DD-MM-YYYY"})}),e.jsx("div",{className:"flex justify-between ml-5",children:e.jsx("div",{children:e.jsx("h3",{className:"card-title text-lg",children:"In Active Customer"})})}),e.jsx("div",{className:"card-body flex flex-col justify-end items-stretch grow px-0 py-3",children:e.jsx(_,{options:m.options,series:m.series,type:m.options.chart.type,height:m.options.chart.height})})]})},Ae=()=>{const o=R(),{hasPermission:l}=z(),a=()=>{o("/customer/add")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-fixed grid xl:grid-cols-3 lg:grid-cols-2 md:grid-cols-1 sm:grid-cols-1 desktop:grid-cols-1 zx:grid-cols-1 pb-8 gap-x-4 gap-y-4",children:[e.jsx(ye,{}),e.jsx(be,{}),e.jsx(ve,{})]}),e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-4",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customers"})}),l(8,"create")&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{className:"btn btn-primary",onClick:a,children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Customer"]})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(ge,{})})})})]})};export{Ae as default};
