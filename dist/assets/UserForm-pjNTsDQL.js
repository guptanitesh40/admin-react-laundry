import{r as l,B as $,V as w,n as H,i as q,q as z,v as J,j as e,b as K}from"./index-CyVmr_i_.js";import{u as Q}from"./useGetCompanies-j4W0LemE.js";import{u as X,a as Y}from"./userSchema-BuAuxmWj.js";import{u as Z}from"./useGetWorkshops-Dk0YDJhJ.js";import{u as ee}from"./useGetuser-r87YlLDH.js";import{M as D}from"./index-K9ZSR_yP.js";const ae=()=>{const[k,u]=l.useState(!1);return{updateUser:async(b,_)=>{const o=localStorage.getItem("authToken");u(!0);try{const d=await fetch(`${$}/user/${b}`,{method:"PUT",headers:{Authorization:`Bearer ${o}`},body:_});if(!d.ok){const x=await d.json();return w.error(x.message,{position:"top-center"}),!1}const g=await d.json();return w.success(g.message,{position:"top-center"}),!0}catch(d){return w.error(d.message,{position:"top-center"}),!1}finally{u(!1)}},loading:k}},ie=()=>{const{addUser:k,loading:u}=X(),{updateUser:F,loading:b}=ae(),{id:_}=H(),o=_?Number(_):null,d=1e3,g=1,x=q(),{companies:C}=Q(g,d),{userData:E,fetchUser:P}=ee(),[j,B]=l.useState([]),{branches:S}=z(g,d),{workshops:U}=Z(g,d),[y,R]=l.useState([]),[N,L]=l.useState([]),i=E==null?void 0:E.user,A=J(),[m,O]=l.useState(!1),v={first_name:"",last_name:"",email:"",mobile_number:"",password:"",gender:null,role_id:null,image:"",company_ids:[],branch_ids:[],workshop_ids:[]},[s,r]=l.useState(v),[V,I]=l.useState(v),[p,M]=l.useState({});l.useEffect(()=>{A.pathname.split("/")[1]==="customer"&&O(!0)},[A]),l.useEffect(()=>{m&&r({...s,role_id:5})},[m]),l.useEffect(()=>{(async()=>{await P(o)})()},[o]),l.useEffect(()=>{if(C){const a=C.map(t=>({company_id:t.company_id,company_name:t.company_name}));B(a)}},[C]),l.useEffect(()=>{if(S){const a=S.map(t=>({branch_id:t.branch_id,branch_name:t.branch_name}));R(a)}},[S]),l.useEffect(()=>{if(U){const a=U.map(t=>({workshop_id:t.workshop_id,workshop_name:t.workshop_name}));L(a)}},[U]),l.useEffect(()=>{if(i){const a={...s,first_name:i.first_name,last_name:i.last_name,email:i.email,mobile_number:i.mobile_number,gender:i.gender,role_id:i.role_id,branch_ids:i.branch_ids,company_ids:i.company_ids,workshop_ids:i.workshop_ids};r(a),I(a)}else r(v),I(v),M({})},[i]);const T=a=>{const t=a.target;if(t instanceof HTMLInputElement){const{name:h,value:c,files:n}=t;h==="image"&&n&&n.length>0?r(f=>({...f,image:n[0]})):r(f=>({...f,[h]:c}))}else if(t instanceof HTMLTextAreaElement){const{name:h,value:c}=t;r(n=>({...n,[h]:c}))}},G=async a=>{a.preventDefault();try{if(await Y(!!o).validate(s,{abortEarly:!1}),!Object.keys(s).some(n=>n==="image"?s.image instanceof File||s.image!==V.image:s[n]!==V[n])){x(m?"/customers":"/users");return}let c;if(o){const n=new FormData;Object.keys(s).forEach(f=>{f==="image"&&s.image instanceof File?n.append(f,s.image):n.append(f,s[f])}),c=await F(o,n)}else c=await k(s);c&&x(m?"/customers":"/users")}catch(t){if(t instanceof K){const h={};t.inner.forEach(c=>{h[c.path||""]=c.message}),M(h)}else w.error("Failed to submit the form. Please try again.")}},W=()=>{x(m?"/customers":"/users")};return e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:m?o?"Edit Customer":"Add Customer":o?"Edit User":"Add User"}),e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"first_name",className:"block text-gray-700 font-semibold",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",autoComplete:"off",value:s.first_name||"",onChange:a=>r({...s,first_name:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.first_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"last_name",className:"block text-gray-700 font-semibold",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",autoComplete:"off",value:s.last_name||"",onChange:a=>r({...s,last_name:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.last_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:s.email||"",onChange:a=>r({...s,email:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"mobile_number",className:"block text-gray-700 font-semibold",children:"Mobile number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:s.mobile_number||"",onChange:a=>r({...s,mobile_number:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.mobile_number||" "})]}),!m&&o&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-700 font-semibold",children:"Password"}),e.jsx("input",{type:"text",id:"password",name:"password",autoComplete:"off",value:s.password||"",onChange:a=>r({...s,password:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.password||" "})]}),!m&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"role_id",children:"Role"}),e.jsxs("select",{id:"role_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.role_id===null?"":s.role_id,onChange:a=>r({...s,role_id:a.target.value?parseInt(a.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Role"}),e.jsx("option",{value:1,children:"Super Admin"}),e.jsx("option",{value:2,children:"Sub Admin"}),e.jsx("option",{value:3,children:"Branch Manager"}),e.jsx("option",{value:4,children:"Delivery and Pickup"}),e.jsx("option",{value:5,children:"Customer"}),e.jsx("option",{value:6,children:"Workshop Manager"}),e.jsx("option",{value:7,children:"Vendor"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:p.role_id||" "})]}),(s.role_id===2||s.role_id===1)&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Company"}),e.jsx(D,{options:j,displayValue:"company_name",selectedValues:j==null?void 0:j.filter(a=>{var t;return(t=s.company_ids)==null?void 0:t.includes(a.company_id)}),onSelect:a=>{r({...s,company_ids:a.map(t=>t.company_id)})},onRemove:a=>{r({...s,company_ids:a.map(t=>t.company_id)})},isObject:!0}),e.jsx("p",{className:"text-red-500 text-sm",children:p.company_ids||" "})]}),s.role_id===3&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Branch"}),e.jsx(D,{options:y,displayValue:"branch_name",selectedValues:y==null?void 0:y.filter(a=>{var t;return(t=s.branch_ids)==null?void 0:t.includes(a.branch_id)}),onSelect:a=>{r({...s,branch_ids:a.map(t=>t.branch_id)})},onRemove:a=>{r({...s,branch_ids:a.map(t=>t.branch_id)})},isObject:!0})]}),s.role_id===6&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Workshop"}),e.jsx(D,{options:N,displayValue:"workshop_name",selectedValues:N==null?void 0:N.filter(a=>{var t;return(t=s.workshop_ids)==null?void 0:t.includes(a.workshop_id)}),onSelect:a=>{r({...s,workshop_ids:a.map(t=>t.workshop_id)})},onRemove:a=>{r({...s,workshop_ids:a.map(t=>t.workshop_id)})},isObject:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:s.gender===1,onChange:a=>r({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:s.gender===2,onChange:a=>r({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:s.gender===3,onChange:a=>r({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:p.gender||" "})]}),o&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"image",className:"block text-gray-700 font-semibold",children:"Profile Photo"}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:T,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.image||" "})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${u||b?"opacity-50 cursor-not-allowed":""}`,disabled:u||b,children:u||b?u?"Adding...":"Updating...":m?o?"Update customer":"Add customer":o?"Update user":"Add User"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:W,disabled:u||b,children:"Cancel"})]})]})]})};export{ie as default};
