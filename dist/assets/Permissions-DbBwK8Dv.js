import{r as a,B as S,V as g,a1 as k,v as P,j as e,T as E,L as w}from"./index-vHAOnTyK.js";const D=()=>{const[h,t]=a.useState(!1),[u,n]=a.useState(),o=async()=>{const d=localStorage.getItem("authToken");t(!0);try{const r=await fetch(`${S}/modules`,{method:"GET",headers:{Authorization:`Bearer ${d}`}}),l=await r.json();if(!r.ok){g.error(l.message,{position:"top-center"}),t(!1);return}n(l==null?void 0:l.data)}catch{g.error("Network error: Failed to fetch modules data.")}finally{t(!1)}};return a.useEffect(()=>{o()},[]),{modulesData:u,fetchModulesData:o,loading:h}},C=()=>{const[h,t]=a.useState(),[u,n]=a.useState(),o=async()=>{const d=localStorage.getItem("authToken");t(!0);try{const r=await fetch(`${S}/role-permission`,{method:"GET",headers:{Authorization:`Bearer ${d}`}}),l=await r.json();if(!r.ok){g.error(l.message),t(!1);return}n(l==null?void 0:l.data)}catch{g.error("Network Error : Fail to fetch Role Permissions Data")}finally{t(!1)}};return a.useEffect(()=>{o()},[]),{permissionsData:u,fetchRolesPermissions:o,loading:h}},L=({isSave:h,setIsSave:t,setIsLoading:u})=>{var y;const{modulesData:n}=D(),{assignRolePermission:o,loading:d}=k(),{permissionsData:r,loading:l}=C(),[f,b]=a.useState([]),[v,N]=a.useState([]),p=P(),j=(y=p==null?void 0:p.state)==null?void 0:y.role_id;a.useEffect(()=>{u(d)},[d]),a.useEffect(()=>{if(n&&r){const i=r.map(s=>({...s}));n.forEach(s=>{i.find(m=>m.role_id===j&&m.module_id===s.module_id)||i.push({role_id:j,module_id:s.module_id,create:!1,update:!1,read:!1,delete:!1})}),b(i),N(JSON.parse(JSON.stringify(i)))}},[n,r]),a.useEffect(()=>{if(h){if(!(JSON.stringify(f)!==JSON.stringify(v))){t(!1);return}(async()=>{try{o(f)&&(N(JSON.parse(JSON.stringify(f))),t(!1))}catch{g.error("Failed to assign role permissions. Please try again.")}})()}},[h]);const _=(i,s)=>{b(c=>c.map(m=>{if(m.role_id===j&&m.module_id===i){const x={...m,[s]:!m[s]};return s==="read"?x.read=!m.read:(s==="create"||s==="update")&&(x.create||x.update)&&(x.read=!0),x}return m}))};return e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[200px]",children:"Modules"}),e.jsx("th",{children:"Create"}),e.jsx("th",{children:"Read"}),e.jsx("th",{children:"Update"}),e.jsx("th",{children:"Delete"})]})}),l?e.jsx(E,{}):n&&f.length>0?e.jsx("tbody",{children:n.map(i=>{const s=f.find(c=>c.role_id===j&&c.module_id===i.module_id);return e.jsxs("tr",{children:[e.jsx("td",{children:i.module_name}),["create","read","update","delete"].map(c=>e.jsx("td",{children:e.jsx("input",{className:"w-4 h-4",type:"checkbox",checked:s?s[c]:!1,onChange:()=>_(i.module_id,c)})},c))]},i.module_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No Modules Data Available"})})})]})})})})},T=()=>{var r;const[h,t]=a.useState(!1),[u,n]=a.useState(!1),o=P(),d=(r=o==null?void 0:o.state)==null?void 0:r.role;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-5",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[e.jsxs("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:[d," Permissions"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage permissions for the ",d,"."]})]}),e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>t(!0),disabled:u,children:u?e.jsxs(e.Fragment,{children:[" ","Saving"," ",e.jsx(w,{})," "]}):e.jsx(e.Fragment,{children:"Save Changes"})})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(L,{isSave:h,setIsSave:t,setIsLoading:n})})})})]})};export{T as default};
