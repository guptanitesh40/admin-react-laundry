import{r as a,_ as g,u as B,j as e,aO as F,V as G}from"./index-DctR2NZY.js";import{u as z}from"./useGetCategories-Bu4w7zRB.js";import{u as M}from"./useGetProducts-C0hm0ysU.js";import{u as U}from"./useGetServices-D7ZgNGba.js";import{u as V}from"./useGetPrice-B832B28D.js";import{s as q}from"./searchSchema-jWF4PMLO.js";const J="http://35.154.167.170:3000/prices",W=()=>{const[l,d]=a.useState(!1);return{addPrice:async u=>{const p=localStorage.getItem("authToken");if(u.length===0)return g.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;d(!0);try{const o={prices:u},m=await fetch(J,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(o)});if(!m.ok){const i=(await m.json()).message;return g.error(i,{position:"top-center"}),!1}const f=await m.json();return g.success(f.message,{position:"top-center"}),!0}catch(o){return o.name==="TypeError"&&o.message.includes("Failed to fetch")?g.error("Network error: Failed to fetch.",{position:"top-center"}):g.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{d(!1)}},loading:l}},Z=({search:l,isSave:d,setIsSave:v})=>{const{categories:u}=z(),{products:p}=M(),{services:o}=U(),{prices:m,loading:f,fetchPrices:j}=V(),{addPrice:i}=W(),[n,L]=a.useState({}),[S,N]=a.useState(new Set),C=a.useRef({}),[H,k]=B(),[c,I]=a.useState(null),[h,b]=a.useState(null),w=a.useCallback((s,r,t,_)=>{const x=[];return s.forEach(E=>{r.forEach(A=>{t.forEach($=>{const R=`${E.category_id}_${A.product_id}_${$.service_id}`;x.push({category:E,product:A,service:$,price:_[R]||0})})})}),x},[u,p,o,m])(u,p,o,m),P=w.filter(s=>{const r=l.toLowerCase();return s.category.name.toLowerCase().includes(r)||s.product.name.toLowerCase().includes(r)||s.service.name.toLowerCase().includes(r)}).sort((s,r)=>["category","product","service"].includes(c)?h==="ASC"?s[c].name.localeCompare(r[c].name):r[c].name.localeCompare(s[c].name):c==="price"?h==="ASC"?s.price-r.price:r.price-s.price:0),D=s=>{N(r=>{const t=new Set(r);return t.add(s),t})},T=(s,r)=>{L(t=>({...t,[s]:r}))},y=s=>{c===s?b(h==="ASC"?"DESC":"ASC"):(I(s),b("ASC"))};a.useEffect(()=>{if(d){const s=w.map(r=>{const t=`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`;return{category_id:r.category.category_id,product_id:r.product.product_id,service_id:r.service.service_id,price:n[t]!==void 0?n[t]:r.price}}).filter(r=>r.price>0);try{i(s),j(),N(new Set)}catch{g.error("Failed to save prices.")}}v(!1)},[d,i,j,w,n]);const O=s=>{N(r=>{const t=new Set(r);return t.delete(s),t})};return a.useEffect(()=>{var r;const s=Array.from(S);if(s.length>0){const t=s[0];C.current[t]&&((r=C.current[t])==null||r.focus())}},[S]),a.useEffect(()=>{k(l?{search:l}:{})},[l]),e.jsx("div",{children:f?e.jsx(F,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-12 grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[40px]",children:"Id"}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="category"?h==="ASC"?"asc":"desc":""}`,onClick:()=>y("category"),children:[e.jsx("span",{className:"sort-label",children:"Category"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="product"?h==="ASC"?"asc":"desc":""}`,onClick:()=>y("product"),children:[e.jsx("span",{className:"sort-label",children:"Product"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="service"?h==="ASC"?"asc":"desc":""}`,onClick:()=>y("service"),children:[e.jsx("span",{className:"sort-label",children:"Service"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${c==="price"?h==="ASC"?"asc":"desc":""}`,onClick:()=>y("price"),children:[e.jsx("span",{className:"sort-label",children:"Price"}),e.jsx("span",{className:"sort-icon"})]})})]})}),e.jsx("tbody",{children:P.length>0?P.map((s,r)=>{const t=`${s.category.category_id}_${s.product.product_id}_${s.service.service_id}`,_=S.has(t);return e.jsxs("tr",{className:`font-semibold ${s.price?"":"text-red-500"}`,children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:s.category.name}),e.jsx("td",{children:s.product.name}),e.jsx("td",{children:s.service.name}),e.jsx("td",{className:"relative",children:_?e.jsx("input",{ref:x=>C.current[t]=x,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:n[t]!==void 0?n[t]:s.price||"",onChange:x=>T(t,x.target.value===""?0:Number(x.target.value)),onBlur:()=>O(t)}):e.jsx("span",{className:"cursor-pointer h-full flex",onClick:()=>D(t),children:n[t]!==void 0?n[t]:s.price||"Add Price"})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})})},te=()=>{const[l,d]=a.useState(!1),[v,u]=a.useState(""),[p,o]=a.useState(""),[m,f]=a.useState(""),j=async i=>{i.preventDefault();try{await q.validate({search:p},{abortEarly:!1}),u(p),f("")}catch(n){n instanceof G&&f(n.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Table"}),e.jsxs("button",{onClick:()=>d(!0),className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:j,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:p,onChange:i=>{o(i.target.value),i.target.value===""&&u("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:m||"Â "})]}),e.jsx(Z,{search:v,isSave:l,setIsSave:d})]})};export{te as default};
