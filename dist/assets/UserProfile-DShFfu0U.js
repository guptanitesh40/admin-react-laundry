import{r as c,B as M,V as R,G as K,j as e,a0 as V,W as D,t as Y,q as W,m as q,H,e as J,L as Z,R as B,a2 as Q,h as X}from"./index-uvtpSlnJ.js";import{u as T}from"./useGetuser-Dvm3LDLo.js";import{g as I}from"./roleClasses-CC8P3gCH.js";import{g as z}from"./paymentStatusClasses-BddHAg9R.js";import{g as ee}from"./orderStatusClasses-HfHBGnti.js";import{u as te}from"./useRestoreUser-BkldMW0D.js";import{S as O}from"./sweetalert2.esm.all-B0Dix5B2.js";const se=()=>{const[m,x]=c.useState(!1);return{clearDueAmount:async(g,v)=>{const j=localStorage.getItem("authToken");x(!0);try{const p=await fetch(`${M}/orders/payments/clear-due`,{method:"POST",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"},body:JSON.stringify({user_id:g,orders:v})}),_=await p.json();return p.ok?(R.success(_.message,{position:"top-center"}),!0):(R.error(_.message,{position:"top-center"}),!1)}catch{return R.error("Error clearing due amount",{position:"top-center"}),!1}finally{x(!1)}},loading:m}};function F(m){return K({attr:{viewBox:"0 0 32 32"},child:[{tag:"path",attr:{d:"M 8 5 L 8 7 L 12 7 C 13.703125 7 15.941406 8.039063 16.71875 10 L 8 10 L 8 12 L 16.96875 12 C 16.660156 14.609375 13.972656 16 12 16 L 8 16 L 8 18.46875 L 18.25 27 L 21.375 27 L 10.5625 18 L 12 18 C 15.234375 18 18.675781 15.609375 18.96875 12 L 24 12 L 24 10 L 18.8125 10 C 18.507813 8.816406 17.859375 7.804688 17 7 L 24 7 L 24 5 Z"},child:[]}]})(m)}const ae=({modalOpen:m,onClose:x,userId:N,setRefetch:g,count:v})=>{const{userData:j,fetchUser:p,loading:_}=T(),{clearDueAmount:P,loading:r}=se(),[n,L]=c.useState([]),[C,a]=c.useState([]),[u,t]=c.useState(),S=1,f=j==null?void 0:j.user;console.log(f),c.useEffect(()=>{m&&p(N,S,v)},[m,N]),c.useEffect(()=>{if(f!=null&&f.orders){const s=f.orders.filter(i=>![2].includes(i.payment_status)&&![12,13].includes(i.order_status));s.map(i=>({...i,kasar_amount:i.kasar_amount||null,payment_status:i.payment_status||null,current_total:0})),L(s)}},[f]);const y=(s,i,b)=>{const o=n.map(l=>{if(l.order_id===s){const d={...l,[i]:b};return d.current_total=(d.current_paid||0)+(d.kasar_amount||0)||0,d.current_total===0?d.payment_status=1:d.current_total===l.total||d.current_total===l.total-l.paid_amount?(t(!0),d.payment_status=2):(t(!1),d.payment_status=3),d}return l});L(o);const w=o.find(l=>l.order_id===s);w&&a(l=>{const d=l.findIndex(k=>k.order_id===s);if(d>-1){const k=[...l];return k[d]=w,k}return[...l,w]})},E=async()=>{if(C.length===0){x();return}const s={filteredOrders:C.map(({order_id:b,payment_status:o,kasar_amount:w,current_paid:l})=>({order_id:b,paid_amount:l||0,payment_status:o,kasar_amount:w}))};await P(N,s.filteredOrders)&&(x(),a([])),g(!0)};return m?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:x}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[1000px] z-10 relative max-h-[80vh] overflow-auto",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:x,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsxs("div",{className:"flex justify-between items-center mb-6 lgscreen:flex-col lgscreen:gap-2 lgscreen:items-start",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),e.jsx("div",{className:"flex items-start gap-2 lgscreen:w-full lgscreen:justify-between lgscreen:!items-center",children:e.jsx("button",{className:"btn btn-primary btn-lg flex flex-end mt-10 lgscreen:mt-0",onClick:E,disabled:r,children:r?"Saving...":"Save"})})]}),e.jsx("div",{className:"grid gap-5 lg:gap-5.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[30px]",children:"Id"}),e.jsx("th",{className:"min-w-[120px]",children:"Total"}),e.jsx("th",{className:"min-w-[120px]",children:"Paid Amount"}),e.jsx("th",{className:"min-w-[120px]",children:"Kasar Amount"}),e.jsx("th",{className:"min-w-[120px]",children:"Current Paid"}),e.jsx("th",{className:"min-w-[190px]",children:"Current Total"}),e.jsx("th",{className:"min-w-[120px]",children:"Payment Status"})]})}),_?e.jsx("tbody",{children:Array.from({length:4}).map((s,i)=>e.jsx("tr",{children:Array.from({length:7}).map((b,o)=>e.jsx("td",{className:"!px-3 !py-3",children:e.jsx("span",{className:"inline-block w-full bg-gray-200 animate-pulse rounded-md text-xl",children:" "})},o))},i))}):e.jsx("tbody",{children:n.map(s=>{const i=(s.paid_amount||0)+(s.kasar_amount||0)+(s.current_paid||0),b=z(s.payment_status,!0);return e.jsxs("tr",{className:"custom-row",children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsxs("td",{children:["₹",s.total||0]}),e.jsxs("td",{children:["₹",s.paid_amount||0]}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input input-bordered",value:s.kasar_amount||0,onChange:o=>y(s.order_id,"kasar_amount",Number(o.target.value))})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input input-bordered",value:s.current_paid||0,onChange:o=>y(s.order_id,"current_paid",Number(o.target.value))})}),e.jsxs("td",{className:i>(s.total||0)?"text-red-500":"",children:[e.jsxs("span",{children:["₹",s.current_total||0]}),i>(s.total||0)?e.jsx("span",{className:"flex mt-1 font-serif",children:"greater then pending amount"}):""]}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${b}`,"data-datatable-size":"true","data-tooltip":"#custom_tooltip",value:s.payment_status,onChange:o=>y(s.order_id,"payment_status",Number(o.target.value)),children:[e.jsx("option",{value:"1",className:`${b}`,disabled:u||!u,children:"Pending"}),e.jsx("option",{value:"2",disabled:!u||s.paid_amount===0,children:"Received"}),e.jsx("option",{value:"3",disabled:u,children:"Partial Received"})]}),e.jsx("div",{className:"hidden rounded-xl shadow-default p-3 bg-light border border-gray-200 text-gray-700 text-xs font-normal",id:"custom_tooltip",children:"Change Payment Status"})]})})]},s.order_id)})})]})})})})})]})]}):null},ne=({user:m,userId:x,count:N})=>{const[g,v]=c.useState(1),[j,p]=c.useState(100),{fetchUser:_,loading:P}=T(),[r,n]=c.useState([]);c.useEffect(()=>{n(m==null?void 0:m.orders)},[m]),c.useEffect(()=>{(async()=>{const u=await _(x,g,j);u&&n(t=>{const S=new Set(t.map(y=>y.order_id)),f=u==null?void 0:u.filter(y=>!S.has(y.order_id));return[...t,...f]})})()},[g]);const L=a=>{window.open(`/order/${a}`,"_blank")},C=()=>{v(g+1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-5 lg:gap-7.5 mt-5",children:e.jsxs("div",{className:"card card-grid min-w-full",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:"Orders"}),e.jsxs("span",{className:"text-gray-700 text-lg font-semibold px-3 py-1 rounded-lg",children:["Total Orders: ",N]})]}),e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Id"}),e.jsx("th",{className:"min-w-[220px]",children:"Status"}),e.jsx("th",{className:"min-w-[60px]",children:"Item Count"}),e.jsx("th",{children:"Total"}),e.jsx("th",{className:"min-w-[80px]",children:"Paid Amount"}),e.jsx("th",{className:"",children:"Kasar Amount"}),e.jsx("th",{className:"min-w-[140px]",children:"Payment Type"}),e.jsx("th",{className:"min-w-[135px]",children:"Payment Status"}),e.jsx("th",{className:"min-w-[130px]",children:"Actions"})]})}),(r==null?void 0:r.length)>0?e.jsx("tbody",{children:r==null?void 0:r.map(a=>{const u=z(a.payment_status),t=ee(a.admin_order_status.admin_label),S=a.items.length;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",a.order_id]}),e.jsx("td",{children:e.jsx("span",{className:`${t} badge-outline badge-xl rounded-[30px]`,children:a.admin_order_status.admin_label})}),e.jsx("td",{children:S}),e.jsxs("td",{children:["₹",a.total]}),e.jsxs("td",{children:["₹",a.paid_amount===""?0:a.paid_amount]}),e.jsxs("td",{children:["₹",a.kasar_amount===""?0:a.kasar_amount]}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-outline",children:V[a.payment_type]})}),e.jsx("td",{children:e.jsx("span",{className:`${u} badge-outline`,children:D[a.payment_status]})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>L(a.order_id),children:"View Order"})})]},a.order_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center",children:"No Orders available"})})})]})})]})}),(r==null?void 0:r.length)<N&&e.jsx("div",{className:"mt-2 flex justify-center items-center",children:e.jsx("button",{className:"btn btn-primary custom-rounded",onClick:C,disabled:P,children:P?e.jsxs(e.Fragment,{children:["Loading ",e.jsx(Y,{})]}):e.jsx(e.Fragment,{children:"Load More"})})})]})},xe=()=>{var o,w,l,d,k,U;const{id:m}=W(),x=Number(m),N=q(),g=H(),[v,j]=c.useState(),[p,_]=c.useState(!1),[P,r]=c.useState(!1),{userData:n,fetchUser:L,count:C,loading:a}=T(),{restoreUser:u}=te(),t=n==null?void 0:n.user,{hasPermission:S}=J();if(c.useEffect(()=>{L(x),r(!1)},[x,P]),c.useEffect(()=>{_(g.pathname.split("/")[1]==="customer")},[g.pathname]),!t)return;const f=(o=t==null?void 0:t.orders)==null?void 0:o.reduce((h,A)=>h+A.kasar_amount,0),y=(w=t==null?void 0:t.orders)==null?void 0:w.reduce((h,A)=>h+A.total,0),E=()=>{j(!0)},s=h=>{N(p?`/customer/edit/${h}`:`/user/edit/${h}`)},i=async h=>{try{if((await O.fire({title:"Are you sure?",text:p?"You want to restore this customer?":"You want to restore this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!",cancelButtonText:"No, cancel"})).isConfirmed){O.fire({title:p?"Restoring customer...":"Restoring user...",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{O.showLoading()}});const{success:G,message:$}=await u(h);r(!0),G?O.fire("Restored!",$,"success"):O.fire("Failed",$,"error")}}catch(A){O.fire({title:"Error",text:A.message,icon:"error"})}};if(!t&&a)return e.jsx(Z,{});const b=!!(t!=null&&t.deleted_at);return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex flex-col bg-gray-50 p-5 rounded-md shadow-md",children:e.jsxs("div",{className:"flex justify-between gap-4 items-center",children:[e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:[t==null?void 0:t.first_name," ",t==null?void 0:t.last_name]}),(n==null?void 0:n.total_pending_amount)!==0&&e.jsxs("div",{className:"flex flex-end items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-red-700",children:["Total Pending Amount: ₹",n==null?void 0:n.total_pending_amount]}),e.jsxs("button",{className:"font-extralight btn btn-lg btn-light",onClick:E,children:["Pay ",e.jsx(F,{size:20})]})]}),b?e.jsxs("button",{className:"btn btn-sm btn-danger",onClick:()=>i(t==null?void 0:t.user_id),children:["Restore ",p?"Customer":"User"]}):t.role_id!==5&&e.jsx("span",{className:`mt-1 p-2 rounded-md text-sm ${I(t.role_id)}`,children:B[t.role_id]})]})}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-5 lg:gap-7.5 mt-5",children:e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"card pb-2.5",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:"Personal Information"}),!b&&S(8,"update")&&e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"tooltip absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 hidden group-hover:flex items-center justify-center whitespace-nowrap",id:"tooltip_hover",children:["Edit ",p?"Customer":"User"]}),e.jsx("button",{className:"btn btn-light flex justify-center items-center rounded-full p-0 !h-8 !w-8","data-tooltip":"#tooltip_hover","data-tooltip-trigger":"hover",onClick:()=>s(t==null?void 0:t.user_id),children:e.jsx(Q,{className:"h-5 w-5 text-gray-600 group-hover:text-gray-800 transition-colors duration-300"})})]})]}),e.jsx("div",{className:"card-body pt-4 pb-3",children:e.jsx("table",{className:"table-auto",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Name:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:[t==null?void 0:t.first_name," ",t==null?void 0:t.last_name]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Email:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Mobile Number:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:t==null?void 0:t.mobile_number})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Gender:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:X[t==null?void 0:t.gender]})]}),(t==null?void 0:t.image)!==""&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Profile Photo :"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:e.jsx("span",{children:e.jsx("img",{className:"h-14 w-14 rounded-full",src:t==null?void 0:t.image})})})]}),(t==null?void 0:t.role_id)!==5&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Role:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:e.jsx("span",{className:`p-2 rounded-md text-sm ${I(t==null?void 0:t.role_id)}`,children:B[t==null?void 0:t.role_id]})})]}),((l=t==null?void 0:t.companies)==null?void 0:l.length)>0&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Company:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:Array.isArray(t==null?void 0:t.companies)&&t.companies.length>0?t.companies.map(h=>h).join(","):""})]}),((d=t==null?void 0:t.branches)==null?void 0:d.length)>0&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Branch:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:Array.isArray(t.branches)&&t.branches.length>0?t.branches.map(h=>h).join(", "):""})]}),((k=t==null?void 0:t.workshops)==null?void 0:k.length)>0&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Workshop:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:Array.isArray(t.workshops)&&t.workshops.length>0?t.workshops.map(h=>h).join(", "):""})]})]})})})]})})}),(t==null?void 0:t.role_id)===5&&t&&e.jsx(ne,{user:t,userId:x,count:C}),((U=t==null?void 0:t.orders)==null?void 0:U.length)>0&&e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"col-span-2 lg:col-span-1 flex",children:e.jsxs("div",{className:"card grow",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Orders Summary"})}),e.jsx("div",{className:"card-body pt-4 pb-3",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsx("table",{className:"table-auto",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Total Kasar Amount:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:["₹",f]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Total Order Amount:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:["₹",y]})]}),n.total_pending_amount>0&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Total Pending Amount:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:["₹",n.total_pending_amount]}),e.jsx("td",{children:e.jsx("span",{className:"relative bottom-2 left-4",children:e.jsxs("button",{className:"flex items-center gap-2.5 font-extralight btn btn-light ",onClick:E,children:["Pay ",e.jsx(F,{size:20})]})})})]})]})})})})]})})})}),e.jsx(ae,{modalOpen:v,onClose:()=>j(!1),userId:x,setRefetch:r,count:C})]})};export{xe as default};
