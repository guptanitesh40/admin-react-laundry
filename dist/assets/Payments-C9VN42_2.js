import{r as a,B as W,V,u as X,t as Z,j as e,T as ee,k as T,P as se,s as ae,b as te}from"./index-Epl70b2T.js";import{M as B}from"./MultiSelect-xWrnfUT4.js";import"./orderStatusClasses-HfHBGnti.js";const re=(x=1,m=10,r="",f,j,l,n)=>{const[E,d]=a.useState(),[P,S]=a.useState(0),[b,c]=a.useState(!1),N=async()=>{var _,v;const g=localStorage.getItem("authToken"),i=new URLSearchParams;x&&i.append("page_number",x.toString()),m&&i.append("per_page",m.toString()),r&&i.append("search",r),f&&i.append("sort_by",f),j&&i.append("order",j),l&&l.forEach(o=>i.append("user_id",o.toString())),n&&n.forEach(o=>i.append("status",o)),c(!0);try{const o=await fetch(`${W}/razorpay/transaction?${i}`,{method:"GET",headers:{Authorization:g?`Bearer ${g}`:""}}),h=await o.json();if(!o.ok){V.error(h.message,{position:"top-center"}),c(!1);return}d((_=h==null?void 0:h.data)==null?void 0:_.result),S((v=h==null?void 0:h.data)==null?void 0:v.count)}catch{V.error("Network Error : Failed to fetch payments")}finally{c(!1)}};return a.useEffect(()=>{N()},[x,m,r,f,j,l,n]),{payments:E,count:P,fetchPayments:N,loading:b}},ne=()=>{const[x,m]=a.useState(1),[r,f]=a.useState(10),[j,l]=X(),[n,E]=a.useState(null),[d,P]=a.useState(null),S=j.get("page"),b=j.get("perPage"),[c,N]=a.useState(""),[g,i]=a.useState(""),[_,v]=a.useState(""),[o,h]=a.useState([]),[k,z]=a.useState([]),[D,F]=a.useState([]),[A,Y]=a.useState(""),[$,O]=a.useState([]),[U,I]=a.useState([]),{payments:u,count:M,loading:G}=re(x,r,c,n,d,U,$),q=[{label:"Created",value:"created"},{label:"Paid",value:"paid"},{label:"Attempted",value:"attempted"}],{fetchUsersByRole:R}=Z(),L=Math.ceil(M/r);a.useEffect(()=>{(async()=>{const t=await R(5);h((p=>p.map(y=>({label:`${y.first_name} ${y.last_name} (${y.mobile_number})`,value:y.user_id})))(t))})()},[]),a.useEffect(()=>{A?(async()=>{const w=(await R(5,A)).map(p=>({label:`${p.first_name} ${p.last_name} (${p.mobile_number})`,value:p.user_id}));F(w)})():F(o)},[A,o]),a.useEffect(()=>{S&&m(Number(S)),b&&f(Number(b))},[S,b]),a.useEffect(()=>{m(1),l(c!==""?{search:c,page:"1",perPage:r.toString()}:{})},[c]),a.useEffect(()=>{m(1),l(c!==""?{search:c,page:"1",perPage:r.toString()}:{page:"1",perPage:r.toString()})},[$,U]);const H=async s=>{s.preventDefault();try{await ae.validate({search:g},{abortEarly:!1}),N(g),v("")}catch(t){t instanceof te&&v(t.errors[0])}},C=s=>{n===s?P(d==="ASC"?"DESC":"ASC"):(E(s),P("ASC"))},J=s=>{s>=1&&s<=L&&(m(s),l({page:s.toString(),perPage:r.toString()}))},K=s=>{const t=Number(s.target.value);f(t),m(1),l({page:"1",perPage:t.toString()})},Q=(s,t)=>[...s.filter(w=>!t.some(p=>p.value===w.value)),...t];return G?e.jsx(ee,{isFilters:!0,columns:9,records:10,isPagination:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:r,onChange:K,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-2 mb-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2.5",children:[e.jsx(B,{options:q,displayValue:"label",placeholder:"Select Payment Status",selectedValues:$,onSelect:s=>O(s.map(t=>t.value)),onRemove:s=>O(s.map(t=>t.value)),className:"min-w-[180px]",sliceCount:1}),e.jsx(B,{options:Q(k,D),displayValue:"label",placeholder:"Search Customer",selectedValues:k.map(s=>s.value),onSelect:s=>{z(s),I(s.map(t=>t.value))},onRemove:s=>{z(s),I(s.map(t=>t.value))},setSearch:Y,className:"sm:min-w-[320px] smmobile:min-w-[290px] smobile:min-w-[300px] vsmobile:min-w-[240px]",isSearchInput:!0})]}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:H,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:g,onChange:s=>{i(s.target.value),s.target.value===""&&N("")},placeholder:"Search...",className:"min-w-[150px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:_||"Â "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"min-w-[250px]",children:[e.jsxs("span",{className:`sort ${n==="first_name"?d==="ASC"?"asc":"desc":""}`,onClick:()=>C("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer Name"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[250px]",children:[e.jsxs("span",{className:`sort ${n==="email"?d==="ASC"?"asc":"desc":""}`,onClick:()=>C("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[130px]",children:[e.jsxs("span",{className:`sort ${n==="mobile_number"?d==="ASC"?"asc":"desc":""}`,onClick:()=>C("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile No"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[120px]",children:[e.jsxs("span",{className:`sort ${n==="razorpay_transaction_id"?d==="ASC"?"asc":"desc":""}`,onClick:()=>C("razorpay_transaction_id"),children:[e.jsx("span",{className:"sort-label",children:"Transaction Id"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsx("th",{className:"min-w-[120px]",children:"Created At"}),e.jsx("th",{className:"min-w-[60px]",children:"Status"}),e.jsx("th",{className:"min-w-[120px]",children:"Order Id"}),e.jsx("th",{className:"min-w-[60px]",children:"Currency"}),e.jsxs("th",{className:"min-w-[60px]",children:[e.jsxs("span",{className:`sort ${n==="amount"?d==="ASC"?"asc":"desc":""}`,onClick:()=>C("amount"),children:[e.jsx("span",{className:"sort-label",children:"Amount"}),e.jsx("span",{className:"sort-icon"})]})," "]})]})}),(u==null?void 0:u.length)>0?e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[s.user.first_name," ",s.user.last_name]}),e.jsx("td",{children:s.user.email}),e.jsx("td",{children:s.user.mobile_number}),e.jsx("td",{children:s.razorpay_transaction_id}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[T(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),T(s.created_at).format("hh:mm:ss A")]})}),e.jsx("td",{children:s.status}),e.jsx("td",{children:s.razorpay_order_id}),e.jsx("td",{children:s.currency}),e.jsx("td",{children:s.amount})]},s.razorpay_transaction_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No Payments data available"})})})]})}),e.jsx(se,{count:M,currentPage:x,totalRecords:u==null?void 0:u.length,perPage:r,onPageChange:J,label:"records"})]})})]})},oe=()=>e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Payments"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(ne,{})})})})]});export{oe as default};
