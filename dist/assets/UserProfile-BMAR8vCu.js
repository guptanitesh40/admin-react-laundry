import{r as c,aW as k,_ as S,j as e,aL as P,b1 as A}from"./index-BKJMOhbd.js";import{u as O}from"./useGetuser-C5PzseKi.js";import{g as C}from"./paymentStatusClasses-CG7cqzE3.js";import{b as T,P as E}from"./enums-CTW_vMWA.js";import{g as L}from"./orderStatusClasses-DgGpuqsn.js";const R=()=>{const[m,d]=c.useState(!1);return{clearDueAmount:async(j,x)=>{const f=localStorage.getItem("authToken");d(!0);try{const l=await fetch(`${k}/orders/payments/clear-due`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({user_id:j,orders:x})}),u=await l.json();return l.ok?(S.success(u.message,{position:"top-center"}),!0):(S.error(u.message,{position:"top-center"}),!1)}catch{S.error("Error clearing due amount",{position:"top-center"})}finally{d(!1)}},loading:m}},U=({modalOpen:m,onClose:d,userId:o,setRefetch:j})=>{const{userData:x,fetchUser:f}=O(),{clearDueAmount:l,loading:u}=R(),[a,N]=c.useState([]),[v,w]=c.useState([]),h=x==null?void 0:x.user;c.useEffect(()=>{m&&f(o)},[m,o]),c.useEffect(()=>{if(h!=null&&h.orders){const t=h.orders.filter(n=>n.payment_status!==2);t.map(n=>({...n,kasar_amount:n.kasar_amount||null,payment_status:n.payment_status||null,current_total:0})),N(t)}},[h]);const g=(t,n,r)=>{const y=a.map(i=>{if(i.order_id===t){const p={...i,[n]:r};return p.current_total=(p.current_paid||0)+(p.kasar_amount||0)||0,p}return i});N(y);const b=y.find(i=>i.order_id===t);b&&w(i=>{const p=i.findIndex(_=>_.order_id===t);if(p>-1){const _=[...i];return _[p]=b,_}return[...i,b]})},s=async()=>{const t={user_id:o,filteredOrders:v.map(({order_id:r,payment_status:y,kasar_amount:b,current_paid:i})=>({order_id:r,paid_amount:i||0,payment_status:y,kasar_amount:b}))};await l(o,t.filteredOrders)&&d(),j(!0)};return m?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:d}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[1000px] z-10 relative max-h-[80vh] overflow-auto",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:d,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Orders"}),e.jsx("button",{className:"btn btn-primary btn-lg flex flex-end mt-10",onClick:s,disabled:u,children:u?"Saving...":"Save"})]}),e.jsx("div",{className:"grid gap-5 lg:gap-5.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[30px]",children:"Id"}),e.jsx("th",{className:"min-w-[120px]",children:"Total"}),e.jsx("th",{className:"min-w-[120px]",children:"Paid Amount"}),e.jsx("th",{className:"min-w-[120px]",children:"Kasar Amount"}),e.jsx("th",{className:"min-w-[120px]",children:"Current Paid"}),e.jsx("th",{className:"min-w-[190px]",children:"Current Total"}),e.jsx("th",{className:"min-w-[120px]",children:"Payment Status"})]})}),e.jsx("tbody",{children:a.map(t=>{const n=(t.paid_amount||0)+(t.kasar_amount||0)+(t.current_paid||0);return e.jsxs("tr",{className:"custom-row",children:[e.jsxs("td",{children:["#",t.order_id]}),e.jsxs("td",{children:["₹",t.total||0]}),e.jsxs("td",{children:["₹",t.paid_amount||0]}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input input-bordered",value:t.kasar_amount||0,onChange:r=>g(t.order_id,"kasar_amount",Number(r.target.value))})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"input input-bordered",value:t.current_paid||0,onChange:r=>g(t.order_id,"current_paid",Number(r.target.value))})}),e.jsxs("td",{className:n>(t.total||0)?"text-red-500":"",children:[e.jsxs("span",{children:["₹",t.current_total||0]}),n>(t.total||0)?e.jsx("span",{className:"flex mt-1 font-serif",children:"greater then pending amount"}):""]}),e.jsx("td",{children:e.jsxs("select",{className:"select select-sm w-[170px] text-sm","data-datatable-size":"true",value:t.payment_status,onChange:r=>g(t.order_id,"payment_status",Number(r.target.value)),children:[e.jsx("option",{value:"1",children:"Pending"}),e.jsx("option",{value:"2",children:"Received"}),e.jsx("option",{value:"3",children:"Partial Received"})]})})]},t.order_id)})})]})})})})})]})]}):null},D=()=>{var g;const{id:m}=P(),d=Number(m),[o,j]=c.useState(),[x,f]=c.useState(!1),{userData:l,fetchUser:u}=O(),a=l==null?void 0:l.user;c.useEffect(()=>{u(d)},[d,x]);const N=s=>{window.open(`/order/${s}`,"_blank")};if(!a)return;const v=a.orders.reduce((s,t)=>s+t.kasar_amount,0),w=a.orders.reduce((s,t)=>s+t.total,0),h=()=>{j(!0)};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex flex-col bg-gray-100 p-6 rounded-md shadow-md",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:[a.first_name," ",a.last_name]})})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"col-span-2 lg:col-span-1 flex",children:e.jsxs("div",{className:"card grow",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Personal Information"})}),e.jsx("div",{className:"card-body pt-4 pb-3",children:e.jsx("table",{className:"table-auto",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Name:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:[a.first_name," ",a.last_name]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Email:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:"email"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Mobile Number:"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:a.mobile_number})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Profile Photo :"}),e.jsx("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:e.jsx("span",{className:"",children:e.jsx("img",{className:"h-14 w-14 rounded-full",src:"http://35.154.167.170:3000/images/user/1735042941768.jpeg"})})})]})]})})})]})})})}),e.jsxs("div",{className:"card rounded-lg mt-6",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:"Orders"}),e.jsxs("span",{className:"text-gray-700 text-lg font-semibold px-3 py-1 rounded-lg",children:["Total Orders: ",(g=a==null?void 0:a.orders)==null?void 0:g.length]})]}),e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Id"}),e.jsx("th",{className:"min-w-[220px]",children:"Status"}),e.jsx("th",{className:"min-w-[80px]",children:"Item Count"}),e.jsx("th",{children:"Total"}),e.jsx("th",{className:"min-w-[80px]",children:"Paid Amount"}),e.jsx("th",{className:"",children:"Kasar Amount"}),e.jsx("th",{className:"min-w-[140px]",children:"Payment Type"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:a.orders.map(s=>{const t=C(s.payment_status),n=L(s.admin_order_status.admin_label),r=s.items.length;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsx("td",{children:e.jsx("span",{className:`${n} badge-outline badge-xl rounded-[30px]`,children:s.admin_order_status.admin_label})}),e.jsx("td",{children:r}),e.jsxs("td",{children:["₹",s.total]}),e.jsxs("td",{children:["₹",s.paid_amount===""?0:s.paid_amount]}),e.jsxs("td",{children:["₹",s.kasar_amount===""?0:s.kasar_amount]}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-outline",children:T[s.payment_type]})}),e.jsx("td",{children:e.jsx("span",{className:`${t} badge-outline`,children:E[s.payment_status]})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>N(s.order_id),children:"View Order"})})]},s.order_id)})})]})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"col-span-2 lg:col-span-1 flex",children:e.jsxs("div",{className:"card grow",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Orders Summary"})}),e.jsx("div",{className:"card-body pt-4 pb-3",children:e.jsx("table",{className:"table-auto",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Total Kasar Amount:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:["₹",v]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Total Order Amount:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:["₹",w]})]}),l.total_pending_amount>0&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm font-medium text-gray-500 min-w-36 pb-5 pe-6",children:"Total Pending Amount:"}),e.jsxs("td",{className:"flex items-center gap-2.5 text-sm font-medium text-gray-700",children:["₹",l.total_pending_amount]}),e.jsx("td",{children:e.jsxs("button",{className:"relative bottom-3 left-4 font-extralight btn btn-lg btn-light",onClick:h,children:["Pay ",e.jsx(A,{size:20})]})})]})]})})})]})})})}),e.jsx(U,{modalOpen:o,onClose:()=>j(!1),userId:d,setRefetch:f})]})};export{D as default};
