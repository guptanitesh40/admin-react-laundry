import{q as X,r as o,i as Y,k as Z,H as ee,V as I,j as e,L as se,b as ae}from"./index-D7NXGV6o.js";import{u as te}from"./useGetCompanies-CXLlkU2p.js";import{u as re,a as le}from"./userSchema-CfXW9anm.js";import{u as oe}from"./useUpdateUser-IWr5XT3h.js";import{u as ne}from"./useGetWorkshops-BfC5nSPw.js";import{u as ie}from"./useGetuser-CnuJRSy4.js";import{M as F}from"./index-h1CqH6pJ.js";const fe=()=>{const{addUser:L,loading:x}=re(),{updateUser:O,loading:b}=oe(),{id:A}=X(),i=A?Number(A):null,v=1e3,w=1,[R,G]=o.useState(!1),p=Y(),{companies:k}=te(w,v),{userData:C,fetchUser:T,loading:B}=ie(),[g,W]=o.useState([]),{branches:S}=Z(w,v),{workshops:E}=ne(w,v),[_,H]=o.useState([]),[j,q]=o.useState([]),n=C==null?void 0:C.user,D=ee(),[d,$]=o.useState(!1),[U,z]=o.useState(!1),y={first_name:"",last_name:"",email:"",mobile_number:"",password:"",gender:null,role_id:null,image:"",company_ids:[],branch_ids:[],workshop_ids:[]},[a,r]=o.useState(y),[V,P]=o.useState(y),[m,M]=o.useState({});o.useEffect(()=>{D.pathname.split("/")[1]==="customer"&&$(!0)},[D]),o.useEffect(()=>{d&&r({...a,role_id:5})},[d]),o.useEffect(()=>{i&&(G(!0),T(i))},[i]),o.useEffect(()=>{if(k){const s=k.map(t=>({company_id:t.company_id,company_name:t.company_name}));W(s)}},[k]),o.useEffect(()=>{if(S){const s=S.map(t=>({branch_id:t.branch_id,branch_name:t.branch_name}));H(s)}},[S]),o.useEffect(()=>{if(E){const s=E.map(t=>({workshop_id:t.workshop_id,workshop_name:t.workshop_name}));q(s)}},[E]),o.useEffect(()=>{if(n){if(typeof n.deleted_at=="string"&&n.deleted_at!==""){I.error("This user has been deleted and cannot be edited."),p(d?"/customers":"/users");return}const s={...a,first_name:n.first_name,last_name:n.last_name,email:n.email,mobile_number:n.mobile_number,gender:n.gender,role_id:n.role_id,branch_ids:n.branch_ids,company_ids:n.company_ids,workshop_ids:n.workshop_ids};r(s),P(s)}else r(y),P(y),M({})},[n]);const J=s=>{const t=s.target;if(t instanceof HTMLInputElement){const{name:u,value:c,files:l}=t;u==="image"&&l&&l.length>0?r(N=>({...N,image:l[0]})):r(N=>({...N,[u]:c}))}else if(t instanceof HTMLTextAreaElement){const{name:u,value:c}=t;r(l=>({...l,[u]:c}))}},K=async s=>{s.preventDefault();try{if(await le(!!i).validate(a,{abortEarly:!1}),!Object.keys(a).some(l=>l==="image"?a.image instanceof File||a.image!==V.image:a[l]!==V[l])){p(d?"/customers":"/users");return}let c;if(i){const l=new FormData;Object.keys(a).forEach(h=>{h==="image"&&a.image instanceof File?l.append(h,a.image):h==="company_ids"&&Array.isArray(a.company_ids)?a.company_ids.forEach(f=>{l.append("company_ids",f.toString())}):h==="branch_ids"&&Array.isArray(a.branch_ids)?a.branch_ids.forEach(f=>{l.append("branch_ids",f.toString())}):h==="workshop_ids"&&Array.isArray(a.workshop_ids)?a.workshop_ids.forEach(f=>{l.append("workshop_ids",f.toString())}):l.append(h,a[h])}),l.get("image")||l.delete("image"),c=await O(i,l)}else c=await L(a);c&&p(d?"/customers":"/users")}catch(t){if(t instanceof ae){const u={};t.inner.forEach(c=>{u[c.path||""]=c.message}),M(u)}else I.error("Failed to submit the form. Please try again.")}},Q=()=>{p(d?"/customers":"/users")};return i&&(!R||B)?e.jsx(se,{}):e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:d?i?"Edit Customer":"Add Customer":i?"Edit User":"Add User"}),e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"first_name",className:"block text-gray-700 font-semibold",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",autoComplete:"off",value:a.first_name||"",onChange:s=>r({...a,first_name:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.first_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"last_name",className:"block text-gray-700 font-semibold",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",autoComplete:"off",value:a.last_name||"",onChange:s=>r({...a,last_name:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.last_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:a.email||"",onChange:s=>r({...a,email:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"mobile_number",className:"block text-gray-700 font-semibold",children:"Mobile number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:a.mobile_number||"",onChange:s=>r({...a,mobile_number:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.mobile_number||" "})]}),!d&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-700 font-semibold",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:U?"text":"password",id:"password",name:"password",autoComplete:"off",value:a.password||"",onChange:s=>r({...a,password:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer",onClick:()=>z(s=>!s),children:U?e.jsx("i",{className:"ki-filled ki-eye-slash text-gray-500"}):e.jsx("i",{className:"ki-filled ki-eye text-gray-500"})})]}),e.jsx("p",{className:"text-red-500 text-sm",children:m.password||" "})]}),!d&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"role_id",children:"Role"}),e.jsxs("select",{id:"role_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:a.role_id===null?"":a.role_id,onChange:s=>r({...a,role_id:s.target.value?parseInt(s.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Role"}),e.jsx("option",{value:1,children:"Super Admin"}),e.jsx("option",{value:2,children:"Sub Admin"}),e.jsx("option",{value:3,children:"Branch Manager"}),e.jsx("option",{value:4,children:"Delivery and Pickup"}),e.jsx("option",{value:5,children:"Customer"}),e.jsx("option",{value:6,children:"Workshop Manager"}),e.jsx("option",{value:7,children:"Vendor"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:m.role_id||" "})]}),(a.role_id===2||a.role_id===1)&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Company"}),e.jsx(F,{options:g,displayValue:"company_name",selectedValues:g==null?void 0:g.filter(s=>{var t;return(t=a.company_ids)==null?void 0:t.includes(s.company_id)}),onSelect:s=>{r({...a,company_ids:s.map(t=>t.company_id)})},onRemove:s=>{r({...a,company_ids:s.map(t=>t.company_id)})},isObject:!0}),e.jsx("p",{className:"text-red-500 text-sm",children:m.company_ids||" "})]}),a.role_id===3&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Branch"}),e.jsx(F,{options:_,displayValue:"branch_name",selectedValues:_==null?void 0:_.filter(s=>{var t;return(t=a.branch_ids)==null?void 0:t.includes(s.branch_id)}),onSelect:s=>{r({...a,branch_ids:s.map(t=>t.branch_id)})},onRemove:s=>{r({...a,branch_ids:s.map(t=>t.branch_id)})},isObject:!0})]}),a.role_id===6&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Workshop"}),e.jsx(F,{options:j,displayValue:"workshop_name",selectedValues:j==null?void 0:j.filter(s=>{var t;return(t=a.workshop_ids)==null?void 0:t.includes(s.workshop_id)}),onSelect:s=>{r({...a,workshop_ids:s.map(t=>t.workshop_id)})},onRemove:s=>{r({...a,workshop_ids:s.map(t=>t.workshop_id)})},isObject:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:a.gender===1,onChange:s=>r({...a,gender:parseInt(s.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:a.gender===2,onChange:s=>r({...a,gender:parseInt(s.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:a.gender===3,onChange:s=>r({...a,gender:parseInt(s.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:m.gender||" "})]}),i&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"image",className:"block text-gray-700 font-semibold",children:"Profile Photo"}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:J,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.image||" "})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${x||b?"opacity-50 cursor-not-allowed":""}`,disabled:x||b,children:x||b?x?"Adding...":"Updating...":d?i?"Update customer":"Add customer":i?"Update user":"Add User"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:Q,disabled:x||b,children:"Cancel"})]})]})]})};export{fe as default};
