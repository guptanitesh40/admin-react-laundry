import{a3 as U,r as n,j as e,u as X,a4 as Z,a5 as ee,e as se,T as ae,l as Y,g as te,h as le,s as ne,b as re,V as ie}from"./index-6J7qaUxy.js";import{M as ce}from"./MultiSelect-BEOuPAXF.js";import"./orderStatusClasses-HfHBGnti.js";const F=t=>{switch(t){case 1:return"one-star-rating";case 2:return"two-star-rating";case 3:return"three-star-rating";case 4:return"four-star-rating";case 5:return"five-star-rating";default:return"custom-rating-on"}},oe=()=>{const{customerRatingData:t,fetchCustomerRatingData:u}=U(),[c,j]=n.useState([{label:"5",count:0},{label:"4",count:0},{label:"3",count:0},{label:"2",count:0},{label:"1",count:0}]),[b,N]=n.useState(0),[o,C]=n.useState(0);n.useEffect(()=>{u()},[]),n.useEffect(()=>{if(t){const l=c.map(r=>{const m=t==null?void 0:t.find(y=>y.rating.toString()===r.label);return m?{...r,count:m.count}:r});j(l);const i=t==null?void 0:t.reduce((r,m)=>r+m.rating*m.count,0),x=t==null?void 0:t.reduce((r,m)=>r+m.count,0),v=i/x;N(v),C(x)}},[t]);const d=Math.max(...c.map(l=>l.count)),f=(l,i)=>{const x=Number(l);if(i===0)return"bg-gray-200";switch(x){case 1:return"bg-red-500";case 2:return"bg-green-500";case 3:return"bg-yellow-500";case 4:return"bg-orange-500";case 5:return"bg-blue-500";default:return"bg-gray-200"}};return e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"flex flex-wrap mt-3 justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 ml-3",children:[e.jsx("div",{children:e.jsx("img",{className:"default-logo h-[55px] max-w-none",src:"/media/app/review.png"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl text-gray-700 font-bold",children:b.toFixed(2)}),e.jsxs("p",{className:"text-base font-semibold text-gray-700",children:["─ of ",o," reviews"]})]})]}),e.jsx("div",{className:"card-body flex flex-col gap-2 custom-body min-w-[250px]",children:c.map((l,i)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex justify-between text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("span",{children:l.label}),e.jsx("div",{className:"rating-label custom-rating checked",children:e.jsx("i",{className:`${F(Number(l.label))} rating-on ki-solid ki-star text-base leading-none`})},i)]})}),e.jsx("div",{className:"w-full h-[8px] bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:`${f(l.label,l.count)} rounded-full h-full transition-all duration-500`,style:{width:`${l.count/d*100}%`}})}),e.jsx("span",{className:"font-medium text-sm text-gray-600",children:l.count})]},i))})]})})})},B=t=>{switch(t){case 1:return"badge badge-danger badge-outline";case 2:return"badge badge-info badge-outline";case 3:return"badge badge-warning badge-outline";default:return""}},de=()=>{const[t,u]=n.useState(1),[c,j]=n.useState(10),[b,N]=X(),[o,C]=n.useState(null),[d,f]=n.useState(null),l=b.get("page"),i=b.get("perPage"),[x,v]=n.useState(""),[r,m]=n.useState(""),[y,$]=n.useState(""),[P,D]=n.useState(),[R,M]=n.useState([]),{feedbacks:g,count:_,fetchFeedbacks:z,loading:G}=Z(t,c,x,o,d,R,P),{approveFeedback:L}=ee(),{hasPermission:S}=se(),w=Math.ceil(_/c);n.useEffect(()=>{l&&u(Number(l)),i&&j(Number(i))},[l,i]);const W=async s=>{s.preventDefault();try{await ne.validate({search:r},{abortEarly:!1}),v(r),$("")}catch(a){a instanceof re&&$(a.errors[0])}},p=s=>{o===s?f(d==="ASC"?"DESC":"ASC"):(C(s),f("ASC"))},A=s=>{s>=1&&s<=w&&(u(s),N({page:s.toString(),perPage:c.toString()}))},q=s=>{const a=Number(s.target.value);j(a),u(1),N({page:"1",perPage:a.toString()})},H=s=>Array.from({length:5}).map((a,h)=>e.jsxs("div",{className:`rating-label ${h<s?"checked":""}`,children:[e.jsx("i",{className:`rating-on ki-solid ki-star text-base leading-none ${h<s?F(s):""}`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]},h)),J=async(s,a)=>{try{await L(s,a),z()}catch{ie.error("Failed to update publish status:")}},K=Array.from({length:5},(s,a)=>({label:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-1",children:a+1}),e.jsxs("div",{className:"rating-label checked mb-1",children:[e.jsx("i",{className:`rating-on ${F(a+1)} ki-solid ki-star text-base leading-none`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]})]},a),value:a+1}));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:c,onChange:q,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(ce,{options:K,displayValue:"label",placeholder:"Select Rating",selectedValues:R,onSelect:s=>M(s.map(a=>a.value)),onRemove:s=>M(s.map(a=>a.value)),className:"lgmobile:min-w-[250px] vsmobile:min-w-[235px]",sliceCount:3,isSearchInput:!1})}),e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${B(P)}`,value:P,onChange:s=>D(Number(s.target.value)),children:[e.jsx("option",{value:"",children:"Publish Status"}),e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:W,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:r,onChange:s=>{m(s.target.value),s.target.value===""&&v("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:y||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[70px]",children:e.jsxs("span",{className:`sort ${o==="order_id"?d==="ASC"?"asc":"desc":""}`,onClick:()=>p("order_id"),children:[e.jsx("span",{className:"sort-label",children:"Order Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${o==="first_name"?d==="ASC"?"asc":"desc":""}`,onClick:()=>p("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${o==="email"?d==="ASC"?"asc":"desc":""}`,onClick:()=>p("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${o==="mobile_number"?d==="ASC"?"asc":"desc":""}`,onClick:()=>p("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile no"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[100px]",children:"Rating"}),e.jsx("th",{className:"min-w-[300px]",children:"Comment"}),e.jsx("th",{className:"min-w-[120px]",children:e.jsxs("span",{className:`sort ${o==="created_at"?d==="ASC"?"asc":"desc":""}`,onClick:()=>p("created_at"),children:[e.jsx("span",{className:"sort-label",children:"Date"}),e.jsx("span",{className:"sort-icon"})]})}),(S(17,"create")||S(17,"update"))&&e.jsx("th",{className:"min-w-[140px]",children:"Publish"})]})}),G?e.jsx(ae,{}):(g==null?void 0:g.length)>0?e.jsx("tbody",{children:g.map(s=>{var a,h,E,k,V,I,O,T;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsxs("td",{children:[(h=(a=s==null?void 0:s.order)==null?void 0:a.user)==null?void 0:h.first_name," ",(k=(E=s==null?void 0:s.order)==null?void 0:E.user)==null?void 0:k.last_name]}),e.jsx("td",{children:(I=(V=s==null?void 0:s.order)==null?void 0:V.user)==null?void 0:I.email}),e.jsx("td",{children:(T=(O=s==null?void 0:s.order)==null?void 0:O.user)==null?void 0:T.mobile_number}),e.jsx("td",{children:e.jsx("div",{className:"rating",children:H(s.rating)})}),e.jsx("td",{children:s.comment}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[Y(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),Y(s.created_at).format("hh:mm:ss A")]})}),(S(17,"create")||S(17,"update"))&&e.jsx("td",{children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${B(s.is_publish)}`,value:s.is_publish,onChange:Q=>J(s.feedback_id,Q.target.value),children:[e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})})]},s.feedback_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No feedback data available"})})})]})}),_>c&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",g.length," of ",_," feedbacks"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:t===1,onClick:()=>A(t-1),className:`btn ${t===1?"disabled":""}`,children:e.jsx(te,{})}),Array.from({length:w}).map((s,a)=>e.jsx("button",{className:`btn ${t===a+1?"active":""}`,onClick:()=>A(a+1),children:a+1},a)),e.jsx("button",{disabled:t===w,onClick:()=>A(t+1),className:`btn ${t===w?"disabled":""}`,children:e.jsx(le,{})})]})]})})]})})]})},ue=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Feedback And Rating"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx(oe,{})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(de,{})})})})]});export{ue as default};
