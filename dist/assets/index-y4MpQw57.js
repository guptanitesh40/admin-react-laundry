import{r,V as y,i as K,j as t,D as Q,k as V}from"./index-uvtpSlnJ.js";import{M as f}from"./MultiSelect-ChdG0H2p.js";import{u as W}from"./useGetCompanies-B53_uj83.js";import"./orderStatusClasses-HfHBGnti.js";const F=(n,l="")=>{const[g,v]=r.useState(!1),[w,_]=r.useState([]);return r.useEffect(()=>{(async()=>{const x=localStorage.getItem("authToken"),S=`http://35.154.167.170:3000/user/by-role?role_id=${n}`,d=new URLSearchParams;l&&d.append("search",l),v(!0);try{const o=await fetch(`${S}&${d}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`}});if(!o.ok){const u=await o.json();y.error(u.message||"Failed to fetch users",{position:"top-center"});return}const i=await o.json();_((i==null?void 0:i.data)||[])}catch(o){y.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{v(!1)}})()},[n,l]),{users:w,loading:g}},{RangePicker:X}=Q,Z=({reportTitle:n,index:l,dynamic_url:g})=>{const[_,R]=r.useState(""),[x,S]=r.useState(""),[d,o]=r.useState([]),[i,u]=r.useState([]),[p,N]=r.useState([]),[b,D]=r.useState([]),{users:U,loading:C}=F(5,_),{users:I,loading:P}=F(4,x),{companies:E,loading:$}=W(1,1e3),{branches:B,loading:M}=K(1,1e3,"","","",p),[k,Y]=r.useState(!1),[h,L]=r.useState({start_time:"",end_time:""}),G="http://35.154.167.170:3000",O=localStorage.getItem("authToken"),A=r.useMemo(()=>C?[{label:"Loading...",value:0}]:U.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[U,C]),T=r.useMemo(()=>n!=="Pick Up Report"&&n!=="Delivery Report"?[]:P?[{label:"Loading...",value:0}]:I.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[n,I,P]),q=r.useMemo(()=>$?[{label:"Loading...",value:0}]:E.map(e=>({label:e.company_name,value:e.company_id})),[E,$]),z=r.useMemo(()=>M?[{label:"Loading...",value:0}]:B.map(e=>({label:e.branch_name,value:e.branch_id})),[B,M]),H=e=>{L(e?{start_time:V(e[0]).format("DD-MM-YYYY"),end_time:V(e[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},J=e=>{switch(e){case 0:c();break;case 1:c();break;case 2:c();break;case 3:c();break;case 4:c();break;case 5:c();break;case 6:c();break;default:c()}},c=async()=>{Y(!0);const e=new URLSearchParams;h.start_time&&h.end_time&&(e.append("startDate",h.start_time),e.append("endDate",h.end_time)),d.length&&d.forEach(a=>e.append("user_id",a)),i.length&&i.forEach(a=>e.append("driver_id",a)),p.length&&p.forEach(a=>e.append("company_id",a)),b.length&&b.forEach(a=>e.append("branch_id",a));try{const a=await fetch(`${G}/report/${g}?format=excel&${e}`,{headers:{Authorization:`Bearer ${O}`}}),s=await a.json();if(!a.ok)throw new Error(s.message||"Failed to download report");const j=s==null?void 0:s.url;if(!j){y.error("Download report not found");return}const m=document.createElement("a");m.href=j,m.download=j,document.body.appendChild(m),m.click(),m.remove()}catch(a){y.error(a.message||"Network error: Failed to download report")}finally{Y(!1)}};return t.jsxs("div",{className:"card !shadow-black/10",children:[t.jsx("div",{className:"card-header",children:t.jsx("h3",{className:"card-title",children:n})}),t.jsxs("div",{className:"card-body flex flex-col gap-3",children:[t.jsx("div",{children:t.jsx(X,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:H,format:"DD-MM-YYYY"})}),t.jsx("div",{className:"mui-multiselect-parent",children:t.jsx(f,{options:q,displayValue:"label",placeholder:"Select Company",selectedValues:p,onSelect:e=>{const a=e.map(s=>s.value);N(a)},onRemove:e=>{const a=e.map(s=>s.value);N(a)},className:"w-full",isSearchInput:!1})}),t.jsx("div",{className:"mui-multiselect-parent",children:t.jsx(f,{options:z,displayValue:"label",placeholder:"Select Branch",selectedValues:b,onSelect:e=>{const a=e.map(s=>s.value);D(a)},onRemove:e=>{const a=e.map(s=>s.value);D(a)},className:"w-full",isSearchInput:!1})}),t.jsx("div",{className:"mui-multiselect-parent",children:t.jsx(f,{options:A,displayValue:"label",placeholder:"Select Customer",selectedValues:d,onSelect:e=>{const a=e.map(s=>s.value);o(a)},onRemove:e=>{const a=e.map(s=>s.value);o(a)},setSearch:R,className:"w-full",isSearchInput:!0})}),(n==="Pick Up Report"||n==="Delivery Report")&&t.jsx("div",{className:"mui-multiselect-parent",children:t.jsx(f,{options:T,defaultOption:"No Data Found",displayValue:"label",placeholder:n==="Pick Up Report"?"Select PickUp Boy":"Select Delivery Boy",selectedValues:i,onSelect:e=>{const a=e.map(s=>s.value);u(a)},onRemove:e=>{const a=e.map(s=>s.value);u(a)},setSearch:S,className:"w-full",isSearchInput:!0})})]}),t.jsx("div",{className:"card-footer",children:t.jsxs("button",{disabled:k,className:"w-full inline-flex items-center justify-center btn btn-primary px-3 py-2 relative overflow-hidden",onClick:()=>J(l),children:[k&&t.jsx("span",{className:"absolute inset-0 loading-bar"}),t.jsx("span",{children:k?"Downloading...":"Download"})]})})]},l)},ee=[{name:"Total Order Report",dynamic_url:"total-orders"},{name:"Payment Transaction Report",dynamic_url:"payment-transaction"},{name:"Refund Report",dynamic_url:"refund-report"},{name:"In Active Customer Report",dynamic_url:"inactive-customer-report"},{name:"GST Report",dynamic_url:"gst"},{name:"Pick Up Report",dynamic_url:"pickup"},{name:"Delivery Report",dynamic_url:"delivery"}],ne=()=>t.jsx("main",{className:"grow content",id:"content",role:"content",children:t.jsxs("div",{className:"container-fixed",children:[t.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:t.jsx("div",{className:"flex flex-col justify-center gap-2",children:t.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Reports"})})}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start",children:ee.map((n,l)=>t.jsx(Z,{reportTitle:n.name,dynamic_url:n.dynamic_url,index:l},l))})]})});export{ne as default};
