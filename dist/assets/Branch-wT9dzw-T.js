import{r as o,_ as P,u as R,x as M,n as k,j as e,F as j,a as b,T as U,b as z,c as G,d as O,e as V,S as f,s as Y,V as H}from"./index-CrW1VcAo.js";import{u as W}from"./useGetBranch-2Bj2i7Tv.js";const Z=()=>{const[i,a]=o.useState(!1);return{deleteBranch:async t=>{a(!0);const h=`http://35.154.167.170:3000/branches/${t}`,m=localStorage.getItem("authToken");try{const c=await fetch(h,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}}),r=await c.json();return c.ok?{success:!0,message:r.message}:(P.error(r.message,{position:"top-center"}),{success:!1,message:r.message})}catch(c){return P.error(c.message,{position:"top-center"}),{success:!1,message:c.message}}finally{a(!1)}},loading:i}},q=({search:i})=>{const[a,d]=o.useState(1),[t,h]=o.useState(10),[m,c]=R(),[r,y]=o.useState(null),[n,x]=o.useState(null),N=m.get("page"),S=m.get("perPage"),{branches:g,fetchBranches:v,totalBranches:C,loading:A}=W(a,t,i,r,n),{companies:D}=M(),B=k(),u=Math.ceil(C/t),{deleteBranch:L}=Z(),T=s=>{B(`/branch/edit/${s.branch_id}`,{state:{branch:s}})},F=async s=>{try{const{isConfirmed:l}=await f.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(l){const{success:_,message:E}=await L(s);_?(g.filter(I=>I.branch_id!==s).length===0&&a>1&&(d(a-1),c({page:(a-1).toString(),perPage:t.toString()})),await v(),f.fire(E)):f.fire(E)}}catch(l){f.fire({title:"Error",text:l.message,icon:"error"})}};o.useEffect(()=>{N&&d(Number(N)),S&&h(Number(S))},[N,S]),o.useEffect(()=>{i?(d(1),c({search:i,page:"1",perPage:t.toString()})):c({page:"1",perPage:t.toString()})},[i]),o.useEffect(()=>{v()},[t,a,i,r,n,v]);const p=s=>{r===s?x(n==="ASC"?"DESC":"ASC"):(y(s),x("ASC"))},w=s=>{s>=1&&s<=u&&(d(s),c({page:s.toString(),perPage:t.toString()}))},$=s=>{const l=Number(s.target.value);h(l),d(1),c({page:"1",perPage:l.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:t,onChange:$,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-4.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:e.jsxs("div",{className:"flex justify-between",onClick:()=>p("branch_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(j,{color:r==="branch_id"&&n==="ASC"?"gray":"lightgray"}),e.jsx(b,{color:r==="branch_id"&&n==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between",onClick:()=>p("branch_name"),children:["Branch Name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(j,{color:r==="branch_name"&&n==="ASC"?"gray":"lightgray"}),e.jsx(b,{color:r==="branch_name"&&n==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between",onClick:()=>p("branch_address"),children:["Address",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx("span",{children:e.jsx(j,{color:r==="branch_address"&&n==="ASC"?"gray":"lightgray"})}),e.jsx("span",{children:e.jsx(b,{color:r==="branch_address"&&n==="DESC"?"gray":"lightgray"})})]})]})}),e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("div",{className:"flex justify-between",onClick:()=>p("company_name"),children:["Company Name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx("span",{children:e.jsx(j,{color:r==="company_name"&&n==="DESC"?"gray":"lightgray"})}),e.jsx("span",{children:e.jsx(b,{color:r==="company_name"&&n==="DESC"?"gray":"lightgray"})})]})]})}),e.jsx("th",{className:"w-[50px]",children:"Actions"})]})}),A?e.jsx(U,{}):g.length>0?e.jsx("tbody",{children:g.map(s=>{var l;return e.jsxs("tr",{children:[e.jsx("td",{children:s.branch_id}),e.jsx("td",{children:e.jsx("span",{className:"cursor-pointer hover:text-primary",onClick:()=>B(`/branch-profile/${s.branch_id}`),children:s.branch_name})}),e.jsx("td",{children:s.branch_address}),e.jsx("td",{children:((l=D.find(_=>_.company_id===s.company_id))==null?void 0:l.company_name)||"Not Available"}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(s),className:"bg-yellow-100 hover:bg-yellow-200 p-2 rounded-full",children:e.jsx(z,{className:"text-yellow-600"})}),e.jsx("button",{onClick:()=>F(s.branch_id),className:"bg-red-100 hover:bg-red-200 p-2 rounded-full",children:e.jsx(G,{className:"text-red-500"})})]})})]},s.branch_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"No branches available."})})})]})})})}),C>t&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",g.length," of ",C," Branches"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:a===1,onClick:()=>w(a-1),className:`btn ${a===1?"disabled":""}`,children:e.jsx(O,{})}),Array.from({length:u}).map((s,l)=>e.jsx("button",{className:`btn ${a===l+1?"active":""}`,onClick:()=>w(l+1),children:l+1},l)),e.jsx("button",{disabled:a===u,onClick:()=>w(a+1),className:`btn ${a===u?"disabled":""}`,children:e.jsx(V,{})})]})]})]})},X=()=>{const i=k(),[a,d]=o.useState(""),[t,h]=o.useState(""),[m,c]=o.useState(""),r=()=>{i("/branch/add")},y=async n=>{n.preventDefault();try{await Y.validate({search:t},{abortEarly:!1}),d(t),c("")}catch(x){x instanceof H&&c(x.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-7.5",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900 py-3",children:"Branch List"})}),e.jsx("button",{onClick:r,className:"btn btn-primary",children:"Add Branch"})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:y,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:t,onChange:n=>h(n.target.value),className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:m||"Â "})]}),e.jsx(q,{search:a})]})};export{X as default};
