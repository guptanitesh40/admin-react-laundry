import{Q as Z,r as t,j as e,u as k,S as ee,T as se,d as ae,e as te,V as le}from"./index-Dq441dD2.js";import{s as ne}from"./searchSchema-DGXoJ2hy.js";import{d as Y}from"./dayjs.min-DTFaOsHK.js";import{M as re}from"./MultiSelect-CYL6yZd0.js";import"./orderStatusClasses-DgGpuqsn.js";const ie=()=>{const{customerRatingData:l,fetchCustomerRatingData:j}=Z(),[m,N]=t.useState([{label:"5",count:0},{label:"4",count:0},{label:"3",count:0},{label:"2",count:0},{label:"1",count:0}]),[b,v]=t.useState(0),[n,S]=t.useState(0);t.useEffect(()=>{j()},[]),t.useEffect(()=>{if(l){const c=m.map(o=>{const i=l.find(w=>w.rating.toString()===o.label);return i?{...o,count:i.count}:o});N(c);const x=l.reduce((o,i)=>o+i.rating*i.count,0),g=l.reduce((o,i)=>o+i.count,0),C=x/g;v(C),S(g)}},[l]);const r=Math.max(...m.map(c=>c.count));return e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"card w-full",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Customer Rating"})}),e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 ml-3",children:[e.jsx("div",{children:e.jsx("img",{className:"default-logo h-[55px] max-w-none",src:"/media/app/review.png"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl text-gray-700 font-bold",children:b.toFixed(2)}),e.jsxs("p",{className:"text-base font-semibold text-gray-700",children:["─ of ",n," reviews"]})]})]}),e.jsx("div",{className:"card-body flex flex-col gap-2 custom-body",children:m.map((c,x)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex justify-between text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("span",{children:c.label}),e.jsx("div",{className:"rating-label custom-rating checked",children:e.jsx("i",{className:"custom-rating-on rating-on ki-solid ki-star text-base leading-none"})},x)]})}),e.jsx("div",{className:"w-full h-[8px] bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"progressbar h-full transition-all duration-500",style:{width:`${c.count/r*100}%`}})}),e.jsx("span",{className:"font-medium text-sm text-gray-600",children:c.count})]},x))})]})]})})},T=l=>{switch(l){case 1:return"badge badge-danger badge-outline";case 2:return"badge badge-info badge-outline";case 3:return"badge badge-warning badge-outline";default:return""}},ce=()=>{const[l,j]=t.useState(1),[m,N]=t.useState(10),[b,v]=k(),[n,S]=t.useState(null),[r,c]=t.useState(null),x=b.get("page"),g=b.get("perPage"),[C,o]=t.useState(""),[i,w]=t.useState(""),[z,A]=t.useState(""),[_,B]=t.useState(),[P,F]=t.useState([]),[G,L]=t.useState(!1),[W,$]=t.useState([]),{feedbacks:d,count:y,fetchFeedbacks:Q}=ee(l,m,C,n,r,P,_),{approveFeedback:U}=se(),f=Math.ceil(y/m);t.useEffect(()=>{Q(),L(!1)},[G]),t.useEffect(()=>{if((d==null?void 0:d.length)>0){const s=d==null?void 0:d.map(a=>{var u,p,E,D,M,I,O,V;return{first_name:(p=(u=a==null?void 0:a.order)==null?void 0:u.user)==null?void 0:p.first_name,last_name:(D=(E=a==null?void 0:a.order)==null?void 0:E.user)==null?void 0:D.last_name,order_id:a.order_id,email:(I=(M=a==null?void 0:a.order)==null?void 0:M.user)==null?void 0:I.email,created_at:a.created_at,mobile_number:(V=(O=a==null?void 0:a.order)==null?void 0:O.user)==null?void 0:V.mobile_number,feedback_id:a.feedback_id,is_publish:a.is_publish,comment:a.comment,rating:a.rating}});$(s)}},[d]),t.useEffect(()=>{x&&j(Number(x)),g&&N(Number(g))},[x,g]);const q=async s=>{s.preventDefault();try{await ne.validate({search:i},{abortEarly:!1}),o(i),A("")}catch(a){a instanceof le&&A(a.errors[0])}},h=s=>{n===s?c(r==="ASC"?"DESC":"ASC"):(S(s),c("ASC"))},R=s=>{s>=1&&s<=f&&(j(s),v({page:s.toString(),perPage:m.toString()}))},H=s=>{const a=Number(s.target.value);N(a),j(1),v({page:"1",perPage:a.toString()})},J=s=>Array.from({length:5}).map((a,u)=>e.jsxs("div",{className:`rating-label ${u<s?"checked":""}`,children:[e.jsx("i",{className:"rating-on custom-rating-on ki-solid ki-star text-base leading-none"}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]},u)),K=(s,a)=>{$(u=>u.map(p=>p.feedback_id===s?{...p,is_publish:a}:p)),U(s,a)},X=Array.from({length:5},(s,a)=>({label:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-1",children:a+1}),e.jsxs("div",{className:"rating-label checked mb-1",children:[e.jsx("i",{className:"rating-on custom-rating-on ki-solid ki-star text-base leading-none"}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]})]},a),value:a+1}));if(d)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:m,onChange:H,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(re,{options:X,displayValue:"label",placeholder:"Select Rating",selectedValues:P,onSelect:s=>F(s.map(a=>a.value)),onRemove:s=>F(s.map(a=>a.value)),className:"min-w-[270px]",sliceCount:3,isSearchInput:!1})}),e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${T(_)}`,value:_,onChange:s=>{B(Number(s.target.value))},children:[e.jsx("option",{value:"",children:"Publish Status"}),e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"Approve"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:q,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:i,onChange:s=>{w(s.target.value),s.target.value===""&&o("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:z||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"min-w-[70px]",children:[e.jsxs("span",{className:`sort ${n==="order_id"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("order_id"),children:[e.jsx("span",{className:"sort-label",children:"Order Id"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[250px]",children:[e.jsxs("span",{className:`sort ${n==="first_name"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer name"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${n==="email"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${n==="mobile_number"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile no"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsxs("th",{className:"min-w-[100px]",children:[e.jsxs("span",{className:`sort ${n==="rating"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("rating"),children:[e.jsx("span",{className:"sort-label",children:"Rating"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[300px]",children:[e.jsxs("span",{className:`sort ${n==="comment"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("comment"),children:[e.jsx("span",{className:"sort-label",children:"Comment"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[120px]",children:[e.jsxs("span",{className:`sort ${n==="date"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("date"),children:[e.jsx("span",{className:"sort-label",children:"Date"}),e.jsx("span",{className:"sort-icon"})]})," "]}),e.jsxs("th",{className:"min-w-[140px]",children:[e.jsxs("span",{className:`sort ${n==="is_publish"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("is_publish"),children:[e.jsx("span",{className:"sort-label",children:"Publish"}),e.jsx("span",{className:"sort-icon"})]})," "]})]})}),d.length>0?e.jsx("tbody",{children:W.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsxs("td",{children:[s.first_name," ",s.last_name]}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.mobile_number}),e.jsx("td",{children:e.jsx("span",{children:e.jsx("div",{className:"rating",children:J(s.rating)})})}),e.jsx("td",{children:s.comment}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[Y(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),Y(s.created_at).format("hh:mm:ss A")]})}),e.jsx("td",{children:e.jsx("span",{className:"menu-badge","data-tooltip":"true","data-tooltip-placement":"top",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${T(s.is_publish)}`,"data-tooltip":"true",value:s.is_publish,onChange:a=>K(s.feedback_id,a.target.value),children:[e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"Approve"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})})})]},s.feedback_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No Feedback data available"})})})]})}),y>m&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",d.length," of ",y," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:l===1,onClick:()=>R(l-1),className:`btn ${l===1?"disabled":""}`,children:e.jsx(ae,{})}),Array.from({length:f}).map((s,a)=>e.jsx("button",{className:`btn ${l===a+1?"active":""}`,onClick:()=>R(a+1),children:a+1},a)),e.jsx("button",{disabled:l===f,onClick:()=>R(l+1),className:`btn ${l===f?"disabled":""}`,children:e.jsx(te,{})})]})]})})]})})]})},ue=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Feedback"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx(ie,{})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(ce,{})})})})]});export{ue as default};
