import{r as b,_ as u,c as k,a as p,h as D,i as A,g as I,j as e,V as P}from"./index-DkLiFbUV.js";import{u as $}from"./useGetCompanies-D-VW1D-Q.js";import{u as R}from"./useGetBranch-BRdFdpfV.js";import{u as U}from"./useGetUsersByRole-BNHrtaVi.js";const T="http://3.110.208.70:3000",O=`${T}/branches`,L=()=>{const[r,i]=b.useState(!1);return{addBranch:async t=>{const l=localStorage.getItem("authToken");i(!0),t.company_id&&typeof t.company_id!="number"&&(t.company_id=Number(t.company_id));const o={...t,company_id:parseInt(t.company_id),branch_manager_id:parseInt(t.branch_manager_id)};try{const c=await fetch(O,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!c.ok){const n=await c.json();return u.error(n.message,{position:"top-center"}),!1}const _=await c.json();return u.success(_.message,{position:"top-center"}),!0}catch(c){return u.error((c==null?void 0:c.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{i(!1)}},loading:r}},G=()=>{const[r,i]=b.useState(!1);return{updateBranch:async(t,l)=>{const o=localStorage.getItem("authToken"),c=`http://3.110.208.70:3000/branches/${t}`;i(!0);const _={...l,company_id:parseInt(l.company_id),branch_manager_id:parseInt(l.branch_manager_id)};try{const n=await fetch(c,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(_)});if(n.ok){const y=await n.json();return u.success(y.message,{position:"top-center"}),!0}const N=await n.json();return u.error(N.message,{position:"top-center"}),!1}catch(n){return u.error((n==null?void 0:n.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{i(!1)}},loading:r}},z=k().shape({branch_name:p().required("Branch name is required"),branch_address:p().required("Branch address is required"),branch_manager_id:p().required("Please select branch manager").test("required","Please select branch manager",r=>!!r),branch_phone_number:p().nullable().test("format","Phone Number must be a 10-digit number",r=>r===null||r===""?!0:/^[0-9]{10}$/.test(r)).test("required","Phone Number is required",r=>!(r===null||r==="")),branch_email:p().required("Email is required").email("Enter a valid email").test("required","Email is required",r=>!!r),branch_registration_number:p().nullable().test("required","Branch registration number is required",r=>!!r),company_id:D().typeError("Company ID must be a number").required("Company ID is required").positive("Company ID must be a positive number").integer("Company ID must be an integer").test("required","Company id must be a number",r=>!!r)}),K=()=>{const{addBranch:r,loading:i}=L(),{updateBranch:j,loading:t}=G(),{id:l}=A(),o=Number(l),c=1e3,_=1,{branch:n,fetchBranch:N}=R(),{companies:y}=$(_,c),{users:B,fetchUsersByRole:C}=U(),v=I(),[s,f]=b.useState({branch_name:"",branch_address:"",branch_manager_id:null,branch_phone_number:"",branch_email:"",branch_registration_number:"",company_id:null}),[w,q]=b.useState({branch_name:"",branch_address:"",branch_manager_id:null,branch_phone_number:"",branch_email:"",branch_registration_number:"",company_id:null}),[m,E]=b.useState({});b.useEffect(()=>{(async()=>{await N(o),await C(3)})()},[o]),b.useEffect(()=>{if(n){const a={branch_name:n.branch_name,branch_address:n.branch_address,branch_manager_id:n.branch_manager_id,branch_phone_number:n.branch_phone_number,branch_email:n.branch_email,branch_registration_number:n.branch_registration_number,company_id:n.company_id};f(a),q(a)}},[n]);const g=a=>{const{name:x,value:d}=a.target;f(h=>({...h,[x]:d}))},F=async a=>{a.preventDefault();try{if(await z.validate(s,{abortEarly:!1}),!Object.keys(s).some(h=>s[h]!==w[h])){v("/branches");return}let d;o?d=await j(l,s):d=await r(s),d&&v("/branches")}catch(x){if(x instanceof P){const d={};x.inner.forEach(h=>{d[h.path||""]=h.message}),E(d)}else u.error("Failed to submit the form. Please try again.")}},S=()=>{v("/branches")};return e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:o?"Edit Branch":"Add Branch"}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_id",children:"Company"}),e.jsxs("select",{id:"company_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.company_id||"",onChange:a=>f({...s,company_id:a.target.value?Number(a.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Company"}),y.length>0?y.map(a=>e.jsx("option",{value:a.company_id,children:a.company_name},a.company_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:m.company_id||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_manager_id",children:"Branch Manager"}),e.jsxs("select",{id:"branch_manager_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.branch_manager_id||"",onChange:a=>f({...s,branch_manager_id:a.target.value?Number(a.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch Manager"}),B?B.map(a=>e.jsxs("option",{value:a.user_id,children:[a.first_name," ",a.last_name]},a.user_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:m.branch_manager_id||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_name",children:"Branch Name"}),e.jsx("input",{type:"text",id:"branch_name",name:"branch_name",value:s.branch_name||"",onChange:g,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.branch_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_address",children:"Branch Address"}),e.jsx("input",{type:"text",id:"branch_address",name:"branch_address",value:s.branch_address||"",onChange:g,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.branch_address||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_phone_number",children:"Branch Phone Number"}),e.jsx("input",{type:"text",id:"branch_phone_number",name:"branch_phone_number",value:s.branch_phone_number||"",onChange:g,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.branch_phone_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_email",children:"Branch Email"}),e.jsx("input",{type:"text",id:"branch_email",name:"branch_email",value:s.branch_email||"",onChange:g,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.branch_email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_registration_number",children:"Branch Registration Number"}),e.jsx("input",{type:"text",id:"branch_registration_number",name:"branch_registration_number",value:s.branch_registration_number||"",onChange:g,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:m.branch_registration_number||" "})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary mt-5 ${i||t?"opacity-50 cursor-not-allowed":""}`,disabled:i||t,children:i||t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):o?"Update Branch":"Add Branch"}),e.jsx("button",{type:"button",className:"mx-5 btn btn-light mt-5",onClick:S,disabled:i||t,children:"Cancel"})]})]})]})};export{K as default};
