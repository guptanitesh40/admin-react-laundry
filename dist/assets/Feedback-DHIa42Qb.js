import{r as t,B as z,V as _,j as e,u as Z,a2 as ee,e as se,T as ae,l as L,P as te,s as ne,b as re}from"./index-BImCLaEY.js";import{M as le}from"./MultiSelect-CGk28bO9.js";import"./orderStatusClasses-HfHBGnti.js";const ie=()=>{const[a,m]=t.useState(),[l,h]=t.useState(!1);return{customerRatingData:a,loading:l,fetchCustomerRatingData:async()=>{const o=localStorage.getItem("authToken");h(!0);try{const c=await fetch(`${z}/report/customers-feedback`,{method:"GET",headers:{Authorization:`Bearer ${o}`}}),f=await c.json();if(!c.ok){_.error(f.message,{position:"top-center"}),h(!1);return}m(f)}catch{_.error("Network error: Failed to fetch data.")}finally{h(!1)}}}},ce=(a=1,m=10,l="",h,j,o,c)=>{const[f,p]=t.useState(),[S,n]=t.useState(!1),[g,u]=t.useState(0),N=async()=>{var w,C;const d=localStorage.getItem("authToken"),i=new URLSearchParams;a&&i.append("page_number",a.toString()),m&&i.append("per_page",m.toString()),l&&i.append("search",l),h&&i.append("sort_by",h),j&&i.append("order",j),c&&i.append("is_publish",c.toString()),o&&o.forEach(x=>i.append("rating",x.toString())),n(!0);try{const x=await fetch(`${z}/feedback?${i}`,{method:"GET",headers:{Authorization:d?`Bearer ${d}`:""}}),b=await x.json();if(!x.ok){_.error(b.message,{position:"top-center"}),n(!1);return}p(((w=b==null?void 0:b.data)==null?void 0:w.feedbacks)||[]),u((C=b==null?void 0:b.data)==null?void 0:C.count)}catch(x){_.error(x||"Network Error : Failed to fetch feedbacks")}finally{n(!1)}};return t.useEffect(()=>{N()},[a,m,l,h,j,c,o]),{feedbacks:f,fetchFeedbacks:N,loading:S,count:g}},F=a=>{switch(a){case 1:return"one-star-rating";case 2:return"two-star-rating";case 3:return"three-star-rating";case 4:return"four-star-rating";case 5:return"five-star-rating";default:return"custom-rating-on"}},oe=()=>{const{customerRatingData:a,fetchCustomerRatingData:m}=ie(),[l,h]=t.useState([{label:"5",count:0},{label:"4",count:0},{label:"3",count:0},{label:"2",count:0},{label:"1",count:0}]),[j,o]=t.useState(0),[c,f]=t.useState(0);t.useEffect(()=>{m()},[]),t.useEffect(()=>{if(a){const n=l.map(d=>{const i=a==null?void 0:a.find(w=>w.rating.toString()===d.label);return i?{...d,count:i.count}:d});h(n);const g=a==null?void 0:a.reduce((d,i)=>d+i.rating*i.count,0),u=a==null?void 0:a.reduce((d,i)=>d+i.count,0),N=g/u;o(N),f(u)}},[a]);const p=Math.max(...l.map(n=>n.count)),S=(n,g)=>{const u=Number(n);if(g===0)return"bg-gray-200";switch(u){case 1:return"bg-red-500";case 2:return"bg-green-500";case 3:return"bg-yellow-500";case 4:return"bg-orange-500";case 5:return"bg-blue-500";default:return"bg-gray-200"}};return e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"flex flex-wrap mt-3 justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 ml-3",children:[e.jsx("div",{children:e.jsx("img",{className:"default-logo h-[55px] max-w-none",src:"/media/app/review.png"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl text-gray-700 font-bold",children:j.toFixed(2)}),e.jsxs("p",{className:"text-base font-semibold text-gray-700",children:["─ of ",c," reviews"]})]})]}),e.jsx("div",{className:"card-body flex flex-col gap-2 custom-body min-w-[250px]",children:l.map((n,g)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex justify-between text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("span",{children:n.label}),e.jsx("div",{className:"rating-label custom-rating checked",children:e.jsx("i",{className:`${F(Number(n.label))} rating-on ki-solid ki-star text-base leading-none`})},g)]})}),e.jsx("div",{className:"w-full h-[8px] bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:`${S(n.label,n.count)} rounded-full h-full transition-all duration-500`,style:{width:`${n.count/p*100}%`}})}),e.jsx("span",{className:"font-medium text-sm text-gray-600",children:n.count})]},g))})]})})})},V=a=>{switch(a){case 1:return"badge badge-danger badge-outline";case 2:return"badge badge-info badge-outline";case 3:return"badge badge-warning badge-outline";default:return""}},de=()=>{const[a,m]=t.useState(1),[l,h]=t.useState(10),[j,o]=Z(),[c,f]=t.useState(null),[p,S]=t.useState(null),n=j.get("page"),g=j.get("perPage"),[u,N]=t.useState(""),[d,i]=t.useState(""),[w,C]=t.useState(""),[x,b]=t.useState(),[R,E]=t.useState([]),{feedbacks:v,count:$,fetchFeedbacks:G,loading:Y}=ce(a,l,u,c,p,R,x),{approveFeedback:O}=ee(),{hasPermission:A}=se(),U=Math.ceil($/l);t.useEffect(()=>{n&&m(Number(n)),g&&h(Number(g))},[n,g]),t.useEffect(()=>{m(1),o(u!==""?{search:u,page:"1",perPage:l.toString()}:{})},[u]),t.useEffect(()=>{(x!==void 0||R.length>0)&&(m(1),o(u!==""?{search:u,page:"1",perPage:l.toString()}:{page:"1",perPage:l.toString()}))},[x,R]);const W=async s=>{s.preventDefault();try{await ne.validate({search:d},{abortEarly:!1}),N(d),C("")}catch(r){r instanceof re&&C(r.errors[0])}},P=s=>{c===s?S(p==="ASC"?"DESC":"ASC"):(f(s),S("ASC"))},q=s=>{s>=1&&s<=U&&(m(s),o({page:s.toString(),perPage:l.toString()}))},H=s=>{const r=Number(s.target.value);h(r),m(1),o({page:"1",perPage:r.toString()})},J=s=>Array.from({length:5}).map((r,y)=>e.jsxs("div",{className:`rating-label ${y<s?"checked":""}`,children:[e.jsx("i",{className:`rating-on ki-solid ki-star text-base leading-none ${y<s?F(s):""}`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]},y)),K=async(s,r)=>{try{await O(s,r),G()}catch{_.error("Failed to update publish status:")}},Q=Array.from({length:5},(s,r)=>({label:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-1",children:r+1}),e.jsxs("div",{className:"rating-label checked mb-1",children:[e.jsx("i",{className:`rating-on ${F(r+1)} ki-solid ki-star text-base leading-none`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]})]},r),value:r+1}));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:l,onChange:H,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(le,{options:Q,displayValue:"label",placeholder:"Select Rating",selectedValues:R,onSelect:s=>E(s.map(r=>r.value)),onRemove:s=>E(s.map(r=>r.value)),className:"lgmobile:min-w-[250px] vsmobile:min-w-[235px]",sliceCount:3,isSearchInput:!1})}),e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${V(x)}`,value:x,onChange:s=>b(Number(s.target.value)),children:[e.jsx("option",{value:"",children:"Publish Status"}),e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:W,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:d,onChange:s=>{i(s.target.value),s.target.value===""&&N("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:w||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[70px]",children:e.jsxs("span",{className:`sort ${c==="order_id"?p==="ASC"?"asc":"desc":""}`,onClick:()=>P("order_id"),children:[e.jsx("span",{className:"sort-label",children:"Order Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="first_name"?p==="ASC"?"asc":"desc":""}`,onClick:()=>P("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="email"?p==="ASC"?"asc":"desc":""}`,onClick:()=>P("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${c==="mobile_number"?p==="ASC"?"asc":"desc":""}`,onClick:()=>P("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile no"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[100px]",children:"Rating"}),e.jsx("th",{className:"min-w-[300px]",children:"Comment"}),e.jsx("th",{className:"min-w-[120px]",children:e.jsxs("span",{className:`sort ${c==="created_at"?p==="ASC"?"asc":"desc":""}`,onClick:()=>P("created_at"),children:[e.jsx("span",{className:"sort-label",children:"Date"}),e.jsx("span",{className:"sort-icon"})]})}),(A(17,"create")||A(17,"update"))&&e.jsx("th",{className:"min-w-[140px]",children:"Publish"})]})}),Y?e.jsx(ae,{}):(v==null?void 0:v.length)>0?e.jsx("tbody",{children:v.map(s=>{var r,y,k,M,T,B,D,I;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsxs("td",{children:[(y=(r=s==null?void 0:s.order)==null?void 0:r.user)==null?void 0:y.first_name," ",(M=(k=s==null?void 0:s.order)==null?void 0:k.user)==null?void 0:M.last_name]}),e.jsx("td",{children:(B=(T=s==null?void 0:s.order)==null?void 0:T.user)==null?void 0:B.email}),e.jsx("td",{children:(I=(D=s==null?void 0:s.order)==null?void 0:D.user)==null?void 0:I.mobile_number}),e.jsx("td",{children:e.jsx("div",{className:"rating",children:J(s.rating)})}),e.jsx("td",{children:s.comment}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[L(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),L(s.created_at).format("hh:mm:ss A")]})}),(A(17,"create")||A(17,"update"))&&e.jsx("td",{children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${V(s.is_publish)}`,value:s.is_publish,onChange:X=>K(s.feedback_id,X.target.value),children:[e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})})]},s.feedback_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No feedback data available"})})})]})}),e.jsx(te,{count:$,currentPage:a,totalRecords:v==null?void 0:v.length,perPage:l,onPageChange:q,label:"feedbacks"})]})})]})},ge=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Feedback And Rating"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx(oe,{})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(de,{})})})})]});export{ge as default};
