import{r as l,_ as v,i as T,g as G,j as e,V as $}from"./index-BKkjcOAn.js";import{u as L}from"./useGetCompanies-BhvM9qdX.js";import{u as z}from"./useGetBranches-CLnX_sVU.js";import{u as J,a as W}from"./userSchema-DQ2uYrb3.js";import{u as q}from"./useGetuser-bhbhu1a3.js";import{M as P}from"./index-BCAVsHf5.js";const H=()=>{const[w,m]=l.useState(!1);return{updateUser:async(u,f)=>{const n=localStorage.getItem("authToken"),g=`http://35.154.167.170:3000/user/${u}`;m(!0);try{const p=await fetch(g,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!p.ok){const h=await p.json();return v.error(h.message,{position:"top-center"}),!1}const x=await p.json();return v.success(x.message,{position:"top-center"}),!0}catch(p){return v.error(p.message,{position:"top-center"}),!1}finally{m(!1)}},loading:w}},ae=()=>{const{addUser:w,loading:m}=J(),{updateUser:S,loading:u}=H(),{id:f}=T(),n=f?Number(f):null,g=1e3,p=1,x=G(),{companies:h}=L(p,g),{userData:C,fetchUser:A}=q(),[j,R]=l.useState([]),{branches:k}=z(p,g),[_,V]=l.useState([]),i=C==null?void 0:C.user,y={first_name:"",last_name:"",email:"",password:"",mobile_number:"",gender:null,role_id:null,image:"",company_ids:[],branch_ids:[]},[s,r]=l.useState(y),[F,D]=l.useState(y),[d,E]=l.useState({}),[U,I]=l.useState(!1);l.useEffect(()=>{(async()=>{await A(n)})()},[n]),l.useEffect(()=>{if(h){const a=h.map(t=>({company_id:t.company_id,company_name:t.company_name}));R(a)}},[h]),l.useEffect(()=>{if(k){const a=k.map(t=>({branch_id:t.branch_id,branch_name:t.branch_name}));V(a)}},[k]),l.useEffect(()=>{if(i){const a={...s,first_name:i.first_name,last_name:i.last_name,email:i.email,password:"",mobile_number:i.mobile_number,gender:i.gender,role_id:i.role_id,branch_ids:i.branch_ids,company_ids:i.company_ids};r(a),D(a)}else r(y),D(y),E({})},[i]);const M=a=>{const{name:t,value:b,files:o}=a.target;t==="image"&&o&&o.length>0?r(c=>({...c,image:o[0].name})):r(c=>({...c,[t]:b}))},O=async a=>{a.preventDefault();try{if(await W(!!n).validate(s,{abortEarly:!1}),!Object.keys(s).some(c=>c==="image"?s.image instanceof File||s.image!==F.image:s[c]!==F[c])){x("/user");return}let o;if(n){const c=new FormData;Object.keys(s).forEach(N=>{N==="image"&&s.image instanceof File?c.append(N,s.image):c.append(N,s[N])}),o=await S(n,s)}else o=await w(s);o&&x("/user")}catch(t){if(t instanceof $){const b={};t.inner.forEach(o=>{b[o.path||""]=o.message}),E(b)}else v.error("Failed to submit the form. Please try again.")}},B=()=>{x("/user")};return e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:n?"Edit user detail":"Add user"}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"first_name",className:"block text-gray-700 font-semibold",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",value:s.first_name||"",onChange:a=>r({...s,first_name:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:d.first_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"last_name",className:"block text-gray-700 font-semibold",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",value:s.last_name||"",onChange:a=>r({...s,last_name:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:d.last_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",value:s.email||"",onChange:a=>r({...s,email:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:d.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"mobile_number",className:"block text-gray-700 font-semibold",children:"Mobile number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",value:s.mobile_number||"",onChange:a=>r({...s,mobile_number:a.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:d.mobile_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-700 font-semibold",children:"Password"}),e.jsx("div",{className:"relative",children:e.jsxs("label",{className:"input","data-toggle-password":"true",children:[e.jsx("input",{type:U?"text":"password",id:"password",name:"password",value:s.password||"",onChange:a=>r({...s,password:a.target.value})}),e.jsx("span",{className:"btn btn-icon cursor-pointer ml-2",onClick:()=>I(a=>!a),children:U?e.jsx("i",{className:"ki-filled ki-eye-slash text-gray-500"}):e.jsx("i",{className:"ki-filled ki-eye text-gray-500"})})]})}),e.jsx("p",{className:"text-red-500 text-sm",children:d.password||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"role_id",children:"Role"}),e.jsxs("select",{id:"role_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.role_id===null?"":s.role_id,onChange:a=>r({...s,role_id:a.target.value?parseInt(a.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Role"}),e.jsx("option",{value:2,children:"Sub Admin"}),e.jsx("option",{value:3,children:"Branch Manager"}),e.jsx("option",{value:4,children:"Delivery and Pickup"}),e.jsx("option",{value:5,children:"Customer"}),e.jsx("option",{value:6,children:"Workshop Manager"}),e.jsx("option",{value:7,children:"Vendor"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:d.role_id||" "})]}),s.role_id===2&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"role_id",children:"Company"}),e.jsx(P,{options:j,displayValue:"company_name",selectedValues:j==null?void 0:j.filter(a=>{var t;return(t=s.company_ids)==null?void 0:t.includes(a.company_id)}),onSelect:a=>{r({...s,company_ids:a.map(t=>t.company_id)})},onRemove:a=>{r({...s,company_ids:a.map(t=>t.company_id)})},isObject:!0}),e.jsx("p",{className:"text-red-500 text-sm",children:d.company_ids||" "})]}),s.role_id===3&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"role_id",children:"Branch"}),e.jsx(P,{options:_,displayValue:"branch_name",selectedValues:_==null?void 0:_.filter(a=>{var t;return(t=s.branch_ids)==null?void 0:t.includes(a.branch_id)}),onSelect:a=>{r({...s,branch_ids:a.map(t=>t.branch_id)})},onRemove:a=>{r({...s,branch_ids:a.map(t=>t.branch_id)})},isObject:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:s.gender===1,onChange:a=>r({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:s.gender===2,onChange:a=>r({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:s.gender===3,onChange:a=>r({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:d.gender||" "})]}),n&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"image",className:"block text-gray-700 font-semibold",children:"Profile Photo"}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:M,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:d.image||" "})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${m||u?"opacity-50 cursor-not-allowed":""}`,disabled:m||u,children:m||u?m?"Adding...":"Updating...":n?"Update user":"Add user"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:B,disabled:m||u,children:"Cancel"})]})]})]})};export{ae as default};
