import{r as v,B as Ne,V as I,a as Ae,y as dt,m as B,d as se,z as ve,A as ct,C as ut,D as mt,j as e,b as Pe,n as pt,t as gt,E as ht,w as ft,i as bt,o as xt,f as yt,L as _t,H as vt}from"./index-qfg-RXc2.js";import{u as jt}from"./useGetCategories-DaV7yfvH.js";import{u as Nt}from"./useGetPrice-ChGVkQQf.js";import{u as wt}from"./useGetBranches-Nrz_Nmvv.js";import{u as St}from"./useGetOrder-C8Js5fNI.js";import{u as kt,c as Ct}from"./userSchema-hbMCmMxO.js";import{u as At}from"./useGetuser-CgEmz64o.js";const Pt=()=>{const[l,d]=v.useState(!1);return{loading:l,fetchProductsOnId:async b=>{const g=localStorage.getItem("authToken");d(!0);try{const o=await fetch(`${Ne}/category/${b}/product`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}}),h=await o.json();if(!o.ok){I.error(h.message,{position:"top-center"}),d(!1);return}return(h==null?void 0:h.data)||[]}catch(o){return I.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{d(!1)}}}},Ot=()=>{const[l,d]=v.useState(!1);return{loading:l,fetchServicesOnId:async(b,g)=>{const o=localStorage.getItem("authToken");d(!0);try{const h=await fetch(`${Ne}/category/${b}/product/${g}/service`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}}),c=await h.json();if(!h.ok){I.error(c.message,{position:"top-center"}),d(!1);return}return(c==null?void 0:c.data)||[]}catch(h){return I.error((h==null?void 0:h.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{d(!1)}}}},It="http://3.110.208.70:3000/admin/coupon/apply",Dt=()=>{const[l,d]=v.useState(!1);return{applyCoupon:async(b,g,o)=>{const h=localStorage.getItem("authToken");d(!0);try{const c=await fetch(It,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({user_id:b,order_Total:g,coupon_code:o})}),u=await c.json();return c.ok?u.data:(I.error(u.message,{position:"top-center"}),!1)}catch{I.error("Unable to apply coupon code!")}finally{d(!1)}},loading:l}},Tt=()=>{const[l,d]=v.useState([]),[j,b]=v.useState(!1),g=async o=>{const h=localStorage.getItem("authToken");b(!0);try{const c=await fetch(`${Ne}/admin/valid-coupons?${o}`,{method:"GET",headers:{Authorization:h?`Bearer ${h}`:""}}),u=await c.json();if(!c.ok){I.error(u.message,{position:"top-center"}),b(!1);return}d(u==null?void 0:u.data)}catch{I.error("Network error: Failed to fetch coupons.")}finally{b(!1)}};return v.useEffect(()=>{g()},[]),{validCoupons:l,fetchValidCoupons:g,loading:j}},Et="http://3.110.208.70:3000",Ft=`${Et}/admin/orders`,qt=()=>{const[l,d]=v.useState(!1);return{addOrder:async b=>{const g=localStorage.getItem("authToken");d(!0);try{const o=await fetch(Ft,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify(b)});if(!o.ok){const c=await o.json();return I.error(c.message,{position:"top-center"}),!1}const h=await o.json();return I.success(h.message,{position:"top-center"}),!0}catch(o){return I.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{d(!1)}},loading:l}},$t=()=>{const[l,d]=v.useState(!1);return{updateOrder:async(b,g)=>{const o=localStorage.getItem("authToken"),h=`http://3.110.208.70:3000/admin/orders/${b}`;d(!0);try{const c=await fetch(h,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(c.ok){const O=await c.json();return I.success(O.message,{position:"top-center"}),!0}const u=await c.json();return I.error(u.message,{position:"top-center"}),!1}catch(c){return I.error((c==null?void 0:c.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{d(!1)}},loading:l}},Lt=()=>{const[l,d]=v.useState([]),[j,b]=v.useState(!1);return{address:l,loading:j,fetchAddress:async o=>{var u;const h=localStorage.getItem("authToken"),c=`http://3.110.208.70:3000/address/${o}/user`;try{const O=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});if(!O.ok){const x=await O.json();I.error(x.message,{position:"top-center"});return}const S=await O.json(),E=((u=S==null?void 0:S.data)==null?void 0:u.result)||[];d(E)}catch(O){I.error((O==null?void 0:O.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{b(!1)}}}},Ut=Ae().shape({category_id:B().nullable().required("Please select a category").test("required","Please select a category",l=>!!l),product_id:B().nullable().required("Please select a product").test("required","Please select a product",l=>!!l),service_id:B().nullable().required("Please select a service").test("required","Please select a service",l=>!!l),price:B().nullable().when(["category_id","product_id","service_id"],([l,d,j],b)=>l&&d&&j?b.required("Price is not available for the combination, please add a price"):b.nullable())}),Rt=Ae().shape({username:se().required("Please enter username"),address_id:B().required("Please select address").test("required","Please select address",l=>!!l),express_delivery_charges:B().typeError("Express delivery charges must be a number").min(0,"Express delivery charges must be a positive number"),shipping_charges:B().typeError("Shipping charge must be a number").min(0,"Shipping charge must be a positive number"),payment_type:B().required("Please choose payment type").test("required","Please choose payment type",l=>!!l),payment_status:B().required("Please choose payment status").test("required","Please choose payment status",l=>!!l),paid_amount:B().typeError("Paid amount must be a number").min(0,"Paid amount must be a positive number").test("max-paid","Paid amount cannot be greater than the total amount",function(l){var d;return l==null||l===0?!0:l<=((d=this.options.context)==null?void 0:d.total)}),branch_id:B().required("Please select branch").test("required","Please select branch",l=>!!l),items:dt().of(Ut)}),Re=()=>{const[l,d]=v.useState(!1);return{addAddress:async(b,g=!0)=>{var h;const o=localStorage.getItem("authToken");d(!0);try{const c=await fetch(`${Ne}/address/admin`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(b)}),u=await c.json();return c.ok?(g&&I.success(u.message,{position:"top-center"}),(h=u==null?void 0:u.data)==null?void 0:h.result):(g&&I.error(u.message,{position:"top-center"}),!1)}catch(c){return I.error((c==null?void 0:c.message)||"Error adding banner",{position:"top-center"}),!1}finally{d(!1)}},loading:l}},Me=Ae().shape({pincode:se().required("Pin Code is required").matches(/^[0-9]{6}$/,"Pincode must be 6 digit"),address_type:B().required("Address type is required"),building_number:se().required("Building number is required"),area:se().required("Area is required"),city:se().required("City is required"),state:se().required("State is required"),country:se().required("Country is required"),landmark:se().required("Landmark is required")});var W={},je={},Ce,Fe;function Mt(){if(Fe)return Ce;Fe=1;var l="Expected a function",d=NaN,j="[object Symbol]",b=/^\s+|\s+$/g,g=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,h=/^0o[0-7]+$/i,c=parseInt,u=typeof ve=="object"&&ve&&ve.Object===Object&&ve,O=typeof self=="object"&&self&&self.Object===Object&&self,S=u||O||Function("return this")(),E=Object.prototype,x=E.toString,C=Math.max,G=Math.min,N=function(){return S.Date.now()};function y(r,m,w){var D,L,J,k,R,V,Y=0,pe=!1,Q=!1,oe=!0;if(typeof r!="function")throw new TypeError(l);m=f(m)||0,A(w)&&(pe=!!w.leading,Q="maxWait"in w,J=Q?C(f(w.maxWait)||0,m):J,oe="trailing"in w?!!w.trailing:oe);function le(T){var K=D,te=L;return D=L=void 0,Y=T,k=r.apply(te,K),k}function ge(T){return Y=T,R=setTimeout(ee,m),pe?le(T):k}function Z(T){var K=T-V,te=T-Y,ce=m-K;return Q?G(ce,J-te):ce}function M(T){var K=T-V,te=T-Y;return V===void 0||K>=m||K<0||Q&&te>=J}function ee(){var T=N();if(M(T))return ie(T);R=setTimeout(ee,Z(T))}function ie(T){return R=void 0,oe&&D?le(T):(D=L=void 0,k)}function we(){R!==void 0&&clearTimeout(R),Y=0,D=V=L=R=void 0}function he(){return R===void 0?k:ie(N())}function de(){var T=N(),K=M(T);if(D=arguments,L=this,V=T,K){if(R===void 0)return ge(V);if(Q)return R=setTimeout(ee,m),le(V)}return R===void 0&&(R=setTimeout(ee,m)),k}return de.cancel=we,de.flush=he,de}function A(r){var m=typeof r;return!!r&&(m=="object"||m=="function")}function t(r){return!!r&&typeof r=="object"}function s(r){return typeof r=="symbol"||t(r)&&x.call(r)==j}function f(r){if(typeof r=="number")return r;if(s(r))return d;if(A(r)){var m=typeof r.valueOf=="function"?r.valueOf():r;r=A(m)?m+"":m}if(typeof r!="string")return r===0?r:+r;r=r.replace(b,"");var w=o.test(r);return w||h.test(r)?c(r.slice(2),w?2:8):g.test(r)?d:+r}return Ce=y,Ce}var ue={},qe;function Bt(){return qe||(qe=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.compose=function(){for(var d=arguments.length,j=Array(d),b=0;b<d;b++)j[b]=arguments[b];return function(){for(var g=arguments.length,o=Array(g),h=0;h<g;h++)o[h]=arguments[h];j.forEach(function(c){return c&&c.apply(void 0,o)})}},ue.pick=function(d){for(var j=arguments.length,b=Array(j>1?j-1:0),g=1;g<j;g++)b[g-1]=arguments[g];return b.reduce(function(o,h){return d&&d.hasOwnProperty(h)&&(o[h]=d[h]),o},{})}),ue}var $e;function Gt(){if($e)return je;$e=1,Object.defineProperty(je,"__esModule",{value:!0});var l=Object.assign||function(N){for(var y=1;y<arguments.length;y++){var A=arguments[y];for(var t in A)Object.prototype.hasOwnProperty.call(A,t)&&(N[t]=A[t])}return N},d=function(){function N(y,A){for(var t=0;t<A.length;t++){var s=A[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(y,s.key,s)}}return function(y,A,t){return A&&N(y.prototype,A),t&&N(y,t),y}}(),j=ct(),b=O(j),g=ut(),o=O(g),h=Mt(),c=O(h),u=Bt();function O(N){return N&&N.__esModule?N:{default:N}}function S(N,y){if(!(N instanceof y))throw new TypeError("Cannot call a class as a function")}function E(N,y){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:N}function x(N,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);N.prototype=Object.create(y&&y.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(N,y):N.__proto__=y)}var C=function(y){return{mainText:y.main_text,secondaryText:y.secondary_text}},G=function(N){x(y,N);function y(A){S(this,y);var t=E(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,A));return t.init=function(){if(!window.google)throw new Error("[react-places-autocomplete]: Google Maps JavaScript API library must be loaded. See: https://github.com/kenny-hibino/react-places-autocomplete#load-google-library");if(!window.google.maps.places)throw new Error("[react-places-autocomplete]: Google Maps Places library must be loaded. Please add `libraries=places` to the src URL. See: https://github.com/kenny-hibino/react-places-autocomplete#load-google-library");t.autocompleteService=new window.google.maps.places.AutocompleteService,t.autocompleteOK=window.google.maps.places.PlacesServiceStatus.OK,t.setState(function(s){return s.ready?null:{ready:!0}})},t.autocompleteCallback=function(s,f){if(t.setState({loading:!1}),f!==t.autocompleteOK){t.props.onError(f,t.clearSuggestions);return}var r=t.props.highlightFirstSuggestion;t.setState({suggestions:s.map(function(m,w){return{id:m.id,description:m.description,placeId:m.place_id,active:!!(r&&w===0),index:w,formattedSuggestion:C(m.structured_formatting),matchedSubstrings:m.matched_substrings,terms:m.terms,types:m.types}})})},t.fetchPredictions=function(){var s=t.props.value;s.length&&(t.setState({loading:!0}),t.autocompleteService.getPlacePredictions(l({},t.props.searchOptions,{input:s}),t.autocompleteCallback))},t.clearSuggestions=function(){t.setState({suggestions:[]})},t.clearActive=function(){t.setState({suggestions:t.state.suggestions.map(function(s){return l({},s,{active:!1})})})},t.handleSelect=function(s,f,r){t.clearSuggestions(),t.props.onSelect?t.props.onSelect(s,f,r):t.props.onChange(s)},t.getActiveSuggestion=function(){return t.state.suggestions.find(function(s){return s.active})},t.selectActiveAtIndex=function(s){var f=t.state.suggestions.find(function(r){return r.index===s}).description;t.setActiveAtIndex(s),t.props.onChange(f)},t.selectUserInputValue=function(){t.clearActive(),t.props.onChange(t.state.userInputValue)},t.handleEnterKey=function(){var s=t.getActiveSuggestion();s===void 0?t.handleSelect(t.props.value,null,null):t.handleSelect(s.description,s.placeId,s)},t.handleDownKey=function(){if(t.state.suggestions.length!==0){var s=t.getActiveSuggestion();s===void 0?t.selectActiveAtIndex(0):s.index===t.state.suggestions.length-1?t.selectUserInputValue():t.selectActiveAtIndex(s.index+1)}},t.handleUpKey=function(){if(t.state.suggestions.length!==0){var s=t.getActiveSuggestion();s===void 0?t.selectActiveAtIndex(t.state.suggestions.length-1):s.index===0?t.selectUserInputValue():t.selectActiveAtIndex(s.index-1)}},t.handleInputKeyDown=function(s){switch(s.key){case"Enter":s.preventDefault(),t.handleEnterKey();break;case"ArrowDown":s.preventDefault(),t.handleDownKey();break;case"ArrowUp":s.preventDefault(),t.handleUpKey();break;case"Escape":t.clearSuggestions();break}},t.setActiveAtIndex=function(s){t.setState({suggestions:t.state.suggestions.map(function(f,r){return r===s?l({},f,{active:!0}):l({},f,{active:!1})})})},t.handleInputChange=function(s){var f=s.target.value;if(t.props.onChange(f),t.setState({userInputValue:f}),!f){t.clearSuggestions();return}t.props.shouldFetchSuggestions&&t.debouncedFetchPredictions()},t.handleInputOnBlur=function(){t.mousedownOnSuggestion||t.clearSuggestions()},t.getActiveSuggestionId=function(){var s=t.getActiveSuggestion();return s?"PlacesAutocomplete__suggestion-"+s.placeId:void 0},t.getIsExpanded=function(){return t.state.suggestions.length>0},t.getInputProps=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(s.hasOwnProperty("value"))throw new Error("[react-places-autocomplete]: getInputProps does not accept `value`. Use `value` prop instead");if(s.hasOwnProperty("onChange"))throw new Error("[react-places-autocomplete]: getInputProps does not accept `onChange`. Use `onChange` prop instead");var f={type:"text",autoComplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":t.getIsExpanded(),"aria-activedescendant":t.getActiveSuggestionId(),disabled:!t.state.ready};return l({},f,s,{onKeyDown:(0,u.compose)(t.handleInputKeyDown,s.onKeyDown),onBlur:(0,u.compose)(t.handleInputOnBlur,s.onBlur),value:t.props.value,onChange:function(m){t.handleInputChange(m)}})},t.getSuggestionItemProps=function(s){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.handleSuggestionMouseEnter.bind(t,s.index),m=t.handleSuggestionClick.bind(t,s);return l({},f,{key:s.id,id:t.getActiveSuggestionId(),role:"option",onMouseEnter:(0,u.compose)(r,f.onMouseEnter),onMouseLeave:(0,u.compose)(t.handleSuggestionMouseLeave,f.onMouseLeave),onMouseDown:(0,u.compose)(t.handleSuggestionMouseDown,f.onMouseDown),onMouseUp:(0,u.compose)(t.handleSuggestionMouseUp,f.onMouseUp),onTouchStart:(0,u.compose)(t.handleSuggestionTouchStart,f.onTouchStart),onTouchEnd:(0,u.compose)(t.handleSuggestionMouseUp,f.onTouchEnd),onClick:(0,u.compose)(m,f.onClick)})},t.handleSuggestionMouseEnter=function(s){t.setActiveAtIndex(s)},t.handleSuggestionMouseLeave=function(){t.mousedownOnSuggestion=!1,t.clearActive()},t.handleSuggestionMouseDown=function(s){s.preventDefault(),t.mousedownOnSuggestion=!0},t.handleSuggestionTouchStart=function(){t.mousedownOnSuggestion=!0},t.handleSuggestionMouseUp=function(){t.mousedownOnSuggestion=!1},t.handleSuggestionClick=function(s,f){f&&f.preventDefault&&f.preventDefault();var r=s.description,m=s.placeId;t.handleSelect(r,m,s),setTimeout(function(){t.mousedownOnSuggestion=!1})},t.state={loading:!1,suggestions:[],userInputValue:A.value,ready:!A.googleCallbackName},t.debouncedFetchPredictions=(0,c.default)(t.fetchPredictions,A.debounce),t}return d(y,[{key:"componentDidMount",value:function(){var t=this.props.googleCallbackName;if(t){var s=window.google&&window.google.maps&&window.google.maps.places;s?this.init():window[t]=this.init}else this.init()}},{key:"componentWillUnmount",value:function(){var t=this.props.googleCallbackName;t&&window[t]&&delete window[t]}},{key:"render",value:function(){return this.props.children({getInputProps:this.getInputProps,getSuggestionItemProps:this.getSuggestionItemProps,loading:this.state.loading,suggestions:this.state.suggestions})}}]),y}(b.default.Component);return G.propTypes={onChange:o.default.func.isRequired,value:o.default.string.isRequired,children:o.default.func.isRequired,onError:o.default.func,onSelect:o.default.func,searchOptions:o.default.shape({bounds:o.default.object,componentRestrictions:o.default.object,location:o.default.object,offset:o.default.oneOfType([o.default.number,o.default.string]),radius:o.default.oneOfType([o.default.number,o.default.string]),types:o.default.array}),debounce:o.default.number,highlightFirstSuggestion:o.default.bool,shouldFetchSuggestions:o.default.bool,googleCallbackName:o.default.string},G.defaultProps={onError:function(y,A){return console.error(`[react-places-autocomplete]: error happened when fetching data from Google Maps API.
Please check the docs here (https://developers.google.com/maps/documentation/javascript/places#place_details_responses)
Status: `,y)},searchOptions:{},debounce:200,highlightFirstSuggestion:!1,shouldFetchSuggestions:!0},je.default=G,je}var ne={},Le;function Kt(){return Le||(Le=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.geocodeByAddress=function(d){var j=new window.google.maps.Geocoder,b=window.google.maps.GeocoderStatus.OK;return new Promise(function(g,o){j.geocode({address:d},function(h,c){c!==b&&o(c),g(h)})})},ne.getLatLng=function(d){return new Promise(function(j,b){try{var g={lat:d.geometry.location.lat(),lng:d.geometry.location.lng()};j(g)}catch(o){b(o)}})},ne.geocodeByPlaceId=function(d){var j=new window.google.maps.Geocoder,b=window.google.maps.GeocoderStatus.OK;return new Promise(function(g,o){j.geocode({placeId:d},function(h,c){c!==b&&o(c),g(h)})})}),ne}var Ue;function zt(){if(Ue)return W;Ue=1,Object.defineProperty(W,"__esModule",{value:!0}),W.getLatLng=W.geocodeByPlaceId=W.geocodeByAddress=void 0;var l=Gt(),d=b(l),j=Kt();function b(g){return g&&g.__esModule?g:{default:g}}return W.geocodeByAddress=j.geocodeByAddress,W.geocodeByPlaceId=j.geocodeByPlaceId,W.getLatLng=j.getLatLng,W.default=d.default,W}var me=zt();const Be=mt(me),Vt=({isOpen:l,onClose:d,userId:j,setIsSubmit:b,onAddressAdded:g,fullname:o})=>{const{addAddress:h,loading:c}=Re(),[u,O]=v.useState({}),[S,E]=v.useState(!1),[x,C]=v.useState({building_number:"",area:"",lat:null,long:null,landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,address_type:null,full_name:""}),[G,N]=v.useState(!1);v.useEffect(()=>{l?j&&C(s=>({...s,user_id:j,full_name:o})):(C({building_number:"",area:"",landmark:"",pincode:"",city:"",lat:null,long:null,state:"",country:"",user_id:null,address_type:null,full_name:""}),O({}))},[l,j]);const y=s=>{C({...x,area:s}),N(!0)},A=async s=>{C({...x,area:s});try{const f=await me.geocodeByAddress(s),r=await me.getLatLng(f[0]);r&&C(m=>({...m,lat:r==null?void 0:r.lat,long:r==null?void 0:r.lng}))}catch{I.error("Failed to fetch address detail",{className:"toast-error"})}},t=async s=>{s.preventDefault();try{if(await Me.validate(x,{abortEarly:!1}),j){const f=await h(x);f&&(g(f),d(),b(!0))}}catch(f){if(f instanceof Pe){const r={};f.inner.forEach(m=>{r[m.path||""]=m.message}),O(r)}else I.error("Failed to submit the form. Please try again.")}};if(l)return e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:d}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-lg max-w-lg smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:d,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Add New Address"}),e.jsxs("form",{onSubmit:t,children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm",onChange:s=>C({...x,address_type:Number(s.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"Building Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:x.building_number,onChange:s=>C({...x,building_number:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Area"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(Be,{value:x.area,onChange:y,onSelect:A,children:({getInputProps:s,suggestions:f,getSuggestionItemProps:r,loading:m})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...s({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>N(!0),onBlur:()=>N(!1)})}),G&&f.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[m&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!m&&f.map((w,D)=>{const{...L}=r(w);return e.jsx("li",{...L,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:w==null?void 0:w.description},D)})]})})]})})}),u.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.area||" "})||S&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:x.landmark,onChange:s=>C({...x,landmark:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:x.pincode,onChange:s=>C({...x,pincode:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:x.city,onChange:s=>C({...x,city:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:x.state,onChange:s=>C({...x,state:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:x.country,onChange:s=>C({...x,country:s.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:u.country||" "})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:d,className:"btn btn-light mr-2",disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c,className:`btn btn-primary ${c?"opacity-50 cursor-not-allowed":""}`,children:c?"Submitting...":"Submit"})]})]})]})]})},Ht=({isOpen:l,onClose:d,setIsSubmit:j,onCustomerCreated:b})=>{const{addUser:g,loading:o}=kt(),{addAddress:h,loading:c}=Re(),[u,O]=v.useState({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),[S,E]=v.useState({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),[x,C]=v.useState({}),[G,N]=v.useState(!1),[y,A]=v.useState(!1);v.useEffect(()=>{l||(O({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),E({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),C({}))},[l]);const t=r=>{E({...S,area:r}),A(!0)},s=async r=>{E({...S,area:r});try{const m=await me.geocodeByAddress(r),w=await me.getLatLng(m[0]);w&&E(D=>({...D,lat:w==null?void 0:w.lat,long:w==null?void 0:w.lng}))}catch{I.error("Failed to fetch address detail",{className:"toast-error"})}},f=async r=>{r.preventDefault();try{await Ct().validate(u,{abortEarly:!1}),await Me.validate(S,{abortEarly:!1});const m=await g(u);if(m!=null&&m.user_id){const w={...S,user_id:m.user_id,full_name:`${m.first_name} ${m.last_name}`},D=await h(w,!1);D&&(b(m,D),d(),j(!0))}}catch(m){if(m instanceof Pe){const w={};m.inner.forEach(D=>{w[D.path||""]=D.message}),C(w)}else I.error("Failed to submit the form. Please try again.")}};return l?e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:d}),e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-5xl w-full smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:d,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsxs("form",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Customer Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-gray-700 font-semibold",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",autoComplete:"off",value:u.first_name||"",onChange:r=>O({...u,first_name:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:x.first_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-gray-700 font-semibold",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",autoComplete:"off",value:u.last_name,onChange:r=>O({...u,last_name:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:x.last_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:u.email,onChange:r=>O({...u,email:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:x.email||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobile_number",className:"block text-gray-700 font-semibold",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:u.mobile_number,onChange:r=>O({...u,mobile_number:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:x.mobile_number||" "})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"mb-2 block text-gray-700 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:u.gender===1,onChange:r=>O({...u,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:u.gender===2,onChange:r=>O({...u,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:u.gender===3,onChange:r=>O({...u,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:x.gender||" "})]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm w-full p-2 border border-gray-300 rounded-md",onChange:r=>E({...S,address_type:Number(r.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"Building Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:S.building_number,onChange:r=>E({...S,building_number:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Area"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(Be,{value:S.area,onChange:t,onSelect:s,children:({getInputProps:r,suggestions:m,getSuggestionItemProps:w,loading:D})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...r({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>A(!0),onBlur:()=>A(!1)})}),y&&m.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[D&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!D&&m.map((L,J)=>{const{...k}=w(L);return e.jsx("li",{...k,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:L==null?void 0:L.description},J)})]})})]})})}),x.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.area||" "})||G&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:S.landmark,onChange:r=>E({...S,landmark:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:S.pincode,onChange:r=>E({...S,pincode:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:S.city,onChange:r=>E({...S,city:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:S.state,onChange:r=>E({...S,state:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:S.country,onChange:r=>E({...S,country:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:x.country||" "})]})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:d,className:"btn btn-light mr-2",disabled:o||c,children:"Cancel"}),e.jsx("button",{type:"button",onClick:f,disabled:o||c,className:`btn btn-primary ${o||c?"opacity-50 cursor-not-allowed":""}`,children:o||c?"Submitting...":"Submit"})]})]})]})]}):null},ta=()=>{const{prices:l}=Nt(),{categories:d}=jt(),{fetchProductsOnId:j}=Pt(),{fetchServicesOnId:b}=Ot(),[g,o]=v.useState(""),[h,c]=v.useState(!0),{id:u}=pt(),{updateOrder:O,loading:S}=$t(),{addOrder:E,loading:x}=qt(),C=Number(u),G=1e3,N=1,[y,A]=v.useState(!1),[t,s]=v.useState(!1),[f,r]=v.useState(!1),{users:m,fetchUsersByRole:w}=gt(),{validCoupons:D,fetchValidCoupons:L}=Tt(),{branches:J}=wt(N,G),{order:k,fetchOrder:R}=St(),{address:V,fetchAddress:Y}=Lt(),{applyCoupon:pe}=Dt(),{userData:Q,fetchUser:oe}=At(),{generatePaymentLink:le,loading:ge}=ht(),Z=Q==null?void 0:Q.user,M=ft(),ee=v.useRef(null),[ie,we]=v.useState({}),[he,de]=v.useState({}),T=v.useRef(null),[K,te]=v.useState(!1),[ce,Se]=v.useState(null),fe=bt(),[n,F]=v.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,normal_delivery_charges:null,payment_type:null,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null}),[Ge,Ke]=v.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,normal_delivery_charges:null,payment_type:null,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null}),[$,ze]=v.useState({});v.useEffect(()=>{const a=i=>{T.current&&!T.current.contains(i.target)&&ee.current&&!ee.current.contains(i.target)&&(c(!1),te(!1))};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),v.useEffect(()=>{(async()=>{await R(C)})()},[C]),v.useEffect(()=>{(async()=>{n.user_id&&(await Y(n.user_id),await L(n.user_id),await oe(n.user_id)),f&&(await Y(n.user_id),r(!1))})()},[n.user_id,f]),v.useEffect(()=>{C||F(a=>({...a,payment_status:n.payment_type===1?1:null}))},[n.payment_type]),v.useEffect(()=>{(async()=>{K&&(!g||g.trim()==="")?(c(!0),await w(5)):g&&h&&await w(5,g)})()},[K,g,h]),v.useEffect(()=>{if(k){const a=`${k.user.first_name} ${k.user.last_name}`;o(a),c(!1);const i={coupon_code:k.coupon_code||"",coupon_discount:k.coupon_discount||null,express_delivery_charges:k.express_delivery_charges||null,normal_delivery_charges:k.normal_delivery_charges||null,payment_type:k.payment_type||null,payment_status:k.payment_status||null,sub_total:k.sub_total||0,paid_amount:k.paid_amount||null,kasar_amount:k.kasar_amount||null,transaction_id:k.transaction_id||"",address_id:k.address_id,username:a,user_id:k.user_id||null,items:k.items.map(p=>{var U,re,xe,q;const P=p.category.category_id,_=((U=p.product)==null?void 0:U.product_id)||null,z=((re=p.service)==null?void 0:re.service_id)||null,be=((xe=p.product)==null?void 0:xe.name)||"",H=((q=p.service)==null?void 0:q.name)||"";return{category_id:P,product_id:_,service_id:z,product_name:be,service_name:H,description:p.description||null,price:p.price,quantity:p.quantity,item_Total:p.price*p.quantity,showDescription:!!p.description}}),total:(k.sub_total||0)+(k.express_delivery_charges||0)+(k.normal_delivery_charges||0),branch_id:k.branch_id,order_status:k.order_status};F(i),Ke(i)}},[k]),v.useEffect(()=>{const a=(n.paid_amount||0)+(n.kasar_amount||0),i=n.total-a;let p=n.payment_status;n.total>0&&a===n.total?(p=2,Se(0)):a>0&&a<n.total?(p=3,Se(i)):a>0&&(p=1,Se(i)),F(P=>({...P,payment_status:p}))},[n.paid_amount,n.kasar_amount,n.total]);const Ve=async a=>{var i,p;a.preventDefault();try{const P=n.items.map(U=>({category_id:Number(U.category_id),product_id:Number(U.product_id),service_id:Number(U.service_id),description:U.description,price:Number(U.price),quantity:Number(U.quantity)})),_={...n,address_id:Number(n.address_id),coupon_discount:Number(n.coupon_discount),normal_delivery_charges:Number(n.normal_delivery_charges),kasar_amount:Number(n.kasar_amount),paid_amount:Number(n.paid_amount),express_delivery_charges:Number(n.express_delivery_charges),payment_type:Number(n.payment_type),payment_status:Number(n.payment_status),order_status:C?n.order_status:4,items:P},z=n.total;if(await Rt.validate(_,{abortEarly:!1,context:{total:z}}),!Object.keys(n).some(U=>n[U]!==Ge[U])){fe(`${(i=M==null?void 0:M.state)==null?void 0:i.prevUrl}`);return}let H;k?H=await O(C,_):H=await E(_),H&&fe(`${(p=M==null?void 0:M.state)==null?void 0:p.prevUrl}`)}catch(P){if(P instanceof Pe){const _={};P.inner.forEach(z=>{_[z.path||""]=z.message}),ze(_)}else I.error("Failed to submit the form. Please try again.")}},He=a=>{o(a.target.value),c(!0)},We=a=>{const i=`${a.first_name} ${a.last_name}`;o(i),c(!1),F({...n,username:i,user_id:a.user_id})},Je=()=>{var a;fe(`${(a=M==null?void 0:M.state)==null?void 0:a.prevUrl}`)},Qe=()=>{F(a=>({...a,items:[...a.items,{category_id:null,product_id:null,product_name:"",service_id:null,service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}]}))},Xe=a=>{F(i=>{const p=i.items.filter((be,H)=>H!==a),P={...i,items:p,coupon_code:"",coupon_discount:0},_=ke(P),z=_+Number(n.express_delivery_charges||0)+Number(n.normal_delivery_charges||0);return{...P,sub_total:_,total:z}})},ae=async(a,i,p)=>{["category_id","product_id","service_id","price","quantity"].includes(i)&&F(P=>({...P,coupon_code:"",coupon_discount:0})),F(P=>{const _=P.items.map((re,xe)=>{if(xe===a){const q={...re,[i]:p};i==="showDescription"&&(q.showDescription=p);const Ie=Number(q.category_id),De=Number(q.product_id),Te=Number(q.service_id),Ee=Number(q.quantity)||1;if(i==="category_id"){const X=Number(p);ie[X]||j(X).then(ye=>{we(_e=>({..._e,[X]:ye}))}),q.product_id=null,q.service_id=null}if(i==="product_id"){const X=Number(re.category_id),ye=Number(p),_e=`${X}_${ye}`;he[_e]||b(X,ye).then(lt=>{de(it=>({...it,[_e]:lt}))}),q.service_id=null}if(["category_id","product_id","service_id"].includes(i))if(Ie&&De&&Te){const X=Ye(Ie,De,Te);q.price=X,q.item_Total=X*Ee}else q.price=null,q.item_Total=null;else i==="price"?q.item_Total=p*Ee:i==="quantity"&&(q.item_Total=q.price*Number(p));return q}return re}),z={...P,items:_},H=ke(z)-P.coupon_discount,U=H+Number(P.express_delivery_charges||0)+Number(P.normal_delivery_charges||0);return{...z,sub_total:H,total:U}})},Ye=(a,i,p)=>{const P=`${a}_${i}_${p}`;return l[P]||0},Ze=async a=>{const i=ke(n),p=await pe(n.user_id,i,a),P=Number(p.finalTotal||0)+Number(n.express_delivery_charges||0)+Number(n.normal_delivery_charges||0);p&&F(_=>({..._,coupon_code:a,coupon_discount:p.discountAmount,sub_total:p.finalTotal,total:P}))},ke=a=>a.items.reduce((i,p)=>i+(p.item_Total||0),0),Oe=(a,i)=>{F(p=>{const P={...p,[a]:i},_=Number(P.sub_total||0)+Number(P.express_delivery_charges||0)+Number(P.normal_delivery_charges||0);return{...P,total:_}})},et=a=>{const i=a.target.value;F(p=>({...p,address_id:Number(i)}))},tt=a=>{a.preventDefault(),n.user_id?A(!0):I.error("Please select the user to add address")},at=a=>{a.preventDefault(),s(!0)},st=()=>{fe(`/order/${C}`)},rt=async()=>{const a=[];if(n.total||a.push("item total"),n.username||a.push("customer name"),a.length>0){I.error(`Please add required fields: ${a.join(", ")}`);return}const i={amount:n.total,currency:"INR",user_id:n.user_id,customer:{name:n.username,contact:Z==null?void 0:Z.mobile_number,email:Z==null?void 0:Z.email}};await le(i)},nt=(a,i)=>{if(a){const p=`${a.first_name} ${a.last_name}`;o(p),c(!1),F({...n,username:p,user_id:a.user_id})}i&&F(p=>({...p,address_id:i.address_id}))},ot=a=>{a&&F(i=>({...i,address_id:a.address_id}))};return e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"card max-w-5xl mx-auto p-6 bg-white shadow-md",children:[e.jsxs("div",{className:"flex",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:k?"Edit Order":"Add Order"}),!isNaN(C)&&e.jsxs("button",{className:"btn bg-gray-200 ml-4 text-gray-700 text-sm font-bold rounded-md",onClick:st,children:[e.jsx(xt,{size:20}),"View Order"]})]}),e.jsxs("form",{onSubmit:Ve,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-y-1 gap-x-6 mt-4",children:[e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer name"}),e.jsx("button",{className:"btn btn-sm btn-primary -mt-6 sm:btn-lg",onClick:at,children:"Add Customer"})]}),e.jsx("input",{type:"text",id:"username",ref:ee,autoComplete:"off",value:g||"",onChange:He,className:"input border border-gray-300 rounded-md p-2 w-full mb-2",placeholder:"Search customer...",onFocus:()=>{te(!0),c(!0)}}),m&&h&&e.jsx("ul",{ref:T,className:"absolute -mt-2 bg-white border z-10 border-gray-300 rounded-md p-2 w-full text-sm max-h-[400px] overflow-y-auto",children:m.length>0?m.map(a=>e.jsxs("li",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>We(a),children:[a.first_name," ",a.last_name," (",a.mobile_number,")"]},a.user_id)):e.jsx("li",{className:"p-2 text-gray-500",children:"No users found"})}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.username||" "})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"address",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer address"}),e.jsx("button",{className:"btn btn-sm btn-primary -mt-6",onClick:tt,children:"Add address"})]}),e.jsxs("select",{id:"address",value:n.address_id,onChange:et,className:"select border border-gray-300 rounded-md w-full text-sm",children:[e.jsx("option",{value:"",selected:!0,disabled:!0,children:"Select Address"}),V.length>0?V.map(a=>e.jsxs("option",{value:a.address_id,children:[a.building_number,", ",a.area,", ",a.landmark,","," ",a.city,", ",a.state,",",a.country,", ",a.pincode]},a.address_id)):e.jsx("option",{disabled:!0,children:"No Address Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.address_id||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"branch",className:"block text-gray-700 text-sm font-bold mb-2",children:"Branch"}),e.jsxs("select",{id:"branch",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n.branch_id||"",onChange:a=>F({...n,branch_id:a.target.value?Number(a.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch"}),J.length>0?J.map(a=>e.jsx("option",{value:a.branch_id,children:a.branch_name},a.branch_id)):e.jsx("option",{children:"No Data Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.branch_id||" "})]})]}),e.jsx("div",{className:"flex flex-wrap",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900 mt-6 mb-5 ml-1",children:"Item"})}),n.items.map((a,i)=>{var p,P;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border border-gray-200 rounded-xl mt-4 p-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(150px,4fr))] gap-x-5 gap-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-gray-700 text-sm font-bold mb-2",children:"Category"}),e.jsxs("select",{id:"category",value:a.category_id??"",onChange:_=>ae(i,"category_id",_.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Category"}),d.map(_=>e.jsx("option",{value:_.category_id,children:_.name},_.category_id))]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$[`items[${i}].category_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"product",className:"block text-gray-700 text-sm font-bold mb-2",children:"Product"}),e.jsxs("select",{id:"product",value:a.product_id??"",onChange:_=>ae(i,"product_id",_.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Product"}),((p=ie[a.category_id])==null?void 0:p.map(_=>e.jsx("option",{value:_.product_product_id,children:_.product_name},_.product_product_id)))||a.product_id&&e.jsx("option",{value:a.product_id,children:a.product_name},a.product_id)]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$[`items[${i}].product_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"service",className:"block text-gray-700 text-sm font-bold mb-2",children:"Service"}),e.jsxs("select",{id:"service",value:a.service_id??"",onChange:_=>ae(i,"service_id",_.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Service"}),((P=he[`${a.category_id}_${a.product_id}`])==null?void 0:P.map(_=>e.jsx("option",{value:_.service_service_id,children:_.service_name},_.service_service_id)))||a.service_id&&e.jsx("option",{value:a.service_id,children:a.service_name},a.service_id)]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$[`items[${i}].service_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Price"}),e.jsx("input",{type:"text",value:a.price||"",onChange:_=>ae(i,"price",_.target.value),className:`input border rounded-md p-2 w-full ${isNaN(C)?"border-gray-300 bg-gray-100 text-sm text-gray-600 cursor-not-allowed focus:outline-none":"border-gray-300"}`,readOnly:isNaN(C)}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$[`items[${i}].price`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"quantity",children:"Quantity"}),e.jsx("input",{type:"text",id:"quantity",autoComplete:"off",value:a.quantity??1,onChange:_=>ae(i,"quantity",_.target.value),className:"input border border-gray-300 rounded-md p-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Item total"}),e.jsx("input",{type:"text",value:a.item_Total??"",onChange:_=>ae(i,"item_Total",_.target.value),min:"0",step:"0.01",readOnly:!0,className:"input w-full border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"description_checkbox",className:"block text-gray-700 text-sm font-bold mb-2",children:"Description"}),e.jsx("input",{className:"checkbox checkbox-lg ml-5",id:"description_checkbox","data-datatable-check":"true",type:"checkbox",checked:a.showDescription,onChange:_=>ae(i,"showDescription",_.target.checked)}),e.jsx("p",{className:" text-red-500 text-sm",children:" "})]})]})},i),e.jsxs("div",{className:"flex justify-between sm:items-center smmobile:flex-col gap-y-2 smmobile:w-full",children:[e.jsx("div",{children:a.showDescription&&e.jsx("div",{children:e.jsxs("div",{className:"flex mt-2 smmobile:w-[100%] smmobile:justify-self-start flex-col md:w-[350px] lg:w-[420px] sm:w-[300px] h-[80px] mb-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Description"}),e.jsx("textarea",{id:"description",value:a.description||"",onChange:_=>ae(i,"description",_.target.value),className:"h-full input border border-gray-300 rounded-md p-2 w-full"})]})})}),e.jsx("div",{className:"flex block-element flex-end smmobile:justify-self-end justify-end relative",children:e.jsx("div",{children:e.jsx("button",{type:"button",className:`p-2 rounded-full ${n.items.length>1?"bg-red-100 hover:bg-red-200":"bg-gray-200 cursor-not-allowed"}`,onClick:()=>Xe(i),disabled:n.items.length===1,children:e.jsx(yt,{className:`${n.items.length>1?"text-red-500":"text-gray-400"}`})})})})]})]})})}),e.jsx("button",{type:"button",onClick:Qe,className:"btn btn-secondary mb-6 mt-4",children:"Add Item"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"coupon_code",children:"Coupon Code"}),e.jsxs("select",{id:"coupon_code",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n.coupon_code??"",onChange:a=>{const i=D.find(p=>p.code===a.target.value);Ze(i==null?void 0:i.code)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Coupon Code"}),D&&D.length>0?D.map(a=>e.jsx("option",{value:a.code,children:a.code},a.coupon_id)):e.jsx("option",{children:"No Coupons available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:$.coupon_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Coupon Discount"}),e.jsx("input",{type:"text",value:n.coupon_discount||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.coupon_discount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"express_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Charge"}),e.jsx("input",{type:"text",id:"express_delivery_charges",autoComplete:"off",min:"0",value:n.express_delivery_charges||"",onChange:a=>Oe("express_delivery_charges",a.target.value),className:`${n.normal_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:n.normal_delivery_charges>0}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.express_delivery_charges||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"normal_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Normal Delivery Charge"}),e.jsx("input",{type:"text",id:"normal_delivery_charges",min:"0",autoComplete:"off",value:n.normal_delivery_charges||"",onChange:a=>Oe("normal_delivery_charges",a.target.value),className:`${n.express_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:n.express_delivery_charges>0}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.normal_delivery_charges||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Sub Total"}),e.jsx("input",{type:"text",value:n.sub_total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.sub_total||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Total"}),e.jsx("input",{type:"text",value:n.total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Method"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_method",value:n.payment_type??"",onChange:a=>F({...n,payment_type:Number(a.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Type"}),e.jsx("option",{value:1,children:"Cash on Delivery"}),e.jsx("option",{value:2,children:"Online Payment"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.payment_type||" "}),!C&&n.payment_type===2&&e.jsx("div",{children:e.jsxs("button",{type:"button",className:"relative min-w-[160px] min-h-[40px] flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 border border-blue-500 rounded-lg hover:bg-blue-100 transition disabled:opacity-50",onClick:rt,disabled:ge,children:[e.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:ge?e.jsx(_t,{}):e.jsx(vt,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{children:"Send Payment Link"})]})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"paid_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Paid amount"}),e.jsx("input",{type:"text",id:"paid_amount",autoComplete:"off",value:n.paid_amount||"",onChange:a=>{F({...n,paid_amount:Number(a.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.paid_amount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"kasar_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Kasar amount"}),e.jsx("input",{type:"text",id:"kasar_amount",autoComplete:"off",value:n.kasar_amount||"",onChange:a=>{F({...n,kasar_amount:Number(a.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_status",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Status"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_status",value:n.payment_status??"",onChange:a=>F({...n,payment_status:Number(a.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Status"}),e.jsx("option",{value:1,children:"Pending"}),e.jsx("option",{value:2,children:"Received"}),e.jsx("option",{value:3,children:"Partial Received"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:$.payment_status}),n.payment_status===2&&ce>0&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:`Remaining amount Rs ${ce}`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"transaction_id",className:"block text-gray-700 text-sm font-bold mb-2",children:"Transaction ID"}),e.jsx("input",{type:"text",id:"transaction_id",autoComplete:"off",value:n.transaction_id??"",onChange:a=>F({...n,transaction_id:a.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${x||S?"opacity-50 cursor-not-allowed":""}`,disabled:x||S,children:x||S?x?"Adding...":"Updating...":C?"Update Order":"Add Order"}),e.jsx("button",{type:"button",onClick:Je,className:"btn btn-secondary",disabled:x||S,children:"Cancel"})]})]}),e.jsx(Vt,{onAddressAdded:ot,isOpen:y,setIsSubmit:r,onClose:()=>A(!1),userId:n.user_id,fullname:n.username}),e.jsx(Ht,{onCustomerCreated:nt,isOpen:t,setIsSubmit:r,onClose:()=>s(!1)})]})})};export{ta as default};
