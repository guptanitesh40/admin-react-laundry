import{r as n,V as y,j as t,D as M,i as R}from"./index-GtiNTMft.js";import{M as D}from"./MultiSelect-CWKwB2LI.js";import{u as T}from"./useGetCompanies-Bp4ErpdW.js";import"./orderStatusClasses-HfHBGnti.js";const L=(c,o="")=>{const[g,x]=n.useState(!1),[j,_]=n.useState([]);return n.useEffect(()=>{(async()=>{const u=localStorage.getItem("authToken"),f=`http://35.154.167.170:3000/user/by-role?role_id=${c}`,d=new URLSearchParams;o&&d.append("search",o),x(!0);try{const r=await fetch(`${f}&${d}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}});if(!r.ok){const m=await r.json();y.error(m.message||"Failed to fetch users",{position:"top-center"});return}const i=await r.json();_((i==null?void 0:i.data)||[])}catch(r){y.error((r==null?void 0:r.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{x(!1)}})()},[c,o]),{users:j,loading:g}},{RangePicker:P}=M,V=({reportTitle:c,index:o,dynamic_url:g})=>{const[j,_]=n.useState(""),{users:w,loading:u}=L(5,j),{companies:f,loading:d}=T(1,1e3),[r,i]=n.useState([]),[m,k]=n.useState([]),[v,S]=n.useState(!1),[h,N]=n.useState({start_time:"",end_time:""}),C="http://35.154.167.170:3000",Y=localStorage.getItem("authToken"),E=n.useMemo(()=>u?[{label:"Loading...",value:0}]:w.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[w,u]),U=n.useMemo(()=>d?[{label:"Loading...",value:0}]:f.map(e=>({label:e.company_name,value:e.company_id})),[f,d]),$=e=>{N(e?{start_time:R(e[0]).format("DD-MM-YYYY"),end_time:R(e[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},I=e=>{switch(e){case 0:l();break;case 1:l();break;case 2:l();break;case 3:l();break;case 4:l();break;case 5:l();break;case 6:l();break;default:l()}},l=async()=>{S(!0);const e=new URLSearchParams;h.start_time&&h.end_time&&(e.append("startDate",h.start_time),e.append("endDate",h.end_time)),r.length&&r.forEach(a=>e.append("user_id",a)),m.length&&m.forEach(a=>e.append("company_id",a));try{const a=await fetch(`${C}/report/${g}?format=excel&${e}`,{headers:{Authorization:`Bearer ${Y}`}}),s=await a.json();if(!a.ok)throw new Error(s.message||"Failed to download report");const b=s==null?void 0:s.url;if(!b){y.error("Download report not found");return}const p=document.createElement("a");p.href=b,p.download=b,document.body.appendChild(p),p.click(),p.remove()}catch(a){y.error(a.message||"Network error: Failed to download report")}finally{S(!1)}};return t.jsxs("div",{className:"card !shadow-black/10",children:[t.jsx("div",{className:"card-header",children:t.jsx("h3",{className:"card-title",children:c})}),t.jsxs("div",{className:"card-body flex flex-col gap-3",children:[t.jsx("div",{children:t.jsx(P,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:$,format:"DD-MM-YYYY"})}),t.jsx("div",{className:"mui-multiselect-parent",children:t.jsx(D,{options:U,displayValue:"label",placeholder:"Select Company",selectedValues:m,onSelect:e=>{const a=e.map(s=>s.value);k(a)},onRemove:e=>{const a=e.map(s=>s.value);k(a)},className:"w-full",isSearchInput:!1})}),t.jsx("div",{className:"mui-multiselect-parent",children:t.jsx(D,{options:E,displayValue:"label",placeholder:"Select Customer",selectedValues:r,onSelect:e=>{const a=e.map(s=>s.value);i(a)},onRemove:e=>{const a=e.map(s=>s.value);i(a)},setSearch:_,className:"w-full",isSearchInput:!0})})]}),t.jsx("div",{className:"card-footer",children:t.jsxs("button",{disabled:v,className:"w-full inline-flex items-center justify-center btn btn-primary px-3 py-2 relative overflow-hidden",onClick:()=>I(o),children:[v&&t.jsx("span",{className:"absolute inset-0 loading-bar"}),t.jsx("span",{children:v?"Downloading...":"Download"})]})})]},o)},B=[{name:"Total Order Report",dynamic_url:"total-orders"},{name:"Payment Transaction Report",dynamic_url:"payment-transaction"},{name:"Refund Report",dynamic_url:"refund-report"},{name:"In Active Customer report",dynamic_url:"inactive-customer-report"},{name:"GST Report",dynamic_url:"gst"},{name:"Pick Up Report",dynamic_url:"pickup"},{name:"Delivery Report",dynamic_url:"delivery"}],q=()=>t.jsx("main",{className:"grow content",id:"content",role:"content",children:t.jsxs("div",{className:"container-fixed",children:[t.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:t.jsx("div",{className:"flex flex-col justify-center gap-2",children:t.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Reports"})})}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map((c,o)=>t.jsx(V,{reportTitle:c.name,dynamic_url:c.dynamic_url,index:o},o))})]})});export{q as default};
