import{r as i,_ as A,u as q,b2 as V,m as T,j as e,F as b,a as y,T as Y,G as W,R as Z,b as H,c as J,d as K,e as O,S as _,s as Q,V as X}from"./index-BM1D7ySV.js";import{u as ee}from"./useGetBranches-Dz8I-_yy.js";const se="http://35.154.167.170:3000/user",te=(d=1,r=10,c="",l,m)=>{const[p,o]=i.useState([]),[t,S]=i.useState(0),[a,g]=i.useState(!1),N=i.useCallback(async()=>{var v,j;const w=localStorage.getItem("authToken"),x=new URLSearchParams;d&&x.append("page_number",d.toString()),r&&x.append("per_page",r.toString()),c&&x.append("search",c),l&&x.append("sortBy",l),m&&x.append("order",m),g(!0);try{const h=await fetch(`${se}?${x}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`}});if(!h.ok){const E=await h.json();A.error(E.message,{position:"top-center"});return}const u=await h.json(),U=((v=u==null?void 0:u.data)==null?void 0:v.users)||[],k=((j=u==null?void 0:u.data)==null?void 0:j.count)||0;o(U),S(k)}catch(h){A.error((h==null?void 0:h.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{g(!1)}},[d,r,m,l,c]);return{users:p,totalUsers:t,loading:a,fetchUsers:N}},ae=()=>{const[d,r]=i.useState(!1);return{deleteUser:async l=>{r(!0);const m=`http://35.154.167.170:3000/user/${l}`,p=localStorage.getItem("authToken");try{const o=await fetch(m,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}}),t=await o.json();return o.ok?{success:!0,message:t.message}:(A.error(t.message,{position:"top-center"}),{success:!1,message:t.message})}catch(o){return{success:!1,message:o.message}}finally{r(!1)}},loading:d}},re=({search:d})=>{const[r,c]=i.useState(1),[l,m]=i.useState(10),[p,o]=q(),[t,S]=i.useState(null),[a,g]=i.useState(null),N=p.get("page"),w=p.get("perPage"),x=1e3,v=1,{users:j,fetchUsers:h,totalUsers:u,loading:U}=te(r,l,d,t,a),{deleteUser:k}=ae(),{companies:E,fetchCompanies:L}=V(v,x),{branches:B,fetchBranches:F}=ee(v,x),$=T(),C=Math.ceil(u/l),R=s=>{$(`/user/edit/${s}`)};i.useEffect(()=>{(async()=>{await L(),await F()})()},[]),i.useEffect(()=>{N&&c(Number(N)),w&&m(Number(w))},[N,w]),i.useEffect(()=>{d&&(c(1),o({search:d,page:"1",perPage:l.toString()})),h()},[l,r,d,t,a,h]);const G=async s=>{try{const{isConfirmed:n}=await _.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(n){const{success:M,message:D}=await k(s);M?(j.filter(z=>z.user_id!==s).length===0&&r>1&&(c(r-1),o({page:(r-1).toString(),perPage:l.toString()})),await h(),_.fire(D)):_.fire(D)}}catch(n){_.fire({title:"Error",text:n.message,icon:"error"})}},f=s=>{t===s?g(a==="ASC"?"DESC":"ASC"):(S(s),g("ASC"))},P=s=>{s>=1&&s<=C&&(c(s),o({page:s.toString(),perPage:l.toString()}))},I=s=>{const n=Number(s.target.value);m(n),c(1),o({page:"1",perPage:n.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:l,onChange:I,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>f("user_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(b,{color:t==="user_id"&&a==="ASC"?"gray":"lightgray"}),e.jsx(y,{color:t==="user_id"&&a==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>f("user_id"),children:["User name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(b,{color:t==="user_id"&&a==="ASC"?"gray":"lightgray"}),e.jsx(y,{color:t==="user_id"&&a==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>f("email"),children:["Email",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(b,{color:t==="email"&&a==="ASC"?"gray":"lightgray"}),e.jsx(y,{color:t==="email"&&a==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>f("mobile_number"),children:["Mobile no",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(b,{color:t==="mobile_number"&&a==="ASC"?"gray":"lightgray"}),e.jsx(y,{color:t==="mobile_number"&&a==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>f("gender"),children:["Gender",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(b,{color:t==="gender"&&a==="ASC"?"gray":"lightgray"}),e.jsx(y,{color:t==="gender"&&a==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[170px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>f("role_id"),children:["Role",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(b,{color:t==="role_id"&&a==="ASC"?"gray":"lightgray"}),e.jsx(y,{color:t==="role_id"&&a==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[250px]",children:"Companies"}),e.jsx("th",{className:"min-w-[250px]",children:"Branches"}),e.jsx("th",{className:"min-w-[140px]",children:"Actions"})]})}),U?e.jsx(Y,{}):j.length>0?e.jsx("tbody",{children:j.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.user_id}),e.jsxs("td",{children:[s.first_name," ",s.last_name]}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.mobile_number}),e.jsx("td",{children:W[s.gender]}),e.jsx("td",{children:Z[s.role_id]}),e.jsx("td",{children:E.filter(n=>s.company_ids.includes(n.company_id)).map(n=>n.company_name).join(", ")}),e.jsx("td",{children:B.filter(n=>s.branch_ids.includes(n.branch_id)).map(n=>n.branch_name).join(", ")}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>R(s.user_id),children:e.jsx(H,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>G(s.user_id),children:e.jsx(J,{className:"text-red-500"})})]})]},s.user_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No users available"})})})]})})})})}),u>l&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",j.length," of ",u," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:r===1,onClick:()=>P(r-1),className:`btn ${r===1?"disabled":""}`,children:e.jsx(K,{})}),Array.from({length:C}).map((s,n)=>e.jsx("button",{className:`btn ${r===n+1?"active":""}`,onClick:()=>P(n+1),children:n+1},n)),e.jsx("button",{disabled:r===C,onClick:()=>P(r+1),className:`btn ${r===C?"disabled":""}`,children:e.jsx(O,{})})]})]})]})},oe=()=>{const d=T(),[r,c]=i.useState(""),[l,m]=i.useState(""),[p,o]=i.useState(""),t=()=>{d("/user/add")},S=async a=>{a.preventDefault();try{await Q.validate({search:l},{abortEarly:!1}),c(l),o("")}catch(g){g instanceof X&&o(g.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Users"}),e.jsxs("button",{onClick:t,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add User"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:S,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:l,onChange:a=>{m(a.target.value),a.target.value===""&&c("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:p||"Â "})]}),e.jsx(re,{search:r})]})};export{oe as default};
