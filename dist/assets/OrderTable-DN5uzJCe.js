import{r as t,u as ze,H as qe,e as Ge,m as He,V,j as e,T as Ke,k as S,a0 as Qe,y as Je,F as Xe,f as Ze,P as es,s as ss,b as as}from"./index-BsfZthRi.js";import{u as ts,a as ns}from"./OrderTableFilter-BjAuwU-a.js";import{u as ls}from"./useGenerateInvoice-BBktRG7v.js";import{S as v}from"./sweetalert2.esm.all-B0Dix5B2.js";import{g as ue}from"./orderStatusClasses-HfHBGnti.js";import{P as cs,W as is,D as rs}from"./DueDetailsModel-B5WBdlVP.js";import{u as os}from"./useChangeOrderStatus-BK-dNG-a.js";import{I as ds}from"./index-CgLj3env.js";const vs=({filters:n,selectedOrderIds:d,setSelectedOrderIds:z,setNextStatus:P,selectedStatus:B,setSelectedStatus:D,nextStatus:F,trackingState:A,setTrackingState:b,isEarlyDelivery:q,setIsEarlyDelivery:G})=>{const[w,g]=t.useState(1),[u,H]=t.useState(50),[K,x]=ze(),[i,pe]=t.useState(null),[r,M]=t.useState(null),O=K.get("page"),Y=K.get("perPage"),[y,Q]=t.useState(""),[$,xe]=t.useState(""),[je,J]=t.useState(""),[hs,ms]=t.useState(),[fe,T]=t.useState(!1),[us,ps]=t.useState([]),[xs,js]=t.useState([]),[be,ge]=t.useState([]),j=qe(),X=[{path:"/orders",list:"",orderList:""},{path:"/pickup-orders",list:"order_list",orderList:"pickup_order"},{path:"/redy-to-deliver",list:"order_list",orderList:"ready_for_delivery"},{path:"/confirmed-orders",list:"order_list",orderList:"confirm_order"}].find(s=>s.path===j.pathname),ye=X.list,Ne=X.orderList,{changeOrderStatus:_e}=os(),[we,E]=t.useState(!1),[Ce,Z]=t.useState(!1),Se=s=>{const{order_id:a}=s;z(l=>l.includes(a)?l.filter(_=>_!==a):[...l,a])},k=()=>{z([]),D(null),P(null),b(null)};t.useEffect(()=>{if(d.length===0)D(null),P(null);else if(d.length===1){const s=c.find(a=>d.includes(a.order_id));s&&(D(s.order_status),P(s.order_status_details.next_step))}},[d]);const{orderData:ve,loading:ke,count:L,fetchOrders:C}=ts(w,u,y,i,r,n.orderStatusFilter,n.customerFilter,n.branchFilter,n.pickupBoyFilter,n.deliveryBoyFilter,n.paymentTypeFilter,n.paymentStatusFilter,n.start_date,n.end_date,ye,Ne),{deleteOrder:Pe}=ns();ls();const{hasPermission:o}=Ge(),W=He(),Be=Math.ceil(L/u),{orders:c=[],total_amount:De=0,paid_amount:I=0,total_quantity:Fe=0,kasar_amount:Ae=0}=ve||{};t.useEffect(()=>{O&&g(Number(O)),Y&&H(Number(Y))},[O,Y]),t.useEffect(()=>{g(1),x(y!==""?{search:y,page:"1",perPage:u.toString()}:{})},[y]),t.useEffect(()=>{g(1),x(y!==""?{search:y,page:"1",perPage:u.toString()}:{})},[n.paymentStatusFilter,n.orderStatusFilter,n.paymentTypeFilter,n.customerFilter,n.pickupBoyFilter,n.deliveryBoyFilter,n.branchFilter,n.start_date,n.end_date]);const Me=s=>{W(`/order/${s}`,{state:{from:"OrderTable"}})},Oe=async s=>{try{const{isConfirmed:a}=await v.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(a){const{success:l,message:m}=await Pe(s);if(l){const f=c.filter(_=>_.order_id!==s);(f==null?void 0:f.length)===0&&w>1&&(g(w-1),x({page:(w-1).toString(),perPage:u.toString()})),await C(),v.fire(m)}else v.fire(m)}}catch(a){v.fire({title:"Error",text:a.message,icon:"error"})}},Ye=s=>{var l;const a=(l=s==null?void 0:s.order_invoice)==null?void 0:l.fileUrl;a?window.open(a,"_blank"):V.error("Please generate the invoice before downloading.")},$e=s=>{W(`/order/edit/${s}`,{state:{prevUrl:j.pathname}})},Te=async s=>{s.preventDefault();try{await ss.validate({search:$},{abortEarly:!1}),Q($),J("")}catch(a){a instanceof as&&J(a.errors[0])}},h=s=>{i===s?M(r==="ASC"?"DESC":"ASC"):(pe(s),M("ASC"))},Ee=s=>{s>=1&&s<=Be&&(g(s),x({page:s.toString(),perPage:u.toString()}))},Le=s=>{const a=Number(s.target.value);H(a),g(1),x({page:"1",perPage:a.toString()})},ee=()=>{const s=c.filter(a=>d.includes(a.order_id));ge(s),T(!0)},N=async()=>{try{const{isConfirmed:s}=await v.fire({title:"Are you sure?",html:`Want to change order status to <span style="color: #1B84FF; font-weight: 500;">"${F}"</span> ?`,showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes",cancelButtonText:"No",icon:void 0,didClose:()=>{b(null)}});if(s){const a=B+1;await _e(d,a)&&(k(),await C())}}catch{V.error("Error while changing status")}},R=(s,a)=>{const l=s.find(m=>(m==null?void 0:m.type)===a);return!s.length||!a||!l?"":`${l.user.first_name} ${l.user.last_name}`};t.useEffect(()=>{q&&ee()},[q]),t.useEffect(()=>{if(A!==null)switch(A){case 1:E(!0);break;case 2:N();break;case 3:N();break;case 4:Z(!0);break;case 5:N();break;case 6:N();break;case 7:N();break;case 8:N();break;case 9:E(!0);break;case 10:ee();break;default:V("Invalid order status...")}},[A]);const p=j.pathname,We=p==="/confirmed-orders",Ie={"/orders":{showCurrentStatus:!0,showPickupDate:!0,showPaymentType:!0,showConfirmedBy:!0,showDeliveredBy:!0,showWorkshopBy:!0},"/pickup-orders":{showCurrentStatus:!0,showPickupDate:!0,showPaymentType:!0,showConfirmedBy:!0,showDeliveredBy:!0,showWorkshopBy:!0},"/confirmed-orders":{showCurrentStatus:!1,showPickupDate:!0,showPaymentType:!1,showConfirmedBy:!0,showDeliveredBy:!1,showWorkshopBy:!1},"/redy-to-deliver":{showCurrentStatus:!0,showPickupDate:!1,showPaymentType:!1,showConfirmedBy:!0,showDeliveredBy:!1,showWorkshopBy:!0}},{showCurrentStatus:se,showPickupDate:ae,showPaymentType:te,showConfirmedBy:ne,showDeliveredBy:le,showWorkshopBy:ce}=Ie[p]||{},Re=()=>p==="/orders"?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:I}),e.jsx("td",{children:Ae}),e.jsx("td",{colSpan:8})]}):p==="/confirmed-orders"?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:I}),e.jsx("td",{colSpan:5})]}):p==="/redy-to-deliver"?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:I}),e.jsx("td",{colSpan:5})]}):e.jsx("td",{colSpan:8}),Ue=()=>p==="/orders"?14:p==="/pickup-orders"?16:p==="/confirmed-orders"?13:16;return ke?e.jsx(Ke,{isFilters:!0,isPagination:!0,columns:5,records:10}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:u,onChange:Le,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:Te,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:$,onChange:s=>{xe(s.target.value),s.target.value===""&&Q("")},placeholder:"Search...",className:"min-w-[185px]"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:je||"Â "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto scrollable-y-auto max-h-[500px]",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"!px-3",children:e.jsx("label",{className:"flex items-center justify-center",children:e.jsx("input",{className:"checkbox",type:"checkbox",disabled:!0})})}),e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("span",{className:`sort ${i==="order_id"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("order_id"),children:[e.jsx("span",{className:"sort-label",children:"Order Number"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${i==="branch_name"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("branch_name"),children:[e.jsx("span",{className:"sort-label",children:"Branch"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[240px]",children:e.jsxs("span",{className:`sort ${i==="first_name"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer Name"}),e.jsx("span",{className:"sort-icon"})]})}),se&&e.jsx("th",{className:"min-w-[280px]",children:"Current Status"}),e.jsx("th",{className:"min-w-[280px]",children:"Next Status"}),e.jsx("th",{className:"min-w-[120px]",children:"Qty"}),e.jsx("th",{className:"min-w-[180px]",children:e.jsxs("span",{className:`sort ${i==="total"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("total"),children:[e.jsx("span",{className:"sort-label",children:"Booking Amount"}),e.jsx("span",{className:"sort-icon"})]})}),j.pathname!=="/pickup-orders"&&e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("span",{className:`sort ${i==="total"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("paid_amount"),children:[e.jsx("span",{className:"sort-label",children:"Paid Amount"}),e.jsx("span",{className:"sort-icon"})]})}),j.pathname==="/orders"&&e.jsx("th",{className:"min-w-[155px]",children:e.jsxs("span",{className:`sort ${i==="total"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("kasar_amount"),children:[e.jsx("span",{className:"sort-label",children:"Kasar Amount"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("span",{className:`sort ${i==="created_at"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("created_at"),children:[e.jsx("span",{className:"sort-label",children:"Booking Date"}),e.jsx("span",{className:"sort-icon"})]})}),ae&&e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("span",{className:`sort ${i==="estimated_pickup_time"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("estimated_pickup_time"),children:[e.jsx("span",{className:"sort-label",children:"Pickup Date"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("span",{className:`sort ${i==="estimated_delivery_time"?r==="ASC"?"asc":"desc":""}`,onClick:()=>h("estimated_delivery_time"),children:[e.jsx("span",{className:"sort-label",children:"Delivery Date"}),e.jsx("span",{className:"sort-icon"})]})}),te&&e.jsx("th",{className:"min-w-[165px]",children:"Payment type"}),ne&&e.jsx("th",{className:"min-w-[150px]",children:e.jsx("span",{className:"sort-label",children:"Confirmed By"})}),le&&e.jsx("th",{className:"min-w-[150px]",children:e.jsx("span",{className:"sort-label",children:"Delivered By"})}),ce&&e.jsx("th",{className:"min-w-[150px]",children:e.jsx("span",{className:"sort-label",children:"Workshop By"})}),(o(3,"read")||o(3,"update")||o(3,"delete"))&&e.jsx("th",{className:"w-[170px]",children:"Actions"})]})}),(c==null?void 0:c.length)>0?e.jsxs("tbody",{children:[e.jsxs("tr",{className:"bg-blue-50 text-blue-900 font-semibold border-t border-blue-100",children:[e.jsxs("td",{colSpan:3,children:["Total Count : ",L]}),e.jsx("td",{}),e.jsx("td",{}),!We&&e.jsx("td",{}),e.jsx("td",{children:Fe}),e.jsx("td",{children:De}),Re()]}),c==null?void 0:c.map(s=>{var f,_,ie,re,oe,de,he,me;const a=B!==null&&s.order_status!==B||[11,12,13].includes(s.order_status),l=ue(s.order_status_details.admin_label),m=ue(s.order_status_details.next_step);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("label",{className:"flex items-center justify-center",children:e.jsx("input",{className:"checkbox",type:"checkbox",disabled:a,checked:d.includes(s.order_id),onChange:()=>Se(s)})})}),e.jsxs("td",{className:"cursor-pointer text-blue-600 hover:underline",onClick:()=>W(`/order/${s==null?void 0:s.order_id}`),children:["#",s.order_id]}),e.jsx("td",{children:(f=s==null?void 0:s.branch)==null?void 0:f.branch_name}),e.jsx("td",{children:((_=s==null?void 0:s.user)==null?void 0:_.first_name)+" "+((ie=s==null?void 0:s.user)==null?void 0:ie.last_name)}),se&&e.jsx("td",{children:e.jsx("span",{className:`${l} relative badge-outline badge-xl rounded-[30px]`,children:(re=s==null?void 0:s.order_status_details)==null?void 0:re.admin_label})}),e.jsx("td",{children:((oe=s==null?void 0:s.order_status_details)==null?void 0:oe.next_step)!=="NULL"&&e.jsxs("div",{className:"tooltip-custom",children:[e.jsx("span",{className:`${m} badge-outline badge-xl rounded-[30px]`,children:(de=s==null?void 0:s.order_status_details)==null?void 0:de.next_step}),e.jsx("div",{className:"tooltip-text",children:(he=s==null?void 0:s.order_status_details)==null?void 0:he.description})]})}),e.jsx("td",{children:(me=s==null?void 0:s.items)==null?void 0:me.reduce((Ve,U)=>Ve+(U==null?void 0:U.quantity),0)}),e.jsx("td",{children:s==null?void 0:s.total}),j.pathname!=="/pickup-orders"&&e.jsx("td",{children:s==null?void 0:s.paid_amount}),j.pathname==="/orders"&&e.jsx("td",{children:s==null?void 0:s.kasar_amount}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[S(s==null?void 0:s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),S(s==null?void 0:s.created_at).format("hh:mm:ss A")]})}),ae&&e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:S(s==null?void 0:s.estimated_pickup_time).format("DD-MM-YYYY")})}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:s!=null&&s.delivery_date?S(s==null?void 0:s.delivery_date).format("DD-MM-YYYY hh:mm:ss A"):S(s==null?void 0:s.estimated_delivery_time).format("DD-MM-YYYY")})}),te&&e.jsx("td",{children:Qe[s==null?void 0:s.payment_type]}),ne&&e.jsx("td",{children:R(s==null?void 0:s.orderLogs,"confirmed_by")}),le&&e.jsx("td",{children:R(s==null?void 0:s.orderLogs,"delivered_by")}),ce&&e.jsx("td",{children:R(s==null?void 0:s.orderLogs,"workshop_by")}),(o(3,"update")||o(3,"delete")||o(3,"read"))&&e.jsx("td",{children:e.jsxs("div",{className:"flex",children:[o(3,"read")&&e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-[11px] rounded-full",onClick:()=>Me(s==null?void 0:s.order_id),children:e.jsx(Je,{size:18,className:"text-gray-600"})}),o(3,"update")&&e.jsx("button",{className:"mr-3 p-3 rounded-full bg-yellow-100 hover:bg-yellow-200",onClick:()=>$e(s==null?void 0:s.order_id),children:e.jsx(Xe,{className:"text-yellow-600 h-4 w-4"})}),o(3,"delete")&&e.jsx("button",{className:"mr-3 p-3 bg-red-100 hover:bg-red-200  rounded-full",onClick:()=>Oe(s==null?void 0:s.order_id),children:e.jsx(Ze,{className:"text-red-500 h-4 w-4"})}),o(3,"read")&&e.jsx("button",{className:"p-3 rounded-full bg-teal-100 hover:bg-teal-200",onClick:()=>Ye(s),children:e.jsx(ds,{className:"text-teal-600 h-4.5 w-4.5"})})]})})]},s==null?void 0:s.order_id)})]}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:Ue(),className:"text-center",children:"No Order available"})})})]})}),e.jsx(es,{count:L,currentPage:w,totalRecords:c==null?void 0:c.length,perPage:u,onPageChange:Ee,label:"orders"})]})}),e.jsx(cs,{orderId:d,modelOpen:we,onClose:()=>{E(!1),b(null)},orderStatus:F,setAssigned:s=>{s&&(k(),C())}}),e.jsx(is,{orderIds:d,workshopModalOpen:Ce,onClose:()=>{b(null),Z(!1)},setAssigned:s=>{s&&(k(),C())},orderStatus:F}),fe&&e.jsx(rs,{orders:be,onClose:()=>{T(!1),b(null),G(!1)},onSuccess:async s=>{s&&(k(),await C(),b(null),T(!1),G(!1))}})]})};export{vs as O};
