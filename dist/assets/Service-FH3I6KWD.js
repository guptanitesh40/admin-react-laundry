import{r,V as p,j as e,b as I,u as O,e as $,T as J,F as Y,f as q,P as H,s as K}from"./index-CCALYk8q.js";import{p as Q}from"./productSchema-D2tdq-dJ.js";import{u as W}from"./useGetServices-BEzlNvhx.js";import{S as D}from"./sweetalert2.esm.all-B0Dix5B2.js";const X=()=>{const[o,s]=r.useState(!1),[c,l]=r.useState(null);return{service:c,loading:o,fetchService:async t=>{var i;if(!t){l(null);return}const d=localStorage.getItem("authToken"),n=`http://35.154.167.170:3000/admin/services/${t}`;s(!1);try{const f=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(!f.ok){const g=await f.json();p.error(g.message,{position:"top-center"}),s(!1);return}const u=await f.json();l((i=u==null?void 0:u.data)==null?void 0:i.service)}catch{p.error("Network error: Failed to fetch.")}finally{s(!1)}}}},Z="http://35.154.167.170:3000/admin/services",ee=()=>{const[o,s]=r.useState(!1);return{addService:async l=>{const h=localStorage.getItem("authToken");s(!0);try{const t=await fetch(Z,{method:"POST",headers:{Authorization:h?`Bearer ${h}`:""},body:l});if(!t.ok){const i=(await t.json()).message;return p.error(i,{position:"top-center"}),!1}const d=await t.json();return p.success(d.message,{position:"top-center"}),!0}catch(t){return t.name==="TypeError"&&t.message.includes("Failed to fetch")?p.error("Network error: Failed to fetch.",{position:"top-center"}):p.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{s(!1)}},loading:o}},te=()=>{const[o,s]=r.useState(!1),c=localStorage.getItem("authToken");return{deleteService:async h=>{s(!0);const t=`http://35.154.167.170:3000/admin/services/${h}`;try{if(!c)return p.error("No authentication token found",{position:"top-center"}),s(!1),{success:!1,message:"No authentication token found"};const d=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}}),n=await d.json();return d.ok?{success:!0,message:n.message}:(p.error(n.message,{position:"top-center"}),{success:!1,message:n.message})}catch(d){return{success:!1,message:d.message}}finally{s(!1)}},loading:o}},se=()=>{const[o,s]=r.useState(!1);return{updateService:async(l,h)=>{s(!0);const t=`http://35.154.167.170:3000/admin/services/${l}`;try{const d=localStorage.getItem("authToken");if(!d)return p.error("No authentication token found",{position:"top-center"}),s(!1),!1;const n=await fetch(t,{method:"PUT",headers:{Authorization:`Bearer ${d}`},body:h});if(n.ok){const i=await n.json();return p.success(i.message,{position:"top-center"}),!0}else{const f=(await n.json()).message;return p.error(f,{position:"top-center"}),!1}}finally{s(!1)}},loading:o}},ae=({isOpen:o,onClose:s,service_id:c,setIsSubmit:l})=>{const{addService:h,loading:t}=ee(),{updateService:d,loading:n}=se(),{service:i,fetchService:f}=X(),[u,g]=r.useState({name:"",image:""}),[y,w]=r.useState({name:"",image:""}),[E,S]=r.useState({});r.useEffect(()=>{o&&c&&f(c)},[o,c]),r.useEffect(()=>{if(o&&i&&c){const b={name:i.name,image:i.image};g(b),w(b)}else g({name:"",image:""}),w({name:"",image:""}),S({})},[o,i]);const P=b=>{const{name:v,value:N,files:m}=b.target;v==="image"&&m&&m.length>0?g(x=>({...x,image:m[0]})):g(x=>({...x,[v]:N}))},k=async b=>{b.preventDefault();try{if(await Q(!!c).validate(u,{abortEarly:!1}),!Object.keys(u).some(x=>x==="image"?u.image instanceof File||u.image!==y.image:u[x]!==y[x])){s();return}const m=new FormData;m.append("name",u.name),u.image instanceof File&&m.append("image",u.image),c?await d(c,m):await h(m),l(!0),s()}catch(v){if(v instanceof I){const N={};v.inner.forEach(m=>{N[m.path||""]=m.message}),S(N)}else p.error("Failed to submit the form. Please try again.")}};return o?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:s}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg min-w-96 z-10 zx:min-w-[85%] relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:s,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:c?"Edit Service":"Add Service"}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",autoComplete:"off",value:u.name,onChange:P,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:E.name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"font-semibold",htmlFor:"image",children:"Image"}),e.jsx("span",{className:"text-sm text-gray-500",children:"(JPG, JPEG, PNG | 85×85 px)"})]}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:P,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:E.image||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${t||n?"opacity-50 cursor-not-allowed":""}`,disabled:t||n,children:t||n?t?"Adding...":"Updating...":c?"Update Service":"Add Service"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:s,disabled:t||n,children:"Cancel"})]})]})]})]}):null},re=({isSubmit:o,setIsSubmit:s,setEditService:c})=>{const[l,h]=r.useState(1),[t,d]=r.useState(10),[n,i]=O(),[f,u]=r.useState(null),[g,y]=r.useState(null),w=n.get("page"),E=n.get("perPage"),[S,P]=r.useState(""),[k,b]=r.useState(""),[v,N]=r.useState(""),{services:m,count:x,fetchServices:A,loading:z}=W(l,t,S,f,g),{hasPermission:C}=$(),L=Math.ceil(x/t),{deleteService:R}=te();r.useEffect(()=>{(async()=>{o&&(A(),s(!1))})()},[o]);const B=async a=>{try{const{isConfirmed:j}=await D.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(j){const{success:V,message:F}=await R(a);V?(m.filter(_=>_.service_id!==a).length===0&&l>1&&(h(l-1),i({page:(l-1).toString(),perPage:t.toString()})),await A(),D.fire(F)):D.fire(F)}}catch(j){D.fire({title:"Error",text:j.message,icon:"error"})}};r.useEffect(()=>{w&&h(Number(w)),E&&d(Number(E))},[w,E]),r.useEffect(()=>{S&&(h(1),i({search:S,page:"1",perPage:t.toString()}))},[S]);const U=async a=>{a.preventDefault();try{await K.validate({search:S},{abortEarly:!1}),P(k),N("")}catch(j){j instanceof I&&N(j.errors[0])}},T=a=>{f===a?y(g==="ASC"?"DESC":"ASC"):(u(a),y("ASC"))},G=a=>{a>=1&&a<=L&&(h(a),i({page:a.toString(),perPage:t.toString()}))},M=a=>{const j=Number(a.target.value);d(j),h(1),i({page:"1",perPage:j.toString()})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:t,onChange:M,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:U,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:k,onChange:a=>{b(a.target.value),a.target.value===""&&P("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v||" "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[30px]",children:e.jsxs("span",{className:`sort ${f==="service_id"?g==="ASC"?"asc":"desc":""}`,onClick:()=>T("service_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[650px]",children:e.jsxs("span",{className:`sort ${f==="name"?g==="ASC"?"asc":"desc":""}`,onClick:()=>T("name"),children:[e.jsx("span",{className:"sort-label",children:"Product name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[125px]",children:"Image"}),(C(7,"update")||C(7,"delete"))&&e.jsx("th",{className:"min-w-[125px]",children:"Actions"})]})}),z?e.jsx(J,{}):m.length>0?e.jsx("tbody",{children:m.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:a.service_id})}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-1.5",children:a.name})}),e.jsx("td",{children:e.jsx("img",{alt:a.name,className:"rounded-lg size-20 shrink-0",src:a.image})}),(C(7,"update")||C(7,"delete"))&&e.jsxs("td",{children:[C(7,"update")&&e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>c(a.service_id),children:e.jsx(Y,{className:"text-yellow-600"})}),C(7,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>B(a.service_id),children:e.jsx(q,{className:"text-red-500"})})]})]},a.service_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Service available"})})})]})}),e.jsx(H,{count:x,currentPage:l,totalRecords:m==null?void 0:m.length,perPage:t,onPageChange:G,label:"service"})]})})]})},de=()=>{const[o,s]=r.useState(!1),[c,l]=r.useState(null),[h,t]=r.useState(!1),[d,n]=r.useState(!1),{hasPermission:i}=$(),f=()=>{t(!1),s(!0),l(null)},u=g=>{t(!0),l(g),s(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-7.5",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Service"})}),i(7,"create")&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{onClick:f,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Service"]})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(re,{isSubmit:d,setIsSubmit:n,setEditService:u})})})}),e.jsx(ae,{setIsSubmit:n,isOpen:o,onClose:()=>s(!1),service_id:c})]})};export{de as default};
