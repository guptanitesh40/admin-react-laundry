import{a as le,d as g,o as u,z as ne,g as de,r as l,A as ie,J as oe,H as ce,l as me,j as e,L as ue,b as he,V as P}from"./index-B1iAACgG.js";import{u as xe}from"./useGetCompanies-BOnnrBxj.js";import{u as pe,a as ge,A as be,C as fe}from"./CustomerModal-BEVmqyGn.js";import{u as _e}from"./useGetuser-Dornvxde.js";import"./userSchema-BXc2guVq.js";const ye=le().shape({company_id:u().nullable().required("Company is required"),branch_id:u().required("Branch is required"),user_id:u().required("User is required"),username:g().trim().required("Username is required"),address_id:u().required("Address is required"),description:g().trim().nullable().max(255).required("Order not must not exceed 255 characters"),payment_type:u().required("Payment type is required"),order_status:u().nullable().required("Order status is required"),gstin:g().trim().matches(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,"Invalid GSTIN format").nullable(),gst_company_name:g().trim().nullable()}),Ee=()=>{var G;const{companies:h,loading:b}=xe(1,1e3),{branches:d,loading:f}=ne(1,1e3),_=de(s=>s==null?void 0:s.user),[c,y]=l.useState(""),[v,m]=l.useState(!0),{loading:x}=pe(),[k,B]=l.useState(!1),[M,D]=l.useState(!1),[R,O]=l.useState(!1),[E,j]=l.useState(!1),{users:N,fetchUsersByRole:F}=ie(),{address:i,fetchAddress:q}=ge(),{userData:C,fetchUser:L}=_e();oe(),C==null||C.user;const w=ce(),T=((G=w==null?void 0:w.state)==null?void 0:G.prevUrl)||"/orders",S=l.useRef(null),A=l.useRef(null),[I,U]=l.useState(!1),[Ne,Ce]=l.useState(null),[o,$]=l.useState({}),H=me(),[a,t]=l.useState({company_id:null,branch_id:null,username:"",user_id:null,address_id:null,description:"",express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,payment_type:1,order_status:1,gstin:"",gst_company_name:""});l.useEffect(()=>{const s=r=>{A.current&&!A.current.contains(r.target)&&S.current&&!S.current.contains(r.target)&&(m(!1),U(!1))};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]),l.useEffect(()=>{if(i!=null&&i.length){const s=i.find(r=>r.is_default)||i[0];t(r=>({...r,address_id:s?s.address_id:null}))}},[i]),l.useEffect(()=>{(async()=>{a.user_id&&(await q(a.user_id),await L(a.user_id)),E&&(await q(a.user_id),j(!1))})()},[a.user_id,E]),l.useEffect(()=>{(async()=>{I&&(!c||c.trim()==="")?(m(!0),await F(5)):c&&v&&await F(5,c)})()},[I,c,v]);const Z=async s=>{s.preventDefault();try{await ye.validate(a,{abortEarly:!1}),$({})}catch(r){if(r instanceof he){const n={};r.inner.forEach(p=>{n[p.path||""]=p.message}),$(n)}else P.error("Failed to submit the form. Please try again.")}},V=s=>{s.target.value===""&&t(r=>({...r,address_id:null,user_id:null})),y(s.target.value),m(!0)},z=s=>{const r=`${s.first_name} ${s.last_name}`;y(r),m(!1),t({...a,username:r,user_id:s.user_id})},J=()=>{H(`${T}`)},Q=s=>{const r=s.target.value;t(n=>({...n,address_id:Number(r)}))},K=s=>{s.preventDefault(),a.user_id?D(!0):P.error("Please select the user to add address")},W=s=>{s.preventDefault(),O(!0)},X=(s,r)=>{if(s){const n=`${s.first_name} ${s.last_name}`;y(n),m(!1),t({...a,username:n,user_id:s.user_id})}r&&t(n=>({...n,address_id:r.address_id}))},Y=s=>{s&&t(r=>({...r,address_id:s.address_id}))};return l.useEffect(()=>{if(!b&&h.length>0){const s=h.find(r=>r.gst_percentage===6);s&&t({...a,company_id:s.company_id})}},[h,b]),l.useEffect(()=>{if(d!=null&&d.length&&_&&!f){const s=_.user_branch||[];if(s.length){const r=d.find(n=>n.branch_id===s[0]);t(r?n=>({...n,branch_id:r.branch_id}):n=>({...n,branch_id:d[0].branch_id}))}else t(r=>({...r,branch_id:d[0].branch_id}))}},[d,_,f]),b||f?e.jsx(ue,{}):e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"card max-w-5xl mx-auto bg-white shadow-md lg:!p-4 xl:!p-6 sm:!p-5 p-3.5",children:[e.jsx("div",{className:"flex",children:e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add Quick Order"})}),e.jsxs("form",{onSubmit:Z,children:[e.jsxs("div",{className:"grid md:grid-cols-2 cs1:gap-x-6 gap-x-4  gap-y-5 mt-4 grid-cols-1",children:[e.jsxs("div",{className:"md:!col-span-2 grid md:!grid-cols-2 cs1:gap-x-6 gap-x-4 items-start grid-cols-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"company_id",children:"Company"}),e.jsxs("select",{id:"company_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:a.company_id||"",onChange:s=>{t({...a,company_id:s.target.value?Number(s.target.value):null})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Company"}),h.length>0?h.map(s=>e.jsx("option",{value:s.company_id,children:`${s.company_name} (${s.gst_percentage}%)`},s.company_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:o.company_id||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"branch",className:"!block text-gray-700 text-sm font-bold mb-2",children:"Branch"}),e.jsxs("select",{id:"branch",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:a.branch_id||"",onChange:s=>t({...a,branch_id:s.target.value?Number(s.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch"}),d.length>0?d.map(s=>e.jsx("option",{value:s.branch_id,children:s.branch_name},s.branch_id)):e.jsx("option",{children:"No Data Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.branch_id||" "})]})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer name"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6 sm:btn-lg",onClick:W,children:"Add Customer"})]}),e.jsx("input",{type:"text",id:"username",ref:S,autoComplete:"off",value:c||"",onChange:V,className:"input border border-gray-300 rounded-md p-2 w-full mb-2",placeholder:"Search customer...",onFocus:()=>{U(!0),m(!0)}}),N&&v&&e.jsx("ul",{ref:A,className:"absolute -mt-2 bg-white border z-10 border-gray-300 rounded-md p-2 w-full text-sm max-h-[400px] overflow-y-auto",children:N.length>0?N.map(s=>e.jsxs("li",{className:"p-2 hover:bg-gray-200 cursor-pointer rounded",onClick:()=>z(s),children:[s.first_name," ",s.last_name," (",s.mobile_number,")"]},s.user_id)):e.jsx("li",{className:"p-2 text-gray-500",children:"No users found"})}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.username||" "})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"address",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer address"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6",onClick:K,children:"Add address"})]}),e.jsxs("select",{id:"address",value:a.address_id??"",onChange:Q,className:"select border border-gray-300 rounded-md w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Address"}),i.length>0&&c?i.map(s=>{const{building_number:r,area:n,landmark:p,city:ee,state:se,country:ae,pincode:re}=s,te=[r,n,p,ee,se,ae,re].filter(Boolean).join(", ");return e.jsx("option",{value:s.address_id,children:te},s.address_id)}):e.jsx("option",{disabled:!0,children:"No Address Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.address_id||" "})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 cs1:!gap-6 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Order Note"}),e.jsx("textarea",{rows:3,id:"description",value:a.description,onChange:s=>t({...a,description:s.target.value}),className:"h-full input border border-gray-300 rounded-md p-2 w-full"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.description||" "})]})}),e.jsx("div",{className:"flex flex-col md:!col-span-2",children:e.jsxs("div",{className:"md:!col-span-2 grid sm:!grid-cols-3 cs1:!gap-6 gap-4 grid-cols-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"exp_delivery_time",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Time"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"exp_delivery_time",value:a.express_delivery_hour||"",onChange:s=>t({...a,express_delivery_hour:s.target.value?Number(s.target.value):null}),children:[e.jsx("option",{value:"",children:"Select Express Delivery Time"}),e.jsx("option",{value:24,children:"24 Hrs"}),e.jsx("option",{value:48,children:"48 Hrs"}),e.jsx("option",{value:72,children:"72 Hrs"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"express_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Charge"}),e.jsx("input",{type:"text",id:"express_delivery_charges",autoComplete:"off",min:"0",value:a.express_delivery_charges||"",onChange:s=>handleChargeChange("express_delivery_charges",s.target.value),className:`${a.normal_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:a.normal_delivery_charges>0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"normal_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Normal Delivery Charge"}),e.jsx("input",{type:"text",id:"normal_delivery_charges",min:"0",autoComplete:"off",value:a.normal_delivery_charges||"",onChange:s=>handleChargeChange("normal_delivery_charges",s.target.value),className:`${a.express_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:a.express_delivery_charges>0})]})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Method"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_method",value:a.payment_type??"",onChange:s=>t({...a,payment_type:Number(s.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Type"}),e.jsx("option",{value:1,children:"Cash on Delivery"}),e.jsx("option",{value:2,children:"Online Payment"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.payment_type||" "})]}),e.jsxs("div",{className:"flex flex-col justify-center items-start",children:[e.jsx("label",{htmlFor:"have_gst_cb",className:"block text-gray-700 text-sm font-bold mb-2",children:"Do you have GSTIN ?"}),e.jsx("input",{className:"checkbox",id:"have_gst_cb",name:"check",type:"checkbox",checked:k,onChange:s=>{B(s.target.checked)}})]}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"gstin",className:"block text-gray-700 text-sm font-bold mb-2",children:"GSTIN"}),e.jsx("input",{type:"text",id:"gstin",autoComplete:"off",value:a.gstin,onChange:s=>t({...a,gstin:s.target.value}),className:"uppercase input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.gstin||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"gst_company_name",className:"block text-gray-700 text-sm font-bold mb-2",children:"Company Name"}),e.jsx("input",{type:"text",id:"gst_company_name",autoComplete:"off",value:a.gst_company_name,onChange:s=>t({...a,gst_company_name:s.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.gst_company_name||" "})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${x?"opacity-50 cursor-not-allowed":""}`,disabled:x,children:x?"Adding...":"Add Order"}),e.jsx("button",{type:"button",onClick:J,className:"btn btn-secondary",disabled:x,children:"Cancel"})]})]}),e.jsx(be,{onAddressAdded:Y,isOpen:M,setIsSubmit:j,onClose:()=>D(!1),userId:a.user_id,fullname:a.username}),e.jsx(fe,{onCustomerCreated:X,isOpen:R,setIsSubmit:j,onClose:()=>O(!1)})]})})};export{Ee as default};
