import{r as n,V as p,j as e,b as F,u as O,e as I,T as H,F as J,f as Y,P as q,s as K}from"./index-tbdUJ46r.js";import{p as Q}from"./productSchema-BGGQhihu.js";import{M as W}from"./ModelLoadingTag-CoFxSvM8.js";import{u as X}from"./useGetServices-RKoi74kz.js";import{S as P}from"./sweetalert2.esm.all-B0Dix5B2.js";const Z=()=>{const[c,t]=n.useState(!1),[l,d]=n.useState(null);return{service:l,loading:c,fetchService:async a=>{var r;if(!a){d(null);return}const m=localStorage.getItem("authToken"),o=`http://35.154.167.170:3000/admin/services/${a}`;t(!0);try{const x=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}});if(!x.ok){const i=await x.json();p.error(i.message,{position:"top-center"}),t(!1);return}const y=await x.json();d((r=y==null?void 0:y.data)==null?void 0:r.service)}catch{p.error("Network error: Failed to fetch.")}finally{t(!1)}}}},ee="http://35.154.167.170:3000/admin/services",ae=()=>{const[c,t]=n.useState(!1);return{addService:async d=>{const h=localStorage.getItem("authToken");t(!0);try{const a=await fetch(ee,{method:"POST",headers:{Authorization:h?`Bearer ${h}`:""},body:d});if(!a.ok){const r=(await a.json()).message;return p.error(r,{position:"top-center"}),!1}const m=await a.json();return p.success(m.message,{position:"top-center"}),!0}catch(a){return a.name==="TypeError"&&a.message.includes("Failed to fetch")?p.error("Network error: Failed to fetch.",{position:"top-center"}):p.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{t(!1)}},loading:c}},se=()=>{const[c,t]=n.useState(!1),l=localStorage.getItem("authToken");return{deleteService:async h=>{t(!0);const a=`http://35.154.167.170:3000/admin/services/${h}`;try{if(!l)return p.error("No authentication token found",{position:"top-center"}),t(!1),{success:!1,message:"No authentication token found"};const m=await fetch(a,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}),o=await m.json();return m.ok?{success:!0,message:o.message}:(p.error(o.message,{position:"top-center"}),{success:!1,message:o.message})}catch(m){return{success:!1,message:m.message}}finally{t(!1)}},loading:c}},te=()=>{const[c,t]=n.useState(!1);return{updateService:async(d,h)=>{t(!0);const a=`http://35.154.167.170:3000/admin/services/${d}`;try{const m=localStorage.getItem("authToken");if(!m)return p.error("No authentication token found",{position:"top-center"}),t(!1),!1;const o=await fetch(a,{method:"PUT",headers:{Authorization:`Bearer ${m}`},body:h});if(o.ok){const r=await o.json();return p.success(r.message,{position:"top-center"}),!0}else{const x=(await o.json()).message;return p.error(x,{position:"top-center"}),!1}}finally{t(!1)}},loading:c}},ne=({isOpen:c,onClose:t,service_id:l,setIsSubmit:d})=>{const{addService:h,loading:a}=ae(),{updateService:m,loading:o}=te(),{service:r,fetchService:x,loading:y}=Z(),[i,N]=n.useState({name:"",name_gujarati:"",name_hindi:"",is_visible:!0,image:""}),[k,C]=n.useState({name:"",name_gujarati:"",name_hindi:"",is_visible:!0,image:""}),[j,_]=n.useState({});n.useEffect(()=>{c&&l&&x(l)},[c,l]),n.useEffect(()=>{if(c&&r&&l){const b={name:r.name,name_gujarati:r.name_gujarati,name_hindi:r.name_hindi,is_visible:r.is_visible,image:r.image};N(b),C(b)}else N({name:"",name_gujarati:"",name_hindi:"",is_visible:!0,image:""}),C({name:"",name_gujarati:"",name_hindi:"",is_visible:!0,image:""}),_({})},[c,r]);const w=b=>{const{name:f,value:g,files:u}=b.target;f==="image"&&u&&u.length>0?N(S=>({...S,image:u[0]})):N(S=>({...S,[f]:g}))},D=async b=>{b.preventDefault();try{if(await Q(!!l).validate(i,{abortEarly:!1}),_({}),!Object.keys(i).some(S=>S==="image"?i.image instanceof File||i.image!==k.image:i[S]!==k[S])){t();return}const u=new FormData;u.append("name",i.name),u.append("name_gujarati",i.name_gujarati),u.append("name_hindi",i.name_hindi),u.append("is_visible",String(i.is_visible)),i.image instanceof File&&u.append("image",i.image),l?await m(l,u):await h(u),d(!0),t()}catch(f){if(f instanceof F){const g={};f.inner.forEach(u=>{g[u.path||""]=u.message}),_(g)}else p.error("Failed to submit the form. Please try again.")}};return c?e.jsxs("div",{className:"fixed inset-0 grid place-items-center z-50 overflow-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:t}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-[25rem] z-10 zx:min-w-[85%] relative",children:[l&&y&&c&&e.jsx(W,{}),e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:t,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:l?"Edit Service":"Add Service"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"English Name"}),e.jsx("input",{type:"text",id:"name",name:"name",autoComplete:"off",value:i.name,onChange:w,className:"input border border-gray-300 rounded-md p-2"}),j.name&&e.jsx("p",{className:"text-red-500 text-sm",children:j.name||" "})]}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name_gujarati",children:"Gujarati Name"}),e.jsx("input",{type:"text",id:"name_gujarati",name:"name_gujarati",autoComplete:"off",value:i.name_gujarati,onChange:w,className:"input border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name_hindi",children:"Hindi Name"}),e.jsx("input",{type:"text",id:"name_hindi",name:"name_hindi",autoComplete:"off",value:i.name_hindi,onChange:w,className:"input border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"font-semibold",htmlFor:"image",children:"Image"}),e.jsx("span",{className:"text-sm text-gray-500",children:"(JPG, JPEG, PNG | 85×85 px)"})]}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:w,className:"input border border-gray-300 rounded-md p-2"})}),j.image&&e.jsx("p",{className:"text-red-500 text-sm",children:j.image||" "})]}),e.jsx("div",{className:"flex flex-col mb-4",children:e.jsxs("label",{className:"form-label flex items-center gap-1 text-sm !font-semibold",children:[e.jsx("input",{className:"checkbox checkbox-lg",name:"check",type:"checkbox",checked:i.is_visible,onChange:b=>{N(f=>({...f,is_visible:b.target.checked}))}}),"Visible on web and mobile"]})}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${a||o?"opacity-50 cursor-not-allowed":""}`,disabled:a||o,children:a||o?a?"Adding...":"Updating...":l?"Update Service":"Add Service"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:t,disabled:a||o,children:"Cancel"})]})]})]})]}):null},re=({isSubmit:c,setIsSubmit:t,setEditService:l})=>{const[d,h]=n.useState(1),[a,m]=n.useState(10),[o,r]=O(),[x,y]=n.useState(null),[i,N]=n.useState(null),k=o.get("page"),C=o.get("perPage"),[j,_]=n.useState(""),[w,D]=n.useState(""),[b,f]=n.useState(""),{services:g,count:u,fetchServices:S,loading:$}=X(d,a,j,x,i),{hasPermission:E}=I(),L=Math.ceil(u/a),{deleteService:z}=se();n.useEffect(()=>{(async()=>{c&&(S(),t(!1))})()},[c]);const R=async s=>{try{const{isConfirmed:v}=await P.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(v){const{success:V,message:T}=await z(s);V?(g.filter(M=>M.service_id!==s).length===0&&d>1&&(h(d-1),r({page:(d-1).toString(),perPage:a.toString()})),await S(),P.fire(T)):P.fire(T)}}catch(v){P.fire({title:"Error",text:v.message,icon:"error"})}};n.useEffect(()=>{k&&h(Number(k)),C&&m(Number(C))},[k,C]),n.useEffect(()=>{j&&(h(1),r({search:j,page:"1",perPage:a.toString()}))},[j]);const B=async s=>{s.preventDefault();try{await K.validate({search:j},{abortEarly:!1}),_(w),f("")}catch(v){v instanceof F&&f(v.errors[0])}},A=s=>{x===s?N(i==="ASC"?"DESC":"ASC"):(y(s),N("ASC"))},G=s=>{s>=1&&s<=L&&(h(s),r({page:s.toString(),perPage:a.toString()}))},U=s=>{const v=Number(s.target.value);m(v),h(1),r({page:"1",perPage:v.toString()})};return $?e.jsx(H,{isFilters:!0,columns:4,records:8,isPagination:!1}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:a,onChange:U,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:B,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:w,onChange:s=>{D(s.target.value),s.target.value===""&&_("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:b||" "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[30px]",children:e.jsxs("span",{className:`sort ${x==="service_id"?i==="ASC"?"asc":"desc":""}`,onClick:()=>A("service_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[210px]",children:e.jsxs("span",{className:`sort ${x==="name"?i==="ASC"?"asc":"desc":""}`,onClick:()=>A("name"),children:[e.jsx("span",{className:"sort-label",children:"Product name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[210px]",children:e.jsx("span",{className:"sort-label",children:"Gujarati name"})}),e.jsx("th",{className:"min-w-[210px]",children:e.jsx("span",{className:"sort-label",children:"Hindi name"})}),e.jsx("th",{className:"min-w-[100px]",children:e.jsx("span",{className:"sort-label",children:"Is Visible"})}),e.jsx("th",{className:"min-w-[125px]",children:"Image"}),(E(7,"update")||E(7,"delete"))&&e.jsx("th",{className:"min-w-[125px]",children:"Actions"})]})}),g.length>0?e.jsx("tbody",{children:g.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"flex items-center gap-2.5",children:s.service_id})}),e.jsx("td",{children:e.jsx("span",{className:"flex items-center gap-1.5",children:s.name})}),e.jsx("td",{children:e.jsx("span",{className:"flex items-center gap-1.5",children:s.name_gujarati})}),e.jsx("td",{children:e.jsx("span",{className:"flex items-center gap-1.5",children:s.name_hindi})}),e.jsx("td",{children:e.jsx("span",{className:"flex items-center justify-center",children:e.jsx("input",{className:"checkbox checkbox-lg",name:"check",type:"checkbox",checked:s.is_visible,disabled:!0})})}),e.jsx("td",{children:e.jsx("img",{alt:s.name,className:"rounded-lg size-20 shrink-0",src:s.image})}),(E(7,"update")||E(7,"delete"))&&e.jsxs("td",{children:[E(7,"update")&&e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>l(s.service_id),children:e.jsx(J,{className:"text-yellow-600"})}),E(7,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>R(s.service_id),children:e.jsx(Y,{className:"text-red-500"})})]})]},s.service_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Service available"})})})]})}),e.jsx(q,{count:u,currentPage:d,totalRecords:g==null?void 0:g.length,perPage:a,onPageChange:G,label:"service"})]})})]})},he=()=>{const[c,t]=n.useState(!1),[l,d]=n.useState(null),[h,a]=n.useState(!1),{hasPermission:m}=I(),o=()=>{t(!0),d(null)},r=x=>{d(x),t(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-7.5",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Service"})}),m(7,"create")&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{onClick:o,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Service"]})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(re,{isSubmit:h,setIsSubmit:a,setEditService:r})})})}),c&&e.jsx(ne,{setIsSubmit:a,isOpen:c,onClose:()=>t(!1),service_id:l})]})};export{he as default};
