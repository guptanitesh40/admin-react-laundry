import{r,V as y,i as P,j as a,D as F,k as Y}from"./index-Dfkh1Z1C.js";import{M as S}from"./MultiSelect-hYaDuVJd.js";import{u as G}from"./useGetCompanies-BT7kqxqY.js";import"./orderStatusClasses-HfHBGnti.js";const A=(c,o="")=>{const[x,b]=r.useState(!1),[v,_]=r.useState([]);return r.useEffect(()=>{(async()=>{const h=localStorage.getItem("authToken"),i=`http://35.154.167.170:3000/user/by-role?role_id=${c}`,m=new URLSearchParams;o&&m.append("search",o),b(!0);try{const n=await fetch(`${i}&${m}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});if(!n.ok){const f=await n.json();y.error(f.message||"Failed to fetch users",{position:"top-center"});return}const d=await n.json();_((d==null?void 0:d.data)||[])}catch(n){y.error((n==null?void 0:n.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{b(!1)}})()},[c,o]),{users:v,loading:x}},{RangePicker:O}=F,q=({reportTitle:c,index:o,dynamic_url:x})=>{const[v,_]=r.useState(""),[u,h]=r.useState([]),[i,m]=r.useState([]),[n,d]=r.useState([]),{users:f,loading:k}=A(5,v),{companies:N,loading:R}=G(1,1e3),{branches:C,loading:D}=P(1,1e3,"","","",i),[j,E]=r.useState(!1),[g,I]=r.useState({start_time:"",end_time:""}),M="http://35.154.167.170:3000",U=localStorage.getItem("authToken"),$=r.useMemo(()=>k?[{label:"Loading...",value:0}]:f.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.user_id})),[f,k]),B=r.useMemo(()=>R?[{label:"Loading...",value:0}]:N.map(e=>({label:e.company_name,value:e.company_id})),[N,R]),L=r.useMemo(()=>D?[{label:"Loading...",value:0}]:C.map(e=>({label:e.branch_name,value:e.branch_id})),[C,D]),V=e=>{I(e?{start_time:Y(e[0]).format("DD-MM-YYYY"),end_time:Y(e[1]).format("DD-MM-YYYY")}:{start_time:"",end_time:""})},T=e=>{switch(e){case 0:l();break;case 1:l();break;case 2:l();break;case 3:l();break;case 4:l();break;case 5:l();break;case 6:l();break;default:l()}},l=async()=>{E(!0);const e=new URLSearchParams;g.start_time&&g.end_time&&(e.append("startDate",g.start_time),e.append("endDate",g.end_time)),u.length&&u.forEach(t=>e.append("user_id",t)),i.length&&i.forEach(t=>e.append("company_id",t)),n.length&&n.forEach(t=>e.append("branch_id",t));try{const t=await fetch(`${M}/report/${x}?format=excel&${e}`,{headers:{Authorization:`Bearer ${U}`}}),s=await t.json();if(!t.ok)throw new Error(s.message||"Failed to download report");const w=s==null?void 0:s.url;if(!w){y.error("Download report not found");return}const p=document.createElement("a");p.href=w,p.download=w,document.body.appendChild(p),p.click(),p.remove()}catch(t){y.error(t.message||"Network error: Failed to download report")}finally{E(!1)}};return a.jsxs("div",{className:"card !shadow-black/10",children:[a.jsx("div",{className:"card-header",children:a.jsx("h3",{className:"card-title",children:c})}),a.jsxs("div",{className:"card-body flex flex-col gap-3",children:[a.jsx("div",{children:a.jsx(O,{className:"w-full min-w-[80px] px-3 py-2 rounded-md border-gray-300",popupClassName:"custom-rangepicker-dropdown",onChange:V,format:"DD-MM-YYYY"})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(S,{options:B,displayValue:"label",placeholder:"Select Company",selectedValues:i,onSelect:e=>{const t=e.map(s=>s.value);m(t)},onRemove:e=>{const t=e.map(s=>s.value);m(t)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(S,{options:L,displayValue:"label",placeholder:"Select Branch",selectedValues:n,onSelect:e=>{const t=e.map(s=>s.value);d(t)},onRemove:e=>{const t=e.map(s=>s.value);d(t)},className:"w-full",isSearchInput:!1})}),a.jsx("div",{className:"mui-multiselect-parent",children:a.jsx(S,{options:$,displayValue:"label",placeholder:"Select Customer",selectedValues:u,onSelect:e=>{const t=e.map(s=>s.value);h(t)},onRemove:e=>{const t=e.map(s=>s.value);h(t)},setSearch:_,className:"w-full",isSearchInput:!0})})]}),a.jsx("div",{className:"card-footer",children:a.jsxs("button",{disabled:j,className:"w-full inline-flex items-center justify-center btn btn-primary px-3 py-2 relative overflow-hidden",onClick:()=>T(o),children:[j&&a.jsx("span",{className:"absolute inset-0 loading-bar"}),a.jsx("span",{children:j?"Downloading...":"Download"})]})})]},o)},z=[{name:"total Order Report",dynamic_url:"total-orders"},{name:"payment Transaction Report",dynamic_url:"payment-transaction"},{name:"refund Report",dynamic_url:"refund-report"},{name:"in Active Customer Report",dynamic_url:"inactive-customer-report"},{name:"gst Report",dynamic_url:"gst"},{name:"pick Up Report",dynamic_url:"pickup"},{name:"delivery Report",dynamic_url:"delivery"}],W=()=>a.jsx("main",{className:"grow content",id:"content",role:"content",children:a.jsxs("div",{className:"container-fixed",children:[a.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:a.jsx("div",{className:"flex flex-col justify-center gap-2",children:a.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Reports"})})}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:z.map((c,o)=>a.jsx(q,{reportTitle:c.name,dynamic_url:c.dynamic_url,index:o},o))})]})});export{W as default};
