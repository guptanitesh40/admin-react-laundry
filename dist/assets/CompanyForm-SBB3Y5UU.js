import{r as y,V as _,a as P,g as w,d as m,p as E,m as S,h as L,j as e,i as A,b as z}from"./index-Qj1W7LSO.js";import{u as O}from"./useGetCompany-Tvjmlt_A.js";import{au as R,av as U}from"./AdapterDayjs-CSAD1Am7.js";import{D as T}from"./DatePicker-DNsPGEKu.js";const $="http://35.154.167.170:3000",Y=`${$}/companies`,I=()=>{const[g,t]=y.useState(!1);return{addCompany:async d=>{const c=localStorage.getItem("authToken");t(!0);try{const s=new FormData;Object.entries(d).forEach(([n,a])=>{a&&(a instanceof FileList?s.append(n,a[0]):s.append(n,a))});const r=await fetch(Y,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:s});if(!r.ok){const n=await r.json();return _.error(n.message,{position:"top-center"}),!1}const h=await r.json();return _.success(h.message,{position:"top-center"}),!0}catch(s){return _.error((s==null?void 0:s.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{t(!1)}},loading:g}},M=()=>{const[g,t]=y.useState(!1);return{updateCompany:async(d,c)=>{const s=localStorage.getItem("authToken"),r=`http://35.154.167.170:3000/companies/${d}`,h=new FormData;for(const n in c)c[n]&&(n==="logo"||n==="contract_document"?c[n]instanceof FileList&&c[n].length>0&&h.append(n,c[n][0]):h.append(n,c[n]));t(!0);try{const n=await fetch(r,{method:"PUT",headers:{Authorization:`Bearer ${s}`},body:h});if(n.ok){const x=await n.json();return _.success(x.message,{position:"top-center"}),!0}const a=await n.json();return _.error(a.message,{position:"top-center"}),!1}catch(n){return _.error(n.message,{position:"top-center"}),!1}finally{t(!1)}},loading:g}},G=(g=!1)=>P().shape({company_name:m().required("Company name is required").test("required","Company name is required",t=>!!t),address:m().required("Address is required").test("required","Address is required",t=>!!t),city:m().required("City is required").test("required","City is required",t=>!!t),state:m().required("State is required").test("required","State is required",t=>!!t),zip_code:m().test("required","Zip Code is required",t=>!(t===null||t==="")).test("format","Zip Code must be a 6 digit number",t=>t===null||t===""?!0:/^[0-9]{6}$/.test(t)),company_owner_name:m().required("Company Owner Name is required").test("required","Company Owner Name is required",t=>!!t),phone_number:m().nullable().test("required","Please add phone number",t=>!(t===null||t==="")).test("is-numeric","Phone number must be a positive number",t=>t?/^[0-9+\-\s()]{5,15}$/.test(t):!0).test("length","Phone number must be between 5 to 15 long",t=>t?t.length>=5&&t.length<=15:!0),mobile_number:m().nullable().test("is-numeric","Phone number must be a positive number",t=>t?/^[0-9+\-\s()]{5,15}$/.test(t):!0).test("length","Phone number must be between 5 to 15 long",t=>t?t.length>=5&&t.length<=15:!0),email:m().required("Email is required").email("Enter a valid email").test("required","Email is required",t=>!!t),website:m().nullable().url("Please enter a valid website URL").test("required","Website URL is required",t=>!!t),logo:w().nullable().test("required","Logo is required",t=>g?!0:!!t).test("fileType","Allowed Format : jpg, jpeg, png, ",t=>t&&t instanceof File?["image/jpeg","image/png","image/jpg"].includes(t.type):!0).test("dimensions","Logo must be 92×92 pixels",t=>!t||!(t instanceof File)?!0:new Promise(j=>{const d=new Image;d.src=URL.createObjectURL(t),d.onload=()=>{URL.revokeObjectURL(d.src),j(d.width===92&&d.height===92)},d.onerror=()=>{j(!1)}})),registration_number:m().nullable().test("required","Registration Number is required",t=>!!t),registration_date:E().nullable().required("Please select the registration date").typeError("Please select the registration date").max(new Date,"Registration Date cannot be in the future"),gstin:m().nullable().test("required","GSTIN is required",t=>!!t),company_ownedby:m().nullable().test("required","Company Owned By is required",t=>!(t===null||t==="")).test("format","Company Owned By must be a number",t=>t===null||t===""?!0:/^[0-9]+$/.test(t)),contract_document:w().nullable().test("fileSize","File is too large",t=>t&&t instanceof File?t.size<=5e6:!0).test("fileType","Unsupported file format",t=>t&&t instanceof File?["application/pdf"].includes(t.type):!0)}),V=()=>{const{addCompany:g,loading:t}=I(),{updateCompany:j,loading:d}=M(),{id:c}=S(),s=Number(c),{company:r,fetchCompany:h}=O(),n=L(),[a,x]=y.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null}),[C,q]=y.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null}),[o,F]=y.useState({});y.useEffect(()=>{(async()=>{await h(s)})()},[s]),y.useEffect(()=>{if(r){const l={company_name:r.company_name,address:r.address,city:r.city,state:r.state,zip_code:r.zip_code,company_owner_name:r.company_owner_name,phone_number:r.phone_number,mobile_number:r.mobile_number,email:r.email,website:r.website,logo:r.logo,registration_number:r.registration_number,registration_date:r.registration_date,gstin:r.gstin,company_ownedby:r.company_ownedby,contract_document:r.contract_document};x(l),q(l)}},[r]);const i=l=>{const u=l.target;if(u instanceof HTMLInputElement){const{name:f,value:p,files:b}=u;f==="image"&&b&&b.length>0?x(N=>({...N,logo:b[0]})):x(N=>({...N,[f]:p}))}else if(u instanceof HTMLTextAreaElement){const{name:f,value:p}=u;x(b=>({...b,[f]:p}))}},v=l=>{x(u=>({...u,registration_date:l?l.format("MM-DD-YYYY"):""}))},k=async l=>{l.preventDefault();try{if(await G(!!s).validate(a,{abortEarly:!1}),!Object.keys(a).some(b=>b==="logo"?a.logo instanceof File||a.logo!==C.logo:a[b]!==C[b])){n("/companies");return}let p;s?p=await j(s,a):p=await g(a),p&&n("/companies")}catch(u){if(u instanceof z){const f={};u.inner.forEach(p=>{f[p.path]=p.message}),F(f)}else _.error("Failed to submit the form. Please try again.")}},D=()=>{n("/companies")};return e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:s?"Edit Company":"Add Company"}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_name",children:"Company name"}),e.jsx("input",{type:"text",id:"company_name",name:"company_name",autoComplete:"off",value:a.company_name,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.company_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"address",children:"Address"}),e.jsx("input",{type:"text",id:"address",name:"address",autoComplete:"off",value:a.address,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.address||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"city",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:a.city,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.city||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"state",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:a.state,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.state||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"zip_code",children:"Zip code"}),e.jsx("input",{type:"text",id:"zip_code",name:"zip_code",autoComplete:"off",value:a.zip_code,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.zip_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_owner_name",children:"Company owner name"}),e.jsx("input",{type:"text",id:"company_owner_name",name:"company_owner_name",autoComplete:"off",value:a.company_owner_name,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.company_owner_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"phone_number",children:"Phone number 1"}),e.jsx("input",{type:"text",id:"phone_number",name:"phone_number",autoComplete:"off",value:a.phone_number,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.phone_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"mobile_number",children:"Phone number 2"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:a.mobile_number,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.mobile_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:a.email,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"website",children:"Website"}),e.jsx("input",{type:"text",id:"website",name:"website",autoComplete:"off",value:a.website,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.website||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"image",children:"Logo"}),e.jsx("span",{className:"text-sm text-gray-600",children:"(JPG, JPEG, PNG | 92×92 px)"})]}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:i,className:"input border border-gray-300 rounded-md p-2 mt-1"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.logo||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"registration_number",children:"Registration Number"}),e.jsx("input",{type:"text",id:"registration_number",name:"registration_number",autoComplete:"off",value:a.registration_number,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.registration_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"registration_date",children:"Registration Date"}),e.jsx(R,{dateAdapter:U,children:e.jsx(T,{value:a.registration_date?A(a.registration_date):null,onChange:v,format:"DD-MM-YYYY",renderInput:l=>e.jsx("input",{...l,id:"registration_date",name:"registration_date",className:"input border border-gray-300 rounded-md p-2"})})}),e.jsx("p",{className:"text-red-500 text-sm",children:o.registration_date||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"gstin",children:"GSTIN"}),e.jsx("input",{type:"text",id:"gstin",name:"gstin",autoComplete:"off",value:a.gstin,onChange:i,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.gstin||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_ownedby",children:"Company owned by"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"company_ownedby",value:a.company_ownedby??"",onChange:l=>x({...a,company_ownedby:Number(l.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Ownership"}),e.jsx("option",{value:1,children:"Own"}),e.jsx("option",{value:2,children:"Other Company"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:o.company_ownedby||" "})]}),a.company_ownedby===2&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"contract_document",children:"Contract Document"}),e.jsx("input",{type:"file",id:"contract_document",name:"contract_document",accept:".pdf,.doc,.docx",onChange:i,className:"border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:o.contract_document||" "})]})]}),e.jsxs("div",{className:"flex justify-start mt-6",children:[e.jsx("button",{type:"submit",className:"btn btn-primary mr-4",disabled:t||d,children:s?"Update Company":"Add Company"}),e.jsx("button",{type:"button",onClick:D,className:"btn btn-secondary",children:"Cancel"})]})]})]})};export{V as default};
