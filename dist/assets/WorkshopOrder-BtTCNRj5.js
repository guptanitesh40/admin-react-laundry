import{r as i,_ as M,u as B,g as Y,j as e,h as W,aT as G,d as z,e as I,V as L,aU as U,aV as K}from"./index-DxJcpna2.js";import{T as q}from"./TableShimmer-DtsENsts.js";import{P,b as H,W as J}from"./enums-DrmPtfwX.js";import{s as Q}from"./searchSchema-BKe6WphV.js";import{S as X}from"./react-select.esm-Dy247hz0.js";import{M as $}from"./index-C7vaskAF.js";import{u as Z}from"./useGetUsersByRole-Cx2yFRnt.js";import{u as ee}from"./useGetBranches-DafcePQN.js";import{u as se}from"./useGetWorkshops-BxFtGkZN.js";const ae="http://35.154.167.170:3000/admin/orders/workshop",te=(l=1,d=10,h="",u,j,b,f,n,g,r,_,x)=>{const[k,y]=i.useState(),[o,s]=i.useState(0),[a,v]=i.useState(!1),S=async()=>{var F,O;const C=localStorage.getItem("authToken"),p=new URLSearchParams;l&&p.append("page_number",l.toString()),d&&p.append("per_page",d.toString()),h&&p.append("search",h),u&&p.append("sortBy",u),j&&p.append("order",j),b&&b.forEach(c=>p.append("orderstatus",c.toString())),f&&f.forEach(c=>p.append("customer_id",c.toString())),n&&n.forEach(c=>p.append("branch_id",c.toString())),r&&r.forEach(c=>p.append("payment_status",c.toString())),_&&_.forEach(c=>p.append("workshop_id",c.toString())),x&&x.forEach(c=>p.append("workshop_manager_id",c.toString())),g&&p.append("payment_type",g.toString()),v(!0);try{const c=await fetch(`${ae}?${p}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`}}),w=await c.json();if(!c.ok){M.error(w.message,{position:"top-center"}),v(!1);return}y((F=w==null?void 0:w.data)==null?void 0:F.workshopOrders),s((O=w==null?void 0:w.data)==null?void 0:O.count)}catch{M.error("Network error: Failed to fetch workshop orders.")}finally{v(!1)}};return i.useEffect(()=>{S()},[l,d,h,u,j,b,f,n,g,r,_,x]),{workshopOrders:k,loading:a,count:o}},ne=({filters:l})=>{const[d,h]=i.useState(1),[u,j]=i.useState(10),[b,f]=B(),[n,g]=i.useState(null),[r,_]=i.useState(null),x=b.get("page"),k=b.get("perPage"),[y,o]=i.useState(""),[s,a]=i.useState(""),[v,S]=i.useState(""),{workshopOrders:C,loading:p,count:F}=te(d,u,y,n,r,l.workshopOrderStatusFilter,l.customerFilter,l.branchFilter,l.paymentTypeFilter,l.paymentStatusFilter,l.workshopFilter,l.workshopManagerFilter),O=Y(),c=Math.ceil(F/u);i.useEffect(()=>{x&&h(Number(x)),k&&j(Number(k))},[x,k]);const w=t=>{O(`/order/${t}`,{state:{from:"WorkshopOrderTable"}})},R=async t=>{t.preventDefault();try{await Q.validate({search:s},{abortEarly:!1}),o(s),S("")}catch(N){N instanceof L&&S(N.errors[0])}},m=t=>{n===t?_(r==="ASC"?"DESC":"ASC"):(g(t),_("ASC"))},E=t=>{t>=1&&t<=c&&(h(t),f({page:t.toString(),perPage:u.toString()}))},T=t=>{const N=Number(t.target.value);j(N),h(1),f({page:"1",perPage:N.toString()})},V=t=>{switch(t){case P.Pending:return"badge badge-pending";case P["Partial received"]:return"badge badge-ready-to-deliver";case P.Received:return"badge badge-delivery-complete";default:return"badge"}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:u,onChange:T,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:R,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:s,onChange:t=>{a(t.target.value),t.target.value===""&&o("")},placeholder:"Search...",className:"w-[275px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v||"Â "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[115px]",children:e.jsxs("span",{className:`sort ${n==="order_id"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("order_id"),children:[e.jsx("span",{className:"sort-label",children:"Order Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[240px]",children:e.jsxs("span",{className:`sort ${n==="first_name"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${n==="email"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[140px]",children:e.jsxs("span",{className:`sort ${n==="mobile_number"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile No"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[280px]",children:"Shipping address"}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${n==="coupon_code"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("coupon_code"),children:[e.jsx("span",{className:"sort-label",children:"Coupon code"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${n==="coupon_discount"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("coupon_discount"),children:[e.jsx("span",{className:"sort-label",children:"Coupon discount"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[220px]",children:"Order Status"}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${n==="estimated_delivery_time"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("estimated_delivery_time"),children:[e.jsx("span",{className:"sort-label",children:"Estimated delivery time"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${n==="estimated_pickup_time"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("estimated_pickup_time"),children:[e.jsx("span",{className:"sort-label",children:"Estimated pickup time"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[140px]",children:e.jsxs("span",{className:`sort ${n==="shipping_charges"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("shipping_charges"),children:[e.jsx("span",{className:"sort-label",children:"Shipping charge"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[180px]",children:e.jsxs("span",{className:`sort ${n==="express_delivery_charges"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("express_delivery_charges"),children:[e.jsx("span",{className:"sort-label",children:"Express delivery charges"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("span",{className:`sort ${n==="gst"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("gst"),children:[e.jsx("span",{className:"sort-label",children:"GST"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${n==="kasar_amount"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("kasar_amount"),children:[e.jsx("span",{className:"sort-label",children:"Kasar amount"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${n==="sub_total"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("sub_total"),children:[e.jsx("span",{className:"sort-label",children:"Sub total"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[105px]",children:e.jsxs("span",{className:`sort ${n==="total"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("total"),children:[e.jsx("span",{className:"sort-label",children:"Total"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[165px]",children:"Payment type"}),e.jsx("th",{className:"min-w-[175px]",children:"Payment status"}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${n==="branch_id"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("branch_id"),children:[e.jsx("span",{className:"sort-label",children:"Branch"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${n==="workshop_name"?r==="ASC"?"asc":"desc":""}`,onClick:()=>m("workshop_name"),children:[e.jsx("span",{className:"sort-label",children:"Workshop name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:"Workshop Manager"}),e.jsx("th",{className:"min-w-[50px]",children:"Action"})]})}),p?e.jsx(q,{}):(C==null?void 0:C.length)>0?e.jsx("tbody",{children:C.map(t=>{const N=P[t.payment_status],D=V(t.payment_status);return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",t.order_id]}),e.jsxs("td",{children:[t.user.first_name," ",t.user.last_name]}),e.jsx("td",{children:t.user.email}),e.jsx("td",{children:t.user.mobile_number}),e.jsx("td",{children:t.address_details}),e.jsx("td",{children:t.coupon_code}),e.jsx("td",{children:t.coupon_discount}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-outline rounded-[30px]",children:t.workshop_status_name})}),e.jsx("td",{children:e.jsx("div",{className:"flex flex-col",children:W(t.estimated_delivery_time).format("DD-MM-YYYY")})}),e.jsx("td",{children:e.jsx("div",{className:"flex flex-col",children:W(t.estimated_pickup_time).format("DD-MM-YYYY")})}),e.jsx("td",{children:t.shipping_charges}),e.jsx("td",{children:t.express_delivery_charges}),e.jsx("td",{children:t.gst}),e.jsx("td",{children:t.kasar_amount}),e.jsx("td",{children:t.sub_total}),e.jsx("td",{children:t.total}),e.jsx("td",{children:H[t.payment_type]}),e.jsx("td",{children:e.jsx("span",{className:`${D} badge-outline rounded-[30px]`,children:N})}),e.jsx("td",{children:t.branch.branch_name}),e.jsx("td",{children:t.workshop.workshop_name}),e.jsx("td",{children:t.workshop.workshopManagerMappings.map(A=>`${A.user.first_name} ${A.user.last_name}`).join(", ")}),e.jsx("td",{children:e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-[11px] rounded-full",onClick:()=>w(t.order_id),children:e.jsx(G,{size:18,className:"text-gray-600"})})})]},t.order_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No Orders available"})})})]})}),F>u&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",C.length," of ",F," Workshop order"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:d===1,onClick:()=>E(d-1),className:`btn ${d===1?"disabled":""}`,children:e.jsx(z,{})}),Array.from({length:c}).map((t,N)=>e.jsx("button",{className:`btn ${d===N+1?"active":""}`,onClick:()=>E(N+1),children:N+1},N)),e.jsx("button",{disabled:d===c,onClick:()=>E(d+1),className:`btn ${d===c?"disabled":""}`,children:e.jsx(I,{})})]})]})})]})})]})},le=({filters:l,updateFilters:d})=>{const[h,u]=i.useState(""),[j,b]=i.useState([]),{fetchUsersByRole:f,users:n}=Z(),{branches:g,fetchBranches:r}=ee(),{fetchWorkshops:_,workshops:x}=se(1,1e3),k=Object.entries(P).filter(([s,a])=>typeof a=="number").map(([s,a])=>({label:s,value:a})),y=Object.entries(J).filter(([s,a])=>typeof a=="number").map(([s,a])=>({label:s,value:a}));i.useEffect(()=>{(async()=>{r(),f(6),_()})()},[]),i.useEffect(()=>{h&&(async()=>{const a=await f(5,h),v=a==null?void 0:a.map(S=>({label:`${S.first_name} ${S.last_name} (${S.mobile_number})`,value:S.user_id}));b(v)})()},[h]);const o=(s,a)=>{d({...l,[s]:a})};return e.jsxs("div",{className:"card-header flex-wrap gap-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(X,{name:"customer-select",options:j,value:j==null?void 0:j.filter(s=>{var a;return(a=l.customerFilter)==null?void 0:a.includes(s.value)}),onChange:s=>o("customerFilter",s.map(a=>a.value)),onInputChange:s=>u(s),isMulti:!0,placeholder:"Search and select customers",className:"custom-select-container",classNamePrefix:"custom-select"}),e.jsx($,{options:g==null?void 0:g.map(s=>({branch_id:s.branch_id,branch_name:s.branch_name})),displayValue:"branch_name",selectedValues:g==null?void 0:g.filter(s=>{var a;return(a=l.branchFilter)==null?void 0:a.includes(s.branch_id)}),placeholder:"Branch",onSelect:s=>{o("branchFilter",s.map(a=>a.branch_id))},onRemove:s=>{o("branchFilter",s.map(a=>a.branch_id))},className:"multiselect-container multiselect min-w-[430px] max-w-[480px]"}),e.jsx($,{options:y,displayValue:"label",selectedValues:y==null?void 0:y.filter(s=>{var a;return(a=l.workshopOrderStatusFilter)==null?void 0:a.includes(s.value)}),placeholder:"Order status",onSelect:s=>{o("workshopOrderStatusFilter",s.map(a=>a.value))},onRemove:s=>{o("workshopOrderStatusFilter",s.map(a=>a.value))},className:"multiselect-container multiselect min-w-[430px] max-w-[480px]"}),e.jsx($,{options:k,displayValue:"label",selectedValues:k.filter(s=>{var a;return(a=l.paymentStatusFilter)==null?void 0:a.includes(s.value)}),placeholder:"Payment status",onSelect:s=>{o("paymentStatusFilter",s.map(a=>a.value))},onRemove:s=>{o("paymentStatusFilter",s.map(a=>a.value))},className:"multiselect-container multiselect min-w-[430px] max-w-[480px]"}),e.jsx($,{options:x==null?void 0:x.map(s=>({workshop_id:s.workshop_id,workshop_name:s.workshop_name})),displayValue:"workshop_name",selectedValues:x==null?void 0:x.filter(s=>{var a;return(a=l.workshopFilter)==null?void 0:a.includes(s.workshop_id)}),placeholder:"Workshop",onSelect:s=>{o("workshopFilter",s.map(a=>a.workshop_id))},onRemove:s=>{o("workshopFilter",s.map(a=>a.workshop_id))},className:"multiselect-container multiselect min-w-[430px] max-w-[480px]"}),e.jsx($,{options:n==null?void 0:n.map(s=>({workshop_manager_id:s.user_id,user_name:`${s.first_name} ${s.last_name} (${s.mobile_number})`})),displayValue:"user_name",selectedValues:n==null?void 0:n.filter(s=>{var a;return(a=l.workshopManagerFilter)==null?void 0:a.includes(s.user_id)}).map(s=>({workshop_manager_id:s.user_id,user_name:`${s.first_name} ${s.last_name} (${s.mobile_number})`})),placeholder:"Workshop manager name",onSelect:s=>{o("workshopManagerFilter",s.map(a=>a.workshop_manager_id))},onRemove:s=>{o("workshopManagerFilter",s.map(a=>a.workshop_manager_id))},className:"multiselect-container multiselect min-w-[430px] max-w-[480px]"})]}),e.jsxs("select",{className:"select select-lg w-[200px] text-sm mt-2",value:l.paymentTypeFilter,onChange:s=>{o("paymentTypeFilter",Number(s.target.value))},children:[e.jsx("option",{value:"",disabled:!0,selected:!0,children:"Payment type"}),e.jsx("option",{value:1,children:"Cash on Delivery"}),e.jsx("option",{value:2,children:"Online Payment"})]})]})},ue=()=>{const[l,d]=i.useState(!1),[h,u]=i.useState({paymentStatusFilter:[],workshopOrderStatusFilter:[],paymentTypeFilter:void 0,customerFilter:[],branchFilter:[],workshopFilter:[],workshopManagerFilter:[]}),j=b=>{u(b)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-fixed",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-7.5",children:e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Workshop Orders"})})}),e.jsx("div",{className:"flex flex-auto items-center gap-2.5 mb-4 shadow-none",children:e.jsxs("button",{className:"btn btn-sm btn-primary shadow-none",onClick:()=>d(!l),children:["Filters",l?e.jsx(U,{size:23}):e.jsx(K,{color:"skyblue",size:23})]})})]}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsxs("div",{className:"card card-grid min-w-full",children:[l&&e.jsx(le,{filters:h,updateFilters:j})," ",e.jsx(ne,{filters:h})]})})})]})};export{ue as default};
