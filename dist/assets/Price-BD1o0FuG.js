import{r as c,_ as f,u as O,j as e,aU as U,V as z}from"./index-ekHY3xQj.js";import{u as M}from"./useGetCategories-CKTTd5BG.js";import{u as V}from"./useGetProducts-Dl6YCXFw.js";import{u as q}from"./useGetServices-koYkfNZS.js";import{u as J}from"./useGetPrice-B_08xpuj.js";import{F as S,a as C,s as W}from"./searchSchema-BZfm46a9.js";const Z="http://35.154.167.170:3000/prices",H=()=>{const[d,u]=c.useState(!1);return{addPrice:async p=>{const h=localStorage.getItem("authToken");if(p.length===0)return f.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;u(!0);try{const n={prices:p},g=await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(n)});if(!g.ok){const l=(await g.json()).message;return f.error(l,{position:"top-center"}),!1}const x=await g.json();return f.success(x.message,{position:"top-center"}),!0}catch(n){return n.name==="TypeError"&&n.message.includes("Failed to fetch")?f.error("Network error: Failed to fetch.",{position:"top-center"}):f.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{u(!1)}},loading:d}},K=({search:d,isSave:u,setIsSave:y})=>{const{categories:p}=M(),{products:h}=V(),{services:n}=q(),{prices:g,loading:x,fetchPrices:j}=J(),{addPrice:l}=H(),[i,F]=c.useState({}),[N,w]=c.useState(new Set),b=c.useRef({}),[Q,P]=O(),[a,I]=c.useState(null),[o,_]=c.useState(null),k=c.useCallback((r,t,s,E)=>{const m=[];return r.forEach(D=>{t.forEach(L=>{s.forEach($=>{const G=`${D.category_id}_${L.product_id}_${$.service_id}`;m.push({category:D,product:L,service:$,price:E[G]||0})})})}),m},[p,h,n,g])(p,h,n,g),A=k.filter(r=>{const t=d.toLowerCase();return r.category.name.toLowerCase().includes(t)||r.product.name.toLowerCase().includes(t)||r.service.name.toLowerCase().includes(t)}).sort((r,t)=>["category","product","service"].includes(a)?o==="ASC"?r[a].name.localeCompare(t[a].name):t[a].name.localeCompare(r[a].name):a==="price"?o==="ASC"?r.price-t.price:t.price-r.price:0),T=r=>{w(t=>{const s=new Set(t);return s.add(r),s})},R=(r,t)=>{F(s=>({...s,[r]:t}))},v=r=>{a===r?_(o==="ASC"?"DESC":"ASC"):(I(r),_("ASC"))};c.useEffect(()=>{if(u){const r=k.map(t=>{const s=`${t.category.category_id}_${t.product.product_id}_${t.service.service_id}`;return{category_id:t.category.category_id,product_id:t.product.product_id,service_id:t.service.service_id,price:i[s]!==void 0?i[s]:t.price}}).filter(t=>t.price>0);try{l(r),j(),w(new Set)}catch{f.error("Failed to save prices.")}}y(!1)},[u,l,j,k,i]);const B=r=>{w(t=>{const s=new Set(t);return s.delete(r),s})};return c.useEffect(()=>{var t;const r=Array.from(N);if(r.length>0){const s=r[0];b.current[s]&&((t=b.current[s])==null||t.focus())}},[N]),c.useEffect(()=>{P(d?{search:d}:{})},[d]),e.jsx("div",{children:x?e.jsx(U,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-12 grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:"Id"}),e.jsxs("th",{className:"min-w-[200px]",children:[e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("category"),children:["Category",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="category"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="category"&&o==="DESC"?"gray":"lightgray"})]})]})," "]}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("product"),children:["Product",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="product"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="product"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("service"),children:["Service",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="service"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="service"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("price"),children:["Price",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="price"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="price"&&o==="DESC"?"gray":"lightgray"})]})]})})]})}),e.jsx("tbody",{children:A.length>0?A.map((r,t)=>{const s=`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`,E=N.has(s);return e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:r.category.name}),e.jsx("td",{children:r.product.name}),e.jsx("td",{children:r.service.name}),e.jsx("td",{className:"relative",children:E?e.jsx("input",{ref:m=>b.current[s]=m,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:i[s]!==void 0?i[s]:r.price||"",onChange:m=>R(s,m.target.value===""?0:Number(m.target.value)),onBlur:()=>B(s)}):e.jsx("span",{className:"cursor-pointer h-full flex",onClick:()=>T(s),children:i[s]!==void 0?i[s]:r.price||"Add Price"})})]},t)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})})},ce=()=>{const[d,u]=c.useState(!1),[y,p]=c.useState(""),[h,n]=c.useState(""),[g,x]=c.useState(""),j=async l=>{l.preventDefault();try{await W.validate({search:h},{abortEarly:!1}),p(h),x("")}catch(i){i instanceof z&&x(i.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Table"}),e.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:j,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:h,onChange:l=>{n(l.target.value),l.target.value===""&&p("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:g||"Â "})]}),e.jsx(K,{search:y,isSave:d,setIsSave:u})]})};export{ce as default};
