import{r as c,_ as f,a$ as O,u as z,j as e,b0 as U,F as S,a as C,s as M,V}from"./index-Z0PagGU8.js";import{u as q}from"./useGetProducts-6KKtHLb7.js";import{u as J}from"./useGetServices-B50l7V9D.js";import{u as W}from"./useGetPrice-B2s__JRt.js";const Z="http://35.154.167.170:3000/prices",H=()=>{const[d,u]=c.useState(!1);return{addPrice:async p=>{const h=localStorage.getItem("authToken");if(p.length===0)return f.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;u(!0);try{const n={prices:p},g=await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(n)});if(!g.ok){const l=(await g.json()).message;return f.error(l,{position:"top-center"}),!1}const m=await g.json();return f.success(m.message,{position:"top-center"}),!0}catch(n){return n.name==="TypeError"&&n.message.includes("Failed to fetch")?f.error("Network error: Failed to fetch.",{position:"top-center"}):f.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{u(!1)}},loading:d}},K=({search:d,isSave:u,setIsSave:y})=>{const{categories:p}=O(),{products:h}=q(),{services:n}=J(),{prices:g,loading:m,fetchPrices:j}=W(),{addPrice:l}=H(),[i,F]=c.useState({}),[N,w]=c.useState(new Set),b=c.useRef({}),[Q,P]=z(),[a,I]=c.useState(null),[o,_]=c.useState(null),k=c.useCallback((r,s,t,E)=>{const x=[];return r.forEach($=>{s.forEach(D=>{t.forEach(L=>{const G=`${$.category_id}_${D.product_id}_${L.service_id}`;x.push({category:$,product:D,service:L,price:E[G]||0})})})}),x},[p,h,n,g])(p,h,n,g),A=k.filter(r=>{const s=d.toLowerCase();return r.category.name.toLowerCase().includes(s)||r.product.name.toLowerCase().includes(s)||r.service.name.toLowerCase().includes(s)}).sort((r,s)=>["category","product","service"].includes(a)?o==="ASC"?r[a].name.localeCompare(s[a].name):s[a].name.localeCompare(r[a].name):a==="price"?o==="ASC"?r.price-s.price:s.price-r.price:0),T=r=>{w(s=>{const t=new Set(s);return t.add(r),t})},R=(r,s)=>{F(t=>({...t,[r]:s}))},v=r=>{a===r?_(o==="ASC"?"DESC":"ASC"):(I(r),_("ASC"))};c.useEffect(()=>{if(u){const r=k.map(s=>{const t=`${s.category.category_id}_${s.product.product_id}_${s.service.service_id}`;return{category_id:s.category.category_id,product_id:s.product.product_id,service_id:s.service.service_id,price:i[t]!==void 0?i[t]:s.price}}).filter(s=>s.price>0);try{l(r),j(),w(new Set)}catch{f.error("Failed to save prices.")}}y(!1)},[u,l,j,k,i]);const B=r=>{w(s=>{const t=new Set(s);return t.delete(r),t})};return c.useEffect(()=>{var s;const r=Array.from(N);if(r.length>0){const t=r[0];b.current[t]&&((s=b.current[t])==null||s.focus())}},[N]),c.useEffect(()=>{P(d?{search:d}:{})},[d]),e.jsx("div",{children:m?e.jsx(U,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-12 grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:"Id"}),e.jsxs("th",{className:"min-w-[200px]",children:[e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("category"),children:["Category",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="category"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="category"&&o==="DESC"?"gray":"lightgray"})]})]})," "]}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("product"),children:["Product",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="product"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="product"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("service"),children:["Service",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="service"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="service"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>v("price"),children:["Price",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(S,{color:a==="price"&&o==="ASC"?"gray":"lightgray"}),e.jsx(C,{color:a==="price"&&o==="DESC"?"gray":"lightgray"})]})]})})]})}),e.jsx("tbody",{children:A.length>0?A.map((r,s)=>{const t=`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`,E=N.has(t);return e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:r.category.name}),e.jsx("td",{children:r.product.name}),e.jsx("td",{children:r.service.name}),e.jsx("td",{className:"relative",children:E?e.jsx("input",{ref:x=>b.current[t]=x,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:i[t]!==void 0?i[t]:r.price||"",onChange:x=>R(t,x.target.value===""?0:Number(x.target.value)),onBlur:()=>B(t)}):e.jsx("span",{className:"cursor-pointer h-full flex",onClick:()=>T(t),children:i[t]!==void 0?i[t]:r.price||"Add Price"})})]},s)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})})},te=()=>{const[d,u]=c.useState(!1),[y,p]=c.useState(""),[h,n]=c.useState(""),[g,m]=c.useState(""),j=async l=>{l.preventDefault();try{await M.validate({search:h},{abortEarly:!1}),p(h),m("")}catch(i){i instanceof V&&m(i.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Table"}),e.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:j,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:h,onChange:l=>{n(l.target.value),l.target.value===""&&p("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:g||"Â "})]}),e.jsx(K,{search:y,isSave:d,setIsSave:u})]})};export{te as default};
