import{r as o,_ as y,aY as L,u as O,j as e,F as R,b as I,d as z,e as q,c as G,a as A,aW as V,V as F}from"./index-DctR2NZY.js";import{T as H}from"./TableShimmer-CrZhrCbk.js";import{u as K}from"./useGetWorkshops-8pFjQX60.js";import{S as D}from"./sweetalert2.esm.all-DwEdJQJv.js";import{u as Y}from"./useGetUsersByRole-AlfnQwDy.js";import{M as J}from"./index-CcdChZxb.js";import{s as Z}from"./searchSchema-jWF4PMLO.js";const Q=()=>{const[r,n]=o.useState(!1),[j,l]=o.useState(null);return{workshop:j,loading:r,fetchWorkshop:async s=>{var k;if(!s){l(null);return}const d=localStorage.getItem("authToken"),i=`http://35.154.167.170:3000/workshops/${s}`;n(!0);try{const x=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}}),f=await x.json();if(!x.ok){y.error(f.message,{position:"top-center"}),n(!1);return}l((k=f==null?void 0:f.data)==null?void 0:k.result)}catch{y.error("Network error: Failed to fetch workshops.")}finally{n(!1)}}}},X="http://35.154.167.170:3000/workshops",ee=()=>{const[r,n]=o.useState(!1);return{addWorkshop:async l=>{const g=localStorage.getItem("authToken");n(!0);try{const s=await fetch(X,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),d=await s.json();return s.ok?(y.success(d.message,{position:"top-center"}),!0):(y.error(d.message,{position:"top-center"}),!1)}catch{return y.error("Error adding workshop",{position:"top-center"}),!1}finally{n(!1)}},loading:r}},se=()=>{const[r,n]=o.useState(!1);return{deleteWorkshop:async l=>{n(!0);const g=`http://35.154.167.170:3000/workshops/${l}`,s=localStorage.getItem("authToken");try{const d=await fetch(g,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}}),i=await d.json();return d.ok?{success:!0,message:i.message}:(y.error(i.message,{position:"top-center"}),{success:!1,message:i.message})}catch(d){return{success:!1,message:d.message}}finally{n(!1)}},loading:r}},ae=()=>{const[r,n]=o.useState(!1);return{updateWorkshop:async(l,g)=>{const s=localStorage.getItem("authToken"),d=`http://35.154.167.170:3000/workshops/${l}`;n(!0);try{const i=await fetch(d,{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(g)}),k=await i.json();return i.ok?(y.success(k.message,{position:"top-center"}),!0):(y.error(k.message,{position:"top-center"}),!1)}catch(i){return y.error(i.message||"Error Updating workshop",{position:"top-center"}),!1}finally{n(!1)}},loading:r}};function E(r){return L({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M169.4 502.6c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 402.7 224 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 370.7L86.6 329.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128z"},child:[]}]})(r)}function P(r){return L({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M214.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 109.3V480c0 17.7 14.3 32 32 32s32-14.3 32-32V109.3l73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128z"},child:[]}]})(r)}const te=({search:r,isSubmit:n,setIsSubmit:j,setUpdateWorkshop:l})=>{const{deleteWorkshop:g}=se(),[s,d]=o.useState(1),[i,k]=o.useState(10),[x,f]=O(),[m,w]=o.useState(null),[u,c]=o.useState(null),h=x.get("page"),N=x.get("perPage"),{workshops:_,totalWorkshops:C,loading:T,fetchWorkshops:S}=K(s,i,r,m,u),v=Math.ceil(C/i);o.useEffect(()=>{(async()=>{n&&(S(),j(!1))})()},[n]);const $=async a=>{try{const{isConfirmed:b}=await D.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(b){const{success:U,message:M}=await g(a);U?(_.filter(B=>B.workshop_id!==a).length===0&&s>1&&(d(s-1),f({page:(s-1).toString(),perPage:i.toString()})),await S(),D.fire(M)):D.fire(M)}}catch(b){D.fire({title:"Error",text:b.message,icon:"error"})}};o.useEffect(()=>{h&&d(Number(h)),N&&k(Number(N))},[h,N]),o.useEffect(()=>{r&&(d(1),f({search:r,page:"1",perPage:i.toString()}))},[r]);const t=a=>{m===a?c(u==="ASC"?"DESC":"ASC"):(w(a),c("ASC"))},p=a=>{a>=1&&a<=v&&(d(a),f({page:a.toString(),perPage:i.toString()}))},W=a=>{const b=Number(a.target.value);k(b),d(1),f({page:"1",perPage:b.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:i,onChange:W,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-5.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[90px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>t("workshop_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(E,{color:m==="workshop_id"&&u==="ASC"?"gray":"lightgray"}),e.jsx(P,{color:m==="workshop_id"&&u==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>t("workshop_name"),children:["Workshop name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(E,{color:m==="workshop_name"&&u==="ASC"?"gray":"lightgray"}),e.jsx(P,{color:m==="workshop_name"&&u==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[230px]",children:"Workshop manager"}),e.jsx("th",{className:"min-w-[230px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>t("address"),children:["Address",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(E,{color:m==="address"&&u==="ASC"?"gray":"lightgray"}),e.jsx(P,{color:m==="address"&&u==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>t("email"),children:["Email",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(E,{color:m==="email"&&u==="ASC"?"gray":"lightgray"}),e.jsx(P,{color:m==="email"&&u==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[155px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>t("mobile_number"),children:["Mobile no",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(E,{color:m==="mobile_number"&&u==="ASC"?"gray":"lightgray"}),e.jsx(P,{color:m==="mobile_number"&&u==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[125px]",children:"Actions"})]})}),T?e.jsx(H,{}):_?e.jsx("tbody",{children:_.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.workshop_id}),e.jsx("td",{children:a.workshop_name}),e.jsx("td",{children:a.workshop_managers.map(b=>b.full_name).join(", ")}),e.jsx("td",{children:a.address}),e.jsx("td",{children:a.email}),e.jsx("td",{children:a.mobile_number}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>l(a.workshop_id),children:e.jsx(R,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>$(a.workshop_id),children:e.jsx(I,{className:"text-red-500"})})]})]},a.workshop_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No workshops available"})})})]})})})})}),C>i&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",_.length," of ",C," Branches"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:s===1,onClick:()=>p(s-1),className:`btn ${s===1?"disabled":""}`,children:e.jsx(z,{})}),Array.from({length:v}).map((a,b)=>e.jsx("button",{className:`btn ${s===b+1?"active":""}`,onClick:()=>p(b+1),children:b+1},b)),e.jsx("button",{disabled:s===v,onClick:()=>p(s+1),className:`btn ${s===v?"disabled":""}`,children:e.jsx(q,{})})]})]})]})},re=G().shape({workshop_name:A().required("Workshop name is required"),address:A().required("Workshop address is required"),email:A().email("Enter a valid email"),mobile_number:A().matches(/^\d{10}$/,"Mobile number must be 10 digits").required("Mobile number is required"),workshop_managers_ids:V().min(1,"Please select at least workshop manager").required("Please select workshop manager")}),oe=({isOpen:r,onClose:n,setIsSubmit:j,workshop_id:l})=>{const g={workshop_name:"",email:"",address:"",mobile_number:"",workshop_managers_ids:[]},{users:s,fetchUsersByRole:d,loading:i}=Y(),{addWorkshop:k,loading:x}=ee(),{updateWorkshop:f,loading:m}=ae(),{workshop:w,fetchWorkshop:u}=Q(),[c,h]=o.useState(g),[N,_]=o.useState(g),[C,T]=o.useState([]),[S,v]=o.useState({});o.useEffect(()=>{if(s){const t=s.map(p=>({workshop_manager_id:p.user_id,workshop_manager_name:`${p.first_name} ${p.last_name}`}));T(t)}},[s]),o.useEffect(()=>{r&&(async()=>d(6))(),r&&l&&u(l)},[r,l]),o.useEffect(()=>{if(r&&w&&l){const t={workshop_name:w.workshop_name,address:w.address,email:w.email,mobile_number:w.mobile_number,workshop_managers_ids:w.workshopManagerMappings.map(p=>p.user_id)};h(t),_(t)}else h(g),_(g),v({})},[r,w,l]);const $=async t=>{t.preventDefault();try{if(await re.validate(c,{abortEarly:!1}),!Object.keys(c).some(a=>c[a]!==N[a])){n();return}const W={...c,user_ids:c.workshop_managers_ids};l?await f(l,W):await k(W),j(!0),n()}catch(p){if(p instanceof F){const W={};p.inner.forEach(a=>{W[a.path||""]=a.message}),v(W)}else y.error("Failed to submit the form. Please try again.")}};return r?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:n}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[480px] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:n,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:l?"Update Workshop":"Add Workshop"}),e.jsx("form",{onSubmit:$,children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"workshop_name",className:"mb-1 block text-gray-700 font-semibold",children:"Workshop name"}),e.jsx("input",{type:"text",id:"workshop_name",name:"workshop_name",value:c.workshop_name||"",onChange:t=>h({...c,workshop_name:t.target.value}),className:"input border border-gray-300 rounded-md p-2 w-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:S.workshop_name||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"address",className:"mb-1 block text-gray-700 font-semibold",children:"Address"}),e.jsx("textarea",{id:"address",name:"address",value:c.address,onChange:t=>h({...c,address:t.target.value}),className:"input border border-gray-300 rounded-md p-2 w-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:S.address||" "})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobile_number",className:"mb-1 block text-gray-700 font-semibold",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",value:c.mobile_number,onChange:t=>h({...c,mobile_number:t.target.value}),className:"input border border-gray-300 rounded-md p-2 w-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:S.mobile_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"mb-1 block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",value:c.email||"",onChange:t=>h({...c,email:t.target.value}),className:"input border border-gray-300 rounded-md p-2 w-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:S.email||" "})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"mb-1 block text-gray-700 font-semibold",children:"Workshop manager"}),e.jsx(J,{options:C,displayValue:"workshop_manager_name",selectedValues:c.workshop_managers_ids?C.filter(t=>c.workshop_managers_ids.includes(t.workshop_manager_id)):[],isObject:!0,onSelect:t=>{h({...c,workshop_managers_ids:t.map(p=>p.workshop_manager_id)})},onRemove:t=>{h({...c,workshop_managers_ids:t.map(p=>p.workshop_manager_id)})}}),e.jsx("p",{className:"text-red-500 text-sm",children:S.workshop_managers_ids||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${x||m?"opacity-50 cursor-not-allowed":""}`,disabled:x||m,children:x||m?x?"Adding...":"Updating...":l?"Update Workshop":"Add Workshop"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:n,disabled:x||m,children:"Cancel"})]})]})})]})]}):null},ue=()=>{const[r,n]=o.useState(""),[j,l]=o.useState(""),[g,s]=o.useState(!1),[d,i]=o.useState(null),[k,x]=o.useState(!1),[f,m]=o.useState(""),w=async h=>{h.preventDefault();try{await Z.validate({search:j},{abortEarly:!1}),n(j),m("")}catch(N){N instanceof F&&m(N.errors[0])}},u=()=>{s(!0),i(null)},c=h=>{i(h),s(!0)};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Workshops"}),e.jsxs("button",{className:"btn btn-primary",onClick:u,children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Workshop"]})]}),e.jsx("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:e.jsxs("form",{onSubmit:w,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:j,onChange:h=>{l(h.target.value),h.target.value===""&&n("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-primary focus:bg-white border-primary",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:f||" "})]})}),e.jsx(te,{search:r,isSubmit:k,setIsSubmit:x,setUpdateWorkshop:c}),e.jsx(oe,{isOpen:g,onClose:()=>s(!1),setIsSubmit:x,workshop_id:d})]})};export{ue as default};
