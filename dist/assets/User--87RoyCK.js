import{r as o,_ as k,u as M,k as P,j as e,F as z,b as q,d as V,e as Y,V as W}from"./index-jKd1kMjl.js";import{F as y,a as S,s as Z}from"./searchSchema-Bkc3hwST.js";import{u as H}from"./useGetCompanies-D00oPAzt.js";import{u as J}from"./useGetBranches-BfEw-sLa.js";import{T as K}from"./TableShimmer-BIB_f2x6.js";import{G as O,R as Q}from"./enums-tzNm48ue.js";import{S as _}from"./sweetalert2.esm.all-DwEdJQJv.js";const X="http://35.154.167.170:3000/user",ee=(d=1,a=10,c="",l,h)=>{const[x,i]=o.useState([]),[t,N]=o.useState(0),[r,g]=o.useState(!1),f=async()=>{var w,j;const v=localStorage.getItem("authToken"),u=new URLSearchParams;d&&u.append("page_number",d.toString()),a&&u.append("per_page",a.toString()),c&&u.append("search",c),l&&u.append("sortBy",l),h&&u.append("order",h),g(!0);try{const p=await fetch(`${X}?${u}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`}}),m=await p.json();if(!p.ok){k.error(m.message,{position:"top-center"});return}i(((w=m==null?void 0:m.data)==null?void 0:w.users)||[]),N(((j=m==null?void 0:m.data)==null?void 0:j.count)||0)}catch(p){k.error((p==null?void 0:p.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{g(!1)}};return o.useEffect(()=>{f()},[d,a,c,l,h]),{users:x,totalUsers:t,loading:r,fetchUsers:f}},se=()=>{const[d,a]=o.useState(!1);return{deleteUser:async l=>{a(!0);const h=`http://35.154.167.170:3000/user/${l}`,x=localStorage.getItem("authToken");try{const i=await fetch(h,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`}}),t=await i.json();return i.ok?{success:!0,message:t.message}:(k.error(t.message,{position:"top-center"}),{success:!1,message:t.message})}catch(i){return{success:!1,message:i.message}}finally{a(!1)}},loading:d}},te=({search:d})=>{const[a,c]=o.useState(1),[l,h]=o.useState(10),[x,i]=M(),[t,N]=o.useState(null),[r,g]=o.useState(null),f=x.get("page"),v=x.get("perPage"),u=1e3,w=1,{users:j,fetchUsers:p,totalUsers:m,loading:A}=ee(a,l,d,t,r),{deleteUser:T}=se(),{companies:L}=H(w,u),{branches:D}=J(w,u),F=P(),C=Math.ceil(m/l),B=s=>{F(`/user/edit/${s}`)};o.useEffect(()=>{f&&c(Number(f)),v&&h(Number(v))},[f,v]),o.useEffect(()=>{d&&(c(1),i({search:d,page:"1",perPage:l.toString()}))},[d]);const $=async s=>{try{const{isConfirmed:n}=await _.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(n){const{success:G,message:E}=await T(s);G?(j.filter(I=>I.user_id!==s).length===0&&a>1&&(c(a-1),i({page:(a-1).toString(),perPage:l.toString()})),await p(),_.fire(E)):_.fire(E)}}catch(n){_.fire({title:"Error",text:n.message,icon:"error"})}},b=s=>{t===s?g(r==="ASC"?"DESC":"ASC"):(N(s),g("ASC"))},U=s=>{s>=1&&s<=C&&(c(s),i({page:s.toString(),perPage:l.toString()}))},R=s=>{const n=Number(s.target.value);h(n),c(1),i({page:"1",perPage:n.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:l,onChange:R,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>b("user_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(y,{color:t==="user_id"&&r==="ASC"?"gray":"lightgray"}),e.jsx(S,{color:t==="user_id"&&r==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>b("first_name"),children:["User name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(y,{color:t==="first_name"&&r==="ASC"?"gray":"lightgray"}),e.jsx(S,{color:t==="first_name"&&r==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>b("email"),children:["Email",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(y,{color:t==="email"&&r==="ASC"?"gray":"lightgray"}),e.jsx(S,{color:t==="email"&&r==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>b("mobile_number"),children:["Mobile no",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(y,{color:t==="mobile_number"&&r==="ASC"?"gray":"lightgray"}),e.jsx(S,{color:t==="mobile_number"&&r==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>b("gender"),children:["Gender",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(y,{color:t==="gender"&&r==="ASC"?"gray":"lightgray"}),e.jsx(S,{color:t==="gender"&&r==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[170px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>b("role_id"),children:["Role",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(y,{color:t==="role_id"&&r==="ASC"?"gray":"lightgray"}),e.jsx(S,{color:t==="role_id"&&r==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[250px]",children:"Companies"}),e.jsx("th",{className:"min-w-[250px]",children:"Branches"}),e.jsx("th",{className:"min-w-[125px]",children:"Actions"})]})}),A?e.jsx(K,{}):j.length>0?e.jsx("tbody",{children:j.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.user_id}),e.jsxs("td",{children:[s.first_name," ",s.last_name]}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.mobile_number}),e.jsx("td",{children:O[s.gender]}),e.jsx("td",{children:Q[s.role_id]}),e.jsx("td",{children:L.filter(n=>s.company_ids.includes(n.company_id)).map(n=>n.company_name).join(", ")}),e.jsx("td",{children:D.filter(n=>s.branch_ids.includes(n.branch_id)).map(n=>n.branch_name).join(", ")}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>B(s.user_id),children:e.jsx(z,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>$(s.user_id),children:e.jsx(q,{className:"text-red-500"})})]})]},s.user_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No users available"})})})]})})})})}),m>l&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",j.length," of ",m," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:a===1,onClick:()=>U(a-1),className:`btn ${a===1?"disabled":""}`,children:e.jsx(V,{})}),Array.from({length:C}).map((s,n)=>e.jsx("button",{className:`btn ${a===n+1?"active":""}`,onClick:()=>U(n+1),children:n+1},n)),e.jsx("button",{disabled:a===C,onClick:()=>U(a+1),className:`btn ${a===C?"disabled":""}`,children:e.jsx(Y,{})})]})]})]})},me=()=>{const d=P(),[a,c]=o.useState(""),[l,h]=o.useState(""),[x,i]=o.useState(""),t=()=>{d("/user/add")},N=async r=>{r.preventDefault();try{await Z.validate({search:l},{abortEarly:!1}),c(l),i("")}catch(g){g instanceof W&&i(g.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Users"}),e.jsxs("button",{onClick:t,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add User"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:N,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:l,onChange:r=>{h(r.target.value),r.target.value===""&&c("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:x||"Â "})]}),e.jsx(te,{search:a})]})};export{me as default};
