import{r as c,_ as f,t as U,u as M,j as e,v as V,F as C,a as N,s as q,V as J}from"./index-CrW1VcAo.js";import{u as W}from"./useGetProducts-doxM0NCL.js";import{u as Z}from"./useGetServices-CMNTJkcQ.js";import{u as H}from"./useGetPrice-D2Oxa2qm.js";const K="http://35.154.167.170:3000/prices",Q=()=>{const[n,l]=c.useState(!1);return{addPrice:async h=>{const d=localStorage.getItem("authToken");if(h.length===0)return f.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;l(!0);try{const i={prices:h},u=await fetch(K,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(i)});if(!u.ok){const p=(await u.json()).message;return f.error(p,{position:"top-center"}),!1}const g=await u.json();return f.success(g.message,{position:"top-center"}),!0}catch(i){return i.name==="TypeError"&&i.message.includes("Failed to fetch")?f.error("Network error: Failed to fetch.",{position:"top-center"}):f.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{l(!1)}},loading:n}},X=({search:n,isSave:l,setIsSave:y})=>{const{categories:h,fetchCategories:d}=U(),{products:i,fetchProducts:u}=W(),{services:g,fetchServices:j}=Z(),{prices:p,loading:v,fetchPrices:F}=H(),{addPrice:I}=Q(),[m,T]=c.useState({}),[w,_]=c.useState(new Set),b=c.useRef({}),[Y,A]=M(),[a,R]=c.useState(null),[o,k]=c.useState(null);c.useEffect(()=>{d(),u(),j()},[d,u,j]);const E=c.useCallback((s,r,t,P)=>{const x=[];return s.forEach($=>{r.forEach(D=>{t.forEach(L=>{const z=`${$.category_id}_${D.product_id}_${L.service_id}`;x.push({category:$,product:D,service:L,price:P[z]||0})})})}),x},[h,i,g,p])(h,i,g,p).filter(s=>{const r=n.toLowerCase();return s.category.name.toLowerCase().includes(r)||s.product.name.toLowerCase().includes(r)||s.service.name.toLowerCase().includes(r)}).sort((s,r)=>["category","product","service"].includes(a)?o==="ASC"?s[a].name.localeCompare(r[a].name):r[a].name.localeCompare(s[a].name):a==="price"?o==="ASC"?s.price-r.price:r.price-s.price:0),B=s=>{_(r=>{const t=new Set(r);return t.add(s),t})},G=(s,r)=>{T(t=>({...t,[s]:r}))},S=s=>{a===s?k(o==="ASC"?"DESC":"ASC"):(R(s),k("ASC"))};c.useEffect(()=>{if(l){const s=E.filter(r=>{const t=`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`;return m[t]!==void 0||r.price>0}).map(r=>({category_id:r.category.category_id,product_id:r.product.product_id,service_id:r.service.service_id,price:m[`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`]||r.price}));try{I(s),F(),_(new Set)}catch{f.error("Failed to save prices.")}}y(!1)},[l]);const O=s=>{_(r=>{const t=new Set(r);return t.delete(s),t})};return c.useEffect(()=>{var r;const s=Array.from(w);if(s.length>0){const t=s[0];b.current[t]&&((r=b.current[t])==null||r.focus())}},[w]),c.useEffect(()=>{A(n?{search:n}:{})},[n]),e.jsx("div",{children:v?e.jsx(V,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-12 grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:"Id"}),e.jsxs("th",{className:"min-w-[200px]",children:[e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>S("category"),children:["Category",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:a==="category"&&o==="ASC"?"gray":"lightgray"}),e.jsx(N,{color:a==="category"&&o==="DESC"?"gray":"lightgray"})]})]})," "]}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>S("product"),children:["Product",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:a==="product"&&o==="ASC"?"gray":"lightgray"}),e.jsx(N,{color:a==="product"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>S("service"),children:["Service",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:a==="service"&&o==="ASC"?"gray":"lightgray"}),e.jsx(N,{color:a==="service"&&o==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>S("price"),children:["Price",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:a==="price"&&o==="ASC"?"gray":"lightgray"}),e.jsx(N,{color:a==="price"&&o==="DESC"?"gray":"lightgray"})]})]})})]})}),e.jsx("tbody",{children:E.length>0?E.map((s,r)=>{const t=`${s.category.category_id}_${s.product.product_id}_${s.service.service_id}`,P=w.has(t);return e.jsxs("tr",{children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:s.category.name}),e.jsx("td",{children:s.product.name}),e.jsx("td",{children:s.service.name}),e.jsx("td",{className:"relative",children:P?e.jsx("input",{ref:x=>b.current[t]=x,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:m[t]!==void 0?m[t]:s.price||"",onChange:x=>G(t,x.target.value===""?0:Number(x.target.value)),onBlur:()=>O(t)}):e.jsx("span",{className:"cursor-pointer h-full flex",onClick:()=>B(t),children:m[t]!==void 0?m[t]:s.price||"Add Price"})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})})},oe=()=>{const[n,l]=c.useState(!1),[y,h]=c.useState(""),[d,i]=c.useState(""),[u,g]=c.useState(""),j=async p=>{p.preventDefault();try{await q.validate({search:d},{abortEarly:!1}),h(d),g("")}catch(v){v instanceof J&&g(v.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Table"}),e.jsxs("button",{onClick:()=>l(!0),className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:j,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:d,onChange:p=>i(p.target.value),className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:u||"Â "})]}),e.jsx(X,{search:y,isSave:n,setIsSave:l})]})};export{oe as default};
