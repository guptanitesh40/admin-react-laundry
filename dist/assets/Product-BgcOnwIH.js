import{r,V as p,j as e,b as $,u as V,e as I,T as H,F as J,f as Y,P as q,s as K}from"./index-6UbIozLO.js";import{p as Q}from"./productSchema--UfnfTmu.js";import{M as W}from"./ModelLoadingTag-CLJWyZK3.js";import{u as X}from"./useGetProducts-YACdKGhY.js";import{S as _}from"./sweetalert2.esm.all-B0Dix5B2.js";const Z=()=>{const[l,t]=r.useState(!1),[c,d]=r.useState(null);return{product:c,loading:l,fetchProduct:async a=>{var o;if(!a){d(null);return}const m=localStorage.getItem("authToken"),n=`http://35.154.167.170:3000/admin/products/${a}`;t(!0);try{const g=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}});if(!g.ok){const i=await g.json();p.error(i.message,{position:"top-center"}),t(!1);return}const j=await g.json();d((o=j==null?void 0:j.data)==null?void 0:o.product)}catch{p.error("Network error: Failed to fetch.")}finally{t(!1)}}}},ee="http://35.154.167.170:3000/admin/products",ae=()=>{const[l,t]=r.useState(!1);return{addProduct:async d=>{const u=localStorage.getItem("authToken");t(!0);try{const a=await fetch(ee,{method:"POST",headers:{Authorization:u?`Bearer ${u}`:""},body:d});if(!a.ok){const o=(await a.json()).message;return p.error(o,{position:"top-center"}),!1}const m=await a.json();return p.success(m.message,{position:"top-center"}),!0}catch(a){return a.name==="TypeError"&&a.message.includes("Failed to fetch")?p.error("Network error: Failed to fetch.",{position:"top-center"}):p.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{t(!1)}},loading:l}},te=()=>{const[l,t]=r.useState(!1);return{deleteProduct:async d=>{t(!0);const u=`http://35.154.167.170:3000/admin/products/${d}`;try{const a=localStorage.getItem("authToken"),m=await fetch(u,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),n=await m.json();return a?m.ok?{success:!0,message:n.message}:(p.error(n.message,{position:"top-center"}),{success:!1,message:n.message}):(p.error(n.message,{position:"top-center"}),t(!1),{success:!1,message:n.message})}catch(a){return p.error(a.message,{position:"top-center"}),{success:!1,message:a.message}}finally{t(!1)}},loading:l}},se=()=>{const[l,t]=r.useState(!1);return{updateProduct:async(d,u)=>{t(!0);const a=`http://35.154.167.170:3000/admin/products/${d}`;try{const m=localStorage.getItem("authToken");if(!m)return p.error("No authentication token found",{position:"top-center"}),t(!1),!1;const n=await fetch(a,{method:"PUT",headers:{Authorization:`Bearer ${m}`},body:u});if(n.ok){const o=await n.json();return p.success(o.message,{position:"top-center"}),!0}else{const g=(await n.json()).message;return p.error(g,{position:"top-center"}),!1}}catch(m){return p.error(m.message,{position:"top-center"}),!1}finally{t(!1)}},loading:l}},re=({isOpen:l,onClose:t,product_id:c,setIsSubmit:d})=>{const{addProduct:u,loading:a}=ae(),{updateProduct:m,loading:n}=se(),{product:o,fetchProduct:g,loading:j}=Z(),[i,S]=r.useState({name:"",name_gujarati:"",name_hindi:"",image:""}),[w,C]=r.useState({name:"",name_gujarati:"",name_hindi:"",image:""}),[f,k]=r.useState({});r.useEffect(()=>{l&&c&&g(c)},[l,c]),r.useEffect(()=>{if(l&&o&&c){const v={name:o.name,name_gujarati:o.name_gujarati,name_hindi:o.name_hindi,image:o.image};S(v),C(v)}else S({name:"",name_gujarati:"",name_hindi:"",image:""}),C({name:"",name_gujarati:"",name_hindi:"",image:""}),k({})},[l,o,c]);const y=v=>{const{name:b,value:x,files:h}=v.target;b==="image"&&h&&h.length>0?S(N=>({...N,image:h[0]})):S(N=>({...N,[b]:x}))},D=async v=>{v.preventDefault();try{if(await Q(!!c).validate(i,{abortEarly:!1}),!Object.keys(i).some(N=>N==="image"?i.image instanceof File||i.image!==w.image:i[N]!==w[N])){t();return}const h=new FormData;h.append("name",i.name),h.append("name_gujarati",i.name_gujarati),h.append("name_hindi",i.name_hindi),i.image instanceof File&&h.append("image",i.image),c?await m(c,h):await u(h),d(!0),t()}catch(b){if(b instanceof $){const x={};b.inner.forEach(h=>{x[h.path||""]=h.message}),k(x)}else p.error("Failed to submit the form. Please try again.")}};return l?e.jsxs("div",{className:"fixed inset-0 grid place-items-center overflow-auto z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:t}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-[25rem] z-10 relative",children:[c&&j&&l&&e.jsx(W,{}),e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:t,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:c?"Edit Product":"Add Product"}),e.jsx("form",{onSubmit:D,children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"English Name"}),e.jsx("input",{type:"text",id:"name",name:"name",autoComplete:"off",value:i.name,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),f.name&&e.jsx("p",{className:"text-red-500 text-sm",children:f.name||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name_gujarati",children:"Gujarati Name"}),e.jsx("input",{type:"text",id:"name_gujarati",name:"name_gujarati",autoComplete:"off",value:i.name_gujarati,onChange:y,className:"input border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name_hindi",children:"Hindi Name"}),e.jsx("input",{type:"text",id:"name_hindi",name:"name_hindi",autoComplete:"off",value:i.name_hindi,onChange:y,className:"input border border-gray-300 rounded-md p-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"font-semibold",htmlFor:"image",children:"Image"}),e.jsx("span",{className:"text-sm text-gray-500",children:"(JPG, JPEG, PNG | 85×85 px)"})]}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:y,className:"input border border-gray-300 rounded-md p-2"}),f.image&&e.jsx("p",{className:"text-red-500 text-sm",children:f.image||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${a||n?"opacity-50 cursor-not-allowed":""}`,disabled:a||n,children:a||n?a?"Adding...":"Updating...":c?"Update Product":"Add Product"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:t,disabled:a||n,children:"Cancel"})]})]})})]})]}):null},ne=({setEditProduct:l,isSubmit:t,setIsSubmit:c})=>{const[d,u]=r.useState(1),[a,m]=r.useState(10),[n,o]=V(),[g,j]=r.useState(null),[i,S]=r.useState(null),w=n.get("page"),C=n.get("perPage"),[f,k]=r.useState(""),[y,D]=r.useState(""),[v,b]=r.useState(""),{products:x,count:h,loading:N,fetchProducts:T}=X(d,a,f,g,i),{hasPermission:E}=I(),L=Math.ceil(h/a);r.useEffect(()=>{t&&(T(),c(!1))},[t,T]);const{deleteProduct:U}=te(),z=async s=>{try{const{isConfirmed:P}=await _.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(P){const{success:R,message:F}=await U(s);R?(x.filter(O=>O.product_id!==s).length===0&&d>1&&(u(d-1),o({page:(d-1).toString(),perPage:a.toString()})),await T(),_.fire(F)):_.fire(F)}}catch(P){_.fire({title:"Error",text:P.message,icon:"error"})}};r.useEffect(()=>{w&&u(Number(w)),C&&m(Number(C))},[w,C]),r.useEffect(()=>{f&&(u(1),o({search:f,page:"1",perPage:a.toString()}))},[f]);const B=async s=>{s.preventDefault();try{await K.validate({search:f},{abortEarly:!1}),k(y),b("")}catch(P){P instanceof $&&b(P.errors[0])}},A=s=>{g===s?S(i==="ASC"?"DESC":"ASC"):(j(s),S("ASC"))},G=s=>{s>=1&&s<=L&&(u(s),o({page:s.toString(),perPage:a.toString()}))},M=s=>{const P=Number(s.target.value);m(P),u(1),o({page:"1",perPage:P.toString()})};return N?e.jsx(H,{isFilters:!0,columns:4,records:10,isPagination:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:a,onChange:M,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:B,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:y,onChange:s=>{D(s.target.value),s.target.value===""&&k("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v||" "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[30px]",children:e.jsxs("span",{className:`sort ${g==="product_id"?i==="ASC"?"asc":"desc":""}`,onClick:()=>A("product_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[230px]",children:e.jsxs("span",{className:`sort ${g==="name"?i==="ASC"?"asc":"desc":""}`,onClick:()=>A("name"),children:[e.jsx("span",{className:"sort-label",children:"English name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[230px]",children:e.jsx("span",{className:"sort-label",children:"Gujarati name"})}),e.jsx("th",{className:"min-w-[230px]",children:e.jsx("span",{className:"sort-label",children:"Hindi name"})}),e.jsx("th",{className:"min-w-[125px]",children:e.jsxs("div",{className:"flex justify-between",children:["Image",e.jsx("div",{className:"flex "})]})}),(E(6,"update")||E(6,"delete"))&&e.jsx("th",{className:"min-w-[125px]",children:"Actions"})]})}),x.length>0?e.jsx("tbody",{children:x.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:s.product_id})}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-1.5",children:s.name})}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-1.5",children:s.name_gujarati})}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-1.5",children:s.name_hindi})}),e.jsx("td",{children:e.jsx("img",{alt:s.name,className:"rounded-lg size-20 shrink-0",src:s.image})}),(E(6,"update")||E(6,"delete"))&&e.jsxs("td",{children:[E(6,"update")&&e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>l(s.product_id),children:e.jsx(J,{className:"text-yellow-600"})}),E(6,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>z(s.product_id),children:e.jsx(Y,{className:"text-red-500"})})]})]},s.product_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Product available"})})})]})}),e.jsx(q,{count:h,currentPage:d,totalRecords:x==null?void 0:x.length,perPage:a,onPageChange:G,label:"products"})]})})]})},ue=()=>{const[l,t]=r.useState(!1),[c,d]=r.useState(null),[u,a]=r.useState(!1),[m,n]=r.useState(!1),{hasPermission:o}=I(),g=()=>{a(!1),t(!0),d(null)},j=i=>{a(!0),d(i),t(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-7.5",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Products"})}),o(6,"create")&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{onClick:g,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Product"]})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(ne,{isSubmit:m,setIsSubmit:n,setEditProduct:j})})})}),l&&e.jsx(re,{setIsSubmit:n,isOpen:l,onClose:()=>t(!1),product_id:c})]})};export{ue as default};
