import{r as f,V as N,a as L,l as F,d as l,p as T,z,q as M,m as $,j as e,L as O,k as R,b as U}from"./index-DkEVCDP-.js";import{u as G}from"./useGetCompany-DRHcxv2O.js";import{au as Y,av as I}from"./AdapterDayjs-EVKgdFsc.js";import{D as B}from"./DatePicker-8NcgnyUp.js";const H="http://35.154.167.170:3000",Z=`${H}/companies`,J=()=>{const[g,t]=f.useState(!1);return{addCompany:async m=>{const p=localStorage.getItem("authToken");t(!0);try{const s=new FormData;Object.entries(m).forEach(([a,h])=>{h&&(h instanceof FileList?s.append(a,h[0]):s.append(a,h))});const y=await fetch(Z,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:s});if(!y.ok){const a=await y.json();return N.error(a.message,{position:"top-center"}),!1}const _=await y.json();return N.success(_.message,{position:"top-center"}),!0}catch(s){return N.error((s==null?void 0:s.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{t(!1)}},loading:g}},V=()=>{const[g,t]=f.useState(!1);return{updateCompany:async(m,p)=>{const s=localStorage.getItem("authToken"),y=`http://35.154.167.170:3000/companies/${m}`,_=new FormData;for(const a in p)p[a]&&(a==="logo"||a==="contract_document"||a==="signature_image"?p[a]instanceof File&&_.append(a,p[a]):_.append(a,p[a]));t(!0);try{const a=await fetch(y,{method:"PUT",headers:{Authorization:`Bearer ${s}`},body:_});if(a.ok){const C=await a.json();return N.success(C.message,{position:"top-center"}),!0}const h=await a.json();return N.error(h.message,{position:"top-center"}),!1}catch(a){return N.error(a.message,{position:"top-center"}),!1}finally{t(!1)}},loading:g}},W=(g=!1)=>L().shape({company_name:l().required("Company name is required").test("required","Company name is required",t=>!!t),address:l().required("Address is required").test("required","Address is required",t=>!!t),city:l().required("City is required").test("required","City is required",t=>!!t),state:l().required("State is required").test("required","State is required",t=>!!t),zip_code:l().test("required","Zip Code is required",t=>!(t===null||t==="")).test("format","Zip Code must be a 6 digit number",t=>t===null||t===""?!0:/^[0-9]{6}$/.test(t)),company_owner_name:l().required("Company Owner Name is required").test("required","Company Owner Name is required",t=>!!t),phone_number:l().nullable().test("required","Please add phone number",t=>!(t===null||t==="")).test("is-numeric","Phone number must be a positive number",t=>t?/^[0-9+\-\s()]{5,15}$/.test(t):!0).test("length","Phone number must be between 5 to 15 long",t=>t?t.length>=5&&t.length<=15:!0),mobile_number:l().nullable().test("is-numeric","Phone number must be a positive number",t=>t?/^[0-9+\-\s()]{5,15}$/.test(t):!0).test("length","Phone number must be between 5 to 15 long",t=>t?t.length>=5&&t.length<=15:!0),email:l().required("Email is required").email("Enter a valid email").test("required","Email is required",t=>!!t),website:l().nullable().url("Please enter a valid website URL").test("required","Website URL is required",t=>!!t),logo:F().nullable().test("required","Logo is required",t=>g?!0:!!t).test("fileType","Allowed Format : jpg, jpeg, png, ",t=>t&&t instanceof File?["image/jpeg","image/png","image/jpg"].includes(t.type):!0).test("dimensions","Logo must be 92×92 pixels",t=>!t||!(t instanceof File)?!0:new Promise(x=>{const m=new Image;m.src=URL.createObjectURL(t),m.onload=()=>{URL.revokeObjectURL(m.src),x(m.width===92&&m.height===92)},m.onerror=()=>{x(!1)}})),registration_number:l().nullable().test("required","Registration Number is required",t=>!!t),registration_date:z().nullable().required("Please select the registration date").typeError("Please select the registration date").max(new Date,"Registration Date cannot be in the future"),gstin:l().nullable().test("required","GSTIN is required",t=>!!t),gst_percentage:T().transform((t,x)=>x===""?void 0:t).min(0,"GST Percentage cannot be less than 0").max(100,"GST Percentage cannot be more than 100").typeError("GST Percentage must be a number").required("GST Percentage is required"),hsn_sac_code:l().required("HSN/SAC Code is required"),company_ownedby:l().nullable().test("required","Company Owned By is required",t=>!(t===null||t==="")).test("format","Company Owned By must be a number",t=>t===null||t===""?!0:/^[0-9]+$/.test(t)),contract_document:F().nullable().test("fileSize","File is too large",t=>t&&t instanceof File?t.size<=5e6:!0).test("fileType","Unsupported file format",t=>t&&t instanceof File?["application/pdf"].includes(t.type):!0),msme_number:l().trim().min(8,"MSME number must be at least 8 characters").max(20,"MSME number must be at most 20 characters").matches(/^[a-zA-Z0-9-]+$/,"MSME number must be alphanumeric").required("MSME number is required"),signature_image:F().nullable().test("required","Auth signature image is required",t=>g?!0:!!t).test("fileType","Allowed Format : jpg, jpeg, png, ",t=>t&&t instanceof File?["image/jpeg","image/png","image/jpg"].includes(t.type):!0)}),te=()=>{const{addCompany:g,loading:t}=J(),{updateCompany:x,loading:m}=V(),{id:p}=M(),s=p?Number(p):null,[y,_]=f.useState(!1),{company:a,fetchCompany:h,loading:C}=G(),w=$(),[r,j]=f.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null,gst_percentage:"",hsn_sac_code:"",msme_number:"",signature_image:null}),[S,k]=f.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null,gst_percentage:"",hsn_sac_code:"",msme_number:"",signature_image:null}),[n,P]=f.useState({});f.useEffect(()=>{s&&(_(!0),(async()=>await h(s))())},[s]),f.useEffect(()=>{if(a){const i={company_name:a.company_name,address:a.address,city:a.city,state:a.state,zip_code:a.zip_code,company_owner_name:a.company_owner_name,phone_number:a.phone_number,mobile_number:a.mobile_number,email:a.email,website:a.website,logo:a.logo,registration_number:a.registration_number,registration_date:a.registration_date,gstin:a.gstin,company_ownedby:a.company_ownedby,contract_document:a.contract_document,gst_percentage:a.gst_percentage,hsn_sac_code:a.hsn_sac_code,msme_number:a.msme_number,signature_image:a.signature_image};j(i),k(i)}},[a]);const o=i=>{const d=i.target;if(d instanceof HTMLInputElement){const{name:c,value:u,files:b}=d;c==="image"&&b&&b.length>0?j(q=>({...q,logo:b[0]})):j(q=>({...q,[c]:u}))}else if(d instanceof HTMLTextAreaElement){const{name:c,value:u}=d;j(b=>({...b,[c]:u}))}},E=i=>{j(d=>({...d,registration_date:i?i.format("MM-DD-YYYY"):""}))},D=async i=>{i.preventDefault();try{if(await W(!!s).validate(r,{abortEarly:!1}),!Object.keys(r).some(b=>b==="logo"?r.logo instanceof File||r.logo!==S.logo:r[b]!==S[b])){w("/companies");return}let u;s?u=await x(s,r):u=await g(r),u&&w("/companies")}catch(d){if(d instanceof U){const c={};d.inner.forEach(u=>{c[u.path]=u.message}),P(c)}else N.error("Failed to submit the form. Please try again.")}},v=i=>{const{name:d,files:c}=i.target;c&&c.length>0&&j(u=>({...u,[d]:c[0]}))},A=()=>{w("/companies")};return s&&(!y||C)?e.jsx(O,{}):e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:s?"Edit Company":"Add Company"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_name",children:"Company name"}),e.jsx("input",{type:"text",id:"company_name",name:"company_name",autoComplete:"off",value:r.company_name,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.company_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"address",children:"Address"}),e.jsx("input",{type:"text",id:"address",name:"address",autoComplete:"off",value:r.address,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.address||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"city",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:r.city,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.city||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"state",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:r.state,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.state||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"zip_code",children:"Zip code"}),e.jsx("input",{type:"text",id:"zip_code",name:"zip_code",autoComplete:"off",value:r.zip_code,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.zip_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_owner_name",children:"Company owner name"}),e.jsx("input",{type:"text",id:"company_owner_name",name:"company_owner_name",autoComplete:"off",value:r.company_owner_name,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.company_owner_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"phone_number",children:"Phone number 1"}),e.jsx("input",{type:"text",id:"phone_number",name:"phone_number",autoComplete:"off",value:r.phone_number,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.phone_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"mobile_number",children:"Phone number 2"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:r.mobile_number,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.mobile_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:r.email,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"website",children:"Website"}),e.jsx("input",{type:"text",id:"website",name:"website",autoComplete:"off",value:r.website,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.website||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"image",children:"Logo"}),e.jsx("span",{className:"text-sm text-gray-600",children:"(JPG, JPEG, PNG | 92×92 px)"})]}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:o,className:"input border border-gray-300 rounded-md p-2 mt-1 file:h-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.logo||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"registration_number",children:"Registration Number"}),e.jsx("input",{type:"text",id:"registration_number",name:"registration_number",autoComplete:"off",value:r.registration_number,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.registration_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"registration_date",children:"Registration Date"}),e.jsx(Y,{dateAdapter:I,children:e.jsx(B,{value:r.registration_date?R(r.registration_date):null,onChange:E,format:"DD-MM-YYYY",renderInput:i=>e.jsx("input",{...i,id:"registration_date",name:"registration_date",className:"input border border-gray-300 rounded-md p-2"})})}),e.jsx("p",{className:"text-red-500 text-sm",children:n.registration_date||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"gstin",children:"GSTIN"}),e.jsx("input",{type:"text",id:"gstin",name:"gstin",autoComplete:"off",value:r.gstin,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.gstin||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_ownedby",children:"Company owned by"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"company_ownedby",value:r.company_ownedby??"",onChange:i=>j({...r,company_ownedby:Number(i.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Ownership"}),e.jsx("option",{value:1,children:"Own"}),e.jsx("option",{value:2,children:"Other Company"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:n.company_ownedby||" "})]}),r.company_ownedby===2&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"contract_document",children:"Contract Document"}),e.jsx("input",{type:"file",id:"contract_document",name:"contract_document",accept:".pdf,.doc,.docx",onChange:v,className:"input border border-gray-300 rounded-md p-2 mt-1 file:h-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.contract_document||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"gst_percentage",children:"GST Percentage (%)"}),e.jsx("input",{type:"text",id:"gst_percentage",name:"gst_percentage",autoComplete:"off",value:r.gst_percentage,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.gst_percentage||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"hsn_sac_code",children:"HSN / SAC Code"}),e.jsx("input",{type:"text",id:"hsn_sac_code",name:"hsn_sac_code",autoComplete:"off",value:r.hsn_sac_code,onChange:o,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.hsn_sac_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"msme_number",children:"MSME Number"}),e.jsx("input",{type:"text",id:"msme_number",name:"msme_number",value:r.msme_number||"",onChange:o,className:"input border border-gray-300 rounded-md p-2 mt-1 file:h-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.msme_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"signature_image",children:"Authorized Signature Image"}),e.jsx("input",{type:"file",id:"signature_image",name:"signature_image",accept:"image/*",onChange:v,className:"input border border-gray-300 rounded-md p-2 mt-1 file:h-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:n.signature_image||" "})]})]}),e.jsxs("div",{className:"flex justify-start mt-6",children:[e.jsx("button",{type:"submit",className:"btn btn-primary mr-4",disabled:t||m,children:s?"Update Company":"Add Company"}),e.jsx("button",{type:"button",onClick:A,className:"btn btn-secondary",children:"Cancel"})]})]})]})};export{te as default};
