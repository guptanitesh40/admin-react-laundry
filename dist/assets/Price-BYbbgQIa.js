import{r as i,V as k,j as e,q as te,t as re,u as ce,e as q,T as le,v as ne,w as ie,x as de,s as oe,b as ue}from"./index-GtiNTMft.js";import{u as B}from"./useGetCategories-DV4UR77w.js";import{u as U}from"./useGetProducts-Bfqb-HQA.js";import{u as J}from"./useGetServices-DzrPkjMf.js";import{u as pe}from"./useGetPrice-CCADzsYg.js";import{M}from"./MultiSelect-CWKwB2LI.js";import"./orderStatusClasses-HfHBGnti.js";const he="http://35.154.167.170:3000/prices",me=()=>{const[r,o]=i.useState(!1);return{addPrice:async p=>{const d=localStorage.getItem("authToken");if(p.length===0)return k.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;o(!0);try{const s={prices:p},l=await fetch(he,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(s)});if(!l.ok){const m=(await l.json()).message;return k.error(m,{position:"top-center"}),!1}const n=await l.json();return k.success(n.message,{position:"top-center"}),!0}catch(s){return s.name==="TypeError"&&s.message.includes("Failed to fetch")?k.error("Network error: Failed to fetch.",{position:"top-center"}):k.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{o(!1)}},loading:r}},xe=({currentPage:r,count:o,totalRecords:f,perPage:p,onPageChange:d,label:s})=>{const l=Math.ceil(o/p),n=(u,m)=>{const x=[];if(u<=5)for(let g=1;g<=u;g++)x.push(g);else{x.push(1);let g=Math.max(2,m-1),h=Math.min(u-1,m+1);g>2&&x.push("...");for(let b=g;b<=h;b++)x.push(b);h<u-1&&x.push("..."),x.push(u)}return x};return o>p&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center flex-wrap gap-x-4 gap-y-2",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",f," of ",o," ",s]}),e.jsxs("div",{className:"pagination flex flex-wrap","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:r===1,onClick:()=>d(r-1),className:`btn btn-light px-3 h-10 min-w-[40px] ${r===1?"disabled":""}`,children:e.jsx(te,{})}),n(l,r).map((u,m)=>u==="..."?e.jsx("span",{className:"px-2 text-gray-500",children:"..."},m):e.jsx("button",{className:`btn btn-light px-3 h-10 min-w-[40px] ${r===u?"active-btn":""}`,onClick:()=>d(u),children:u},m)),e.jsx("button",{disabled:r===l,onClick:()=>d(r+1),className:`btn btn-light px-3 h-10 min-w-[40px] ${r===l?"disabled":""}`,children:e.jsx(re,{})})]})]})})},fe=({isSave:r,setIsSave:o,setIsLoading:f,search:p,filters:d})=>{const{categories:s}=B(1,1e3),{products:l}=U(1,1e3),{services:n}=J(1,1e3),{prices:u,loading:m,fetchPrices:x}=pe(),{addPrice:P,loading:g}=me(),[h,b]=i.useState({}),[I,E]=i.useState(new Set),S=i.useRef({}),[V,z]=ce(),[j,K]=i.useState(null),[w,L]=i.useState(null),[_,T]=i.useState(1),[y,H]=i.useState(10),{hasPermission:$}=q(),Q=i.useCallback((a,c,t,v)=>{const N=[];return a.forEach(R=>{c.forEach(O=>{t.forEach(G=>{const ae=`${R.category_id}_${O.product_id}_${G.service_id}`;N.push({category:R,product:O,service:G,price:v[ae]||0})})})}),N},[s,l,n,u]),A=i.useMemo(()=>Q(s,l,n,u),[s,l,n,u]),C=A.filter(a=>{const c=(p||"").trim().toLowerCase(),t=a.category.name.toLowerCase().includes(c)||a.product.name.toLowerCase().includes(c)||a.service.name.toLowerCase().includes(c),v=d.categoryId.length===0||d.categoryId.includes(a.category.category_id),N=d.productId.length===0||d.productId.includes(a.product.product_id),R=d.serviceId.length===0||d.serviceId.includes(a.service.service_id);return t&&v&&N&&R}).sort((a,c)=>["category","product","service"].includes(j)?w==="ASC"?a[j].name.localeCompare(c[j].name):c[j].name.localeCompare(a[j].name):j==="price"?w==="ASC"?a.price-c.price:c.price-a.price:0),W=Math.ceil((C==null?void 0:C.length)/y),D=C.slice((_-1)*y,(_-1)*y+y),X=a=>{a>=1&&a<=W&&T(a)},Y=a=>{const c=Number(a.target.value);H(c),T(1)};i.useEffect(()=>{T(1)},[d]),i.useEffect(()=>{if(r){if(!A.some(t=>{const v=`${t.category.category_id}_${t.product.product_id}_${t.service.service_id}`;return h[v]!==void 0&&h[v]!==t.price})){o(!1);return}const c=A.map(t=>{const v=`${t.category.category_id}_${t.product.product_id}_${t.service.service_id}`;return{category_id:t.category.category_id,product_id:t.product.product_id,service_id:t.service.service_id,price:h[v]!==void 0?h[v]:t.price}}).filter(t=>t.price>0);try{P(c).then(()=>{x().then(()=>{b({}),E(new Set)})})}catch{k.error("Failed to save prices.")}}o(!1)},[r,P,A,h]),i.useEffect(()=>{var c;const a=Array.from(I);if(a.length>0){const t=a[0];S.current[t]&&((c=S.current[t])==null||c.focus())}},[I]),i.useEffect(()=>{z(p?{search:p}:{})},[p]),i.useEffect(()=>{f(!!g)},[g]);const Z=a=>{E(c=>{const t=new Set(c);return t.add(a),t})},ee=(a,c)=>{b(t=>({...t,[a]:c}))},F=a=>{j===a?L(w==="ASC"?"DESC":"ASC"):(K(a),L("ASC"))},se=a=>{E(c=>{const t=new Set(c);return t.delete(a),t})};return m?e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(le,{isFilters:!0,columns:5,records:20,isPagination:!1})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5 mt-4",children:e.jsxs("div",{className:"card card-grid min-w-full",children:[e.jsx("div",{className:"card-header card-header-space flex-wrap",children:e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:y,onChange:Y,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:500,children:"500"}),e.jsx("option",{value:1e3,children:"1000"})]}),e.jsx("span",{children:"per page"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto scrollable-y-auto max-h-[500px]",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[40px]",children:"Id"}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${j==="category"?w==="ASC"?"asc":"desc":""}`,onClick:()=>F("category"),children:[e.jsx("span",{className:"sort-label",children:"Category"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${j==="product"?w==="ASC"?"asc":"desc":""}`,onClick:()=>F("product"),children:[e.jsx("span",{className:"sort-label",children:"Product"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${j==="service"?w==="ASC"?"asc":"desc":""}`,onClick:()=>F("service"),children:[e.jsx("span",{className:"sort-label",children:"Service"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${j==="price"?w==="ASC"?"asc":"desc":""}`,onClick:()=>F("price"),children:[e.jsx("span",{className:"sort-label",children:"Price"}),e.jsx("span",{className:"sort-icon"})]})})]})}),e.jsx("tbody",{children:C.length>0?C.slice((_-1)*y,(_-1)*y+y).map((a,c)=>{const t=`${a.category.category_id}_${a.product.product_id}_${a.service.service_id}`,v=I.has(t);return e.jsxs("tr",{className:`font-semibold ${a.price?"":"text-red-500"}`,children:[e.jsx("td",{children:(_-1)*y+c+1}),e.jsx("td",{children:a.category.name}),e.jsx("td",{children:a.product.name}),e.jsx("td",{children:a.service.name}),e.jsx("td",{className:"relative",children:v?e.jsx("input",{ref:N=>S.current[t]=N,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:h[t]!==void 0?h[t]:a.price||"",onChange:N=>ee(t,N.target.value===""?0:Number(N.target.value)),onBlur:()=>se(t),onKeyDown:N=>{N.key==="Enter"&&o(!0)}}):e.jsx("span",{className:`${$(10,"update")||$(10,"create")?"cursor-pointer h-full flex":"h-full flex"}`,onClick:$(10,"update")||$(10,"create")?()=>Z(t):void 0,children:h[t]!==void 0?h[t]:a.price||"Add Price"})})]},c)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})}),e.jsx(xe,{count:C.length,currentPage:_,totalRecords:D==null?void 0:D.length,perPage:y,onPageChange:X,label:"prices"})]})})]})})})},ge=({filters:r,updateFilters:o})=>{const{categories:f}=B(1,1e3),{products:p}=U(1,1e3),{services:d}=J(1,1e3);return e.jsx("div",{className:"p-3 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(M,{options:f==null?void 0:f.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.category_id})),displayValue:"name",placeholder:"Select Category",selectedValues:r==null?void 0:r.categoryId,onSelect:s=>{const l=s.map(n=>n.value);o({...r,categoryId:l})},onRemove:s=>{const l=s.map(n=>n.value);o({...r,categoryId:l})},className:"w-full",isSearchInput:!0}),e.jsx(M,{options:p==null?void 0:p.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.product_id})),displayValue:"label",placeholder:"Select Product",selectedValues:r.productId,onSelect:s=>{const l=s.map(n=>n.value);o({...r,productId:l})},onRemove:s=>{const l=s.map(n=>n.value);o({...r,productId:l})},className:"w-full",isSearchInput:!0}),e.jsx(M,{options:d==null?void 0:d.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.service_id})),displayValue:"label",placeholder:"Select Service",selectedValues:r.serviceId,onSelect:s=>{const l=s.map(n=>n.value);o({...r,serviceId:l})},onRemove:s=>{const l=s.map(n=>n.value);o({...r,serviceId:l})},className:"w-full",isSearchInput:!0})]})})},Ce=()=>{const[r,o]=i.useState(!1),[f,p]=i.useState(!1),[d,s]=i.useState(""),[l,n]=i.useState(""),[u,m]=i.useState(""),[x,P]=i.useState(!1),{hasPermission:g}=q(),[h,b]=i.useState({categoryId:[],productId:[],serviceId:[]}),I=S=>{b(S)},E=async S=>{S.preventDefault();try{await oe.validate({search:d},{abortEarly:!1}),n(d),m("")}catch(V){V instanceof ue&&m(V.errors[0])}};return e.jsxs("div",{className:"px-10 max-h-[calc(100vh-69px)] flex flex-col relative",children:[e.jsxs("div",{className:"sticky-save-header pb-1 bg-white",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 py-3 ",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price"})}),e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("form",{onSubmit:E,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:d,onChange:S=>{s(S.target.value),S.target.value===""&&(n(""),m(""))},placeholder:"Search...",className:"min-w-[185px]"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),u&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u||" "})]}),(g(10,"create")||g(10,"update"))&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsx("button",{onClick:()=>o(!0),className:"btn btn-primary",disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ki-filled ki-plus-squared"})," Saving"," ",e.jsx(ne,{})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ki-filled ki-plus-squared"})," Save"]})})})]})]}),e.jsx("div",{className:"flex flex-auto items-center justify-between gap-2.5 mb-2 shadow-none",children:e.jsxs("button",{className:"btn btn-sm btn-primary shadow-none",onClick:()=>P(!x),children:["Filters",x?e.jsx(ie,{size:23}):e.jsx(de,{color:"skyblue",size:23})]})}),e.jsx("div",{children:x&&e.jsx(ge,{filters:h,updateFilters:I})})]}),e.jsx("div",{className:"flex-1 overflow-auto new-scollbar -mr-4 pr-2",children:e.jsx(fe,{isSave:r,setIsSave:o,setIsLoading:p,search:l,filters:h})})]})};export{Ce as default};
