import{r as l,_ as N,u as B,j as e,F as k,a as E,T as M,R as G,G as z,b as O,c as J,d as V,e as W,S as A,f as Y,g as _,n as F,V as $,s as Z}from"./index-D8mCTybp.js";const H="http://35.154.167.170:3000/user",K=(o=1,i=10,g="",d,f)=>{const[t,u]=l.useState([]),[n,h]=l.useState(0),[x,a]=l.useState(!1),r=l.useCallback(async()=>{var p,y;const C=localStorage.getItem("authToken"),c=new URLSearchParams;o&&c.append("page_number",o.toString()),i&&c.append("per_page",i.toString()),g&&c.append("search",g),d&&c.append("sortBy",d),f&&c.append("order",f),a(!0);try{const b=await fetch(`${H}?${c}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`}});if(!b.ok){const w=await b.json();N.error(w.message,{position:"top-center"});return}const s=await b.json(),j=((p=s==null?void 0:s.data)==null?void 0:p.result)||[],S=((y=s==null?void 0:s.data)==null?void 0:y.count)||0;u(j),h(S)}catch(b){N.error((b==null?void 0:b.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{a(!1)}},[o,i,f,d,g]);return{users:t,totalUsers:n,loading:x,fetchUsers:r}},Q="http://35.154.167.170:3000/user",X=()=>{const[o,i]=l.useState(!1);return{addUser:async d=>{const f=localStorage.getItem("authToken");i(!0);try{const t=await fetch(Q,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(!t.ok){const n=await t.json();return N.error(n.message,{position:"top-center"}),!1}const u=await t.json();return N.success(u.message,{position:"top-center"}),!0}catch(t){return N.error((t==null?void 0:t.message)||"Error adding banner",{position:"top-center"}),!1}finally{i(!1)}},loading:o}},ee=()=>{const[o,i]=l.useState(!1);return{deleteUser:async d=>{i(!0);const f=`http://35.154.167.170:3000/user/${d}`,t=localStorage.getItem("authToken");try{const u=await fetch(f,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),n=await u.json();return u.ok?{success:!0,message:n.message}:(N.error(n.message,{position:"top-center"}),{success:!1,message:n.message})}catch(u){return{success:!1,message:u.message}}finally{i(!1)}},loading:o}},se=()=>{const[o,i]=l.useState(!1);return{updateUser:async(d,f)=>{const t=localStorage.getItem("authToken"),u=`http://35.154.167.170:3000/user/${d}`;i(!0);try{const n=await fetch(u,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!n.ok){const x=await n.json();return N.error(x.message,{position:"top-center"}),!1}const h=await n.json();return N.success(h.message,{position:"top-center"}),!0}catch(n){return N.error(n.message,{position:"top-center"}),!1}finally{i(!1)}},loading:o}},ae=({search:o,isSubmit:i,setIsSubmit:g,setEditUser:d})=>{const{deleteUser:f}=ee(),[t,u]=l.useState(1),[n,h]=l.useState(10),[x,a]=B(),[r,C]=l.useState(null),[c,p]=l.useState(null),y=x.get("page"),b=x.get("perPage"),{users:s,fetchUsers:j,totalUsers:S,loading:w}=K(t,n,o,r,c),P=Math.ceil(S/n);l.useEffect(()=>{i&&(j(),g(!1))},[i,j]),l.useEffect(()=>{y&&u(Number(y)),b&&h(Number(b))},[y,b]),l.useEffect(()=>{o?(u(1),a({search:o,page:"1",perPage:n.toString()})):a({page:"1",perPage:n.toString()})},[o]),l.useEffect(()=>{j()},[n,t,o,r,c,j]);const L=async m=>{try{const{isConfirmed:v}=await A.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(v){const{success:q,message:T}=await f(m);q?(s.filter(I=>I.user_id!==m).length===0&&t>1&&(u(t-1),a({page:(t-1).toString(),perPage:n.toString()})),await j(),A.fire(T)):A.fire(T)}}catch(v){A.fire({title:"Error",text:v.message,icon:"error"})}},U=m=>{r===m?p(c==="ASC"?"DESC":"ASC"):(C(m),p("ASC"))},D=m=>{m>=1&&m<=P&&(u(m),a({page:m.toString(),perPage:n.toString()}))},R=m=>{const v=Number(m.target.value);h(v),u(1),a({page:"1",perPage:v.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:n,onChange:R,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>U("user_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(k,{color:r==="user_id"&&c==="ASC"?"gray":"lightgray"}),e.jsx(E,{color:r==="user_id"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>U("user_id"),children:["User name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(k,{color:r==="user_id"&&c==="ASC"?"gray":"lightgray"}),e.jsx(E,{color:r==="user_id"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>U("email"),children:["Email",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(k,{color:r==="email"&&c==="ASC"?"gray":"lightgray"}),e.jsx(E,{color:r==="email"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>U("mobile_number"),children:["Mobile no",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(k,{color:r==="mobile_number"&&c==="ASC"?"gray":"lightgray"}),e.jsx(E,{color:r==="mobile_number"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[170px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>U("role_id"),children:["Role",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(k,{color:r==="role_id"&&c==="ASC"?"gray":"lightgray"}),e.jsx(E,{color:r==="role_id"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>U("gender"),children:["Gender",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(k,{color:r==="gender"&&c==="ASC"?"gray":"lightgray"}),e.jsx(E,{color:r==="gender"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[140px]",children:"Actions"})]})}),w?e.jsx(M,{}):s.length>0?e.jsx("tbody",{children:s.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.user_id}),e.jsxs("td",{children:[m.first_name," ",m.last_name]}),e.jsx("td",{children:m.email}),e.jsx("td",{children:m.mobile_number}),e.jsx("td",{children:G[m.role_id]}),e.jsx("td",{children:z[m.gender]}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>d(m.user_id),children:e.jsx(O,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>L(m.user_id),children:e.jsx(J,{className:"text-red-500"})})]})]},m.user_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No users available"})})})]})})})})}),S>n&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",s.length," of ",S," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:t===1,onClick:()=>D(t-1),className:`btn ${t===1?"disabled":""}`,children:e.jsx(V,{})}),Array.from({length:P}).map((m,v)=>e.jsx("button",{className:`btn ${t===v+1?"active":""}`,onClick:()=>D(v+1),children:v+1},v)),e.jsx("button",{disabled:t===P,onClick:()=>D(t+1),className:`btn ${t===P?"disabled":""}`,children:e.jsx(W,{})})]})]})]})},te=(o=!1)=>Y().shape({first_name:_().required("First name is required"),last_name:_().required("Last name is required"),email:_().email("Enter a valid email"),password:o?_().min(6,"Password must be at least 6 characters"):_().min(6,"Password must be at least 6 characters").required("Password is required"),mobile_number:_().matches(/^\d{10}$/,"Mobile number must be 10 digits").required("Mobile number is required"),gender:F().required("Gender is required"),role_id:F().required("Role is required"),otp:o?_():_().required("OTP is required")}),re=()=>{const[o,i]=l.useState(!1),[g,d]=l.useState(null);return{user:g,loading:o,fetchUser:async t=>{var h;const u=localStorage.getItem("authToken"),n=`http://35.154.167.170:3000/user/${t}`;i(!0);try{const x=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}});if(!x.ok){const r=await x.json();N.error(r.message,{position:"top-center"}),i(!1);return}const a=await x.json();d((h=a==null?void 0:a.data)==null?void 0:h.user)}catch(x){N.error((x==null?void 0:x.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{i(!1)}}}},ne=({isOpen:o,onClose:i,setIsSubmit:g,user_id:d})=>{const{addUser:f,loading:t}=X(),{updateUser:u,loading:n}=se(),{user:h,fetchUser:x}=re(),[a,r]=l.useState({first_name:"",last_name:"",email:"",password:"",mobile_number:"",gender:null,role_id:null,otp:""}),[C,c]=l.useState({first_name:"",last_name:"",email:"",password:"",mobile_number:"",gender:null,role_id:null,otp:""}),[p,y]=l.useState({});l.useEffect(()=>{o&&d&&x(d)},[o,d]),l.useEffect(()=>{if(o&&h&&d){const s={...a,first_name:h.first_name,last_name:h.last_name,email:h.email,password:h.password,mobile_number:h.mobile_number,gender:h.gender,role_id:h.role_id};r(s),c(s)}else r({first_name:"",last_name:"",email:"",password:"",mobile_number:"",gender:null,role_id:null,otp:""}),c({first_name:"",last_name:"",email:"",password:"",mobile_number:"",gender:null,role_id:null,otp:""}),y({})},[o,h,d]);const b=async s=>{s.preventDefault();try{if(await te(!!d).validate(a,{abortEarly:!1}),!Object.keys(a).some(w=>a[w]!==C[w])){i();return}d?await u(d,a):await f(a),g(!0),i()}catch(j){if(j instanceof $){const S={};j.inner.forEach(w=>{S[w.path||""]=w.message}),y(S)}else N.error("Failed to submit the form. Please try again.")}};return o?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:i}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl w-full z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 shadow-default",onClick:i,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:d?"Edit user detail":"Add user"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"first_name",className:"mb-2 font-semibold",children:"First Name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",value:a.first_name||"",onChange:s=>r({...a,first_name:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.first_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"last_name",className:"mb-2 font-semibold",children:"Last Name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",value:a.last_name||"",onChange:s=>r({...a,last_name:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.last_name||" "})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",className:"mb-2 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",value:a.email||"",onChange:s=>r({...a,email:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"mobile_number",className:"mb-2 font-semibold",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",value:a.mobile_number||"",onChange:s=>r({...a,mobile_number:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.mobile_number||" "})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"password",className:"mb-2 font-semibold",children:"Password"}),e.jsx("input",{type:"password",id:"password",name:"password",value:a.password||"",onChange:s=>r({...a,password:s.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:p.password||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"role_id",children:"Role"}),e.jsxs("select",{id:"role_id",className:"select border border-gray-300 rounded-md p-2 w-full",value:a.role_id===null?"":a.role_id,onChange:s=>r({...a,role_id:s.target.value?parseInt(s.target.value):""}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Role"}),e.jsx("option",{value:1,children:"Super Admin"}),e.jsx("option",{value:2,children:"Sub Admin"}),e.jsx("option",{value:3,children:"Branch Manager"}),e.jsx("option",{value:4,children:"Delivery Boy"}),e.jsx("option",{value:5,children:"Customer"}),e.jsx("option",{value:6,children:"Workshop Manager"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:p.role_id||" "})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:a.gender===1,onChange:s=>r({...a,gender:parseInt(s.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:a.gender===2,onChange:s=>r({...a,gender:parseInt(s.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:a.gender===3,onChange:s=>r({...a,gender:parseInt(s.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:p.gender||" "})]}),!d&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"otp",className:"mb-2 font-semibold",children:"Enter OTP"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",id:"otp",name:"otp",value:a.otp,onChange:s=>r({...a,otp:s.target.value}),className:"input border border-gray-300 rounded-md p-2 flex-grow"}),e.jsx("button",{className:"btn btn-primary ml-2 px-4 py-2",children:"Send OTP"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:p.otp||" "})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${t||n?"opacity-50 cursor-not-allowed":""}`,disabled:t||n,children:t||n?t?"Adding...":"Updating...":d?"Update user":"Add user"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:i,disabled:t||n,children:"Cancel"})]})]})]})]}):null},ie=()=>{const[o,i]=l.useState(""),[g,d]=l.useState(""),[f,t]=l.useState(!1),[u,n]=l.useState(null),[h,x]=l.useState(!1),[a,r]=l.useState(!1),[C,c]=l.useState(""),p=s=>{x(!0),n(s),t(!0)},y=()=>{t(!0),n(null)},b=async s=>{s.preventDefault();try{await Z.validate({search:g},{abortEarly:!1}),i(g),c("")}catch(j){j instanceof $&&c(j.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Users"}),e.jsxs("button",{onClick:y,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add User"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:b,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:g,onChange:s=>{d(s.target.value),s.target.value===""&&i("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:C||" "})]}),e.jsx(ae,{search:o,isSubmit:a,setIsSubmit:r,setEditUser:p}),e.jsx(ne,{setIsSubmit:r,isOpen:f,onClose:()=>t(!1),user_id:u})]})};export{ie as default};
