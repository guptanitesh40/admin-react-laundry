import{r as i,B as V,V as g,c as Fe,a as Ee,d as me,o as $,I as gt,p as bt,A as ft,z as vt,J as jt,H as Nt,g as wt,l as Ct,j as e,L as Ae,x as kt,K as St,f as $t,q as Tt,M as It,i as qe,b as Pt}from"./index-DOQwCcB-.js";import{u as Ot}from"./useGetCategories-DlOwRnJ3.js";import{u as Dt}from"./useGetCompanies-ByVmbqDM.js";import{u as Ft}from"./useGetOrder-DxtuseqM.js";import{u as At,a as qt,A as Et,C as Lt}from"./CustomerModal-CtYtQIIN.js";import{u as Rt}from"./useGetuser-BuYXkfRb.js";import"./userSchema-Co24QSWu.js";const Gt=()=>{const[l,_]=i.useState(!1);return{loading:l,fetchProductsOnId:async y=>{const j=localStorage.getItem("authToken");_(!0);try{const b=await fetch(`${V}/category/${y}/product`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`}}),p=await b.json();if(!b.ok){g.error(p.message,{position:"top-center"}),_(!1);return}return(p==null?void 0:p.data)||[]}catch(b){return g.error((b==null?void 0:b.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{_(!1)}}}},Ut=()=>{const[l,_]=i.useState(!1);return{loading:l,fetchServicesOnId:async(y,j)=>{const b=localStorage.getItem("authToken");_(!0);try{const p=await fetch(`${V}/category/${y}/product/${j}/service`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}}),m=await p.json();if(!p.ok){g.error(m.message,{position:"top-center"}),_(!1);return}return(m==null?void 0:m.data)||[]}catch(p){return g.error((p==null?void 0:p.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{_(!1)}}}},Bt="http://35.154.167.170:3000/admin/coupon/apply",Mt=()=>{const[l,_]=i.useState(!1);return{applyCoupon:async(y,j,b)=>{const p=localStorage.getItem("authToken");_(!0);try{const m=await fetch(Bt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({user_id:y,order_Total:j,coupon_code:b})}),f=await m.json();return m.ok?f.data:(g.error(f.message,{position:"top-center"}),!1)}catch{g.error("Unable to apply coupon code!")}finally{_(!1)}},loading:l}},zt=()=>{const[l,_]=i.useState([]),[v,y]=i.useState(!1),j=async b=>{const p=localStorage.getItem("authToken");y(!0);try{const m=await fetch(`${V}/admin/valid-coupons?${b}`,{method:"GET",headers:{Authorization:p?`Bearer ${p}`:""}}),f=await m.json();if(!m.ok){g.error(f.message,{position:"top-center"}),y(!1);return}_(f==null?void 0:f.data)}catch{g.error("Network error: Failed to fetch coupons.")}finally{y(!1)}};return i.useEffect(()=>{j()},[]),{validCoupons:l,fetchValidCoupons:j,loading:v}},Vt=()=>{const[l,_]=i.useState([]),[v,y]=i.useState(!0),j=async()=>{const b=localStorage.getItem("authToken");y(!0);try{const p=await fetch(`${V}/prices/admin`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}});if(!p.ok){const f=await p.json();Fe.error(f.message,{position:"top-center"});return}const m=await p.json();_((m==null?void 0:m.data)||[])}catch{Fe.error("Network error: Failed to fetch.")}finally{y(!1)}};return i.useEffect(()=>{j()},[]),{prices:l,loading:v,fetchPrices:j}},Yt=()=>{const[l,_]=i.useState(!1);return{updateOrder:async(y,j)=>{const b=localStorage.getItem("authToken"),p=`http://35.154.167.170:3000/admin/orders/${y}`;_(!0);try{const m=await fetch(p,{method:"PUT",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify(j)});if(m.ok){const A=await m.json();return g.success(A.message,{position:"top-center"}),!0}const f=await m.json();return g.error(f.message,{position:"top-center"}),!1}catch(m){return g.error((m==null?void 0:m.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{_(!1)}},loading:l}},Kt=Ee().shape({category_id:$().nullable().required("Please select a category").test("required","Please select a category",l=>!!l),product_id:$().nullable().required("Please select a product").test("required","Please select a product",l=>!!l),service_id:$().nullable().required("Please select a service").test("required","Please select a service",l=>!!l),price:$().nullable().when(["category_id","product_id","service_id"],([l,_,v],y)=>l&&_&&v?y.required("Price is not available for the combination, please add a price"):y.nullable())}),Ht=Ee().shape({username:me().required("Please enter username"),address_id:$().required("Please select address").test("required","Please select address",l=>!!l),express_delivery_charges:$().typeError("Express delivery charges must be a number").min(0,"Express delivery charges must be a positive number"),shipping_charges:$().typeError("Shipping charge must be a number").min(0,"Shipping charge must be a positive number"),payment_type:$().required("Please choose payment type").test("required","Please choose payment type",l=>!!l),payment_status:$().required("Please choose payment status").test("required","Please choose payment status",l=>!!l),paid_amount:$().typeError("Paid amount must be a number").min(0,"Paid amount must be a positive number").test("max-paid","Paid amount cannot be greater than the total amount",function(l){var _;return l==null||l===0?!0:l<=((_=this.options.context)==null?void 0:_.total)}),branch_id:$().required("Please select branch").test("required","Please select branch",l=>!!l),items:gt().of(Kt),company_id:$().typeError("Company must be selected").required("Company is required"),gstin:me().transform(l=>l===""?null:l).nullable().matches(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,"Please enter a valid GSTIN"),gst_company_name:me().when("gstin",{is:l=>!!l,then:l=>l.required("Company name is required when GSTIN is provided"),otherwise:l=>l.notRequired()})}),Zt=()=>{const[l,_]=i.useState(null),[v,y]=i.useState(!0),j=async()=>{const b=localStorage.getItem("authToken");if(!b){g.error("Authentication token not found!"),y(!1);return}try{const p=await fetch(`${V}/admin/settings`,{method:"GET",headers:{Authorization:`Bearer ${b}`}}),m=await p.json();if(!p.ok){g.error((m==null?void 0:m.message)||"Failed to fetch settings",{position:"top-center"});return}_((m==null?void 0:m.data)||{})}catch{g.error("Network Error: Failed to fetch settings")}finally{y(!1)}};return i.useEffect(()=>{j()},[]),{settings:l,loading:v}},as=()=>{var Oe;const{prices:l,loading:_}=Vt(),{categories:v,loading:y}=Ot(),{fetchProductsOnId:j,loading:b}=Gt(),{fetchServicesOnId:p,loading:m}=Ut(),[f,A]=i.useState(""),[X,F]=i.useState(!0),{id:G}=bt(),{updateOrder:Le,loading:Y}=Yt(),{addOrder:Re,loading:U}=At(),T=Number(G),pe=1e3,he=1,{companies:B,loading:_e}=Dt(he,pe),[xe,ye]=i.useState(!1),[Ge,ge]=i.useState(!1),[Ue,be]=i.useState(!1),[fe,ee]=i.useState(!1),{users:te,fetchUsersByRole:ve}=ft(),{validCoupons:K,fetchValidCoupons:Be}=zt(),{branches:O,loading:je}=vt(he,pe),{order:d,loading:Me,fetchOrder:ze}=Ft(),{address:D,fetchAddress:Ne}=qt(),{applyCoupon:Ve}=Mt(),{userData:se,fetchUser:Ye}=Rt(),{generatePaymentLink:Ke,loading:we}=jt(),{settings:C,loading:ae}=Zt(),q=se==null?void 0:se.user,H=Nt(),re=((Oe=H==null?void 0:H.state)==null?void 0:Oe.prevUrl)||"/orders",ne=i.useRef(null),[M,oe]=i.useState({}),[Z,Ce]=i.useState({}),le=i.useRef(null),[ke,Se]=i.useState(!1),[$e,ie]=i.useState(null),[ce,Te]=i.useState(null),de=wt(t=>t==null?void 0:t.user),J=Ct(),[s,c]=i.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:2,payment_type:1,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null,company_id:null,gstin:"",gst_company_name:"",description:""}),[He,Ze]=i.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:null,payment_type:null,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null,company_id:null,gstin:"",gst_company_name:"",description:""}),[w,Ie]=i.useState({});i.useEffect(()=>{const t=a=>{le.current&&!le.current.contains(a.target)&&ne.current&&!ne.current.contains(a.target)&&(F(!1),Se(!1))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),i.useEffect(()=>{(async()=>{await ze(T)})()},[T]),i.useEffect(()=>{if(D!=null&&D.length){const t=D.find(a=>a.is_default)||D[0];c(a=>({...a,address_id:t?t.address_id:null}))}},[D]),i.useEffect(()=>{(async()=>{s.user_id&&(await Ne(s.user_id),await Be(s.user_id),await Ye(s.user_id)),fe&&(await Ne(s.user_id),ee(!1))})()},[s.user_id,fe]),i.useEffect(()=>{T||c(t=>({...t,payment_status:s.payment_type===1?1:null}))},[s.payment_type]),i.useEffect(()=>{(async()=>{ke&&(!f||f.trim()==="")?(F(!0),await ve(5)):f&&X&&await ve(5,f)})()},[ke,f,X]),i.useEffect(()=>{if(d){const t=`${d.user.first_name} ${d.user.last_name}`;A(t),F(!1);const a={coupon_code:d.coupon_code||"",coupon_discount:d.coupon_discount||null,express_delivery_charges:d.express_delivery_charges||null,express_delivery_hour:d.express_delivery_hour||null,normal_delivery_charges:d.normal_delivery_charges||null,payment_type:d.payment_type||null,payment_status:d.payment_status||null,sub_total:d.sub_total||0,paid_amount:d.paid_amount||null,kasar_amount:d.kasar_amount||null,transaction_id:d.transaction_id||"",address_id:d.address_id,username:t,user_id:d.user_id||null,items:d.items.map(r=>{var S,E,x,z;const o=r.category.category_id,n=((S=r.product)==null?void 0:S.product_id)||null,u=((E=r.service)==null?void 0:E.service_id)||null,N=((x=r.product)==null?void 0:x.name)||"",h=((z=r.service)==null?void 0:z.name)||"";M[o]||j(o).then(L=>{oe(R=>({...R,[o]:L}))});const k=`${o}_${n}`;return Z[k]||p(o,n).then(L=>{Ce(R=>({...R,[k]:L}))}),{category_id:o,product_id:n,service_id:u,product_name:N,service_name:h,description:r.description||null,price:r.price,quantity:r.quantity,item_Total:r.price*r.quantity,showDescription:!!r.description}}),total:(d.sub_total||0)+(d.express_delivery_charges||0)+(d.normal_delivery_charges||0),branch_id:d.branch_id,order_status:d.order_status,delivery_by:d.delivery_by,company_id:d.company_id,gstin:d.gstin,gst_company_name:d.gst_company_name,description:d==null?void 0:d.description};c(a),Ze(a),d.gst_company_name&&d.gstin&&ye(!0)}},[d]),i.useEffect(()=>{const t=(s.paid_amount||0)+(s.kasar_amount||0),a=s.total-t;let r=s.payment_status;s.total>0&&t===s.total?(r=2,ie(0)):t>0&&t<s.total?(r=3,ie(a)):t===0&&s.total>0&&(r=1,ie(a)),c(o=>({...o,payment_status:r}))},[s.paid_amount,s.kasar_amount,s.total]);const Je=async t=>{t.preventDefault();try{const a=s.items.map(h=>({category_id:Number(h.category_id),product_id:Number(h.product_id),service_id:Number(h.service_id),description:h.description,price:Number(h.price),quantity:Number(h.quantity)})),r={...s,address_id:Number(s.address_id),coupon_discount:Number(s.coupon_discount),normal_delivery_charges:Number(s.normal_delivery_charges),kasar_amount:Number(s.kasar_amount),paid_amount:Number(s.paid_amount),express_delivery_charges:Number(s.express_delivery_charges),payment_type:Number(s.payment_type),payment_status:Number(s.payment_status),order_status:T?s.order_status:4,items:a,company_id:s.company_id,gstin:s.gstin,gst_company_name:s.gst_company_name},o=s.total;if(await Ht.validate(r,{abortEarly:!1,context:{total:o}}),Ie({}),!Object.keys(s).some(h=>s[h]!==He[h])){J(`${re}`);return}let u;const N={...r};N.company_id||delete N.company_id,d?u=await Le(T,N):u=await Re(r),u&&J(`${re}`)}catch(a){if(a instanceof Pt){const r={};a.inner.forEach(o=>{r[o.path||""]=o.message}),Ie(r)}else g.error("Failed to submit the form. Please try again.")}},Qe=t=>{t.target.value===""&&c(a=>({...a,address_id:null,user_id:null})),A(t.target.value),F(!0)},We=t=>{const a=`${t.first_name} ${t.last_name}`;A(a),F(!1),c({...s,username:a,user_id:t.user_id})},Xe=()=>{J(`${re}`)},et=()=>{c(t=>{const a=t.items[t.items.length-1];return{...t,items:[...t.items,{category_id:(a==null?void 0:a.category_id)||null,product_id:null,product_name:"",service_id:null,service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}]}})},tt=t=>{c(a=>{const r=a.items.filter((N,h)=>h!==t),o={...a,items:r,coupon_code:"",coupon_discount:0},n=ue(o),u=n+Number(s.express_delivery_charges||0)+Number(s.normal_delivery_charges||0);return{...o,sub_total:n,total:u}})},I=async(t,a,r)=>{["category_id","product_id","service_id","price","quantity"].includes(a)&&c(o=>({...o,coupon_code:"",coupon_discount:0})),c(o=>{const n=o.items.map((S,E)=>{if(E===t){const x={...S,[a]:r};a==="showDescription"&&(x.showDescription=r);const z=Number(x.category_id),L=Number(x.product_id),R=Number(x.service_id),De=Number(x.quantity)||1;if(a==="category_id"){const P=Number(r);M[P]||j(P).then(Q=>{oe(W=>({...W,[P]:Q}))}),x.product_id=null,x.service_id=null,x.price=null,x.quantity=1,x.item_Total=null}if(a==="product_id"){const P=Number(S.category_id),Q=Number(r),W=`${P}_${Q}`;Z[W]||p(P,Q).then(xt=>{Ce(yt=>({...yt,[W]:xt}))}),x.service_id=null,x.price=null,x.quantity=1,x.item_Total=null}if(["category_id","product_id","service_id"].includes(a)&&a!=="category_id"&&a!=="product_id")if(z&&L&&R){const P=st(z,L,R);x.price=P,x.item_Total=P*De}else x.price=null,x.item_Total=null;else a==="price"?x.item_Total=r*De:a==="quantity"&&(x.item_Total=x.price*Number(r));return x}return S}),u={...o,items:n},h=ue(u)-o.coupon_discount,k=h+Number(o.express_delivery_charges||0)+Number(o.normal_delivery_charges||0);return{...u,sub_total:h,total:k}})},st=(t,a,r)=>{const o=`${t}_${a}_${r}`;return l[o]||0},at=async t=>{const a=ue(s);if(!a){g.error("Please add items first to apply the coupon code.");return}const r=await Ve(s.user_id,a,t),o=Number(r.finalTotal||0)+Number(s.express_delivery_charges||0)+Number(s.normal_delivery_charges||0);if(r&&(r&&c(n=>({...n,coupon_code:t,coupon_discount:r.discountAmount,sub_total:r.finalTotal,total:o})),s.express_delivery_hour)){const n=`express_delivery_${s.express_delivery_hour}hrs`,u=C[n],N=Number(u)/100;if(isNaN(N)){g.error("Invalid delivery charge percentage!");return}c(h=>{const k=Math.floor(h.sub_total*N);return{...h,express_delivery_charges:k,total:h.sub_total+k}})}},ue=t=>t.items.reduce((a,r)=>a+(r.item_Total||0),0),Pe=(t,a)=>{c(r=>{const o={...r,[t]:a},n=Number(o.sub_total||0)+Number(o.express_delivery_charges||0)+Number(o.normal_delivery_charges||0);return{...o,total:n}})},rt=t=>{const a=t.target.value;c(r=>({...r,address_id:Number(a)}))},nt=t=>{t.preventDefault(),s.user_id?ge(!0):g.error("Please select the user to add address")},ot=t=>{t.preventDefault(),be(!0)},lt=()=>{J(`/order/${T}`)},it=async()=>{const t=[];if(s.total||t.push("item total"),s.username||t.push("customer name"),t.length>0){g.error(`Please add required fields: ${t.join(", ")}`);return}const a={amount:s.total,currency:"INR",user_id:s.user_id,customer:{name:s.username,contact:q==null?void 0:q.mobile_number,email:q==null?void 0:q.email}};await Ke(a)},ct=(t,a)=>{if(t){const r=`${t.first_name} ${t.last_name}`;A(r),F(!1),c({...s,username:r,user_id:t.user_id})}a&&c(r=>({...r,address_id:a.address_id}))},dt=t=>{t&&c(a=>({...a,address_id:t.address_id}))},ut=()=>{var a,r;const t=(r=(a=s==null?void 0:s.items)==null?void 0:a[0])==null?void 0:r.item_Total;return typeof t=="number"&&t>0?s.items.length:0},mt=()=>{var a,r,o;return Number((r=(a=s==null?void 0:s.items)==null?void 0:a[0])==null?void 0:r.item_Total)>0?(o=s==null?void 0:s.items)==null?void 0:o.reduce((n,u)=>n+Number(u.quantity||0),0):0},pt=t=>{if(!s.sub_total){g.error("Please add items first");return}if(C&&!ae){if(s.normal_delivery_charges&&c(u=>({...u,normal_delivery_charges:null})),!t){c(u=>({...u,total:u.total-u.express_delivery_charges,express_delivery_hour:null,express_delivery_charges:null,normal_delivery_charges:null}));return}const a=`express_delivery_${t}hrs`,r=C[a],o=Number(r)/100;if(isNaN(o)){g.error("Invalid delivery charge percentage!");return}const n=Math.floor(s.sub_total*o);c(u=>({...u,express_delivery_hour:t,express_delivery_charges:n,total:u.sub_total+n}))}else g("Settings data not found!")};i.useEffect(()=>{if(s.express_delivery_hour&&C&&!ae&&s.sub_total>0){const t=`express_delivery_${s.express_delivery_hour}hrs`,a=C[t],r=Number(a)/100;if(!isNaN(r)){const o=Math.floor(s.sub_total*r);c(n=>({...n,express_delivery_charges:o,total:n.sub_total+o}))}}},[s.sub_total]),i.useEffect(()=>{if(!G&&(O!=null&&O.length)&&de&&!je){const t=de.user_branch||[];if(t.length){const a=O.find(r=>r.branch_id===t[0]);a&&c(r=>({...r,branch_id:a.branch_id}))}else c(a=>({...a,branch_id:O[0].branch_id}))}},[G,O,de,je]),i.useEffect(()=>{if(!_e&&B.length>0&&!G){const t=B.find(a=>a.gst_percentage===6);t&&c({...s,company_id:t.company_id})}},[B]);const ht=async()=>{const t=["men","women","kids","household"],a=[...v].sort((n,u)=>{const N=t.indexOf(n.name.toLowerCase()),h=t.indexOf(u.name.toLowerCase());return(N===-1?1/0:N)-(h===-1?1/0:h)})[0];if(!a)return;const r=a==null?void 0:a.category_id;c(n=>{const u=[...n.items];return u[0]={...u[0],category_id:r},{...n,items:u}});let o=M[r];o||(o=await j(r),oe(n=>({...n,[r]:o})))};i.useEffect(()=>{H.pathname==="/order/add"&&(v!=null&&v.length)&&!y&&ht()},[v]);const _t=({express_delivery_charges:t,express_delivery_hour:a})=>{if(ae||!(C!=null&&C.estimate_delivery_normal_day))return null;const r=Number(C==null?void 0:C.estimate_delivery_normal_day);return t&&a?qe().add(a,"hour").format("DD/MM/YYYY"):qe().add(r,"day").format("DD/MM/YYYY")};return i.useEffect(()=>{const t=_t({express_delivery_charges:s==null?void 0:s.express_delivery_charges,express_delivery_hour:s==null?void 0:s.express_delivery_hour});Te(t||null)},[s==null?void 0:s.express_delivery_charges,s==null?void 0:s.express_delivery_hour,C]),Me&&G?e.jsx(Ae,{}):_?e.jsx(Ae,{}):e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"card max-w-5xl mx-auto bg-white shadow-md lg:!p-4 xl:!p-6 sm:!p-5 p-3.5",children:[e.jsxs("div",{className:"flex",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:d?"Edit Order":"Add Order"}),!isNaN(T)&&e.jsxs("button",{className:"btn bg-gray-200 ml-4 text-gray-700 text-sm font-bold rounded-md",onClick:lt,children:[e.jsx(kt,{size:20}),"View Order"]})]}),e.jsxs("form",{onSubmit:Je,children:[e.jsxs("div",{className:"grid md:grid-cols-2 cs1:gap-x-6 gap-x-4  gap-y-5 mt-4 grid-cols-1",children:[e.jsxs("div",{className:"md:!col-span-2 grid md:!grid-cols-3 cs1:gap-x-6 gap-x-4 items-start grid-cols-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"company_id",children:"Company"}),e.jsxs("select",{id:"company_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.company_id||"",onChange:t=>{c({...s,company_id:t.target.value?Number(t.target.value):null})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Company"}),_e?e.jsx("option",{children:"loading..."}):B.length>0?B.map(t=>e.jsx("option",{value:t.company_id,children:`${t.company_name} (${t.gst_percentage}%)`},t.company_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:w.company_id||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"branch",className:"!block text-gray-700 text-sm font-bold mb-2",children:"Branch"}),e.jsxs("select",{id:"branch",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.branch_id||"",onChange:t=>c({...s,branch_id:t.target.value?Number(t.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch"}),O.length>0?O.map(t=>e.jsx("option",{value:t.branch_id,children:t.branch_name},t.branch_id)):e.jsx("option",{children:"No Data Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.branch_id||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"delivery_by",className:"block text-gray-700 text-sm font-bold mb-2",children:"Delivery By"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"delivery_by",value:s.delivery_by||"",onChange:t=>{c({...s,delivery_by:Number(t.target.value)})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Delivery By"}),e.jsx("option",{value:1,children:"Home"}),e.jsx("option",{value:2,children:"Shop"})]})]})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer name"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6 sm:btn-lg",onClick:ot,children:"Add Customer"})]}),e.jsx("input",{type:"text",id:"username",ref:ne,autoComplete:"off",value:f||"",onChange:Qe,className:"input border border-gray-300 rounded-md p-2 w-full mb-2",placeholder:"Search customer...",onFocus:()=>{Se(!0),F(!0)}}),te&&X&&e.jsx("ul",{ref:le,className:"absolute -mt-2 bg-white border z-10 border-gray-300 rounded-md p-2 w-full text-sm max-h-[400px] overflow-y-auto",children:te.length>0?te.map(t=>e.jsxs("li",{className:"p-2 hover:bg-gray-200 cursor-pointer rounded",onClick:()=>We(t),children:[t.first_name," ",t.last_name," (",t.mobile_number,")"]},t.user_id)):e.jsx("li",{className:"p-2 text-gray-500",children:"No users found"})}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.username||" "})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"address",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer address"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6",onClick:nt,children:"Add address"})]}),e.jsxs("select",{id:"address",value:s.address_id??"",onChange:rt,className:"select border border-gray-300 rounded-md w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Address"}),D.length>0&&f?D.map(t=>{const{building_number:a,area:r,landmark:o,city:n,state:u,country:N,pincode:h}=t,S=[a,r,o,n,u,N,h].filter(Boolean).join(", ");return e.jsx("option",{value:t.address_id,children:S},t.address_id)}):e.jsx("option",{disabled:!0,children:"No Address Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.address_id||" "})]})]}),e.jsx("div",{className:"flex flex-wrap",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900 mt-6 mb-5 ml-1",children:"Item"})}),s.items.map((t,a)=>{var r,o;return e.jsx(St.Fragment,{children:e.jsxs("div",{className:"border border-gray-200 rounded-xl mt-4 xl:!p-4 space-y-2 p-3.5 max-w-full overflow-hidden",children:[e.jsx("div",{children:e.jsxs("div",{className:"grid res-item-container",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`category${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Category"}),e.jsxs("select",{id:`category${a}`,value:t.category_id??"",onChange:n=>I(a,"category_id",n.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Category"}),y?e.jsx(e.Fragment,{children:e.jsx("option",{children:"Loading..."})}):v.length>0?v.sort((n,u)=>{const N=["men","women","kids","household"],h=E=>E.trim().toLowerCase(),k=N.indexOf(h(n.name)),S=N.indexOf(h(u.name));return k===-1&&S===-1?n.name.localeCompare(u.name):(k===-1?1/0:k)-(S===-1?1/0:S)}).map(n=>e.jsx("option",{value:n.category_id,children:n.name},n.category_id)):e.jsx("option",{children:"No Category Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].category_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`product${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Product"}),e.jsxs("select",{id:`product${a}`,value:t.product_id??"",onChange:n=>I(a,"product_id",n.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Product"}),t.category_id?b?e.jsx("option",{children:"Loading..."}):((r=M[t.category_id])==null?void 0:r.length)>0?M[t.category_id].map(n=>e.jsx("option",{value:n.product_product_id,children:n.product_name},n.product_product_id)):t.product_id?e.jsx("option",{value:t.product_id,children:t.product_name},t.product_id):e.jsx("option",{children:"No Product Available"}):e.jsx("option",{disabled:!0,children:"Please select a category"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].product_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`service${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Service"}),e.jsxs("select",{id:`service${a}`,value:t.service_id??"",onChange:n=>I(a,"service_id",n.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Service"}),t.product_id?m?e.jsx("option",{children:"Loading..."}):((o=Z[`${t.category_id}_${t.product_id}`])==null?void 0:o.length)>0?Z[`${t.category_id}_${t.product_id}`].map(n=>e.jsx("option",{value:n.service_service_id,children:n.service_name},n.service_service_id)):t.service_id?e.jsx("option",{value:t.service_id,children:t.service_name},t.service_id):e.jsx("option",{children:"No service available"}):e.jsx("option",{disabled:!0,children:"Please select a product"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].service_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`price${a}`,children:"Price"}),e.jsx("input",{type:"text",id:`price${a}`,value:t.price||"",onChange:n=>I(a,"price",Number(n.target.value)),className:"input border rounded-md p-2 w-full border-gray-300 bg-gray-100 text-sm text-gray-600"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].price`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`quantity${a}`,children:"Quantity"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:`quantity${a}`,autoComplete:"off",value:t.quantity??1,onChange:n=>I(a,"quantity",Number(n.target.value)),className:"w-full p-2 text-sm focus:outline-none input text-center"}),e.jsx("button",{type:"button",className:"absolute top-1/2 left-1.5 -translate-y-1/2 p-1 rounded hover:bg-gray-200 transition",onClick:()=>I(a,"quantity",Math.max(1,(t.quantity??1)-1)),children:e.jsx("i",{className:"ki-filled ki-minus text-gray-600 text-base"})}),e.jsx("button",{type:"button",className:"absolute top-1/2 right-1.5 -translate-y-1/2 p-1 rounded hover:bg-gray-200 transition",onClick:()=>I(a,"quantity",(t.quantity??1)+1),children:e.jsx("i",{className:"ki-filled ki-plus text-gray-500 text-base"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Item total"}),e.jsx("input",{type:"text",value:t.item_Total??"",onChange:n=>I(a,"item_Total",n.target.value),min:"0",step:"0.01",readOnly:!0,className:"input w-full border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:!border-gray-300"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:`description_checkbox${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Remarks"}),e.jsx("div",{className:"h-full w-full flex items-center cs2:justify-center justify-start cs2:ml-0 lgmobile:!ml-4 ml-[9px]",children:e.jsx("input",{className:"checkbox checkbox-lg",id:`description_checkbox${a}`,"data-datatable-check":"true",type:"checkbox",checked:t.showDescription,onChange:n=>I(a,"showDescription",n.target.checked)})})]}),e.jsxs("div",{className:"flex flex-col items-center max-w-[40px]",children:[e.jsx("label",{className:"text-gray-700 text-sm font-bold mb-2 lgmobile:block hidden",children:" "}),e.jsx("div",{className:"grow flex justify-center items-center",children:e.jsx("button",{type:"button",className:`p-2 rounded-full ${s.items.length>1?"bg-red-100 hover:bg-red-200":"bg-gray-200 cursor-not-allowed"}`,onClick:()=>tt(a),disabled:s.items.length===1,children:e.jsx($t,{className:`${s.items.length>1?"text-red-500":"text-gray-400"}`})})})]})]})}),e.jsx("div",{className:"flex justify-between sm:items-center smmobile:flex-col gap-y-2 smmobile:w-full",children:e.jsx("div",{children:t.showDescription&&e.jsx("div",{children:e.jsxs("div",{className:"flex mt-2 smmobile:w-[100%] smmobile:justify-self-start flex-col md:w-[350px] lg:w-[420px] sm:w-[300px] h-[80px] mb-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Description"}),e.jsx("textarea",{id:"description",value:t.description||"",onChange:n=>I(a,"description",n.target.value),className:"h-full input border border-gray-300 rounded-md p-2 w-full"})]})})})})]})},a)}),e.jsxs("div",{className:"flex bndesktop:!items-center justify-start cs2:gap-12 sm:!gap-8 flex-wrap bndesktop:!gap-4 gap-2 bndesktop:!flex-row flex-col items-start mb-2",children:[e.jsx("button",{type:"button",onClick:et,className:"btn btn-primary bndesktop:!mb-6 mt-4",children:"Add Item"}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Items : ",ut()]}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Quantity : ",mt()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 cs1:!gap-6 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Order Note"}),e.jsx("textarea",{rows:3,id:"description",value:s.description,onChange:t=>c({...s,description:t.target.value}),className:"h-full input border border-gray-300 rounded-md p-2 w-full"})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"coupon_code",children:"Coupon Code"}),e.jsxs("select",{id:"coupon_code",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.coupon_code??"",onChange:t=>{const a=K.find(r=>r.code===t.target.value);at(a==null?void 0:a.code)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Coupon Code"}),K&&K.length>0?K.map(t=>e.jsxs("option",{value:t.code,children:[t.code," ",s.coupon_code===t.code?"":`(min: ${t.min_cart_value||0})`]},t.coupon_id)):e.jsx("option",{children:"No Coupons available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:w.coupon_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Coupon Discount"}),e.jsx("input",{type:"text",value:s.coupon_discount||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.coupon_discount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Sub Total"}),e.jsx("input",{type:"text",value:s.sub_total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.sub_total||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"kasar_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Kasar amount"}),e.jsx("input",{type:"text",id:"kasar_amount",autoComplete:"off",value:s.kasar_amount||"",onChange:t=>{c({...s,kasar_amount:Number(t.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"flex flex-col md:!col-span-2",children:[e.jsxs("div",{className:"md:!col-span-2 grid sm:!grid-cols-3 cs1:!gap-6 gap-4 grid-cols-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"exp_delivery_time",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Time"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"exp_delivery_time",value:s.express_delivery_hour||"",onChange:t=>{pt(Number(t.target.value))},children:[e.jsx("option",{value:"",children:"Select Express Delivery Time"}),e.jsx("option",{value:24,children:"24 Hrs"}),e.jsx("option",{value:48,children:"48 Hrs"}),e.jsx("option",{value:72,children:"72 Hrs"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"express_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Charge"}),e.jsx("input",{type:"text",id:"express_delivery_charges",autoComplete:"off",min:"0",value:s.express_delivery_charges||"",onChange:t=>Pe("express_delivery_charges",t.target.value),className:`${s.normal_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:s.normal_delivery_charges>0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"normal_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Normal Delivery Charge"}),e.jsx("input",{type:"text",id:"normal_delivery_charges",min:"0",autoComplete:"off",value:s.normal_delivery_charges||"",onChange:t=>Pe("normal_delivery_charges",t.target.value),className:`${s.express_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:s.express_delivery_charges>0})]})]}),ce&&!T&&e.jsx("p",{className:"w-full text-green-500 text-sm font-medium mt-1",children:`Your order will be delivered on ${ce||" "}`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Total"}),e.jsx("input",{type:"text",value:s.total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Method"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_method",value:s.payment_type??"",onChange:t=>c({...s,payment_type:Number(t.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Type"}),e.jsx("option",{value:1,children:"Cash on Delivery"}),e.jsx("option",{value:2,children:"Online Payment"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.payment_type||" "}),!T&&s.payment_type===2&&e.jsx("div",{children:e.jsxs("button",{type:"button",className:"relative min-w-[160px] min-h-[40px] flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 border border-blue-500 rounded-lg hover:bg-blue-100 transition disabled:opacity-50",onClick:it,disabled:we,children:[e.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:we?e.jsx(Tt,{}):e.jsx(It,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{children:"Send Payment Link"})]})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"paid_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Paid amount"}),e.jsx("input",{type:"text",id:"paid_amount",autoComplete:"off",value:s.paid_amount||"",onChange:t=>{c({...s,paid_amount:Number(t.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.paid_amount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_status",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Status"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_status",value:s.payment_status??"",onChange:t=>c({...s,payment_status:Number(t.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Status"}),e.jsx("option",{value:1,children:"Pending"}),e.jsx("option",{value:2,children:"Received"}),e.jsx("option",{value:3,children:"Partial Received"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.payment_status}),s.payment_status===2&&$e>0&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:`Remaining amount Rs ${$e}`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"transaction_id",className:"block text-gray-700 text-sm font-bold mb-2",children:"Transaction ID"}),e.jsx("input",{type:"text",id:"transaction_id",autoComplete:"off",value:s.transaction_id??"",onChange:t=>c({...s,transaction_id:t.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col justify-center items-start",children:[e.jsx("label",{htmlFor:"have_gst_cb",className:"block text-gray-700 text-sm font-bold mb-2",children:"Do you have GSTIN ?"}),e.jsx("input",{className:"checkbox",id:"have_gst_cb",name:"check",type:"checkbox",checked:xe,onChange:t=>{ye(t.target.checked)}})]}),xe&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"gstin",className:"block text-gray-700 text-sm font-bold mb-2",children:"GSTIN"}),e.jsx("input",{type:"text",id:"gstin",autoComplete:"off",value:s.gstin,onChange:t=>c({...s,gstin:t.target.value}),className:"uppercase input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.gstin||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"gst_company_name",className:"block text-gray-700 text-sm font-bold mb-2",children:"Company Name"}),e.jsx("input",{type:"text",id:"gst_company_name",autoComplete:"off",value:s.gst_company_name,onChange:t=>c({...s,gst_company_name:t.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.gst_company_name||" "})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${U||Y?"opacity-50 cursor-not-allowed":""}`,disabled:U||Y,children:U||Y?U?"Adding...":"Updating...":T?"Update Order":"Add Order"}),e.jsx("button",{type:"button",onClick:Xe,className:"btn btn-secondary",disabled:U||Y,children:"Cancel"})]})]}),e.jsx(Et,{onAddressAdded:dt,isOpen:Ge,setIsSubmit:ee,onClose:()=>ge(!1),userId:s.user_id,fullname:s.username}),e.jsx(Lt,{onCustomerCreated:ct,isOpen:Ue,setIsSubmit:ee,onClose:()=>be(!1)})]})})};export{as as default};
