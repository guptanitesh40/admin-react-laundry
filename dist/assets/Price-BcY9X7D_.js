import{r as a,_ as p,u as V,j as e,V as q}from"./index-C2mEiCt6.js";import{u as J}from"./useGetCategories-DAM41bEM.js";import{u as H}from"./useGetProducts-mM3fc3fS.js";import{u as K}from"./useGetServices-CtBeRGCo.js";import{u as Q}from"./useGetPrice-CmzsiXce.js";import{s as W}from"./searchSchema-bo8qmsGV.js";const X="http://3.110.208.70:3000/prices",Y=()=>{const[u,i]=a.useState(!1);return{addPrice:async m=>{const h=localStorage.getItem("authToken");if(m.length===0)return p.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;i(!0);try{const l={prices:m},x=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(l)});if(!x.ok){const n=(await x.json()).message;return p.error(n,{position:"top-center"}),!1}const N=await x.json();return p.success(N.message,{position:"top-center"}),!0}catch(l){return l.name==="TypeError"&&l.message.includes("Failed to fetch")?p.error("Network error: Failed to fetch.",{position:"top-center"}):p.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{i(!1)}},loading:u}},Z=({isSave:u,setIsSave:i})=>{const{categories:g}=J(1,1e3),{products:m}=H(1,1e3),{services:h}=K(1,1e3),{prices:l,loading:x,fetchPrices:N}=Q(),{addPrice:v}=Y(),[n,F]=a.useState({}),[S,y]=a.useState(new Set),C=a.useRef({}),[ee,k]=V(),[c,R]=a.useState(null),[o,b]=a.useState(null),[f,E]=a.useState(""),[w,T]=a.useState(""),[G,$]=a.useState(""),_=a.useCallback((s,r,t,P)=>{const d=[];return s.forEach(I=>{r.forEach(L=>{t.forEach(D=>{const U=`${I.category_id}_${L.product_id}_${D.service_id}`;d.push({category:I,product:L,service:D,price:P[U]||0})})})}),d},[g,m,h,l])(g,m,h,l),A=_.filter(s=>{const r=f.toLowerCase();return s.category.name.toLowerCase().includes(r)||s.product.name.toLowerCase().includes(r)||s.service.name.toLowerCase().includes(r)}).sort((s,r)=>["category","product","service"].includes(c)?o==="ASC"?s[c].name.localeCompare(r[c].name):r[c].name.localeCompare(s[c].name):c==="price"?o==="ASC"?s.price-r.price:r.price-s.price:0),O=s=>{y(r=>{const t=new Set(r);return t.add(s),t})},B=(s,r)=>{F(t=>({...t,[s]:r}))},z=async s=>{s.preventDefault();try{await W.validate({search:w},{abortEarly:!1}),E(w),$("")}catch(r){r instanceof q&&$(r.errors[0])}},j=s=>{c===s?b(o==="ASC"?"DESC":"ASC"):(R(s),b("ASC"))};a.useEffect(()=>{if(u){const s=_.map(r=>{const t=`${r.category.category_id}_${r.product.product_id}_${r.service.service_id}`;return{category_id:r.category.category_id,product_id:r.product.product_id,service_id:r.service.service_id,price:n[t]!==void 0?n[t]:r.price}}).filter(r=>r.price>0);try{v(s),N(),y(new Set)}catch{p.error("Failed to save prices.")}}i(!1)},[u,v,_,n]);const M=s=>{y(r=>{const t=new Set(r);return t.delete(s),t})};return a.useEffect(()=>{var r;const s=Array.from(S);if(s.length>0){const t=s[0];C.current[t]&&((r=C.current[t])==null||r.focus())}},[S]),a.useEffect(()=>{k(f?{search:f}:{})},[f]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-wrap container-fixed",children:e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:z,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:w,onChange:s=>{T(s.target.value),s.target.value===""&&E("")},placeholder:"Search...",className:"min-w-[185px]"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:G||"Â "})]})})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[40px]",children:"Id"}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="category"?o==="ASC"?"asc":"desc":""}`,onClick:()=>j("category"),children:[e.jsx("span",{className:"sort-label",children:"Category"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="product"?o==="ASC"?"asc":"desc":""}`,onClick:()=>j("product"),children:[e.jsx("span",{className:"sort-label",children:"Product"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${c==="service"?o==="ASC"?"asc":"desc":""}`,onClick:()=>j("service"),children:[e.jsx("span",{className:"sort-label",children:"Service"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${c==="price"?o==="ASC"?"asc":"desc":""}`,onClick:()=>j("price"),children:[e.jsx("span",{className:"sort-label",children:"Price"}),e.jsx("span",{className:"sort-icon"})]})})]})}),e.jsx("tbody",{children:A.length>0?A.map((s,r)=>{const t=`${s.category.category_id}_${s.product.product_id}_${s.service.service_id}`,P=S.has(t);return e.jsxs("tr",{className:`font-semibold ${s.price?"":"text-red-500"}`,children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:s.category.name}),e.jsx("td",{children:s.product.name}),e.jsx("td",{children:s.service.name}),e.jsx("td",{className:"relative",children:P?e.jsx("input",{ref:d=>C.current[t]=d,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:n[t]!==void 0?n[t]:s.price||"",onChange:d=>B(t,d.target.value===""?0:Number(d.target.value)),onBlur:()=>M(t)}):e.jsx("span",{className:"cursor-pointer h-full flex",onClick:()=>O(t),children:n[t]!==void 0?n[t]:s.price||"Add Price"})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})]})},le=()=>{const[u,i]=a.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-3",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price"})}),e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{onClick:()=>i(!0),className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})})]})}),e.jsx(Z,{isSave:u,setIsSave:i})]})};export{le as default};
