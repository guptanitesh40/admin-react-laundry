import{r as i,B as j,V as h,a as T,l as _,w as $,d as A,j as e,b as F,e as S,T as I,F as D,f as B}from"./index-4Ya-CA-9.js";import{M as U}from"./index-DgLsXZkc.js";import{u as z}from"./useGetServices-C2XM2APy.js";import{S as y}from"./sweetalert2.esm.all-B0Dix5B2.js";const L=()=>{const[c,s]=i.useState([]),[o,n]=i.useState(!1),l=async()=>{const t=localStorage.getItem("authToken");n(!0);try{const a=await fetch(`${j}/price-content`,{method:"GET",headers:{Authorization:t?`Bearer ${t}`:""}}),r=await a.json();if(!a.ok){h.error(r.message,{position:"top-center"}),n(!1);return}s(r==null?void 0:r.data)}catch{h.error("Network Error : Failed to fetch prices")}finally{n(!1)}};return i.useEffect(()=>{l()},[]),{priceContents:c,loading:o,fetchPriceContents:l}},q=()=>{const[c,s]=i.useState(),[o,n]=i.useState(!1);return{priceContent:c,loading:o,fetchPriceContent:async t=>{const a=localStorage.getItem("authToken");n(!0);try{const r=await fetch(`${j}/price-content/${t}`,{method:"GET",headers:{Authorization:a?`Bearer ${a}`:""}}),m=await r.json();if(!r.ok){h.error(m.message,{position:"top-center"}),n(!1);return}s(m==null?void 0:m.data)}catch{h.error("Network Error : Failed to fetch data")}finally{n(!1)}}}},G=()=>{const[c,s]=i.useState(!1);return{addPriceContent:async n=>{const l=localStorage.getItem("authToken");s(!0);try{const t=await fetch(`${j}/price-content`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),a=await t.json();return t.ok?(h.success(a.message,{position:"top-center"}),!0):(h.error(a.message,{position:"top-center"}),!1)}catch{h.error("Error adding Price content",{position:"top-center"})}finally{s(!1)}},loading:c}},M=()=>{const[c,s]=i.useState(!1);return{updatePriceContent:async(n,l)=>{const t=localStorage.getItem("authToken");s(!0);try{const a=await fetch(`${j}/price-content/${n}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),r=await a.json();return a.ok?(h.success(r.message,{position:"top-center"}),!0):(h.error(r.message,{position:"top-center"}),!1)}catch{return h.error("Error Updating price content",{position:"top-center"}),!1}finally{s(!1)}},loading:c}},O=()=>{const[c,s]=i.useState(!1);return{deletePriceContent:async n=>{const l=localStorage.getItem("authToken");s(!0);try{const t=await fetch(`${j}/price-content/${n}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}),a=await t.json();return t.ok?{success:!0,message:a.message}:(h.error(a.message,{position:"top-center"}),{success:!1,message:a.message})}catch(t){return h.error(t.message,{position:"top-center"}),{success:!1,message:t.message}}finally{s(!1)}},loading:c}},V=T().shape({category_name:A().required("Category is required"),service_names:$().min(1,"Please select service name").required("Please select servuce name"),price:_().typeError("Maximum usage per user must be a number").required("Please enter price")}),R=({isOpen:c,onClose:s,price_content_id:o,setIsSubmit:n})=>{const{services:l}=z(1,1e3),{priceContent:t,fetchPriceContent:a}=q(),{addPriceContent:r,loading:m}=G(),{updatePriceContent:u,loading:g}=M(),[p,f]=i.useState({category_name:"",service_names:[],price:null}),[k,N]=i.useState({category_name:"",service_names:[],price:null}),[C,v]=i.useState({}),P=l.map(d=>({name:d.name}));i.useEffect(()=>{c&&o&&a(o)},[c,o]),i.useEffect(()=>{if(c&&t&&o){const d={category_name:t.category_name,service_names:t.service_names,price:t.price};f(d),N(d)}else f({category_name:"",service_names:[],price:null}),N({category_name:"",service_names:[],price:null}),v({})},[c,t,o]);const E=async d=>{d.preventDefault();try{if(await V.validate(p,{abortEarly:!1}),!Object.keys(p).some(b=>p[b]!==k[b])){s();return}o?await u(o,p):await r(p),n(!0),s()}catch(x){if(x instanceof F){const b={};x.inner.forEach(w=>{b[w.path||""]=w.message}),v(b)}else h.error("Failed to submit the form. Please try again.")}};return c?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:s}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[480px] ban:w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:s,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:o?"Update Price":"Add Price"}),e.jsx("form",{onSubmit:E,children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"category",className:"mb-1 block text-gray-700 font-semibold",children:"Category name"}),e.jsx("input",{type:"text",id:"category",name:"category",autoComplete:"off",className:"input border border-gray-300 rounded-md p-2 w-full",value:p.category_name??"",onChange:d=>f({...p,category_name:d.target.value})}),e.jsx("p",{className:"text-red-500 text-sm",children:C.category_name||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"service",className:"mb-1 block text-gray-700 font-semibold",children:"Service name"}),e.jsx(U,{options:P,displayValue:"name",selectedValues:P.filter(d=>p.service_names.includes(d.name)),onSelect:d=>{f({...p,service_names:d.map(x=>x.name)})},onRemove:d=>{f({...p,service_names:d.map(x=>x.name)})},isObject:!0}),e.jsx("p",{className:"text-red-500 text-sm",children:C.service_names||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"price",className:"mb-1 block text-gray-700 font-semibold",children:"Price"}),e.jsx("input",{type:"text",id:"price",name:"price",autoComplete:"off",className:"input border border-gray-300 rounded-md p-2 w-full",value:p.price??"",onChange:d=>f({...p,price:Number(d.target.value)})}),e.jsx("p",{className:"text-red-500 text-sm",children:C.price||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${m||g?"opacity-50 cursor-not-allowed":""}`,disabled:m||g,children:m||g?m?"Adding...":"Updating...":o?"Update Price":"Add Price"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:s,disabled:m||g,children:"Cancel"})]})]})})]})]}):null},J=({isSubmit:c,setIsSubmit:s,setUpdateItem:o})=>{const{priceContents:n,fetchPriceContents:l,loading:t}=L(),{deletePriceContent:a}=O(),{hasPermission:r}=S();i.useEffect(()=>{(async()=>{c&&(l(),s(!1))})()},[c]);const m=async u=>{try{const{isConfirmed:g}=await y.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(g){const{success:p,message:f}=await a(u);p?(l(),y.fire(f)):y.fire(f)}}catch(g){y.fire({title:"Error",text:g.message,icon:"error"})}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-5 lg:gap-5.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[30px]",children:"Id"}),e.jsx("th",{className:"min-w-[120px]",children:"Category"}),e.jsx("th",{className:"min-w-[120px]",children:"Service"}),e.jsx("th",{className:"min-w-[60px]",children:"Price"}),(r(11,"update")||r(11,"delete"))&&e.jsx("th",{className:"w-[50px]",children:"Actions"})]})}),t?e.jsx(I,{}):n?e.jsx("tbody",{children:n.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.price_content_id}),e.jsx("td",{children:u.category_name}),e.jsx("td",{children:u.service_names.join(", ")}),e.jsx("td",{children:u.price}),(r(11,"update")||r(11,"delete"))&&e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[r(11,"update")&&e.jsx("button",{className:"bg-yellow-100 hover:bg-yellow-200 p-2 rounded-full",onClick:()=>o(u.price_content_id),children:e.jsx(D,{className:"text-yellow-600"})}),r(11,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-2 rounded-full",onClick:()=>m(u.price_content_id),children:e.jsx(B,{className:"text-red-500"})})]})})]},u.price_content_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No price data available"})})})]})})})})})})},W=()=>{const[c,s]=i.useState(!1),[o,n]=i.useState(null),[l,t]=i.useState(!1),{hasPermission:a}=S(),r=()=>{s(!0),n(null)},m=u=>{n(u),s(!0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container-fixed",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Content"}),a(11,"create")&&e.jsxs("button",{className:"btn btn-primary",onClick:r,children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Price"]})]}),e.jsx(J,{isSubmit:l,setIsSubmit:t,setUpdateItem:m}),e.jsx(R,{isOpen:c,onClose:()=>s(!1),price_content_id:o,setIsSubmit:t})]})})};export{W as default};
