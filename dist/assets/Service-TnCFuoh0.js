import{r as a,_ as x,j as e,V as L,u as U,F as _,b as z,d as M,e as V}from"./index-jKd1kMjl.js";import{p as G}from"./productSchema-DFdnFsaL.js";import{u as O}from"./useGetServices-Cpqt4-f8.js";import{S as D}from"./sweetalert2.esm.all-DwEdJQJv.js";import{F as T,a as I,s as Y}from"./searchSchema-Bkc3hwST.js";import{T as q}from"./TableShimmer-BIB_f2x6.js";const W=()=>{const[d,s]=a.useState(!1),[o,h]=a.useState(null);return{service:o,loading:d,fetchService:async t=>{var m;if(!t){h(null);return}const n=localStorage.getItem("authToken"),c=`http://35.154.167.170:3000/admin/services/${t}`;s(!1);try{const u=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!u.ok){const S=await u.json();x.error(S.message,{position:"top-center"}),s(!1);return}const i=await u.json();h((m=i==null?void 0:i.data)==null?void 0:m.service)}catch{x.error("Network error: Failed to fetch.")}finally{s(!1)}}}},Z="http://35.154.167.170:3000/admin/services",H=()=>{const[d,s]=a.useState(!1);return{addService:async h=>{const r=localStorage.getItem("authToken");s(!0);try{const t=await fetch(Z,{method:"POST",headers:{Authorization:r?`Bearer ${r}`:""},body:h});if(!t.ok){const m=(await t.json()).message;return x.error(m,{position:"top-center"}),!1}const n=await t.json();return x.success(n.message,{position:"top-center"}),!0}catch(t){return t.name==="TypeError"&&t.message.includes("Failed to fetch")?x.error("Network error: Failed to fetch.",{position:"top-center"}):x.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{s(!1)}},loading:d}},J=()=>{const[d,s]=a.useState(!1),o=localStorage.getItem("authToken");return{deleteService:async r=>{s(!0);const t=`http://35.154.167.170:3000/admin/services/${r}`;try{if(!o)return x.error("No authentication token found",{position:"top-center"}),s(!1),{success:!1,message:"No authentication token found"};const n=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}}),c=await n.json();return n.ok?{success:!0,message:c.message}:(x.error(c.message,{position:"top-center"}),{success:!1,message:c.message})}catch(n){return{success:!1,message:n.message}}finally{s(!1)}},loading:d}},K=()=>{const[d,s]=a.useState(!1);return{updateService:async(h,r)=>{s(!0);const t=`http://35.154.167.170:3000/admin/services/${h}`;try{const n=localStorage.getItem("authToken");if(!n)return x.error("No authentication token found",{position:"top-center"}),s(!1),!1;const c=await fetch(t,{method:"PUT",headers:{Authorization:`Bearer ${n}`},body:r});if(c.ok){const m=await c.json();return x.success(m.message,{position:"top-center"}),!0}else{const u=(await c.json()).message;return x.error(u,{position:"top-center"}),!1}}finally{s(!1)}},loading:d}},Q=({isOpen:d,onClose:s,service_id:o,setIsSubmit:h})=>{const{addService:r,loading:t}=H(),{updateService:n,loading:c}=K(),{service:m,fetchService:u}=W(),[i,S]=a.useState({name:"",image:""}),[b,N]=a.useState({name:"",image:""}),[C,E]=a.useState({});a.useEffect(()=>{d&&o&&u(o)},[d,o]),a.useEffect(()=>{if(d&&m&&o){const g={name:m.name,image:m.image};S(g),N(g)}else S({name:"",image:""}),N({name:"",image:""}),E({})},[d,m]);const y=g=>{const{name:k,value:v,files:f}=g.target;k==="image"&&f&&f.length>0?S(w=>({...w,image:f[0]})):S(w=>({...w,[k]:v}))},p=async g=>{g.preventDefault();try{if(await G(!!o).validate(i,{abortEarly:!1}),!Object.keys(i).some(w=>w==="image"?i.image instanceof File||i.image!==b.image:i[w]!==b[w])){s();return}const f=new FormData;f.append("name",i.name),i.image instanceof File&&f.append("image",i.image),o?await n(o,f):await r(f),h(!0),s()}catch(k){if(k instanceof L){const v={};k.inner.forEach(f=>{v[f.path||""]=f.message}),E(v)}else x.error("Failed to submit the form. Please try again.")}};return d?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:s}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96 z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:s,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:o?"Edit Service":"Add Service"}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:i.name,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:C.name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"image",children:"Image"}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:y,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:C.image||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${t||c?"opacity-50 cursor-not-allowed":""}`,disabled:t||c,children:t||c?t?"Adding...":"Updating...":o?"Update Service":"Add Service"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:s,disabled:t||c,children:"Cancel"})]})]})]})]}):null},X=({search:d,isSubmit:s,setIsSubmit:o,setEditService:h})=>{const[r,t]=a.useState(1),[n,c]=a.useState(10),[m,u]=U(),[i,S]=a.useState(null),[b,N]=a.useState(null),C=m.get("page"),E=m.get("perPage"),{services:y,totalServices:p,fetchServices:g,loading:k}=O(r,n,d,i,b),v=Math.ceil(p/n),{deleteService:f}=J();a.useEffect(()=>{s&&(g(),o(!1))},[s,g]);const w=async l=>{try{const{isConfirmed:j}=await D.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(j){const{success:B,message:F}=await f(l);B?(y.filter(R=>R.service_id!==l).length===0&&r>1&&(t(r-1),u({page:(r-1).toString(),perPage:n.toString()})),await g(),D.fire(F)):D.fire(F)}}catch(j){D.fire({title:"Error",text:j.message,icon:"error"})}};a.useEffect(()=>{d&&(t(1),u({search:d,page:"1",perPage:n.toString()}))},[d]),a.useEffect(()=>{C&&t(Number(C)),E&&c(Number(E))},[C,E]);const P=l=>{i===l?N(b==="ASC"?"DESC":"ASC"):(S(l),N("ASC"))},A=l=>{l>=1&&l<=v&&(t(l),u({page:l.toString(),perPage:n.toString()}))},$=l=>{const j=Number(l.target.value);c(j),t(1),u({page:"1",perPage:j.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:n,onChange:$,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>P("service_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(T,{color:i==="service_id"&&b==="ASC"?"gray":"lightgray"}),e.jsx(I,{color:i==="service_id"&&b==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>P("name"),children:["Service Name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(T,{color:i==="name"&&b==="ASC"?"gray":"lightgray"}),e.jsx(I,{color:i==="name"&&b==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex justify-between",children:["Image",e.jsx("div",{className:"flex "})]})}),e.jsx("th",{className:"w-[125px]",children:"Actions"})]})}),k?e.jsx(q,{}):y.length>0?e.jsx("tbody",{children:y.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.service_id}),e.jsx("td",{children:l.name}),e.jsx("td",{children:e.jsx("img",{alt:l.name,className:"rounded-lg size-20 shrink-0",src:l.image})}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>h(l.service_id),children:e.jsx(_,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>w(l.service_id),children:e.jsx(z,{className:"text-red-500"})})]})]},l.service_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"No services available"})})})]})})})})}),p>n&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",y.length," of ",p," Services"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:r===1,onClick:()=>A(r-1),className:`btn ${r===1?"disabled":""}`,children:e.jsx(M,{})}),Array.from({length:v}).map((l,j)=>e.jsx("button",{className:`btn ${r===j+1?"active":""}`,onClick:()=>A(j+1),children:j+1},j)),e.jsx("button",{disabled:r===v,onClick:()=>A(r+1),className:`btn ${r===v?"disabled":""}`,children:e.jsx(V,{})})]})]})]})},ie=()=>{const[d,s]=a.useState(""),[o,h]=a.useState(""),[r,t]=a.useState(!1),[n,c]=a.useState(null),[m,u]=a.useState(!1),[i,S]=a.useState(!1),[b,N]=a.useState(""),C=()=>{u(!1),t(!0),c(null)},E=p=>{u(!0),c(p),t(!0)},y=async p=>{p.preventDefault();try{await Y.validate({search:o},{abortEarly:!1}),s(o),N("")}catch(g){g instanceof L&&N(g.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Services"}),e.jsxs("button",{onClick:C,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Service"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:y,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:o,onChange:p=>{h(p.target.value),p.target.value===""&&s("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:b||" "})]}),e.jsx(X,{search:d,isSubmit:i,setIsSubmit:S,setEditService:E}),e.jsx(Q,{setIsSubmit:S,isOpen:r,onClose:()=>t(!1),service_id:n})]})};export{ie as default};
