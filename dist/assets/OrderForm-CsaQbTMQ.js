import{r as y,B as Ne,V as O,a as Pe,x as xt,m as z,d as ee,y as ve,z as bt,A as yt,C as _t,j as e,b as Ie,n as vt,t as jt,q as Nt,D as wt,v as St,i as kt,o as Ct,f as At,L as Pt,E as It}from"./index-Bh52HvmB.js";import{u as Ot}from"./useGetCategories-D7mXv9oO.js";import{u as Tt}from"./useGetPrice-CjSwwwQU.js";import{u as Dt}from"./useGetOrder-xj2is2ts.js";import{u as Et,c as Ft}from"./userSchema-nzgHBkie.js";import{u as qt}from"./useGetuser-DIViwlb6.js";const $t=()=>{const[d,c]=y.useState(!1);return{loading:d,fetchProductsOnId:async x=>{const b=localStorage.getItem("authToken");c(!0);try{const l=await fetch(`${Ne}/category/${x}/product`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}}),h=await l.json();if(!l.ok){O.error(h.message,{position:"top-center"}),c(!1);return}return(h==null?void 0:h.data)||[]}catch(l){return O.error((l==null?void 0:l.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{c(!1)}}}},Lt=()=>{const[d,c]=y.useState(!1);return{loading:d,fetchServicesOnId:async(x,b)=>{const l=localStorage.getItem("authToken");c(!0);try{const h=await fetch(`${Ne}/category/${x}/product/${b}/service`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}),u=await h.json();if(!h.ok){O.error(u.message,{position:"top-center"}),c(!1);return}return(u==null?void 0:u.data)||[]}catch(h){return O.error((h==null?void 0:h.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{c(!1)}}}},Rt="http://3.110.208.70:3000/admin/coupon/apply",Ut=()=>{const[d,c]=y.useState(!1);return{applyCoupon:async(x,b,l)=>{const h=localStorage.getItem("authToken");c(!0);try{const u=await fetch(Rt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({user_id:x,order_Total:b,coupon_code:l})}),i=await u.json();return u.ok?i.data:(O.error(i.message,{position:"top-center"}),!1)}catch{O.error("Unable to apply coupon code!")}finally{c(!1)}},loading:d}},Mt=()=>{const[d,c]=y.useState([]),[v,x]=y.useState(!1),b=async l=>{const h=localStorage.getItem("authToken");x(!0);try{const u=await fetch(`${Ne}/admin/valid-coupons?${l}`,{method:"GET",headers:{Authorization:h?`Bearer ${h}`:""}}),i=await u.json();if(!u.ok){O.error(i.message,{position:"top-center"}),x(!1);return}c(i==null?void 0:i.data)}catch{O.error("Network error: Failed to fetch coupons.")}finally{x(!1)}};return y.useEffect(()=>{b()},[]),{validCoupons:d,fetchValidCoupons:b,loading:v}},Bt="http://3.110.208.70:3000",Gt=`${Bt}/admin/orders`,Kt=()=>{const[d,c]=y.useState(!1);return{addOrder:async x=>{const b=localStorage.getItem("authToken");c(!0);try{const l=await fetch(Gt,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify(x)});if(!l.ok){const u=await l.json();return O.error(u.message,{position:"top-center"}),!1}const h=await l.json();return O.success(h.message,{position:"top-center"}),!0}catch(l){return O.error((l==null?void 0:l.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{c(!1)}},loading:d}},zt=()=>{const[d,c]=y.useState(!1);return{updateOrder:async(x,b)=>{const l=localStorage.getItem("authToken"),h=`http://3.110.208.70:3000/admin/orders/${x}`;c(!0);try{const u=await fetch(h,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(b)});if(u.ok){const C=await u.json();return O.success(C.message,{position:"top-center"}),!0}const i=await u.json();return O.error(i.message,{position:"top-center"}),!1}catch(u){return O.error((u==null?void 0:u.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{c(!1)}},loading:d}},Vt=()=>{const[d,c]=y.useState([]),[v,x]=y.useState(!1);return{address:d,loading:v,fetchAddress:async l=>{var i;const h=localStorage.getItem("authToken"),u=`http://3.110.208.70:3000/address/${l}/user`;try{const C=await fetch(u,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});if(!C.ok){const j=await C.json();O.error(j.message,{position:"top-center"});return}const S=await C.json(),F=((i=S==null?void 0:S.data)==null?void 0:i.result)||[];c(F)}catch(C){O.error((C==null?void 0:C.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{x(!1)}}}},Ht=Pe().shape({category_id:z().nullable().required("Please select a category").test("required","Please select a category",d=>!!d),product_id:z().nullable().required("Please select a product").test("required","Please select a product",d=>!!d),service_id:z().nullable().required("Please select a service").test("required","Please select a service",d=>!!d),price:z().nullable().when(["category_id","product_id","service_id"],([d,c,v],x)=>d&&c&&v?x.required("Price is not available for the combination, please add a price"):x.nullable())}),Wt=Pe().shape({username:ee().required("Please enter username"),address_id:z().required("Please select address").test("required","Please select address",d=>!!d),express_delivery_charges:z().typeError("Express delivery charges must be a number").min(0,"Express delivery charges must be a positive number"),shipping_charges:z().typeError("Shipping charge must be a number").min(0,"Shipping charge must be a positive number"),payment_type:z().required("Please choose payment type").test("required","Please choose payment type",d=>!!d),payment_status:z().required("Please choose payment status").test("required","Please choose payment status",d=>!!d),paid_amount:z().typeError("Paid amount must be a number").min(0,"Paid amount must be a positive number").test("max-paid","Paid amount cannot be greater than the total amount",function(d){var c;return d==null||d===0?!0:d<=((c=this.options.context)==null?void 0:c.total)}),branch_id:z().required("Please select branch").test("required","Please select branch",d=>!!d),items:xt().of(Ht)}),ze=()=>{const[d,c]=y.useState(!1);return{addAddress:async(x,b=!0)=>{var h;const l=localStorage.getItem("authToken");c(!0);try{const u=await fetch(`${Ne}/address/admin`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(x)}),i=await u.json();return u.ok?(b&&O.success(i.message,{position:"top-center"}),(h=i==null?void 0:i.data)==null?void 0:h.result):(b&&O.error(i.message,{position:"top-center"}),!1)}catch(u){return O.error((u==null?void 0:u.message)||"Error adding banner",{position:"top-center"}),!1}finally{c(!1)}},loading:d}},Ve=Pe().shape({pincode:ee().required("Pin Code is required").matches(/^[0-9]{6}$/,"Pincode must be 6 digit"),address_type:z().required("Address type is required"),building_number:ee().required("Building number is required"),area:ee().required("Area is required"),city:ee().required("City is required"),state:ee().required("State is required"),country:ee().required("Country is required"),landmark:ee().required("Landmark is required")});var W={},je={},Ae,Ue;function Jt(){if(Ue)return Ae;Ue=1;var d="Expected a function",c=NaN,v="[object Symbol]",x=/^\s+|\s+$/g,b=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,h=/^0o[0-7]+$/i,u=parseInt,i=typeof ve=="object"&&ve&&ve.Object===Object&&ve,C=typeof self=="object"&&self&&self.Object===Object&&self,S=i||C||Function("return this")(),F=Object.prototype,j=F.toString,T=Math.max,V=Math.min,N=function(){return S.Date.now()};function g(r,p,k){var D,$,J,B,G,M,P=0,pe=!1,K=!1,ae=!0;if(typeof r!="function")throw new TypeError(d);p=f(p)||0,A(k)&&(pe=!!k.leading,K="maxWait"in k,J=K?T(f(k.maxWait)||0,p):J,ae="trailing"in k?!!k.trailing:ae);function le(E){var H=D,X=$;return D=$=void 0,P=E,B=r.apply(X,H),B}function ie(E){return P=E,G=setTimeout(te,p),pe?le(E):B}function we(E){var H=E-M,X=E-P,he=p-H;return K?V(he,J-X):he}function ge(E){var H=E-M,X=E-P;return M===void 0||H>=p||H<0||K&&X>=J}function te(){var E=N();if(ge(E))return Q(E);G=setTimeout(te,we(E))}function Q(E){return G=void 0,ae&&D?le(E):(D=$=void 0,B)}function de(){G!==void 0&&clearTimeout(G),P=0,D=M=$=G=void 0}function ce(){return G===void 0?B:Q(N())}function se(){var E=N(),H=ge(E);if(D=arguments,$=this,M=E,H){if(G===void 0)return ie(M);if(K)return G=setTimeout(te,p),le(M)}return G===void 0&&(G=setTimeout(te,p)),B}return se.cancel=de,se.flush=ce,se}function A(r){var p=typeof r;return!!r&&(p=="object"||p=="function")}function s(r){return!!r&&typeof r=="object"}function a(r){return typeof r=="symbol"||s(r)&&j.call(r)==v}function f(r){if(typeof r=="number")return r;if(a(r))return c;if(A(r)){var p=typeof r.valueOf=="function"?r.valueOf():r;r=A(p)?p+"":p}if(typeof r!="string")return r===0?r:+r;r=r.replace(x,"");var k=l.test(r);return k||h.test(r)?u(r.slice(2),k?2:8):b.test(r)?c:+r}return Ae=g,Ae}var ue={},Me;function Qt(){return Me||(Me=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.compose=function(){for(var c=arguments.length,v=Array(c),x=0;x<c;x++)v[x]=arguments[x];return function(){for(var b=arguments.length,l=Array(b),h=0;h<b;h++)l[h]=arguments[h];v.forEach(function(u){return u&&u.apply(void 0,l)})}},ue.pick=function(c){for(var v=arguments.length,x=Array(v>1?v-1:0),b=1;b<v;b++)x[b-1]=arguments[b];return x.reduce(function(l,h){return c&&c.hasOwnProperty(h)&&(l[h]=c[h]),l},{})}),ue}var Be;function Xt(){if(Be)return je;Be=1,Object.defineProperty(je,"__esModule",{value:!0});var d=Object.assign||function(N){for(var g=1;g<arguments.length;g++){var A=arguments[g];for(var s in A)Object.prototype.hasOwnProperty.call(A,s)&&(N[s]=A[s])}return N},c=function(){function N(g,A){for(var s=0;s<A.length;s++){var a=A[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(g,a.key,a)}}return function(g,A,s){return A&&N(g.prototype,A),s&&N(g,s),g}}(),v=bt(),x=C(v),b=yt(),l=C(b),h=Jt(),u=C(h),i=Qt();function C(N){return N&&N.__esModule?N:{default:N}}function S(N,g){if(!(N instanceof g))throw new TypeError("Cannot call a class as a function")}function F(N,g){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:N}function j(N,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);N.prototype=Object.create(g&&g.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(N,g):N.__proto__=g)}var T=function(g){return{mainText:g.main_text,secondaryText:g.secondary_text}},V=function(N){j(g,N);function g(A){S(this,g);var s=F(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,A));return s.init=function(){if(!window.google)throw new Error("[react-places-autocomplete]: Google Maps JavaScript API library must be loaded. See: https://github.com/kenny-hibino/react-places-autocomplete#load-google-library");if(!window.google.maps.places)throw new Error("[react-places-autocomplete]: Google Maps Places library must be loaded. Please add `libraries=places` to the src URL. See: https://github.com/kenny-hibino/react-places-autocomplete#load-google-library");s.autocompleteService=new window.google.maps.places.AutocompleteService,s.autocompleteOK=window.google.maps.places.PlacesServiceStatus.OK,s.setState(function(a){return a.ready?null:{ready:!0}})},s.autocompleteCallback=function(a,f){if(s.setState({loading:!1}),f!==s.autocompleteOK){s.props.onError(f,s.clearSuggestions);return}var r=s.props.highlightFirstSuggestion;s.setState({suggestions:a.map(function(p,k){return{id:p.id,description:p.description,placeId:p.place_id,active:!!(r&&k===0),index:k,formattedSuggestion:T(p.structured_formatting),matchedSubstrings:p.matched_substrings,terms:p.terms,types:p.types}})})},s.fetchPredictions=function(){var a=s.props.value;a.length&&(s.setState({loading:!0}),s.autocompleteService.getPlacePredictions(d({},s.props.searchOptions,{input:a}),s.autocompleteCallback))},s.clearSuggestions=function(){s.setState({suggestions:[]})},s.clearActive=function(){s.setState({suggestions:s.state.suggestions.map(function(a){return d({},a,{active:!1})})})},s.handleSelect=function(a,f,r){s.clearSuggestions(),s.props.onSelect?s.props.onSelect(a,f,r):s.props.onChange(a)},s.getActiveSuggestion=function(){return s.state.suggestions.find(function(a){return a.active})},s.selectActiveAtIndex=function(a){var f=s.state.suggestions.find(function(r){return r.index===a}).description;s.setActiveAtIndex(a),s.props.onChange(f)},s.selectUserInputValue=function(){s.clearActive(),s.props.onChange(s.state.userInputValue)},s.handleEnterKey=function(){var a=s.getActiveSuggestion();a===void 0?s.handleSelect(s.props.value,null,null):s.handleSelect(a.description,a.placeId,a)},s.handleDownKey=function(){if(s.state.suggestions.length!==0){var a=s.getActiveSuggestion();a===void 0?s.selectActiveAtIndex(0):a.index===s.state.suggestions.length-1?s.selectUserInputValue():s.selectActiveAtIndex(a.index+1)}},s.handleUpKey=function(){if(s.state.suggestions.length!==0){var a=s.getActiveSuggestion();a===void 0?s.selectActiveAtIndex(s.state.suggestions.length-1):a.index===0?s.selectUserInputValue():s.selectActiveAtIndex(a.index-1)}},s.handleInputKeyDown=function(a){switch(a.key){case"Enter":a.preventDefault(),s.handleEnterKey();break;case"ArrowDown":a.preventDefault(),s.handleDownKey();break;case"ArrowUp":a.preventDefault(),s.handleUpKey();break;case"Escape":s.clearSuggestions();break}},s.setActiveAtIndex=function(a){s.setState({suggestions:s.state.suggestions.map(function(f,r){return r===a?d({},f,{active:!0}):d({},f,{active:!1})})})},s.handleInputChange=function(a){var f=a.target.value;if(s.props.onChange(f),s.setState({userInputValue:f}),!f){s.clearSuggestions();return}s.props.shouldFetchSuggestions&&s.debouncedFetchPredictions()},s.handleInputOnBlur=function(){s.mousedownOnSuggestion||s.clearSuggestions()},s.getActiveSuggestionId=function(){var a=s.getActiveSuggestion();return a?"PlacesAutocomplete__suggestion-"+a.placeId:void 0},s.getIsExpanded=function(){return s.state.suggestions.length>0},s.getInputProps=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(a.hasOwnProperty("value"))throw new Error("[react-places-autocomplete]: getInputProps does not accept `value`. Use `value` prop instead");if(a.hasOwnProperty("onChange"))throw new Error("[react-places-autocomplete]: getInputProps does not accept `onChange`. Use `onChange` prop instead");var f={type:"text",autoComplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":s.getIsExpanded(),"aria-activedescendant":s.getActiveSuggestionId(),disabled:!s.state.ready};return d({},f,a,{onKeyDown:(0,i.compose)(s.handleInputKeyDown,a.onKeyDown),onBlur:(0,i.compose)(s.handleInputOnBlur,a.onBlur),value:s.props.value,onChange:function(p){s.handleInputChange(p)}})},s.getSuggestionItemProps=function(a){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=s.handleSuggestionMouseEnter.bind(s,a.index),p=s.handleSuggestionClick.bind(s,a);return d({},f,{key:a.id,id:s.getActiveSuggestionId(),role:"option",onMouseEnter:(0,i.compose)(r,f.onMouseEnter),onMouseLeave:(0,i.compose)(s.handleSuggestionMouseLeave,f.onMouseLeave),onMouseDown:(0,i.compose)(s.handleSuggestionMouseDown,f.onMouseDown),onMouseUp:(0,i.compose)(s.handleSuggestionMouseUp,f.onMouseUp),onTouchStart:(0,i.compose)(s.handleSuggestionTouchStart,f.onTouchStart),onTouchEnd:(0,i.compose)(s.handleSuggestionMouseUp,f.onTouchEnd),onClick:(0,i.compose)(p,f.onClick)})},s.handleSuggestionMouseEnter=function(a){s.setActiveAtIndex(a)},s.handleSuggestionMouseLeave=function(){s.mousedownOnSuggestion=!1,s.clearActive()},s.handleSuggestionMouseDown=function(a){a.preventDefault(),s.mousedownOnSuggestion=!0},s.handleSuggestionTouchStart=function(){s.mousedownOnSuggestion=!0},s.handleSuggestionMouseUp=function(){s.mousedownOnSuggestion=!1},s.handleSuggestionClick=function(a,f){f&&f.preventDefault&&f.preventDefault();var r=a.description,p=a.placeId;s.handleSelect(r,p,a),setTimeout(function(){s.mousedownOnSuggestion=!1})},s.state={loading:!1,suggestions:[],userInputValue:A.value,ready:!A.googleCallbackName},s.debouncedFetchPredictions=(0,u.default)(s.fetchPredictions,A.debounce),s}return c(g,[{key:"componentDidMount",value:function(){var s=this.props.googleCallbackName;if(s){var a=window.google&&window.google.maps&&window.google.maps.places;a?this.init():window[s]=this.init}else this.init()}},{key:"componentWillUnmount",value:function(){var s=this.props.googleCallbackName;s&&window[s]&&delete window[s]}},{key:"render",value:function(){return this.props.children({getInputProps:this.getInputProps,getSuggestionItemProps:this.getSuggestionItemProps,loading:this.state.loading,suggestions:this.state.suggestions})}}]),g}(x.default.Component);return V.propTypes={onChange:l.default.func.isRequired,value:l.default.string.isRequired,children:l.default.func.isRequired,onError:l.default.func,onSelect:l.default.func,searchOptions:l.default.shape({bounds:l.default.object,componentRestrictions:l.default.object,location:l.default.object,offset:l.default.oneOfType([l.default.number,l.default.string]),radius:l.default.oneOfType([l.default.number,l.default.string]),types:l.default.array}),debounce:l.default.number,highlightFirstSuggestion:l.default.bool,shouldFetchSuggestions:l.default.bool,googleCallbackName:l.default.string},V.defaultProps={onError:function(g,A){return console.error(`[react-places-autocomplete]: error happened when fetching data from Google Maps API.
Please check the docs here (https://developers.google.com/maps/documentation/javascript/places#place_details_responses)
Status: `,g)},searchOptions:{},debounce:200,highlightFirstSuggestion:!1,shouldFetchSuggestions:!0},je.default=V,je}var oe={},Ge;function Yt(){return Ge||(Ge=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.geocodeByAddress=function(c){var v=new window.google.maps.Geocoder,x=window.google.maps.GeocoderStatus.OK;return new Promise(function(b,l){v.geocode({address:c},function(h,u){u!==x&&l(u),b(h)})})},oe.getLatLng=function(c){return new Promise(function(v,x){try{var b={lat:c.geometry.location.lat(),lng:c.geometry.location.lng()};v(b)}catch(l){x(l)}})},oe.geocodeByPlaceId=function(c){var v=new window.google.maps.Geocoder,x=window.google.maps.GeocoderStatus.OK;return new Promise(function(b,l){v.geocode({placeId:c},function(h,u){u!==x&&l(u),b(h)})})}),oe}var Ke;function Zt(){if(Ke)return W;Ke=1,Object.defineProperty(W,"__esModule",{value:!0}),W.getLatLng=W.geocodeByPlaceId=W.geocodeByAddress=void 0;var d=Xt(),c=x(d),v=Yt();function x(b){return b&&b.__esModule?b:{default:b}}return W.geocodeByAddress=v.geocodeByAddress,W.geocodeByPlaceId=v.geocodeByPlaceId,W.getLatLng=v.getLatLng,W.default=c.default,W}var me=Zt();const He=_t(me),es=({isOpen:d,onClose:c,userId:v,setIsSubmit:x,onAddressAdded:b,fullname:l})=>{const{addAddress:h,loading:u}=ze(),[i,C]=y.useState({}),[S,F]=y.useState(!1),[j,T]=y.useState({building_number:"",area:"",lat:null,long:null,landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,address_type:null,full_name:""}),[V,N]=y.useState(!1);y.useEffect(()=>{d?v&&T(a=>({...a,user_id:v,full_name:l})):(T({building_number:"",area:"",landmark:"",pincode:"",city:"",lat:null,long:null,state:"",country:"",user_id:null,address_type:null,full_name:""}),C({}))},[d,v]);const g=a=>{T({...j,area:a}),N(!0)},A=async a=>{T({...j,area:a});try{const f=await me.geocodeByAddress(a),r=await me.getLatLng(f[0]);r&&T(p=>({...p,lat:r==null?void 0:r.lat,long:r==null?void 0:r.lng}))}catch{O.error("Failed to fetch address detail",{className:"toast-error"})}},s=async a=>{a.preventDefault();try{if(await Ve.validate(j,{abortEarly:!1}),v){const f=await h(j);f&&(b(f),c(),x(!0))}}catch(f){if(f instanceof Ie){const r={};f.inner.forEach(p=>{r[p.path||""]=p.message}),C(r)}else O.error("Failed to submit the form. Please try again.")}};if(d)return e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:c}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-lg max-w-lg smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:c,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Add New Address"}),e.jsxs("form",{onSubmit:s,children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm",onChange:a=>T({...j,address_type:Number(a.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"Building Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:j.building_number,onChange:a=>T({...j,building_number:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Area"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(He,{value:j.area,onChange:g,onSelect:A,children:({getInputProps:a,suggestions:f,getSuggestionItemProps:r,loading:p})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...a({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>N(!0),onBlur:()=>N(!1)})}),V&&f.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[p&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!p&&f.map((k,D)=>{const{...$}=r(k);return e.jsx("li",{...$,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:k==null?void 0:k.description},D)})]})})]})})}),i.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.area||" "})||S&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:j.landmark,onChange:a=>T({...j,landmark:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:j.pincode,onChange:a=>T({...j,pincode:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:j.city,onChange:a=>T({...j,city:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:j.state,onChange:a=>T({...j,state:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:j.country,onChange:a=>T({...j,country:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:i.country||" "})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:c,className:"btn btn-light mr-2",disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:`btn btn-primary ${u?"opacity-50 cursor-not-allowed":""}`,children:u?"Submitting...":"Submit"})]})]})]})]})},ts=({isOpen:d,onClose:c,setIsSubmit:v,onCustomerCreated:x})=>{const{addUser:b,loading:l}=Et(),{addAddress:h,loading:u}=ze(),[i,C]=y.useState({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),[S,F]=y.useState({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),[j,T]=y.useState({}),[V,N]=y.useState(!1),[g,A]=y.useState(!1);y.useEffect(()=>{d||(C({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),F({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),T({}))},[d]);const s=r=>{F({...S,area:r}),A(!0)},a=async r=>{F({...S,area:r});try{const p=await me.geocodeByAddress(r),k=await me.getLatLng(p[0]);k&&F(D=>({...D,lat:k==null?void 0:k.lat,long:k==null?void 0:k.lng}))}catch{O.error("Failed to fetch address detail",{className:"toast-error"})}},f=async r=>{r.preventDefault();try{await Ft().validate(i,{abortEarly:!1}),await Ve.validate(S,{abortEarly:!1});const p=await b(i);if(p!=null&&p.user_id){const k={...S,user_id:p.user_id,full_name:`${p.first_name} ${p.last_name}`},D=await h(k,!1);D&&(x(p,D),c(),v(!0))}}catch(p){if(p instanceof Ie){const k={};p.inner.forEach(D=>{k[D.path||""]=D.message}),T(k)}else O.error("Failed to submit the form. Please try again.")}};return d?e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:c}),e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-5xl w-full smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:c,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsxs("form",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Customer Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-gray-700 font-semibold",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",autoComplete:"off",value:i.first_name||"",onChange:r=>C({...i,first_name:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:j.first_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-gray-700 font-semibold",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",autoComplete:"off",value:i.last_name,onChange:r=>C({...i,last_name:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:j.last_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:i.email,onChange:r=>C({...i,email:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:j.email||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobile_number",className:"block text-gray-700 font-semibold",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:i.mobile_number,onChange:r=>C({...i,mobile_number:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:j.mobile_number||" "})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"mb-2 block text-gray-700 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:i.gender===1,onChange:r=>C({...i,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:i.gender===2,onChange:r=>C({...i,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:i.gender===3,onChange:r=>C({...i,gender:parseInt(r.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:j.gender||" "})]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm w-full p-2 border border-gray-300 rounded-md",onChange:r=>F({...S,address_type:Number(r.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"Building Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:S.building_number,onChange:r=>F({...S,building_number:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Area"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(He,{value:S.area,onChange:s,onSelect:a,children:({getInputProps:r,suggestions:p,getSuggestionItemProps:k,loading:D})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...r({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>A(!0),onBlur:()=>A(!1)})}),g&&p.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[D&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!D&&p.map(($,J)=>{const{...B}=k($);return e.jsx("li",{...B,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:$==null?void 0:$.description},J)})]})})]})})}),j.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.area||" "})||V&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:S.landmark,onChange:r=>F({...S,landmark:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:S.pincode,onChange:r=>F({...S,pincode:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:S.city,onChange:r=>F({...S,city:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:S.state,onChange:r=>F({...S,state:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:S.country,onChange:r=>F({...S,country:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:j.country||" "})]})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:c,className:"btn btn-light mr-2",disabled:l||u,children:"Cancel"}),e.jsx("button",{type:"button",onClick:f,disabled:l||u,className:`btn btn-primary ${l||u?"opacity-50 cursor-not-allowed":""}`,children:l||u?"Submitting...":"Submit"})]})]})]})]}):null},is=()=>{var Fe;const{prices:d}=Tt(),{categories:c,loading:v}=Ot(),{fetchProductsOnId:x,loading:b}=$t(),{fetchServicesOnId:l,loading:h}=Lt(),[u,i]=y.useState(""),[C,S]=y.useState(!0),{id:F}=vt(),{updateOrder:j,loading:T}=zt(),{addOrder:V,loading:N}=Kt(),g=Number(F),A=1e3,s=1,[a,f]=y.useState(!1),[r,p]=y.useState(!1),[k,D]=y.useState(!1),{users:$,fetchUsersByRole:J}=jt(),{validCoupons:B,fetchValidCoupons:G}=Mt(),{branches:M}=Nt(s,A),{order:P,fetchOrder:pe}=Dt(),{address:K,fetchAddress:ae}=Vt(),{applyCoupon:le}=Ut(),{userData:ie,fetchUser:we}=qt(),{generatePaymentLink:ge,loading:te}=wt(),Q=ie==null?void 0:ie.user,de=St(),ce=((Fe=de==null?void 0:de.state)==null?void 0:Fe.prevUrl)||"/orders",se=y.useRef(null),[E,H]=y.useState({}),[X,he]=y.useState({}),Se=y.useRef(null),[Oe,Te]=y.useState(!1),[De,ke]=y.useState(null),fe=kt(),[n,I]=y.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:1,payment_type:1,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null}),[We,Je]=y.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:null,payment_type:null,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null}),[R,Qe]=y.useState({});y.useEffect(()=>{const t=o=>{Se.current&&!Se.current.contains(o.target)&&se.current&&!se.current.contains(o.target)&&(S(!1),Te(!1))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),y.useEffect(()=>{(async()=>{await pe(g)})()},[g]),y.useEffect(()=>{M&&M.length&&I(t=>({...t,branch_id:M[0].branch_id}))},[M]),y.useEffect(()=>{if(K&&K.length>0){const t=K.find(o=>o.is_default);I(o=>({...o,address_id:t?t.address_id:null}))}},[K]),y.useEffect(()=>{(async()=>{n.user_id&&(await ae(n.user_id),await G(n.user_id),await we(n.user_id)),k&&(await ae(n.user_id),D(!1))})()},[n.user_id,k]),y.useEffect(()=>{g||I(t=>({...t,payment_status:n.payment_type===1?1:null}))},[n.payment_type]),y.useEffect(()=>{(async()=>{Oe&&(!u||u.trim()==="")?(S(!0),await J(5)):u&&C&&await J(5,u)})()},[Oe,u,C]),y.useEffect(()=>{if(P){const t=`${P.user.first_name} ${P.user.last_name}`;i(t),S(!1);const o={coupon_code:P.coupon_code||"",coupon_discount:P.coupon_discount||null,express_delivery_charges:P.express_delivery_charges||null,normal_delivery_charges:P.normal_delivery_charges||null,payment_type:P.payment_type||null,payment_status:P.payment_status||null,sub_total:P.sub_total||0,paid_amount:P.paid_amount||null,kasar_amount:P.kasar_amount||null,transaction_id:P.transaction_id||"",address_id:P.address_id,username:t,user_id:P.user_id||null,items:P.items.map(m=>{var xe,ne,be,q;const w=m.category.category_id,_=((xe=m.product)==null?void 0:xe.product_id)||null,U=((ne=m.service)==null?void 0:ne.service_id)||null,L=((be=m.product)==null?void 0:be.name)||"",re=((q=m.service)==null?void 0:q.name)||"";return{category_id:w,product_id:_,service_id:U,product_name:L,service_name:re,description:m.description||null,price:m.price,quantity:m.quantity,item_Total:m.price*m.quantity,showDescription:!!m.description}}),total:(P.sub_total||0)+(P.express_delivery_charges||0)+(P.normal_delivery_charges||0),branch_id:P.branch_id,order_status:P.order_status};I(o),Je(o)}},[P]),y.useEffect(()=>{const t=(n.paid_amount||0)+(n.kasar_amount||0),o=n.total-t;let m=n.payment_status;n.total>0&&t===n.total?(m=2,ke(0)):t>0&&t<n.total?(m=3,ke(o)):t===0&&n.total>0&&(m=1,ke(o)),I(w=>({...w,payment_status:m}))},[n.paid_amount,n.kasar_amount,n.total]);const Xe=async t=>{t.preventDefault();try{const o=n.items.map(L=>({category_id:Number(L.category_id),product_id:Number(L.product_id),service_id:Number(L.service_id),description:L.description,price:Number(L.price),quantity:Number(L.quantity)})),m={...n,address_id:Number(n.address_id),coupon_discount:Number(n.coupon_discount),normal_delivery_charges:Number(n.normal_delivery_charges),kasar_amount:Number(n.kasar_amount),paid_amount:Number(n.paid_amount),express_delivery_charges:Number(n.express_delivery_charges),payment_type:Number(n.payment_type),payment_status:Number(n.payment_status),order_status:g?n.order_status:4,items:o},w=n.total;if(await Wt.validate(m,{abortEarly:!1,context:{total:w}}),!Object.keys(n).some(L=>n[L]!==We[L])){fe(`${ce}`);return}let U;P?U=await j(g,m):U=await V(m),U&&fe(`${ce}`)}catch(o){if(o instanceof Ie){const m={};o.inner.forEach(w=>{m[w.path||""]=w.message}),Qe(m)}else O.error("Failed to submit the form. Please try again.")}},Ye=t=>{i(t.target.value),S(!0)},Ze=t=>{const o=`${t.first_name} ${t.last_name}`;i(o),S(!1),I({...n,username:o,user_id:t.user_id})},et=()=>{fe(`${ce}`)},tt=()=>{I(t=>({...t,items:[...t.items,{category_id:null,product_id:null,product_name:"",service_id:null,service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}]}))},st=t=>{I(o=>{const m=o.items.filter((L,re)=>re!==t),w={...o,items:m,coupon_code:"",coupon_discount:0},_=Ce(w),U=_+Number(n.express_delivery_charges||0)+Number(n.normal_delivery_charges||0);return{...w,sub_total:_,total:U}})},Z=async(t,o,m)=>{["category_id","product_id","service_id","price","quantity"].includes(o)&&I(w=>({...w,coupon_code:"",coupon_discount:0})),I(w=>{const _=w.items.map((ne,be)=>{if(be===t){const q={...ne,[o]:m};o==="showDescription"&&(q.showDescription=m);const qe=Number(q.category_id),$e=Number(q.product_id),Le=Number(q.service_id),Re=Number(q.quantity)||1;if(o==="category_id"){const Y=Number(m);E[Y]||x(Y).then(ye=>{H(_e=>({..._e,[Y]:ye}))}),q.product_id=null,q.service_id=null}if(o==="product_id"){const Y=Number(ne.category_id),ye=Number(m),_e=`${Y}_${ye}`;X[_e]||l(Y,ye).then(ht=>{he(ft=>({...ft,[_e]:ht}))}),q.service_id=null}if(["category_id","product_id","service_id"].includes(o))if(qe&&$e&&Le){const Y=at(qe,$e,Le);q.price=Y,q.item_Total=Y*Re}else q.price=null,q.item_Total=null;else o==="price"?q.item_Total=m*Re:o==="quantity"&&(q.item_Total=q.price*Number(m));return q}return ne}),U={...w,items:_},re=Ce(U)-w.coupon_discount,xe=re+Number(w.express_delivery_charges||0)+Number(w.normal_delivery_charges||0);return{...U,sub_total:re,total:xe}})},at=(t,o,m)=>{const w=`${t}_${o}_${m}`;return d[w]||0},rt=async t=>{const o=Ce(n),m=await le(n.user_id,o,t),w=Number(m.finalTotal||0)+Number(n.express_delivery_charges||0)+Number(n.normal_delivery_charges||0);m&&I(_=>({..._,coupon_code:t,coupon_discount:m.discountAmount,sub_total:m.finalTotal,total:w})),n.express_delivery_hour&&(O("yes..."),I(_=>{let U=0;n.express_delivery_hour===24?U=.5:n.express_delivery_hour===48?U=.25:n.express_delivery_hour===72&&(U=.1);const L=Math.floor(_.sub_total*U);return{..._,express_delivery_charges:L,total:_.sub_total+L}}))},Ce=t=>t.items.reduce((o,m)=>o+(m.item_Total||0),0),Ee=(t,o)=>{I(m=>{const w={...m,[t]:o},_=Number(w.sub_total||0)+Number(w.express_delivery_charges||0)+Number(w.normal_delivery_charges||0);return{...w,total:_}})},nt=t=>{const o=t.target.value;I(m=>({...m,address_id:Number(o)}))},ot=t=>{t.preventDefault(),n.user_id?f(!0):O.error("Please select the user to add address")},lt=t=>{t.preventDefault(),p(!0)},it=()=>{fe(`/order/${g}`)},dt=async()=>{const t=[];if(n.total||t.push("item total"),n.username||t.push("customer name"),t.length>0){O.error(`Please add required fields: ${t.join(", ")}`);return}const o={amount:n.total,currency:"INR",user_id:n.user_id,customer:{name:n.username,contact:Q==null?void 0:Q.mobile_number,email:Q==null?void 0:Q.email}};await ge(o)},ct=(t,o)=>{if(t){const m=`${t.first_name} ${t.last_name}`;i(m),S(!1),I({...n,username:m,user_id:t.user_id})}o&&I(m=>({...m,address_id:o.address_id}))},ut=t=>{t&&I(o=>({...o,address_id:t.address_id}))},mt=()=>(n==null?void 0:n.items[0].item_Total)>0?n.items.length:0,pt=()=>(n==null?void 0:n.items[0].item_Total)>0?n==null?void 0:n.items.reduce((t,o)=>t+=Number(o.quantity),0):0,gt=t=>{if(n.normal_delivery_charges&&I(w=>({...w,normal_delivery_charges:null})),!t){I(w=>({...w,express_delivery_hour:null,express_delivery_charges:null,normal_delivery_charges:null}));return}let o=0;t===24?o=.5:t===48?o=.25:t===72&&(o=.1);const m=Math.floor(n.sub_total*o);I(w=>({...w,express_delivery_hour:t,express_delivery_charges:m,total:w.sub_total+m}))};return e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"card max-w-5xl mx-auto p-6 bg-white shadow-md",children:[e.jsxs("div",{className:"flex",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:P?"Edit Order":"Add Order"}),!isNaN(g)&&e.jsxs("button",{className:"btn bg-gray-200 ml-4 text-gray-700 text-sm font-bold rounded-md",onClick:it,children:[e.jsx(Ct,{size:20}),"View Order"]})]}),e.jsxs("form",{onSubmit:Xe,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-y-1 gap-x-6 mt-4",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"branch",className:"block text-gray-700 text-sm font-bold mb-2",children:"Branch"}),e.jsxs("select",{id:"branch",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n.branch_id||"",onChange:t=>I({...n,branch_id:t.target.value?Number(t.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch"}),M.length>0?M.map(t=>e.jsx("option",{value:t.branch_id,children:t.branch_name},t.branch_id)):e.jsx("option",{children:"No Data Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.branch_id||" "})]}),e.jsx("div",{}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer name"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6 sm:btn-lg",onClick:lt,children:"Add Customer"})]}),e.jsx("input",{type:"text",id:"username",ref:se,autoComplete:"off",value:u||"",onChange:Ye,className:"input border border-gray-300 rounded-md p-2 w-full mb-2",placeholder:"Search customer...",onFocus:()=>{Te(!0),S(!0)}}),$&&C&&e.jsx("ul",{ref:Se,className:"absolute -mt-2 bg-white border z-10 border-gray-300 rounded-md p-2 w-full text-sm max-h-[400px] overflow-y-auto",children:$.length>0?$.map(t=>e.jsxs("li",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>Ze(t),children:[t.first_name," ",t.last_name," (",t.mobile_number,")"]},t.user_id)):e.jsx("li",{className:"p-2 text-gray-500",children:"No users found"})}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.username||" "})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"address",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer address"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6",onClick:ot,children:"Add address"})]}),e.jsxs("select",{id:"address",value:n.address_id??"",defaultValue:"",onChange:nt,className:"select border border-gray-300 rounded-md w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Address"}),K.length>0?K.map(t=>e.jsxs("option",{value:t.address_id,children:[t.building_number,", ",t.area,", ",t.landmark,","," ",t.city,", ",t.state,",",t.country,", ",t.pincode]},t.address_id)):e.jsx("option",{disabled:!0,children:"No Address Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.address_id||" "})]})]}),e.jsx("div",{className:"flex flex-wrap",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900 mt-6 mb-5 ml-1",children:"Item"})}),n.items.map((t,o)=>{var m,w;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border border-gray-200 rounded-xl mt-4 p-4 space-y-2",children:[e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-[minmax(150px,1fr)_minmax(150px,1fr)_minmax(150px,1fr)_minmax(50px,1fr)_minmax(50px,1fr)_minmax(50px,1fr)_minmax(35px,0.75fr)_minmax(35px,0.5fr)] gap-x-5 gap-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-gray-700 text-sm font-bold mb-2",children:"Category"}),e.jsxs("select",{id:"category",value:t.category_id??"",onChange:_=>Z(o,"category_id",_.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Category"}),v?e.jsx(e.Fragment,{children:e.jsx("option",{children:"Loading..."})}):c.length>0?c.map(_=>e.jsx("option",{value:_.category_id,children:_.name},_.category_id)):e.jsx("option",{children:"No Category Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R[`items[${o}].category_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"product",className:"block text-gray-700 text-sm font-bold mb-2",children:"Product"}),e.jsxs("select",{id:"product",value:t.product_id??"",onChange:_=>Z(o,"product_id",_.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Product"}),t.category_id?b?e.jsx("option",{children:"Loading..."}):((m=E[t.category_id])==null?void 0:m.length)>0?E[t.category_id].map(_=>e.jsx("option",{value:_.product_product_id,children:_.product_name},_.product_product_id)):t.product_id?e.jsx("option",{value:t.product_id,children:t.product_name},t.product_id):e.jsx("option",{children:"No Product Available"}):e.jsx("option",{disabled:!0,children:"Please select a category"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R[`items[${o}].product_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"service",className:"block text-gray-700 text-sm font-bold mb-2",children:"Service"}),e.jsxs("select",{id:"service",value:t.service_id??"",onChange:_=>Z(o,"service_id",_.target.value),className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Service"}),t.product_id?h?e.jsx("option",{children:"Loading..."}):((w=X[`${t.category_id}_${t.product_id}`])==null?void 0:w.length)>0?X[`${t.category_id}_${t.product_id}`].map(_=>e.jsx("option",{value:_.service_service_id,children:_.service_name},_.service_service_id)):t.service_id?e.jsx("option",{value:t.service_id,children:t.service_name},t.service_id):e.jsx("option",{children:"No service available"}):e.jsx("option",{disabled:!0,children:"Please select a product"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R[`items[${o}].service_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Price"}),e.jsx("input",{type:"text",value:t.price||"",onChange:_=>Z(o,"price",_.target.value),className:`input border rounded-md p-2 w-full ${isNaN(g)?"border-gray-300 bg-gray-100 text-sm text-gray-600 cursor-not-allowed focus:outline-none":"border-gray-300"}`,readOnly:isNaN(g)}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R[`items[${o}].price`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"quantity",children:"Quantity"}),e.jsx("input",{type:"text",id:"quantity",autoComplete:"off",value:t.quantity??1,onChange:_=>Z(o,"quantity",_.target.value),className:"input border border-gray-300 rounded-md p-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Item total"}),e.jsx("input",{type:"text",value:t.item_Total??"",onChange:_=>Z(o,"item_Total",_.target.value),min:"0",step:"0.01",readOnly:!0,className:"input w-full border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"description_checkbox",className:"block text-gray-700 text-sm font-bold mb-2",children:"Remarks"}),e.jsx("div",{className:"h-full flex items-center",children:e.jsx("input",{className:"checkbox checkbox-lg ml-5",id:"description_checkbox","data-datatable-check":"true",type:"checkbox",checked:t.showDescription,onChange:_=>Z(o,"showDescription",_.target.checked)})})]}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("button",{type:"button",className:`p-2 rounded-full ${n.items.length>1?"bg-red-100 hover:bg-red-200":"bg-gray-200 cursor-not-allowed"}`,onClick:()=>st(o),disabled:n.items.length===1,children:e.jsx(At,{className:`${n.items.length>1?"text-red-500":"text-gray-400"}`})})})]})},o),e.jsx("div",{className:"flex justify-between sm:items-center smmobile:flex-col gap-y-2 smmobile:w-full",children:e.jsx("div",{children:t.showDescription&&e.jsx("div",{children:e.jsxs("div",{className:"flex mt-2 smmobile:w-[100%] smmobile:justify-self-start flex-col md:w-[350px] lg:w-[420px] sm:w-[300px] h-[80px] mb-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Description"}),e.jsx("textarea",{id:"description",value:t.description||"",onChange:_=>Z(o,"description",_.target.value),className:"h-full input border border-gray-300 rounded-md p-2 w-full"})]})})})})]})})}),e.jsxs("div",{className:"flex items-center justify-start gap-12 flex-wrap",children:[e.jsx("button",{type:"button",onClick:tt,className:"btn btn-secondary mb-6 mt-4",children:"Add Item"}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Items : ",mt()]}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Quantity : ",pt()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"coupon_code",children:"Coupon Code"}),e.jsxs("select",{id:"coupon_code",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n.coupon_code??"",onChange:t=>{const o=B.find(m=>m.code===t.target.value);rt(o==null?void 0:o.code)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Coupon Code"}),B&&B.length>0?B.map(t=>e.jsx("option",{value:t.code,children:t.code},t.coupon_id)):e.jsx("option",{children:"No Coupons available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:R.coupon_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Coupon Discount"}),e.jsx("input",{type:"text",value:n.coupon_discount||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.coupon_discount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Sub Total"}),e.jsx("input",{type:"text",value:n.sub_total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.sub_total||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"kasar_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Kasar amount"}),e.jsx("input",{type:"text",id:"kasar_amount",autoComplete:"off",value:n.kasar_amount||"",onChange:t=>{I({...n,kasar_amount:Number(t.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"col-span-2 grid grid-cols-4 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"delivery_by",className:"block text-gray-700 text-sm font-bold mb-2",children:"Delivery By"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"delivery_by",value:n.delivery_by||"",onChange:t=>{I({...n,delivery_by:Number(t.target.value)})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Delivery By"}),e.jsx("option",{value:1,children:"Home"}),e.jsx("option",{value:2,children:"Shop"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"exp_delivery_time",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Time"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"exp_delivery_time",value:n.express_delivery_hour||"",onChange:t=>{gt(Number(t.target.value))},children:[e.jsx("option",{value:"",children:"Select Express Delivery Time"}),e.jsx("option",{value:24,children:"24 Hrs"}),e.jsx("option",{value:48,children:"48 Hrs"}),e.jsx("option",{value:72,children:"72 Hrs"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"express_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Charge"}),e.jsx("input",{type:"text",id:"express_delivery_charges",autoComplete:"off",min:"0",value:n.express_delivery_charges||"",onChange:t=>Ee("express_delivery_charges",t.target.value),className:`${n.normal_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:n.normal_delivery_charges>0}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.express_delivery_charges||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"normal_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Normal Delivery Charge"}),e.jsx("input",{type:"text",id:"normal_delivery_charges",min:"0",autoComplete:"off",value:n.normal_delivery_charges||"",onChange:t=>Ee("normal_delivery_charges",t.target.value),className:`${n.express_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:n.express_delivery_charges>0}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.normal_delivery_charges||" "})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Total"}),e.jsx("input",{type:"text",value:n.total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Method"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_method",value:n.payment_type??"",onChange:t=>I({...n,payment_type:Number(t.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Type"}),e.jsx("option",{value:1,children:"Cash on Delivery"}),e.jsx("option",{value:2,children:"Online Payment"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.payment_type||" "}),!g&&n.payment_type===2&&e.jsx("div",{children:e.jsxs("button",{type:"button",className:"relative min-w-[160px] min-h-[40px] flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 border border-blue-500 rounded-lg hover:bg-blue-100 transition disabled:opacity-50",onClick:dt,disabled:te,children:[e.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:te?e.jsx(Pt,{}):e.jsx(It,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{children:"Send Payment Link"})]})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"paid_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Paid amount"}),e.jsx("input",{type:"text",id:"paid_amount",autoComplete:"off",value:n.paid_amount||"",onChange:t=>{I({...n,paid_amount:Number(t.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.paid_amount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_status",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Status"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_status",value:n.payment_status??"",onChange:t=>I({...n,payment_status:Number(t.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Status"}),e.jsx("option",{value:1,children:"Pending"}),e.jsx("option",{value:2,children:"Received"}),e.jsx("option",{value:3,children:"Partial Received"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:R.payment_status}),n.payment_status===2&&De>0&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:`Remaining amount Rs ${De}`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"transaction_id",className:"block text-gray-700 text-sm font-bold mb-2",children:"Transaction ID"}),e.jsx("input",{type:"text",id:"transaction_id",autoComplete:"off",value:n.transaction_id??"",onChange:t=>I({...n,transaction_id:t.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${N||T?"opacity-50 cursor-not-allowed":""}`,disabled:N||T,children:N||T?N?"Adding...":"Updating...":g?"Update Order":"Add Order"}),e.jsx("button",{type:"button",onClick:et,className:"btn btn-secondary",disabled:N||T,children:"Cancel"})]})]}),e.jsx(es,{onAddressAdded:ut,isOpen:a,setIsSubmit:D,onClose:()=>f(!1),userId:n.user_id,fullname:n.username}),e.jsx(ts,{onCustomerCreated:ct,isOpen:r,setIsSubmit:D,onClose:()=>p(!1)})]})})};export{is as default};
