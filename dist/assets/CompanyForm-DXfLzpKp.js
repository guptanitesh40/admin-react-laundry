import{r as j,V as N,a as A,h as w,d,m as E,q as L,n as T,i as z,j as e,L as $,k as O,b as R}from"./index-hNZfDtfv.js";import{u as U}from"./useGetCompany-IDooX2ij.js";import{au as G,av as Y}from"./AdapterDayjs-CKzc--Nx.js";import{D as I}from"./DatePicker-CJaw_kV7.js";const M="http://35.154.167.170:3000",B=`${M}/companies`,H=()=>{const[h,t]=j.useState(!1);return{addCompany:async m=>{const g=localStorage.getItem("authToken");t(!0);try{const o=new FormData;Object.entries(m).forEach(([n,b])=>{b&&(b instanceof FileList?o.append(n,b[0]):o.append(n,b))});const r=await fetch(B,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:o});if(!r.ok){const n=await r.json();return N.error(n.message,{position:"top-center"}),!1}const y=await r.json();return N.success(y.message,{position:"top-center"}),!0}catch(o){return N.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{t(!1)}},loading:h}},Z=()=>{const[h,t]=j.useState(!1);return{updateCompany:async(m,g)=>{const o=localStorage.getItem("authToken"),r=`http://35.154.167.170:3000/companies/${m}`,y=new FormData;for(const n in g)g[n]&&(n==="logo"||n==="contract_document"||n==="signature_image"?g[n]instanceof File&&y.append(n,g[n]):y.append(n,g[n]));t(!0);try{const n=await fetch(r,{method:"PUT",headers:{Authorization:`Bearer ${o}`},body:y});if(n.ok){const a=await n.json();return N.success(a.message,{position:"top-center"}),!0}const b=await n.json();return N.error(b.message,{position:"top-center"}),!1}catch(n){return N.error(n.message,{position:"top-center"}),!1}finally{t(!1)}},loading:h}},J=(h=!1)=>A().shape({company_name:d().required("Company name is required").test("required","Company name is required",t=>!!t),address:d().required("Address is required").test("required","Address is required",t=>!!t),city:d().required("City is required").test("required","City is required",t=>!!t),state:d().required("State is required").test("required","State is required",t=>!!t),zip_code:d().test("required","Zip Code is required",t=>!(t===null||t==="")).test("format","Zip Code must be a 6 digit number",t=>t===null||t===""?!0:/^[0-9]{6}$/.test(t)),company_owner_name:d().required("Company Owner Name is required").test("required","Company Owner Name is required",t=>!!t),phone_number:d().nullable().test("required","Please add phone number",t=>!(t===null||t==="")).test("is-numeric","Phone number must be a positive number",t=>t?/^[0-9+\-\s()]{5,15}$/.test(t):!0).test("length","Phone number must be between 5 to 15 long",t=>t?t.length>=5&&t.length<=15:!0),mobile_number:d().nullable().test("is-numeric","Phone number must be a positive number",t=>t?/^[0-9+\-\s()]{5,15}$/.test(t):!0).test("length","Phone number must be between 5 to 15 long",t=>t?t.length>=5&&t.length<=15:!0),email:d().required("Email is required").email("Enter a valid email").test("required","Email is required",t=>!!t),website:d().nullable().url("Please enter a valid website URL").test("required","Website URL is required",t=>!!t),logo:w().nullable().test("required","Logo is required",t=>h?!0:!!t).test("fileType","Allowed Format : jpg, jpeg, png, ",t=>t&&t instanceof File?["image/jpeg","image/png","image/jpg"].includes(t.type):!0).test("dimensions","Logo must be 92×92 pixels",t=>!t||!(t instanceof File)?!0:new Promise(f=>{const m=new Image;m.src=URL.createObjectURL(t),m.onload=()=>{URL.revokeObjectURL(m.src),f(m.width===92&&m.height===92)},m.onerror=()=>{f(!1)}})),registration_number:d().nullable().test("required","Registration Number is required",t=>!!t),registration_date:L().nullable().required("Please select the registration date").typeError("Please select the registration date").max(new Date,"Registration Date cannot be in the future"),gstin:d().nullable().test("required","GSTIN is required",t=>!!t),gst_percentage:E().transform((t,f)=>f===""?void 0:t).min(0,"GST Percentage cannot be less than 0").max(100,"GST Percentage cannot be more than 100").typeError("GST Percentage must be a number").required("GST Percentage is required"),hsn_sac_code:d().matches(/^\d+$/,"HSN/SAC Code must contain only digits").required("HSN/SAC Code is required"),company_ownedby:d().nullable().test("required","Company Owned By is required",t=>!(t===null||t==="")).test("format","Company Owned By must be a number",t=>t===null||t===""?!0:/^[0-9]+$/.test(t)),contract_document:w().nullable().test("fileSize","File is too large",t=>t&&t instanceof File?t.size<=5e6:!0).test("fileType","Unsupported file format",t=>t&&t instanceof File?["application/pdf"].includes(t.type):!0),signature_image:w().nullable().test("required","Auth signature image is required",t=>h?!0:!!t).test("fileType","Allowed Format : jpg, jpeg, png, ",t=>t&&t instanceof File?["image/jpeg","image/png","image/jpg"].includes(t.type):!0)}),X=()=>{const{addCompany:h,loading:t}=H(),{updateCompany:f,loading:m}=Z(),{id:g}=T(),o=Number(g),{company:r,fetchCompany:y,loading:n}=U(),b=z(),[a,_]=j.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null,gst_percentage:"",hsn_sac_code:"",signature_image:null}),[q,S]=j.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null,gst_percentage:"",hsn_sac_code:"",signature_image:null}),[s,v]=j.useState({});j.useEffect(()=>{(async()=>{await y(o)})()},[o]),j.useEffect(()=>{if(r){const i={company_name:r.company_name,address:r.address,city:r.city,state:r.state,zip_code:r.zip_code,company_owner_name:r.company_owner_name,phone_number:r.phone_number,mobile_number:r.mobile_number,email:r.email,website:r.website,logo:r.logo,registration_number:r.registration_number,registration_date:r.registration_date,gstin:r.gstin,company_ownedby:r.company_ownedby,contract_document:r.contract_document,gst_percentage:r.gst_percentage,hsn_sac_code:r.hsn_sac_code,signature_image:r.signature_image};_(i),S(i)}},[r]);const l=i=>{const c=i.target;if(c instanceof HTMLInputElement){const{name:u,value:p,files:x}=c;u==="image"&&x&&x.length>0?_(C=>({...C,logo:x[0]})):_(C=>({...C,[u]:p}))}else if(c instanceof HTMLTextAreaElement){const{name:u,value:p}=c;_(x=>({...x,[u]:p}))}},k=i=>{_(c=>({...c,registration_date:i?i.format("MM-DD-YYYY"):""}))},P=async i=>{i.preventDefault();try{if(await J(!!o).validate(a,{abortEarly:!1}),!Object.keys(a).some(x=>x==="logo"?a.logo instanceof File||a.logo!==q.logo:a[x]!==q[x])){b("/companies");return}let p;o?p=await f(o,a):p=await h(a),p&&b("/companies")}catch(c){if(c instanceof R){const u={};c.inner.forEach(p=>{u[p.path]=p.message}),v(u)}else N.error("Failed to submit the form. Please try again.")}},F=i=>{const{name:c,files:u}=i.target;u&&u.length>0&&_(p=>({...p,[c]:u[0]}))},D=()=>{b("/companies")};return n&&g?e.jsx($,{}):e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:o?"Edit Company":"Add Company"}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_name",children:"Company name"}),e.jsx("input",{type:"text",id:"company_name",name:"company_name",autoComplete:"off",value:a.company_name,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.company_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"address",children:"Address"}),e.jsx("input",{type:"text",id:"address",name:"address",autoComplete:"off",value:a.address,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.address||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"city",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:a.city,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.city||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"state",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:a.state,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.state||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"zip_code",children:"Zip code"}),e.jsx("input",{type:"text",id:"zip_code",name:"zip_code",autoComplete:"off",value:a.zip_code,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.zip_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_owner_name",children:"Company owner name"}),e.jsx("input",{type:"text",id:"company_owner_name",name:"company_owner_name",autoComplete:"off",value:a.company_owner_name,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.company_owner_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"phone_number",children:"Phone number 1"}),e.jsx("input",{type:"text",id:"phone_number",name:"phone_number",autoComplete:"off",value:a.phone_number,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.phone_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"mobile_number",children:"Phone number 2"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:a.mobile_number,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.mobile_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:a.email,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"website",children:"Website"}),e.jsx("input",{type:"text",id:"website",name:"website",autoComplete:"off",value:a.website,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.website||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"image",children:"Logo"}),e.jsx("span",{className:"text-sm text-gray-600",children:"(JPG, JPEG, PNG | 92×92 px)"})]}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:l,className:"input border border-gray-300 rounded-md p-2 mt-1 file:h-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.logo||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"registration_number",children:"Registration Number"}),e.jsx("input",{type:"text",id:"registration_number",name:"registration_number",autoComplete:"off",value:a.registration_number,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.registration_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"registration_date",children:"Registration Date"}),e.jsx(G,{dateAdapter:Y,children:e.jsx(I,{value:a.registration_date?O(a.registration_date):null,onChange:k,format:"DD-MM-YYYY",renderInput:i=>e.jsx("input",{...i,id:"registration_date",name:"registration_date",className:"input border border-gray-300 rounded-md p-2"})})}),e.jsx("p",{className:"text-red-500 text-sm",children:s.registration_date||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"gstin",children:"GSTIN"}),e.jsx("input",{type:"text",id:"gstin",name:"gstin",autoComplete:"off",value:a.gstin,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.gstin||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_ownedby",children:"Company owned by"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"company_ownedby",value:a.company_ownedby??"",onChange:i=>_({...a,company_ownedby:Number(i.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Ownership"}),e.jsx("option",{value:1,children:"Own"}),e.jsx("option",{value:2,children:"Other Company"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.company_ownedby||" "})]}),a.company_ownedby===2&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"contract_document",children:"Contract Document"}),e.jsx("input",{type:"file",id:"contract_document",name:"contract_document",accept:".pdf,.doc,.docx",onChange:F,className:"input border border-gray-300 rounded-md p-2 mt-1 file:h-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.contract_document||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"gst_percentage",children:"GST Percentage (%)"}),e.jsx("input",{type:"text",id:"gst_percentage",name:"gst_percentage",autoComplete:"off",value:a.gst_percentage,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.gst_percentage||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"hsn_sac_code",children:"HSN / SAC Code"}),e.jsx("input",{type:"text",id:"hsn_sac_code",name:"hsn_sac_code",autoComplete:"off",value:a.hsn_sac_code,onChange:l,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.hsn_sac_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"signature_image",children:"Authorized Signature Image"}),e.jsx("input",{type:"file",id:"signature_image",name:"signature_image",accept:"image/*",onChange:F,className:"input border border-gray-300 rounded-md p-2 mt-1 file:h-full"}),e.jsx("p",{className:"text-red-500 text-sm",children:s.signature_image||" "})]})]}),e.jsxs("div",{className:"flex justify-start mt-6",children:[e.jsx("button",{type:"submit",className:"btn btn-primary mr-4",disabled:t||m,children:o?"Update Company":"Add Company"}),e.jsx("button",{type:"button",onClick:D,className:"btn btn-secondary",children:"Cancel"})]})]})]})};export{X as default};
