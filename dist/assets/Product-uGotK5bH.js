import{r as n,_ as x,j as e,V as F,u as U,F as D,a as T,T as z,b as M,c as O,d as R,e as V,S as C,s as Y}from"./index-CrW1VcAo.js";import{p as q}from"./productSchema-C-WjOpCn.js";import{u as G}from"./useGetProducts-doxM0NCL.js";const W="http://35.154.167.170:3000/admin/products",Z=()=>{const[i,o]=n.useState(!1);return{addProduct:async m=>{const a=localStorage.getItem("authToken");o(!0);try{const s=await fetch(W,{method:"POST",headers:{Authorization:a?`Bearer ${a}`:""},body:m});if(!s.ok){const g=(await s.json()).message;return x.error(g,{position:"top-center"}),!1}const t=await s.json();return x.success(t.message,{position:"top-center"}),!0}catch(s){return s.name==="TypeError"&&s.message.includes("Failed to fetch")?x.error("Network error: Failed to fetch.",{position:"top-center"}):x.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{o(!1)}},loading:i}},H=()=>{const[i,o]=n.useState(!1);return{deleteProduct:async m=>{o(!0);const a=`http://35.154.167.170:3000/admin/products/${m}`;try{const s=localStorage.getItem("authToken"),t=await fetch(a,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}}),c=await t.json();return s?t.ok?{success:!0,message:c.message}:(x.error(c.message,{position:"top-center"}),{success:!1,message:c.message}):(x.error(c.message,{position:"top-center"}),o(!1),{success:!1,message:c.message})}catch(s){return x.error(s.message,{position:"top-center"}),{success:!1,message:s.message}}finally{o(!1)}},loading:i}},J=()=>{const[i,o]=n.useState(!1);return{updateProduct:async(m,a)=>{o(!0);const s=`http://35.154.167.170:3000/admin/products/${m}`;try{const t=localStorage.getItem("authToken");if(!t)return x.error("No authentication token found",{position:"top-center"}),o(!1),!1;const c=await fetch(s,{method:"PUT",headers:{Authorization:`Bearer ${t}`},body:a});if(c.ok){const g=await c.json();return x.success(g.message,{position:"top-center"}),!0}else{const d=(await c.json()).message;return x.error(d,{position:"top-center"}),!1}}catch(t){return x.error(t.message,{position:"top-center"}),!1}finally{o(!1)}},loading:i}},K=({isOpen:i,onClose:o,productData:u,product_id:m,setIsSubmit:a})=>{const{addProduct:s,loading:t}=Z(),{updateProduct:c,loading:g}=J(),[d,h]=n.useState({name:"",image:""}),[S,f]=n.useState({});n.useEffect(()=>{i?h(u?{name:u.name,image:u.image}:{name:"",image:""}):f({})},[i,u]);const N=y=>{const{name:p,value:l,files:b}=y.target;p==="image"&&b&&b.length>0?h(P=>({...P,image:b[0]})):h(P=>({...P,[p]:l}))},w=async y=>{y.preventDefault();try{await q(!!m).validate(d,{abortEarly:!1});const l=new FormData;l.append("name",d.name),d.image instanceof File&&l.append("image",d.image),m?await c(m,l):await s(l),a(!0),o()}catch(p){if(p instanceof F){const l={};p.inner.forEach(b=>{l[b.path||""]=b.message}),f(l)}else x.error("Failed to submit the form. Please try again.")}};return i?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:o}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96 z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:o,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:m?"Edit Product":"Add Product"}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:d.name,onChange:N,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:S.name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"image",children:"Image"}),e.jsx("input",{type:"file",id:"image",name:"image",accept:"image/*",onChange:N,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:S.image||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${t||g?"opacity-50 cursor-not-allowed":""}`,disabled:t||g,children:t||g?t?"Adding...":"Updating...":m?"Update Product":"Add Product"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:o,disabled:t||g,children:"Cancel"})]})]})]})]}):null},Q=({search:i,setEditProduct:o,isSubmit:u,setIsSubmit:m})=>{const[a,s]=n.useState(1),[t,c]=n.useState(10),[g,d]=U(),[h,S]=n.useState(null),[f,N]=n.useState(null),w=g.get("page"),y=g.get("perPage"),{products:p,totalProducts:l,loading:b,fetchProducts:P}=G(a,t,i,h,f),v=Math.ceil(l/t);n.useEffect(()=>{u&&(P(),m(!1))},[u,P]);const{deleteProduct:L}=H(),$=async r=>{try{const{isConfirmed:j}=await C.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(j){const{success:_,message:A}=await L(r);_?(p.filter(B=>B.product_id!==r).length===0&&a>1&&(s(a-1),d({page:(a-1).toString(),perPage:t.toString()})),await P(),C.fire(A)):C.fire(A)}}catch(j){C.fire({title:"Error",text:j.message,icon:"error"})}};n.useEffect(()=>{w&&s(Number(w)),y&&c(Number(y))},[w,y]),n.useEffect(()=>{i?(s(1),d({search:i,page:"1",perPage:t.toString()})):d({page:"1",perPage:t.toString()})},[i]),n.useEffect(()=>{P()},[t,a,i,h,f,P]);const E=r=>{h===r?N(f==="ASC"?"DESC":"ASC"):(S(r),N("ASC"))},k=r=>{r>=1&&r<=v&&(s(r),d({page:r.toString(),perPage:t.toString()}))},I=r=>{const j=Number(r.target.value);c(j),s(1),d({page:"1",perPage:j.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:t,onChange:I,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>E("product_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(D,{color:h==="product_id"&&f==="ASC"?"gray":"lightgray"}),e.jsx(T,{color:h==="product_id"&&f==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>E("name"),children:["Product name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(D,{color:h==="name"&&f==="ASC"?"gray":"lightgray"}),e.jsx(T,{color:h==="name"&&f==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("div",{className:"flex justify-between",children:["Image",e.jsx("div",{className:"flex "})]})}),e.jsx("th",{className:"w-[125px]",children:"Actions"})]})}),b?e.jsx(z,{}):p.length>0?e.jsx("tbody",{children:p.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.product_id}),e.jsx("td",{children:r.name}),e.jsx("td",{children:e.jsx("img",{alt:r.name,className:"rounded-lg size-20 shrink-0",src:r.image})}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>o(r),children:e.jsx(M,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>$(r.product_id),children:e.jsx(O,{className:"text-red-500"})})]})]},r.product_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No products available"})})})]})})})})}),l>t&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",p.length," of ",l," Branches"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:a===1,onClick:()=>k(a-1),className:`btn ${a===1?"disabled":""}`,children:e.jsx(R,{})}),Array.from({length:v}).map((r,j)=>e.jsx("button",{className:`btn ${a===j+1?"active":""}`,onClick:()=>k(j+1),children:j+1},j)),e.jsx("button",{disabled:a===v,onClick:()=>k(a+1),className:`btn ${a===v?"disabled":""}`,children:e.jsx(V,{})})]})]})]})},ae=()=>{const[i,o]=n.useState(""),[u,m]=n.useState(""),[a,s]=n.useState(!1),[t,c]=n.useState(null),[g,d]=n.useState(!1),[h,S]=n.useState(!1),[f,N]=n.useState(""),w=()=>{d(!1),s(!0),c(null)},y=l=>{d(!0),c(l),s(!0)},p=async l=>{l.preventDefault();try{await Y.validate({search:u},{abortEarly:!1}),o(u),N("")}catch(b){b instanceof F&&N(b.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Products"}),e.jsxs("button",{onClick:w,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Product"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:p,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:u,onChange:l=>m(l.target.value),className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:f||" "})]}),e.jsx(Q,{search:i,isSubmit:h,setIsSubmit:S,setEditProduct:y}),e.jsx(K,{setIsSubmit:S,isOpen:a,onClose:()=>s(!1),productData:t,product_id:t==null?void 0:t.product_id})]})};export{ae as default};
