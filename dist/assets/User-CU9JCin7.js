import{r as l,_ as N,u as B,j as e,F as C,a as U,T as M,b as G,c as z,d as O,e as J,S as P,f as V,g as w,o as $,V as F,s as W}from"./index-CrW1VcAo.js";import{R as Y,G as Z}from"./enums-B4eR1RbL.js";const H="http://35.154.167.170:3000/user",K=(o=1,d=10,g="",u,f)=>{const[a,h]=l.useState([]),[t,x]=l.useState(0),[s,i]=l.useState(!1),r=l.useCallback(async()=>{var n,j;const S=localStorage.getItem("authToken"),c=new URLSearchParams;o&&c.append("page_number",o.toString()),d&&c.append("per_page",d.toString()),g&&c.append("search",g),u&&c.append("sortBy",u),f&&c.append("order",f),i(!0);try{const b=await fetch(`${H}?${c}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}});if(!b.ok){const A=await b.json();N.error(A.message,{position:"top-center"});return}const p=await b.json(),v=((n=p==null?void 0:p.data)==null?void 0:n.result)||[],k=((j=p==null?void 0:p.data)==null?void 0:j.count)||0;h(v),x(k)}catch(b){N.error((b==null?void 0:b.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{i(!1)}},[o,d,f,u,g]);return{users:a,totalUsers:t,loading:s,fetchUsers:r}},Q="http://35.154.167.170:3000/user",X=()=>{const[o,d]=l.useState(!1);return{addUser:async u=>{const f=localStorage.getItem("authToken");d(!0);try{const a=await fetch(Q,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!a.ok){const t=await a.json();return N.error(t.message,{position:"top-center"}),!1}const h=await a.json();return N.success(h.message,{position:"top-center"}),!0}catch(a){return N.error((a==null?void 0:a.message)||"Error adding banner",{position:"top-center"}),!1}finally{d(!1)}},loading:o}},ee=()=>{const[o,d]=l.useState(!1);return{deleteUser:async u=>{d(!0);const f=`http://35.154.167.170:3000/user/${u}`,a=localStorage.getItem("authToken");try{const h=await fetch(f,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}),t=await h.json();return h.ok?{success:!0,message:t.message}:(N.error(t.message,{position:"top-center"}),{success:!1,message:t.message})}catch(h){return{success:!1,message:h.message}}finally{d(!1)}},loading:o}},se=()=>{const[o,d]=l.useState(!1);return{updateUser:async(u,f)=>{const a=localStorage.getItem("authToken"),h=`http://35.154.167.170:3000/user/${u}`;d(!0);try{const t=await fetch(h,{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!t.ok){const s=await t.json();return N.error(s.message,{position:"top-center"}),!1}const x=await t.json();return N.success(x.message,{position:"top-center"}),!0}catch(t){return N.error(t.message,{position:"top-center"}),!1}finally{d(!1)}},loading:o}},ae=({search:o,isSubmit:d,setIsSubmit:g,setEditUser:u})=>{const{deleteUser:f}=ee(),[a,h]=l.useState(1),[t,x]=l.useState(10),[s,i]=B(),[r,S]=l.useState(null),[c,n]=l.useState(null),j=s.get("page"),b=s.get("perPage"),{users:p,fetchUsers:v,totalUsers:k,loading:A}=K(a,t,o,r,c),E=Math.ceil(k/t);l.useEffect(()=>{d&&(v(),g(!1))},[d,v]),l.useEffect(()=>{j&&h(Number(j)),b&&x(Number(b))},[j,b]),l.useEffect(()=>{o?(h(1),i({search:o,page:"1",perPage:t.toString()})):i({page:"1",perPage:t.toString()})},[o]),l.useEffect(()=>{v()},[t,a,o,r,c,v]);const L=async m=>{try{const{isConfirmed:y}=await P.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(y){const{success:q,message:D}=await f(m);q?(p.filter(I=>I.user_id!==m).length===0&&a>1&&(h(a-1),i({page:(a-1).toString(),perPage:t.toString()})),await v(),P.fire(D)):P.fire(D)}}catch(y){P.fire({title:"Error",text:y.message,icon:"error"})}},_=m=>{r===m?n(c==="ASC"?"DESC":"ASC"):(S(m),n("ASC"))},T=m=>{m>=1&&m<=E&&(h(m),i({page:m.toString(),perPage:t.toString()}))},R=m=>{const y=Number(m.target.value);x(y),h(1),i({page:"1",perPage:y.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:t,onChange:R,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>_("user_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:r==="user_id"&&c==="ASC"?"gray":"lightgray"}),e.jsx(U,{color:r==="user_id"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>_("user_id"),children:["User name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:r==="user_id"&&c==="ASC"?"gray":"lightgray"}),e.jsx(U,{color:r==="user_id"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>_("email"),children:["Email",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:r==="email"&&c==="ASC"?"gray":"lightgray"}),e.jsx(U,{color:r==="email"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>_("mobile_number"),children:["Mobile no",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:r==="mobile_number"&&c==="ASC"?"gray":"lightgray"}),e.jsx(U,{color:r==="mobile_number"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[170px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>_("role_id"),children:["Role",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:r==="role_id"&&c==="ASC"?"gray":"lightgray"}),e.jsx(U,{color:r==="role_id"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[150px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>_("gender"),children:["Gender",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(C,{color:r==="gender"&&c==="ASC"?"gray":"lightgray"}),e.jsx(U,{color:r==="gender"&&c==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[140px]",children:"Actions"})]})}),A?e.jsx(M,{}):p.length>0?e.jsx("tbody",{children:p.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.user_id}),e.jsxs("td",{children:[m.first_name," ",m.last_name]}),e.jsx("td",{children:m.email}),e.jsx("td",{children:m.mobile_number}),e.jsx("td",{children:Y[m.role_id]}),e.jsx("td",{children:Z[m.gender]}),e.jsxs("td",{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>u(m.user_id),children:e.jsx(G,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>L(m.user_id),children:e.jsx(z,{className:"text-red-500"})})]})]},m.user_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No users available"})})})]})})})})}),k>t&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",p.length," of ",k," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:a===1,onClick:()=>T(a-1),className:`btn ${a===1?"disabled":""}`,children:e.jsx(O,{})}),Array.from({length:E}).map((m,y)=>e.jsx("button",{className:`btn ${a===y+1?"active":""}`,onClick:()=>T(y+1),children:y+1},y)),e.jsx("button",{disabled:a===E,onClick:()=>T(a+1),className:`btn ${a===E?"disabled":""}`,children:e.jsx(J,{})})]})]})]})},te=(o=!1)=>V().shape({first_name:w().required("First name is required"),last_name:w().required("Last name is required"),email:w().email("Enter a valid email"),password:o?w().min(6,"Password must be at least 6 characters"):w().min(6,"Password must be at least 6 characters").required("Password is required"),mobile_number:w().matches(/^\d{10}$/,"Mobile number must be 10 digits").required("Mobile number is required"),gender:$().required("Gender is required"),role_id:$().required("Role is required"),otp:o?w():w().required("OTP is required")}),re=o=>{const[d,g]=l.useState(!1),[u,f]=l.useState(null);return l.useEffect(()=>{(async()=>{var x;const h=localStorage.getItem("authToken"),t=`http://35.154.167.170:3000/user/${o}`;g(!0);try{const s=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});if(!s.ok){const r=await s.json();N.error(r.message,{position:"top-center"}),g(!1);return}const i=await s.json();f((x=i==null?void 0:i.data)==null?void 0:x.user)}catch(s){N.error((s==null?void 0:s.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{g(!1)}})()},[o]),{user:u,loading:d}},ne=({isOpen:o,onClose:d,setIsSubmit:g,user_id:u})=>{const{addUser:f,loading:a}=X(),{updateUser:h,loading:t}=se(),{user:x}=re(u),[s,i]=l.useState({first_name:"",last_name:"",email:"",password:"",mobile_number:"",gender:null,role_id:null,otp:""}),[r,S]=l.useState({});l.useEffect(()=>{o?i(x?{...s,first_name:x.first_name,last_name:x.last_name,email:x.email,password:x.password,mobile_number:x.mobile_number,gender:x.gender,role_id:x.role_id}:{first_name:"",last_name:"",email:"",password:"",mobile_number:"",gender:null,role_id:null,otp:""}):S({})},[o,x]);const c=async n=>{n.preventDefault();try{await te(!!u).validate(s,{abortEarly:!1}),u?await h(u,s):await f(s),g(!0),d()}catch(j){if(j instanceof F){const b={};j.inner.forEach(p=>{b[p.path||""]=p.message}),S(b)}else N.error("Failed to submit the form. Please try again.")}};return o?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:d}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl w-full z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 shadow-default",onClick:d,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:u?"Edit user detail":"Add user"}),e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"first_name",className:"mb-2 font-semibold",children:"First Name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",value:s.first_name,onChange:n=>i({...s,first_name:n.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:r.first_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"last_name",className:"mb-2 font-semibold",children:"Last Name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",value:s.last_name,onChange:n=>i({...s,last_name:n.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:r.last_name||" "})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",className:"mb-2 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",value:s.email,onChange:n=>i({...s,email:n.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:r.email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"mobile_number",className:"mb-2 font-semibold",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",value:s.mobile_number,onChange:n=>i({...s,mobile_number:n.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:r.mobile_number||" "})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"password",className:"mb-2 font-semibold",children:"Password"}),e.jsx("input",{type:"password",id:"password",name:"password",value:s.password,onChange:n=>i({...s,password:n.target.value}),className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:r.password||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"role_id",children:"Role"}),e.jsxs("select",{id:"role_id",className:"select border border-gray-300 rounded-md p-2 w-full",value:s.role_id===null?"":s.role_id,onChange:n=>i({...s,role_id:n.target.value?parseInt(n.target.value):""}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Role"}),e.jsx("option",{value:1,children:"Super Admin"}),e.jsx("option",{value:2,children:"Sub Admin"}),e.jsx("option",{value:3,children:"Branch Manager"}),e.jsx("option",{value:4,children:"Delivery Boy"}),e.jsx("option",{value:5,children:"Customer"}),e.jsx("option",{value:6,children:"Workshop Manager"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:r.role_id||" "})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:s.gender===1,onChange:n=>i({...s,gender:parseInt(n.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:s.gender===2,onChange:n=>i({...s,gender:parseInt(n.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:s.gender===3,onChange:n=>i({...s,gender:parseInt(n.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:r.gender||" "})]}),!u&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"otp",className:"mb-2 font-semibold",children:"Enter OTP"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",id:"otp",name:"otp",value:s.otp,onChange:n=>i({...s,otp:n.target.value}),className:"input border border-gray-300 rounded-md p-2 flex-grow"}),e.jsx("button",{className:"btn btn-primary ml-2 px-4 py-2",children:"Send OTP"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:r.otp||" "})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${a||t?"opacity-50 cursor-not-allowed":""}`,disabled:a||t,children:a||t?a?"Adding...":"Updating...":u?"Update user":"Add user"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:d,disabled:a||t,children:"Cancel"})]})]})]})]}):null},ce=()=>{const[o,d]=l.useState(""),[g,u]=l.useState(""),[f,a]=l.useState(!1),[h,t]=l.useState(null),[x,s]=l.useState(!1),[i,r]=l.useState(!1),[S,c]=l.useState(""),n=p=>{s(!0),t(p),a(!0)},j=()=>{a(!0),t(null)},b=async p=>{p.preventDefault();try{await W.validate({search:g},{abortEarly:!1}),d(g),c("")}catch(v){v instanceof F&&c(v.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Users"}),e.jsxs("button",{onClick:j,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add User"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:b,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:g,onChange:p=>u(p.target.value),className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:S||" "})]}),e.jsx(ae,{search:o,isSubmit:i,setIsSubmit:r,setEditUser:n}),e.jsx(ne,{setIsSubmit:r,isOpen:f,onClose:()=>a(!1),user_id:h})]})};export{ce as default};
