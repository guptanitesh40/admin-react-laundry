import{r,e as B,u as Q,j as e,T as X,P as Y,V as b}from"./index-BsfZthRi.js";import{H as Z}from"./index-xnmVeddk.js";const ee=({refetchLabels:S})=>{const[i,o]=r.useState({languagesLoading:!0,labelsLoading:!0,updateLabelLoading:!1}),{hasPermission:x}=B(),[d,y]=r.useState([]),[h,w]=r.useState([]),[f,v]=r.useState([]),[u,j]=r.useState(1),[c,g]=r.useState(10),[L,P]=Q(),[C,D]=r.useState(null),[m,J]=r.useState(null),[p,_]=r.useState(null),E=L.get("page"),A=L.get("perPage"),[N,T]=r.useState(""),[k,M]=r.useState(""),[q,I]=r.useState(""),F="http://35.154.167.170:3000",$=localStorage.getItem("authToken");function z(){return f.filter(a=>{const t=d.find(n=>n.label_id===a.label_id);if(!t)return!1;for(const n in a)if(a[n]!==t[n])return!0;return!1})}const H=s=>{const a=Number(s.target.value);g(a),j(1),P({page:"1",perPage:a.toString()})},U=async s=>{s.preventDefault(),k.length>50?I("Max search input length exceeded by 50 characters"):(T(k),I(""))},O=s=>{m===s?_(p==="ASC"?"DESC":"ASC"):(J(s),_("ASC"))},V=(s,a,t)=>{v(n=>n.map(l=>l.label_id===s?{...l,[a]:t}:l))},W=async()=>{const s=z();if(s.length>0){const a=s.map(t=>{const n={label_id:t.label_id};return Object.keys(t).forEach(l=>{l.startsWith("txt_")&&(n[l]=t[l])}),n});try{o(l=>({...l,updateLabelLoading:!0}));const t=await fetch(`${F}/label`,{method:"PATCH",headers:{Authorization:`Bearer ${$}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await t.json();if(!t.ok)throw new Error((n==null?void 0:n.message)||"Failed to updated labels.");b.success(n.message),y(JSON.parse(JSON.stringify(f)))}catch(t){b.error(t.message||"Failed to updated labels.")}finally{o(t=>({...t,updateLabelLoading:!1}))}}},G=s=>{if(s===u)return;if(z().length)b("Please save your changes before changing the page",{icon:e.jsx(Z,{className:"fill-green-600 h-8 w-8"}),style:{borderRadius:"10px",fontWeight:"500"},className:"text-sm border border-green-500"});else{const t=Math.ceil(C/c);s>=1&&s<=t&&(j(s),P({page:s.toString(),perPage:c.toString()}))}};return r.useEffect(()=>{(async()=>{try{o(n=>({...n,languagesLoading:!0}));const a=await fetch(`${F}/language`,{headers:{Authorization:`Bearer ${$}`}}),t=await a.json();if(!a.ok)throw new Error(t.message||"Failed to fetch languages.");w(t==null?void 0:t.data)}catch(a){b.error(a.message||"Failed to fetch languages.")}finally{o(a=>({...a,languagesLoading:!1}))}})()},[]),r.useEffect(()=>{(async()=>{try{o(l=>({...l,labelsLoading:!0}));const a=new URLSearchParams;u&&a.append("page_number",u.toString()),c&&a.append("per_page",c.toString()),N&&a.append("search",N),m&&a.append("sort_by",m),p&&a.append("order",p);const t=await fetch(`${F}/label?${a.toString()}`,{headers:{Authorization:`Bearer ${$}`}}),n=await t.json();if(!t.ok)throw new Error(n.message||"Failed to fetch labels.");D(n==null?void 0:n.count),y(n==null?void 0:n.data)}catch(a){b.error(a.message||"Failed to fetch labels.")}finally{o(a=>({...a,labelsLoading:!1}))}})()},[S,c,u,N,m,p]),r.useEffect(()=>{if(!i.languagesLoading&&!i.labelsLoading){const s=JSON.parse(JSON.stringify(d));v(s)}},[d,h,C]),r.useEffect(()=>{E&&j(Number(E)),A&&g(Number(A))},[E,A]),r.useEffect(()=>{N&&(j(1),P({search:N,page:"1",perPage:c.toString()}))},[N]),e.jsxs(e.Fragment,{children:[x(21,"update")&&e.jsx("div",{className:"flex items-center gap-2.5 absolute top-0 right-6 xl:right-10",children:e.jsxs("button",{className:"btn btn-primary",onClick:W,disabled:i.updateLabelLoading,children:[i.updateLabelLoading?e.jsx("span",{className:"h-5.5 w-5.5 border-4 border-white/40 border-t-white border-r-white rounded-full animate-spin"}):e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Save"]})}),i.languagesLoading||i.labelsLoading?e.jsx(X,{isFilters:!0,columns:4,records:10,isPagination:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:c,onChange:H,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("form",{onSubmit:U,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:k,onChange:s=>{M(s.target.value),s.target.value===""&&T("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:q||"Â "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[30px]",children:e.jsxs("span",{className:`sort ${m==="label_id"?p==="ASC"?"asc":"desc":""}`,onClick:()=>O("label_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${m==="label_name"?p==="ASC"?"asc":"desc":""}`,onClick:()=>O("label_name"),children:[e.jsx("span",{className:"sort-label",children:"name"}),e.jsx("span",{className:"sort-icon"})]})}),h.length&&h.map(s=>{const{language_id:a,language_name:t,language_code:n}=s;return e.jsx("th",{className:"min-w-[225px]",children:e.jsxs("span",{className:`sort ${m===n?p==="ASC"?"asc":"desc":""}`,onClick:()=>O(n),children:[e.jsx("span",{className:"sort-label",children:t}),e.jsx("span",{className:"sort-icon"})]})},a)})]})}),f.length>0?e.jsx("tbody",{children:f.map(s=>{const{label_id:a,label_name:t}=s;return e.jsxs("tr",{children:[e.jsx("td",{children:a}),e.jsx("td",{children:t}),h.length>0&&h.map(n=>{const{language_id:l,language_code:R}=n;return e.jsx("td",{children:e.jsx("input",{type:"text",value:s[R],placeholder:`${s[R]}`,readOnly:!x(21,"update"),onChange:K=>V(a,R,K.target.value),className:`input placeholder:!text-gray-400${x(21,"update")?"":"!border-gray-300 !bg-gray-100 !cursor-not-allowed !focus:outline-none"}`})},l)})]},a)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No label available"})})})]})}),e.jsx(Y,{count:C,currentPage:u,totalRecords:d==null?void 0:d.length,perPage:c,onPageChange:G,label:"labels"})]})})]})]})},te=()=>{const[S,i]=r.useState(""),[o,x]=r.useState(null),[d,y]=r.useState(!1),[h,w]=r.useState(!1),{hasPermission:f}=B(),v=async u=>{u.preventDefault();const j="http://35.154.167.170:3000",c=localStorage.getItem("authToken");if(!S.trim()){x("Label value is required");return}x(null),y(!0);try{const g=await fetch(`${j}/label`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({label_name:S})}),L=await g.json();if(!g.ok)throw new Error(L.message||"Failed to add label, please try again later.");b.success(L.message||"Label Added Successfully"),i("")}catch(g){b.error(g.message||"Failed to add label.")}finally{y(!1),w(g=>!g)}};return e.jsx("main",{className:"grow content",id:"content",role:"content",children:e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"pb-7.5 space-y-5",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-5 py-2.5",children:e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Label Management"})})}),f(21,"create")&&e.jsx("div",{className:"bg-gray-200 px-4 py-3 border border-gray-300 rounded-md",children:e.jsxs("form",{onSubmit:v,className:"flex flex-col gap-3 items-start",children:[e.jsx("label",{htmlFor:"new_label",className:"form-label text-sm font-semibold",children:"Enter new label"}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsx("input",{id:"new_label",type:"text",className:"input",value:S,onChange:u=>i(u.target.value)}),o&&e.jsx("p",{className:"text-red-500 text-sm",children:o})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h-5.5 w-5.5 border-4 border-white/40 border-t-white border-r-white rounded-full animate-spin"}),"Adding.."]}):"Add Label"})]})})]}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(ee,{refetchLabels:h,setRefetchLabels:w})})})]})})};export{te as default};
