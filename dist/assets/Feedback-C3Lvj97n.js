import{r as l,B as X,V as A,a3 as Z,j as e,u as ee,a4 as se,e as ae,T as te,i as L,P as ne,s as le,b as re}from"./index-b486Fjk2.js";import{M as ie}from"./MultiSelect-Du3gtvGL.js";import"./orderStatusClasses-HfHBGnti.js";const ce=(a=1,u=10,c="",g,p,j,o)=>{const[y,m]=l.useState(),[v,t]=l.useState(!1),[d,b]=l.useState(0),N=async()=>{var S,C;const i=localStorage.getItem("authToken"),r=new URLSearchParams;a&&r.append("page_number",a.toString()),u&&r.append("per_page",u.toString()),c&&r.append("search",c),g&&r.append("sort_by",g),p&&r.append("order",p),o&&r.append("is_publish",o.toString()),j&&j.forEach(x=>r.append("rating",x.toString())),t(!0);try{const x=await fetch(`${X}/feedback?${r}`,{method:"GET",headers:{Authorization:i?`Bearer ${i}`:""}}),h=await x.json();if(!x.ok){A.error(h.message,{position:"top-center"}),t(!1);return}m(((S=h==null?void 0:h.data)==null?void 0:S.feedbacks)||[]),b((C=h==null?void 0:h.data)==null?void 0:C.count)}catch(x){A.error(x||"Network Error : Failed to fetch feedbacks")}finally{t(!1)}};return l.useEffect(()=>{N()},[a,u,c,g,p,o,j]),{feedbacks:y,fetchFeedbacks:N,loading:v,count:d}},F=a=>{switch(a){case 1:return"one-star-rating";case 2:return"two-star-rating";case 3:return"three-star-rating";case 4:return"four-star-rating";case 5:return"five-star-rating";default:return"custom-rating-on"}},oe=()=>{const{customerRatingData:a,fetchCustomerRatingData:u}=Z(),[c,g]=l.useState([{label:"5",count:0},{label:"4",count:0},{label:"3",count:0},{label:"2",count:0},{label:"1",count:0}]),[p,j]=l.useState(0),[o,y]=l.useState(0);l.useEffect(()=>{u()},[]),l.useEffect(()=>{if(a){const t=c.map(i=>{const r=a==null?void 0:a.find(S=>S.rating.toString()===i.label);return r?{...i,count:r.count}:i});g(t);const d=a==null?void 0:a.reduce((i,r)=>i+r.rating*r.count,0),b=a==null?void 0:a.reduce((i,r)=>i+r.count,0),N=d/b;j(N),y(b)}},[a]);const m=Math.max(...c.map(t=>t.count)),v=(t,d)=>{const b=Number(t);if(d===0)return"bg-gray-200";switch(b){case 1:return"bg-red-500";case 2:return"bg-green-500";case 3:return"bg-yellow-500";case 4:return"bg-orange-500";case 5:return"bg-blue-500";default:return"bg-gray-200"}};return e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"flex flex-wrap mt-3 justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 ml-3",children:[e.jsx("div",{children:e.jsx("img",{className:"default-logo h-[55px] max-w-none",src:"/media/app/review.png"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl text-gray-700 font-bold",children:p.toFixed(2)}),e.jsxs("p",{className:"text-base font-semibold text-gray-700",children:["─ of ",o," reviews"]})]})]}),e.jsx("div",{className:"card-body flex flex-col gap-2 custom-body min-w-[250px]",children:c.map((t,d)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex justify-between text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("span",{children:t.label}),e.jsx("div",{className:"rating-label custom-rating checked",children:e.jsx("i",{className:`${F(Number(t.label))} rating-on ki-solid ki-star text-base leading-none`})},d)]})}),e.jsx("div",{className:"w-full h-[8px] bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:`${v(t.label,t.count)} rounded-full h-full transition-all duration-500`,style:{width:`${t.count/m*100}%`}})}),e.jsx("span",{className:"font-medium text-sm text-gray-600",children:t.count})]},d))})]})})})},Y=a=>{switch(a){case 1:return"badge badge-danger badge-outline";case 2:return"badge badge-info badge-outline";case 3:return"badge badge-warning badge-outline";default:return""}},de=()=>{const[a,u]=l.useState(1),[c,g]=l.useState(10),[p,j]=ee(),[o,y]=l.useState(null),[m,v]=l.useState(null),t=p.get("page"),d=p.get("perPage"),[b,N]=l.useState(""),[i,r]=l.useState(""),[S,C]=l.useState(""),[x,h]=l.useState(),[R,$]=l.useState([]),{feedbacks:f,count:E,fetchFeedbacks:z,loading:D}=ce(a,c,b,o,m,R,x),{approveFeedback:G}=se(),{hasPermission:_}=ae(),O=Math.ceil(E/c);l.useEffect(()=>{t&&u(Number(t)),d&&g(Number(d))},[t,d]);const U=async s=>{s.preventDefault();try{await le.validate({search:i},{abortEarly:!1}),N(i),C("")}catch(n){n instanceof re&&C(n.errors[0])}},P=s=>{o===s?v(m==="ASC"?"DESC":"ASC"):(y(s),v("ASC"))},W=s=>{s>=1&&s<=O&&(u(s),j({page:s.toString(),perPage:c.toString()}))},q=s=>{const n=Number(s.target.value);g(n),u(1),j({page:"1",perPage:n.toString()})},H=s=>Array.from({length:5}).map((n,w)=>e.jsxs("div",{className:`rating-label ${w<s?"checked":""}`,children:[e.jsx("i",{className:`rating-on ki-solid ki-star text-base leading-none ${w<s?F(s):""}`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]},w)),J=async(s,n)=>{try{await G(s,n),z()}catch{A.error("Failed to update publish status:")}},K=Array.from({length:5},(s,n)=>({label:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-1",children:n+1}),e.jsxs("div",{className:"rating-label checked mb-1",children:[e.jsx("i",{className:`rating-on ${F(n+1)} ki-solid ki-star text-base leading-none`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]})]},n),value:n+1}));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:c,onChange:q,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(ie,{options:K,displayValue:"label",placeholder:"Select Rating",selectedValues:R,onSelect:s=>$(s.map(n=>n.value)),onRemove:s=>$(s.map(n=>n.value)),className:"lgmobile:min-w-[250px] vsmobile:min-w-[235px]",sliceCount:3,isSearchInput:!1})}),e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${Y(x)}`,value:x,onChange:s=>h(Number(s.target.value)),children:[e.jsx("option",{value:"",children:"Publish Status"}),e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:U,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:i,onChange:s=>{r(s.target.value),s.target.value===""&&N("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:S||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[70px]",children:e.jsxs("span",{className:`sort ${o==="order_id"?m==="ASC"?"asc":"desc":""}`,onClick:()=>P("order_id"),children:[e.jsx("span",{className:"sort-label",children:"Order Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${o==="first_name"?m==="ASC"?"asc":"desc":""}`,onClick:()=>P("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Customer name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${o==="email"?m==="ASC"?"asc":"desc":""}`,onClick:()=>P("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[130px]",children:e.jsxs("span",{className:`sort ${o==="mobile_number"?m==="ASC"?"asc":"desc":""}`,onClick:()=>P("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile no"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[100px]",children:"Rating"}),e.jsx("th",{className:"min-w-[300px]",children:"Comment"}),e.jsx("th",{className:"min-w-[120px]",children:e.jsxs("span",{className:`sort ${o==="created_at"?m==="ASC"?"asc":"desc":""}`,onClick:()=>P("created_at"),children:[e.jsx("span",{className:"sort-label",children:"Date"}),e.jsx("span",{className:"sort-icon"})]})}),(_(17,"create")||_(17,"update"))&&e.jsx("th",{className:"min-w-[140px]",children:"Publish"})]})}),D?e.jsx(te,{}):(f==null?void 0:f.length)>0?e.jsx("tbody",{children:f.map(s=>{var n,w,M,k,B,T,I,V;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsxs("td",{children:[(w=(n=s==null?void 0:s.order)==null?void 0:n.user)==null?void 0:w.first_name," ",(k=(M=s==null?void 0:s.order)==null?void 0:M.user)==null?void 0:k.last_name]}),e.jsx("td",{children:(T=(B=s==null?void 0:s.order)==null?void 0:B.user)==null?void 0:T.email}),e.jsx("td",{children:(V=(I=s==null?void 0:s.order)==null?void 0:I.user)==null?void 0:V.mobile_number}),e.jsx("td",{children:e.jsx("div",{className:"rating",children:H(s.rating)})}),e.jsx("td",{children:s.comment}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[L(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),L(s.created_at).format("hh:mm:ss A")]})}),(_(17,"create")||_(17,"update"))&&e.jsx("td",{children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${Y(s.is_publish)}`,value:s.is_publish,onChange:Q=>J(s.feedback_id,Q.target.value),children:[e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})})]},s.feedback_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No feedback data available"})})})]})}),e.jsx(ne,{count:E,currentPage:a,totalRecords:f==null?void 0:f.length,perPage:c,onPageChange:W,label:"feedbacks"})]})})]})},he=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Feedback And Rating"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx(oe,{})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(de,{})})})})]});export{he as default};
