import{r as u,V as j,j as e,b as E}from"./index-DkEVCDP-.js";import{u as D,P as L,a as I,d as C}from"./index-Dfk2awm5.js";import{u as $,c as P}from"./userSchema-C0pGNltM.js";const H=()=>{const[h,b]=u.useState([]),[g,N]=u.useState(!1);return{address:h,loading:g,fetchAddress:async y=>{var s;const v=localStorage.getItem("authToken"),p=`http://35.154.167.170:3000/address/${y}/user`;try{const d=await fetch(p,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`}});if(!d.ok){const t=await d.json();j.error(t.message,{position:"top-center"});return}const n=await d.json(),m=((s=n==null?void 0:n.data)==null?void 0:s.result)||[];b(m)}catch(d){j.error((d==null?void 0:d.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{N(!1)}}}},M=({isOpen:h,onClose:b,userId:g,setIsSubmit:N,onAddressAdded:_,fullname:y})=>{const{addAddress:v,loading:p}=D(),[s,d]=u.useState({}),[n,m]=u.useState(!1),[t,o]=u.useState({building_number:"",area:"",lat:null,long:null,landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,address_type:null,full_name:""}),[S,k]=u.useState(!1);u.useEffect(()=>{h?g&&o(r=>({...r,user_id:g,full_name:y})):(o({building_number:"",area:"",landmark:"",pincode:"",city:"",lat:null,long:null,state:"",country:"",user_id:null,address_type:null,full_name:""}),d({}))},[h,g]);const F=r=>{o({...t,area:r}),k(!0)},w=async r=>{o({...t,area:r});try{const x=await C.geocodeByAddress(r),a=await C.getLatLng(x[0]);a&&o(i=>({...i,lat:a==null?void 0:a.lat,long:a==null?void 0:a.lng}))}catch{j.error("Failed to fetch address detail",{className:"toast-error"})}},A=async r=>{r.preventDefault();const x={...t};x.pincode||delete x.pincode,x.landmark||delete x.landmark;try{if(await I.validate(t,{abortEarly:!1}),d({}),g){const a=await v(x);a&&(_(a),b(),N(!0))}}catch(a){if(a instanceof E){const i={};a.inner.forEach(l=>{i[l.path||""]=l.message}),d(i)}else j.error("Failed to submit the form. Please try again.")}};if(h)return e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:b}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-lg min-w-[450px] !max-w-full z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:b,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Add New Address"}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm",onChange:r=>o({...t,address_type:Number(r.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Address Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Search Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(L,{value:t.area,onChange:F,onSelect:w,children:({getInputProps:r,suggestions:x,getSuggestionItemProps:a,loading:i})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...r({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>k(!0),onBlur:()=>k(!1)})}),S&&x.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[i&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!i&&x.map((l,c)=>{const{...f}=a(l);return e.jsx("li",{...f,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:l==null?void 0:l.description},c)})]})})]})})}),s.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.area||" "})||n&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"House Number and Society"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:t.building_number,onChange:r=>o({...t,building_number:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:t.landmark,onChange:r=>o({...t,landmark:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:t.city,onChange:r=>o({...t,city:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:t.pincode,onChange:r=>o({...t,pincode:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:t.state,onChange:r=>o({...t,state:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:t.country,onChange:r=>o({...t,country:r.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:s.country||" "})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:b,className:"btn btn-light mr-2",disabled:p,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:`btn btn-primary ${p?"opacity-50 cursor-not-allowed":""}`,children:p?"Submitting...":"Submit"})]})]})]})]})},R=({isOpen:h,onClose:b,setIsSubmit:g,onCustomerCreated:N})=>{const{addUser:_,loading:y}=$(),{addAddress:v,loading:p}=D(),[s,d]=u.useState({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),[n,m]=u.useState({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),[t,o]=u.useState({}),[S,k]=u.useState(!1),[F,w]=u.useState(!1);u.useEffect(()=>{h||(d({first_name:"",last_name:"",email:"",mobile_number:"",gender:null,role_id:5}),m({building_number:"",area:"",landmark:"",pincode:"",city:"",state:"",country:"",user_id:null,full_name:"",address_type:null}),o({}))},[h]);const A=a=>{m({...n,area:a}),w(!0)},r=async a=>{m({...n,area:a});try{const i=await C.geocodeByAddress(a),l=await C.getLatLng(i[0]);l&&m(c=>({...c,lat:l==null?void 0:l.lat,long:l==null?void 0:l.lng}))}catch{j.error("Failed to fetch address detail",{className:"toast-error"})}},x=async a=>{a.preventDefault();try{await P().validate(s,{abortEarly:!1}),await I.validate(n,{abortEarly:!1}),o({});const i={...s};i.email||delete i.email;const l=await _(i);if(l!=null&&l.user_id){const c={...n,user_id:l.user_id,full_name:`${l.first_name} ${l.last_name}`};c.landmark||delete c.landmark,c.pincode||delete c.pincode;const f=await v(c,!1);f&&(N(l,f),b(),g(!0))}}catch(i){if(i instanceof E){const l={};i.inner.forEach(c=>{l[c.path||""]=c.message}),o(l)}else j.error("Failed to submit the form. Please try again.")}};return h?e.jsxs("div",{className:"fixed inset-0 grid overflow-auto items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:b}),e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-5xl w-full smobile:min-w-[85%] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:b,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsxs("form",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Customer Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-gray-700 font-semibold",children:"First name"}),e.jsx("input",{type:"text",id:"first_name",name:"first_name",autoComplete:"off",value:s.first_name||"",onChange:a=>d({...s,first_name:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:t.first_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-gray-700 font-semibold",children:"Last name"}),e.jsx("input",{type:"text",id:"last_name",name:"last_name",autoComplete:"off",value:s.last_name,onChange:a=>d({...s,last_name:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:t.last_name||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold",children:"Email"}),e.jsx("input",{type:"text",id:"email",name:"email",autoComplete:"off",value:s.email,onChange:a=>d({...s,email:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:t.email||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobile_number",className:"block text-gray-700 font-semibold",children:"Mobile Number"}),e.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",autoComplete:"off",value:s.mobile_number,onChange:a=>d({...s,mobile_number:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:t.mobile_number||" "})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"mb-2 block text-gray-700 font-semibold",children:"Gender"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:1,checked:s.gender===1,onChange:a=>d({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Male"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:2,checked:s.gender===2,onChange:a=>d({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Female"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"gender",value:3,checked:s.gender===3,onChange:a=>d({...s,gender:parseInt(a.target.value)}),className:"radio radio-primary"}),e.jsx("span",{className:"text-sm",children:"Other"})]})]}),e.jsx("p",{className:"text-red-500 text-sm",children:t.gender||" "})]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Address Type"}),e.jsxs("select",{className:"select select-lg text-sm w-full p-2 border border-gray-300 rounded-md",onChange:a=>m({...n,address_type:Number(a.target.value)}),children:[e.jsx("option",{value:"",selected:!0,disabled:!0,className:"badge-danger badge-outline",children:"Select Type"}),e.jsx("option",{value:"1",children:"Home"}),e.jsx("option",{value:"2",children:"Office"}),e.jsx("option",{value:"3",children:"Other"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.address_type||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-gray-700 font-semibold",children:"Search Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsx(L,{value:n.area,onChange:A,onSelect:r,children:({getInputProps:a,suggestions:i,getSuggestionItemProps:l,loading:c})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...a({className:"w-full input border border-gray-300 rounded-md p-2",id:"area",type:"text",onFocus:()=>w(!0),onBlur:()=>w(!1)})}),F&&i.length>0&&e.jsx("div",{className:"absolute bg-white border z-10 border-gray-200 rounded-lg w-full text-sm max-h-[150px] overflow-y-auto",children:e.jsxs("ul",{className:"custom-ul",children:[c&&e.jsx("li",{className:"block px-4 py-[0.8rem] hover:bg-gray-100 w-full",children:"Loading..."}),!c&&i.map((f,T)=>{const{...z}=l(f);return e.jsx("li",{...z,className:"block px-2 py-[0.8rem] hover:bg-gray-100 w-full cursor-pointer font-style",children:f==null?void 0:f.description},T)})]})})]})})}),t.area&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.area||" "})||S&&e.jsx("p",{className:"aam-error-label",children:"please select valid area from dropdown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"building_number",className:"block text-gray-700 font-semibold",children:"House Number"}),e.jsx("input",{type:"text",id:"building_number",name:"building_number",autoComplete:"off",value:n.building_number,onChange:a=>m({...n,building_number:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.building_number||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"landmark",className:"block text-gray-700 font-semibold",children:"Landmark"}),e.jsx("input",{type:"text",id:"landmark",name:"landmark",autoComplete:"off",value:n.landmark,onChange:a=>m({...n,landmark:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.landmark||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-gray-700 font-semibold",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"city",autoComplete:"off",value:n.city,onChange:a=>m({...n,city:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.city||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-gray-700 font-semibold",children:"Pin code"}),e.jsx("input",{type:"text",id:"pincode",name:"pincode",autoComplete:"off",value:n.pincode,onChange:a=>m({...n,pincode:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.pincode||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-gray-700 font-semibold",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"state",autoComplete:"off",value:n.state,onChange:a=>m({...n,state:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.state||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-gray-700 font-semibold",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"country",autoComplete:"off",value:n.country,onChange:a=>m({...n,country:a.target.value}),className:"w-full input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:t.country||" "})]})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:b,className:"btn btn-light mr-2",disabled:y||p,children:"Cancel"}),e.jsx("button",{type:"button",onClick:x,disabled:y||p,className:`btn btn-primary ${y||p?"opacity-50 cursor-not-allowed":""}`,children:y||p?"Submitting...":"Submit"})]})]})]})]}):null};export{M as A,R as C,H as u};
