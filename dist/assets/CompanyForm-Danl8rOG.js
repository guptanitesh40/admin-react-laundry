import{r as x,_ as N,j as a,f as Z,g,h as A,o as H,p as J,m as X,V as ee}from"./index-D8mCTybp.js";import{u as te}from"./useGetCompany-DYjxVgGX.js";import{d as ae}from"./dayjs.min-CKGvEKSv.js";import{aw as oe,i as se,j as re,f as k,k as ne,v as M,l as F,_ as q,P as ie,T as le,n as de,o as c,p as ce,q as me,g as ue,a as pe,s as z,L as be,I as fe,N as v,E as S,W as R,c as ye,b as he,S as xe,U as ge,V as E,aj as P,ak as _e,al as L,am as U,an as je,ao as I,ap as $,ar as De,as as Ne,at as Pe,au as we,av as Ce}from"./AdapterDayjs-D7uRcH1x.js";import{P as e}from"./index-_kMdUgWU.js";const Te="http://35.154.167.170:3000",Fe=`${Te}/companies`,ve=()=>{const[d,t]=x.useState(!1);return{addCompany:async l=>{const s=localStorage.getItem("authToken");t(!0);try{const o=new FormData;Object.entries(l).forEach(([i,r])=>{r&&(r instanceof FileList?o.append(i,r[0]):o.append(i,r))});const n=await fetch(Fe,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:o});if(!n.ok){const i=await n.json();return N.error(i.message,{position:"top-center"}),!1}const p=await n.json();return N.success(p.message,{position:"top-center"}),!0}catch(o){return N.error((o==null?void 0:o.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{t(!1)}},loading:d}},Oe=()=>{const[d,t]=x.useState(!1);return{updateCompany:async(l,s)=>{const o=localStorage.getItem("authToken"),n=`http://35.154.167.170:3000/companies/${l}`,p=new FormData;for(const i in s)s[i]&&(i==="logo"||i==="contract_document"?s[i]instanceof FileList&&s[i].length>0&&p.append(i,s[i][0]):p.append(i,s[i]));t(!0);try{const i=await fetch(n,{method:"PUT",headers:{Authorization:`Bearer ${o}`},body:p});if(i.ok){const b=await i.json();return N.success(b.message,{position:"top-center"}),!0}const r=await i.json();return N.error(r.message,{position:"top-center"}),!1}catch(i){return N.error(i.message,{position:"top-center"}),!1}finally{t(!1)}},loading:d}},ke=d=>{const t=oe(d),{forwardedProps:u,internalProps:l}=se(t,"date");return re({forwardedProps:u,internalProps:l,valueManager:k,fieldValueManager:ne,validator:M,valueType:"date"})},Me=["slots","slotProps","InputProps","inputProps"],V=x.forwardRef(function(t,u){const l=F({props:t,name:"MuiDateField"}),{slots:s,slotProps:o,InputProps:n,inputProps:p}=l,i=q(l,Me),r=l,b=(s==null?void 0:s.textField)??(t.enableAccessibleFieldDOMStructure?ie:le),f=de({elementType:b,externalSlotProps:o==null?void 0:o.textField,externalForwardedProps:i,additionalProps:{ref:u},ownerState:r});f.inputProps=c({},p,f.inputProps),f.InputProps=c({},n,f.InputProps);const _=ke(f),m=ce(_),w=me(c({},m,{slots:s,slotProps:o}));return a.jsx(b,c({},w))});function qe(d){return pe("MuiDatePickerToolbar",d)}ue("MuiDatePickerToolbar",["root","title"]);const Se=["value","isLandscape","onChange","toolbarFormat","toolbarPlaceholder","views","className","onViewChange","view"],Re=d=>{const{classes:t}=d;return he({root:["root"],title:["title"]},qe,t)},Ae=z(be,{name:"MuiDatePickerToolbar",slot:"Root",overridesResolver:(d,t)=>t.root})({}),Ee=z(fe,{name:"MuiDatePickerToolbar",slot:"Title",overridesResolver:(d,t)=>t.title})({variants:[{props:{isLandscape:!0},style:{margin:"auto 16px auto auto"}}]}),ze=x.forwardRef(function(t,u){const l=F({props:t,name:"MuiDatePickerToolbar"}),{value:s,isLandscape:o,toolbarFormat:n,toolbarPlaceholder:p="––",views:i,className:r}=l,b=q(l,Se),f=v(),_=S(),m=Re(l),w=x.useMemo(()=>{if(!s)return p;const O=R(f,{format:n,views:i},!0);return f.formatByString(s,O)},[s,n,p,f,i]),y=l;return a.jsx(Ae,c({ref:u,toolbarTitle:_.datePickerToolbarTitle,isLandscape:o,className:ye(m.root,r)},b,{children:a.jsx(Ee,{variant:"h4",align:o?"left":"center",ownerState:y,className:m.title,children:w})}))});function Y(d,t){const u=v(),l=xe(),s=F({props:d,name:t}),o=x.useMemo(()=>{var n;return((n=s.localeText)==null?void 0:n.toolbarTitle)==null?s.localeText:c({},s.localeText,{datePickerToolbarTitle:s.localeText.toolbarTitle})},[s.localeText]);return c({},s,{localeText:o},ge({views:s.views,openTo:s.openTo,defaultViews:["year","day"],defaultOpenTo:"day"}),{disableFuture:s.disableFuture??!1,disablePast:s.disablePast??!1,minDate:E(u,s.minDate,l.minDate),maxDate:E(u,s.maxDate,l.maxDate),slots:c({toolbar:ze},s.slots)})}const W=x.forwardRef(function(t,u){var r,b;const l=S(),s=v(),o=Y(t,"MuiDesktopDatePicker"),n=c({day:P,month:P,year:P},o.viewRenderers),p=c({},o,{viewRenderers:n,format:R(s,o,!1),yearsPerRow:o.yearsPerRow??4,slots:c({openPickerIcon:_e,field:V},o.slots),slotProps:c({},o.slotProps,{field:f=>{var _;return c({},L((_=o.slotProps)==null?void 0:_.field,f),U(o),{ref:u})},toolbar:c({hidden:!0},(r=o.slotProps)==null?void 0:r.toolbar)})}),{renderPicker:i}=je({props:p,valueManager:k,valueType:"date",getOpenDialogAriaText:I({utils:s,formatKey:"fullDate",contextTranslation:l.openDatePickerDialogue,propsTranslation:(b=p.localeText)==null?void 0:b.openDatePickerDialogue}),validator:M});return i()});W.propTypes={autoFocus:e.bool,className:e.string,closeOnSelect:e.bool,dayOfWeekFormatter:e.func,defaultValue:e.object,disabled:e.bool,disableFuture:e.bool,disableHighlightToday:e.bool,disableOpenPicker:e.bool,disablePast:e.bool,displayWeekNumber:e.bool,enableAccessibleFieldDOMStructure:e.any,fixedWeekNumber:e.number,format:e.string,formatDensity:e.oneOf(["dense","spacious"]),inputRef:$,label:e.node,loading:e.bool,localeText:e.object,maxDate:e.object,minDate:e.object,monthsPerRow:e.oneOf([3,4]),name:e.string,onAccept:e.func,onChange:e.func,onClose:e.func,onError:e.func,onMonthChange:e.func,onOpen:e.func,onSelectedSectionsChange:e.func,onViewChange:e.func,onYearChange:e.func,open:e.bool,openTo:e.oneOf(["day","month","year"]),orientation:e.oneOf(["landscape","portrait"]),readOnly:e.bool,reduceAnimations:e.bool,referenceDate:e.object,renderLoading:e.func,selectedSections:e.oneOfType([e.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),e.number]),shouldDisableDate:e.func,shouldDisableMonth:e.func,shouldDisableYear:e.func,showDaysOutsideCurrentMonth:e.bool,slotProps:e.object,slots:e.object,sx:e.oneOfType([e.arrayOf(e.oneOfType([e.func,e.object,e.bool])),e.func,e.object]),timezone:e.string,value:e.object,view:e.oneOf(["day","month","year"]),viewRenderers:e.shape({day:e.func,month:e.func,year:e.func}),views:e.arrayOf(e.oneOf(["day","month","year"]).isRequired),yearsOrder:e.oneOf(["asc","desc"]),yearsPerRow:e.oneOf([3,4])};const B=x.forwardRef(function(t,u){var r,b;const l=S(),s=v(),o=Y(t,"MuiMobileDatePicker"),n=c({day:P,month:P,year:P},o.viewRenderers),p=c({},o,{viewRenderers:n,format:R(s,o,!1),slots:c({field:V},o.slots),slotProps:c({},o.slotProps,{field:f=>{var _;return c({},L((_=o.slotProps)==null?void 0:_.field,f),U(o),{ref:u})},toolbar:c({hidden:!1},(r=o.slotProps)==null?void 0:r.toolbar)})}),{renderPicker:i}=De({props:p,valueManager:k,valueType:"date",getOpenDialogAriaText:I({utils:s,formatKey:"fullDate",contextTranslation:l.openDatePickerDialogue,propsTranslation:(b=p.localeText)==null?void 0:b.openDatePickerDialogue}),validator:M});return i()});B.propTypes={autoFocus:e.bool,className:e.string,closeOnSelect:e.bool,dayOfWeekFormatter:e.func,defaultValue:e.object,disabled:e.bool,disableFuture:e.bool,disableHighlightToday:e.bool,disableOpenPicker:e.bool,disablePast:e.bool,displayWeekNumber:e.bool,enableAccessibleFieldDOMStructure:e.any,fixedWeekNumber:e.number,format:e.string,formatDensity:e.oneOf(["dense","spacious"]),inputRef:$,label:e.node,loading:e.bool,localeText:e.object,maxDate:e.object,minDate:e.object,monthsPerRow:e.oneOf([3,4]),name:e.string,onAccept:e.func,onChange:e.func,onClose:e.func,onError:e.func,onMonthChange:e.func,onOpen:e.func,onSelectedSectionsChange:e.func,onViewChange:e.func,onYearChange:e.func,open:e.bool,openTo:e.oneOf(["day","month","year"]),orientation:e.oneOf(["landscape","portrait"]),readOnly:e.bool,reduceAnimations:e.bool,referenceDate:e.object,renderLoading:e.func,selectedSections:e.oneOfType([e.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),e.number]),shouldDisableDate:e.func,shouldDisableMonth:e.func,shouldDisableYear:e.func,showDaysOutsideCurrentMonth:e.bool,slotProps:e.object,slots:e.object,sx:e.oneOfType([e.arrayOf(e.oneOfType([e.func,e.object,e.bool])),e.func,e.object]),timezone:e.string,value:e.object,view:e.oneOf(["day","month","year"]),viewRenderers:e.shape({day:e.func,month:e.func,year:e.func}),views:e.arrayOf(e.oneOf(["day","month","year"]).isRequired),yearsOrder:e.oneOf(["asc","desc"]),yearsPerRow:e.oneOf([3,4])};const Le=["desktopModeMediaQuery"],Ue=x.forwardRef(function(t,u){const l=F({props:t,name:"MuiDatePicker"}),{desktopModeMediaQuery:s=Pe}=l,o=q(l,Le);return Ne(s,{defaultMatches:!0})?a.jsx(W,c({ref:u},o)):a.jsx(B,c({ref:u},o))}),Ie=(d=!1)=>Z().shape({company_name:g().required("Company name is required").test("required","Company name is required",t=>!!t),address:g().required("Address is required").test("required","Address is required",t=>!!t),city:g().required("City is required").test("required","City is required",t=>!!t),state:g().required("State is required").test("required","State is required",t=>!!t),zip_code:g().test("required","Zip Code is required",t=>!(t===null||t==="")).test("format","Zip Code must be a 6 digit number",t=>t===null||t===""?!0:/^[0-9]{6}$/.test(t)),company_owner_name:g().required("Company Owner Name is required").test("required","Company Owner Name is required",t=>!!t),phone_number:g().nullable().test("format","Phone Number must be a 10-digit number",t=>t===null||t===""?!0:/^[0-9]{10}$/.test(t)).test("required","Phone Number is required",t=>!(t===null||t==="")),mobile_number:g().required("Mobile Number is required").matches(/^[0-9]{10}$/,"Mobile Number must be a 10-digit number").test("required","Mobile Number is required",t=>!!t).test("format","Mobile Number must be a 10-digit number",t=>t?/^[0-9]{10}$/.test(t):!0),email:g().required("Email is required").email("Enter a valid email").test("required","Email is required",t=>!!t),website:g().nullable().url("Please enter a valid website URL").test("required","Website URL is required",t=>!!t),logo:A().nullable().test("fileSize","Logo file is too large",t=>t&&t instanceof File?t.size<=2e6:!0).test("fileType","Unsupported logo format",t=>t&&t instanceof File?["image/jpeg","image/png","image/gif"].includes(t.type):!0).test("required","Logo is required",t=>d?!0:!!t),registration_number:g().nullable().test("required","Registration Number is required",t=>!!t),registration_date:H().nullable().required("Please select the registration date").typeError("Please select the registration date").max(new Date,"Registration Date cannot be in the future"),gstin:g().nullable().test("required","GSTIN is required",t=>!!t),company_ownedby:g().nullable().test("required","Company Owned By is required",t=>!(t===null||t==="")).test("format","Company Owned By must be a number",t=>t===null||t===""?!0:/^[0-9]+$/.test(t)),contract_document:A().nullable().test("fileSize","File is too large",t=>t&&t instanceof File?t.size<=5e6:!0).test("fileType","Unsupported file format",t=>t&&t instanceof File?["application/pdf"].includes(t.type):!0)}),Ge=()=>{const{addCompany:d,loading:t}=ve(),{updateCompany:u,loading:l}=Oe(),{id:s}=J(),o=Number(s),{company:n,fetchCompany:p}=te(),i=X(),[r,b]=x.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null}),[f,_]=x.useState({company_name:"",address:"",city:"",state:"",zip_code:"",company_owner_name:"",phone_number:"",mobile_number:"",email:"",website:"",logo:"",registration_number:"",registration_date:"",gstin:"",company_ownedby:null,contract_document:null}),[m,w]=x.useState({});x.useEffect(()=>{(async()=>{await p(o)})()},[o]),x.useEffect(()=>{if(n){const h={company_name:n.company_name,address:n.address,city:n.city,state:n.state,zip_code:n.zip_code,company_owner_name:n.company_owner_name,phone_number:n.phone_number,mobile_number:n.mobile_number,email:n.email,website:n.website,logo:n.logo,registration_number:n.registration_number,registration_date:n.registration_date,gstin:n.gstin,company_ownedby:n.company_ownedby,contract_document:n.contract_document};b(h),_(h)}},[n]);const y=h=>{const{name:D,value:C,type:j,files:T}=h.target;b(K=>({...K,[D]:j==="file"?T:C}))},O=h=>{b(D=>({...D,registration_date:h?h.format("MM-DD-YYYY"):""}))},G=async h=>{h.preventDefault();try{if(await Ie(!!o).validate(r,{abortEarly:!1}),!Object.keys(r).some(T=>T==="logo"?r.logo instanceof File||r.logo!==f.logo:r[T]!==f[T])){i("/branches");return}let j;o?j=await u(o,r):j=await d(r),j&&i("/companies")}catch(D){if(D instanceof ee){const C={};D.inner.forEach(j=>{C[j.path]=j.message}),w(C)}else N.error("Failed to submit the form. Please try again.")}},Q=()=>{i("/companies")};return a.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:o?"Edit Company":"Add Company"}),a.jsxs("form",{onSubmit:G,children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"company_name",children:"Company Name"}),a.jsx("input",{type:"text",id:"company_name",name:"company_name",value:r.company_name,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.company_name||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"address",children:"Address"}),a.jsx("input",{type:"text",id:"address",name:"address",value:r.address,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.address||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"city",children:"City"}),a.jsx("input",{type:"text",id:"city",name:"city",value:r.city,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.city||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"state",children:"State"}),a.jsx("input",{type:"text",id:"state",name:"state",value:r.state,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.state||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"zip_code",children:"Zip Code"}),a.jsx("input",{type:"text",id:"zip_code",name:"zip_code",value:r.zip_code,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.zip_code||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"company_owner_name",children:"Company Owner Name"}),a.jsx("input",{type:"text",id:"company_owner_name",name:"company_owner_name",value:r.company_owner_name,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.company_owner_name||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"phone_number",children:"Phone Number"}),a.jsx("input",{type:"text",id:"phone_number",name:"phone_number",value:r.phone_number,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.phone_number||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"mobile_number",children:"Mobile Number"}),a.jsx("input",{type:"text",id:"mobile_number",name:"mobile_number",value:r.mobile_number,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.mobile_number||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"email",children:"Email"}),a.jsx("input",{type:"text",id:"email",name:"email",value:r.email,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.email||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"website",children:"Website"}),a.jsx("input",{type:"text",id:"website",name:"website",value:r.website,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.website||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"logo",children:"Logo"}),a.jsx("input",{type:"file",id:"logo",name:"logo",accept:"image/*",onChange:y,className:"border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.logo||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"registration_number",children:"Registration Number"}),a.jsx("input",{type:"text",id:"registration_number",name:"registration_number",value:r.registration_number,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.registration_number||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"registration_date",children:"Registration Date"}),a.jsx(we,{dateAdapter:Ce,children:a.jsx(Ue,{value:r.registration_date?ae(r.registration_date):null,onChange:O,format:"DD-MM-YYYY",renderInput:h=>a.jsx("input",{...h,id:"registration_date",name:"registration_date",className:"input border border-gray-300 rounded-md p-2"})})}),a.jsx("p",{className:"text-red-500 text-sm",children:m.registration_date||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"gstin",children:"GSTIN"}),a.jsx("input",{type:"text",id:"gstin",name:"gstin",value:r.gstin,onChange:y,className:"input border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.gstin||" "})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"company_ownedby",children:"Company owned by"}),a.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"company_ownedby",value:r.company_ownedby??"",onChange:h=>b({...r,company_ownedby:Number(h.target.value)}),children:[a.jsx("option",{value:"",disabled:!0,children:"Select Ownership"}),a.jsx("option",{value:1,children:"Own"}),a.jsx("option",{value:2,children:"Other Company"})]}),a.jsx("p",{className:"w-full text-red-500 text-sm",children:m.company_ownedby||" "})]}),r.company_ownedby===2&&a.jsxs("div",{className:"flex flex-col",children:[a.jsx("label",{className:"mb-2 font-semibold",htmlFor:"contract_document",children:"Contract Document"}),a.jsx("input",{type:"file",id:"contract_document",name:"contract_document",accept:".pdf,.doc,.docx",onChange:y,className:"border border-gray-300 rounded-md p-2"}),a.jsx("p",{className:"text-red-500 text-sm",children:m.contract_document||" "})]})]}),a.jsxs("div",{className:"flex justify-start mt-6",children:[a.jsx("button",{type:"submit",className:"btn btn-primary mr-4",disabled:t||l,children:o?"Update Company":"Add Company"}),a.jsx("button",{type:"button",onClick:Q,className:"btn btn-secondary",children:"Cancel"})]})]})]})};export{Ge as default};
