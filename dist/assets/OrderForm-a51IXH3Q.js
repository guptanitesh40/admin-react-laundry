import{r as i,B as Y,V as g,c as Ae,a as Le,d as pe,p as $,I as bt,q as ft,A as vt,i as jt,J as Nt,H as wt,g as Ct,m as kt,j as e,L as qe,y as St,K as $t,f as Tt,t as It,M as Pt,k as Ee,b as Dt}from"./index-D24ck8V_.js";import{u as Ot}from"./useGetCategories-Bg9YBGMm.js";import{u as Ft}from"./useGetCompanies-CnZCV1HN.js";import{u as At}from"./useGetOrder-Ks3Ep6rp.js";import{u as qt,a as Et,A as Lt,C as Rt}from"./CustomerModal-ByGKn5C1.js";import{u as Gt}from"./useGetuser-BkPH2xvC.js";import"./userSchema-Bp5xQejk.js";const Ut=()=>{const[l,x]=i.useState(!1);return{loading:l,fetchProductsOnId:async y=>{const j=localStorage.getItem("authToken");x(!0);try{const b=await fetch(`${Y}/category/${y}/product`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`}}),p=await b.json();if(!b.ok){g.error(p.message,{position:"top-center"}),x(!1);return}return(p==null?void 0:p.data)||[]}catch(b){return g.error((b==null?void 0:b.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{x(!1)}}}},Bt=()=>{const[l,x]=i.useState(!1);return{loading:l,fetchServicesOnId:async(y,j)=>{const b=localStorage.getItem("authToken");x(!0);try{const p=await fetch(`${Y}/category/${y}/product/${j}/service`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}}),m=await p.json();if(!p.ok){g.error(m.message,{position:"top-center"}),x(!1);return}return(m==null?void 0:m.data)||[]}catch(p){return g.error((p==null?void 0:p.message)||"Network error: Failed to fetch.",{position:"top-center"}),[]}finally{x(!1)}}}},Mt="http://35.154.167.170:3000/admin/coupon/apply",zt=()=>{const[l,x]=i.useState(!1);return{applyCoupon:async(y,j,b)=>{const p=localStorage.getItem("authToken");x(!0);try{const m=await fetch(Mt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({user_id:y,order_Total:j,coupon_code:b})}),f=await m.json();return m.ok?f.data:(g.error(f.message,{position:"top-center"}),!1)}catch{g.error("Unable to apply coupon code!")}finally{x(!1)}},loading:l}},Vt=()=>{const[l,x]=i.useState([]),[v,y]=i.useState(!1),j=async b=>{const p=localStorage.getItem("authToken");y(!0);try{const m=await fetch(`${Y}/admin/valid-coupons?${b}`,{method:"GET",headers:{Authorization:p?`Bearer ${p}`:""}}),f=await m.json();if(!m.ok){g.error(f.message,{position:"top-center"}),y(!1);return}x(f==null?void 0:f.data)}catch{g.error("Network error: Failed to fetch coupons.")}finally{y(!1)}};return i.useEffect(()=>{j()},[]),{validCoupons:l,fetchValidCoupons:j,loading:v}},Yt=()=>{const[l,x]=i.useState([]),[v,y]=i.useState(!0),j=async()=>{const b=localStorage.getItem("authToken");y(!0);try{const p=await fetch(`${Y}/prices/admin`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}});if(!p.ok){const f=await p.json();Ae.error(f.message,{position:"top-center"});return}const m=await p.json();x((m==null?void 0:m.data)||[])}catch{Ae.error("Network error: Failed to fetch.")}finally{y(!1)}};return i.useEffect(()=>{j()},[]),{prices:l,loading:v,fetchPrices:j}},Kt=()=>{const[l,x]=i.useState(!1);return{updateOrder:async(y,j)=>{const b=localStorage.getItem("authToken"),p=`http://35.154.167.170:3000/admin/orders/${y}`;x(!0);try{const m=await fetch(p,{method:"PUT",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify(j)});if(m.ok){const E=await m.json();return g.success(E.message,{position:"top-center"}),!0}const f=await m.json();return g.error(f.message,{position:"top-center"}),!1}catch(m){return g.error((m==null?void 0:m.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{x(!1)}},loading:l}},Ht=Le().shape({category_id:$().nullable().required("Please select a category").test("required","Please select a category",l=>!!l),product_id:$().nullable().required("Please select a product").test("required","Please select a product",l=>!!l),service_id:$().nullable().required("Please select a service").test("required","Please select a service",l=>!!l),price:$().nullable().when(["category_id","product_id","service_id"],([l,x,v],y)=>l&&x&&v?y.required("Price is not available for the combination, please add a price"):y.nullable())}),Zt=Le().shape({username:pe().required("Please enter username"),address_id:$().required("Please select address").test("required","Please select address",l=>!!l),express_delivery_charges:$().typeError("Express delivery charges must be a number").min(0,"Express delivery charges must be a positive number"),shipping_charges:$().typeError("Shipping charge must be a number").min(0,"Shipping charge must be a positive number"),payment_type:$().required("Please choose payment type").test("required","Please choose payment type",l=>!!l),payment_status:$().required("Please choose payment status").test("required","Please choose payment status",l=>!!l),paid_amount:$().typeError("Paid amount must be a number").min(0,"Paid amount must be a positive number").test("max-paid","Paid amount cannot be greater than the total amount",function(l){var x;return l==null||l===0?!0:l<=((x=this.options.context)==null?void 0:x.total)}),branch_id:$().required("Please select branch").test("required","Please select branch",l=>!!l),items:bt().of(Ht),company_id:$().typeError("Company must be selected").required("Company is required"),gstin:pe().transform(l=>l===""?null:l).nullable().matches(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,"Please enter a valid GSTIN"),gst_company_name:pe().when("gstin",{is:l=>!!l,then:l=>l.required("Company name is required when GSTIN is provided"),otherwise:l=>l.notRequired()})}),Jt=()=>{const[l,x]=i.useState(null),[v,y]=i.useState(!0),j=async()=>{const b=localStorage.getItem("authToken");if(!b){g.error("Authentication token not found!"),y(!1);return}try{const p=await fetch(`${Y}/admin/settings`,{method:"GET",headers:{Authorization:`Bearer ${b}`}}),m=await p.json();if(!p.ok){g.error((m==null?void 0:m.message)||"Failed to fetch settings",{position:"top-center"});return}x((m==null?void 0:m.data)||{})}catch{g.error("Network Error: Failed to fetch settings")}finally{y(!1)}};return i.useEffect(()=>{j()},[]),{settings:l,loading:v}},rs=()=>{var Oe;const{prices:l,loading:x}=Yt(),{categories:v,loading:y}=Ot(),{fetchProductsOnId:j,loading:b}=Ut(),{fetchServicesOnId:p,loading:m}=Bt(),[f,E]=i.useState(""),[ee,q]=i.useState(!0),{id:U}=ft(),{updateOrder:Re,loading:K}=Kt(),{addOrder:Ge,loading:B}=qt(),I=Number(U),he=1e3,_e=1,{companies:M,loading:xe}=Ft(_e,he),[ye,ge]=i.useState(!1),[Ue,be]=i.useState(!1),[Be,fe]=i.useState(!1),[ve,te]=i.useState(!1),{users:se,fetchUsersByRole:je}=vt(),{validCoupons:H,fetchValidCoupons:Me}=Vt(),{branches:O,loading:Ne}=jt(_e,he),{order:c,loading:ze,fetchOrder:Ve}=At(),{address:F,fetchAddress:we}=Et(),{applyCoupon:Ye}=zt(),{userData:ae,fetchUser:Ke}=Gt(),{generatePaymentLink:He,loading:Ce}=Nt(),{settings:k,loading:re}=Jt(),L=ae==null?void 0:ae.user,Z=wt(),ne=((Oe=Z==null?void 0:Z.state)==null?void 0:Oe.prevUrl)||"/orders",oe=i.useRef(null),[z,le]=i.useState({}),[J,ke]=i.useState({}),ie=i.useRef(null),[Se,$e]=i.useState(!1),[Te,ce]=i.useState(null),[de,Ie]=i.useState(null),ue=Ct(t=>t==null?void 0:t.user),Q=kt(),[s,d]=i.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:2,payment_type:1,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null,company_id:null,gstin:"",gst_company_name:"",description:""}),[Ze,Je]=i.useState({coupon_code:"",coupon_discount:null,express_delivery_charges:null,express_delivery_hour:null,normal_delivery_charges:null,delivery_by:null,payment_type:null,payment_status:null,sub_total:0,paid_amount:null,kasar_amount:null,transaction_id:"",address_id:null,username:"",user_id:null,items:[{category_id:null,product_id:null,service_id:null,product_name:"",service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}],total:0,branch_id:null,order_status:null,company_id:null,gstin:"",gst_company_name:"",description:""}),[w,Pe]=i.useState({});i.useEffect(()=>{const t=a=>{ie.current&&!ie.current.contains(a.target)&&oe.current&&!oe.current.contains(a.target)&&(q(!1),$e(!1))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),i.useEffect(()=>{(async()=>{await Ve(I)})()},[I]),i.useEffect(()=>{if(F!=null&&F.length){const t=F.find(a=>a.is_default)||F[0];d(a=>({...a,address_id:t?t.address_id:null}))}},[F]),i.useEffect(()=>{(async()=>{s.user_id&&(await we(s.user_id),await Me(s.user_id),await Ke(s.user_id)),ve&&(await we(s.user_id),te(!1))})()},[s.user_id,ve]),i.useEffect(()=>{I||d(t=>({...t,payment_status:s.payment_type===1?1:null}))},[s.payment_type]),i.useEffect(()=>{(async()=>{Se&&(!f||f.trim()==="")?(q(!0),await je(5)):f&&ee&&await je(5,f)})()},[Se,f,ee]),i.useEffect(()=>{if(c){const t=`${c.user.first_name} ${c.user.last_name}`;E(t),q(!1);const a={coupon_code:c.coupon_code||"",coupon_discount:c.coupon_discount||null,express_delivery_charges:c.express_delivery_charges||null,express_delivery_hour:c.express_delivery_hour||null,normal_delivery_charges:c.normal_delivery_charges||null,payment_type:c.payment_type||null,payment_status:c.payment_status||null,sub_total:c.sub_total||0,paid_amount:c.paid_amount||null,kasar_amount:c.kasar_amount||null,transaction_id:c.transaction_id||"",address_id:c.address_id,username:t,user_id:c.user_id||null,items:c.items.map(r=>{var S,A,_,V;const o=r.category.category_id,u=((S=r.product)==null?void 0:S.product_id)||null,n=((A=r.service)==null?void 0:A.service_id)||null,N=((_=r.product)==null?void 0:_.name)||"",h=((V=r.service)==null?void 0:V.name)||"";z[o]||j(o).then(R=>{le(G=>({...G,[o]:R}))});const T=`${o}_${u}`;return J[T]||p(o,u).then(R=>{ke(G=>({...G,[T]:R}))}),{category_id:o,product_id:u,service_id:n,product_name:N,service_name:h,description:r.description||null,price:r.price,quantity:r.quantity,item_Total:r.price*r.quantity,showDescription:!!r.description}}),total:(c.sub_total||0)+(c.express_delivery_charges||0)+(c.normal_delivery_charges||0),branch_id:c.branch_id,order_status:c.order_status,delivery_by:c.delivery_by,company_id:c.company_id,gstin:c.gstin,gst_company_name:c.gst_company_name,description:c==null?void 0:c.description};d(a),Je(a),c.gst_company_name&&c.gstin&&ge(!0)}},[c]),i.useEffect(()=>{const t=(s.paid_amount||0)+(s.kasar_amount||0),a=s.total-t;let r=s.payment_status;s.total>0&&t===s.total?(r=2,ce(0)):t>0&&t<s.total?(r=3,ce(a)):t===0&&s.total>0&&(r=1,ce(a)),d(o=>({...o,payment_status:r}))},[s.paid_amount,s.kasar_amount,s.total]);const Qe=async t=>{t.preventDefault();try{const a=s.items.map(h=>({category_id:Number(h.category_id),product_id:Number(h.product_id),service_id:Number(h.service_id),description:h.description,price:Number(h.price),quantity:Number(h.quantity)})),r={...s,address_id:Number(s.address_id),coupon_discount:Number(s.coupon_discount),normal_delivery_charges:Number(s.normal_delivery_charges),kasar_amount:Number(s.kasar_amount),paid_amount:Number(s.paid_amount),express_delivery_charges:Number(s.express_delivery_charges),payment_type:Number(s.payment_type),payment_status:Number(s.payment_status),order_status:I?s.order_status:4,items:a,company_id:s.company_id,gstin:s.gstin,gst_company_name:s.gst_company_name},o=s.total;if(await Zt.validate(r,{abortEarly:!1,context:{total:o}}),Pe({}),!Object.keys(s).some(h=>s[h]!==Ze[h])){Q(`${ne}`);return}let n;const N={...r};N.company_id||delete N.company_id,c?n=await Re(I,N):n=await Ge(r),n&&Q(`${ne}`)}catch(a){if(a instanceof Dt){const r={};a.inner.forEach(o=>{r[o.path||""]=o.message}),Pe(r)}else g.error("Failed to submit the form. Please try again.")}},We=t=>{t.target.value===""&&d(a=>({...a,address_id:null,user_id:null})),E(t.target.value),q(!0)},Xe=t=>{const a=`${t.first_name} ${t.last_name}`;E(a),q(!1),d({...s,username:a,user_id:t.user_id})},et=()=>{Q(`${ne}`)},tt=()=>{d(t=>{const a=t.items[t.items.length-1];return{...t,items:[...t.items,{category_id:(a==null?void 0:a.category_id)||null,product_id:null,product_name:"",service_id:null,service_name:"",description:null,price:null,quantity:1,item_Total:null,showDescription:!1}]}})},st=t=>{d(a=>{const r=a.items.filter((N,h)=>h!==t),o={...a,items:r,coupon_code:"",coupon_discount:0},u=me(o),n=u+Number(s.express_delivery_charges||0)+Number(s.normal_delivery_charges||0);return{...o,sub_total:u,total:n}})},P=async(t,a,r)=>{["category_id","product_id","service_id","price","quantity"].includes(a)&&d(o=>({...o,coupon_code:"",coupon_discount:0})),d(o=>{const u=o.items.map((S,A)=>{if(A===t){const _={...S,[a]:r};a==="showDescription"&&(_.showDescription=r);const V=Number(_.category_id),R=Number(_.product_id),G=Number(_.service_id),Fe=Number(_.quantity)||1;if(a==="category_id"){const D=Number(r);z[D]||j(D).then(W=>{le(X=>({...X,[D]:W}))}),_.product_id=null,_.service_id=null,_.price=null,_.quantity=1,_.item_Total=null}if(a==="product_id"){const D=Number(S.category_id),W=Number(r),X=`${D}_${W}`;J[X]||p(D,W).then(yt=>{ke(gt=>({...gt,[X]:yt}))}),_.service_id=null,_.price=null,_.quantity=1,_.item_Total=null}if(["category_id","product_id","service_id"].includes(a)&&a!=="category_id"&&a!=="product_id")if(V&&R&&G){const D=at(V,R,G);_.price=D,_.item_Total=D*Fe}else _.price=null,_.item_Total=null;else a==="price"?_.item_Total=r*Fe:a==="quantity"&&(_.item_Total=_.price*Number(r));return _}return S}),n={...o,items:u},h=me(n)-o.coupon_discount,T=h+Number(o.express_delivery_charges||0)+Number(o.normal_delivery_charges||0);return{...n,sub_total:h,total:T}})},at=(t,a,r)=>{const o=`${t}_${a}_${r}`;return l[o]||0},rt=async t=>{const a=me(s);if(!a){g.error("Please add items first to apply the coupon code.");return}const r=await Ye(s.user_id,a,t),o=Number(r.finalTotal||0)+Number(s.express_delivery_charges||0)+Number(s.normal_delivery_charges||0);if(r&&(r&&d(u=>({...u,coupon_code:t,coupon_discount:r.discountAmount,sub_total:r.finalTotal,total:o})),s.express_delivery_hour)){const u=`express_delivery_${s.express_delivery_hour}hrs`,n=k[u],N=Number(n)/100;if(isNaN(N)){g.error("Invalid delivery charge percentage!");return}d(h=>{const T=Math.floor(h.sub_total*N);return{...h,express_delivery_charges:T,total:h.sub_total+T}})}},me=t=>t.items.reduce((a,r)=>a+(r.item_Total||0),0),De=(t,a)=>{d(r=>{const o={...r,[t]:a},u=Number(o.sub_total||0)+Number(o.express_delivery_charges||0)+Number(o.normal_delivery_charges||0);return{...o,total:u}})},nt=t=>{const a=t.target.value;d(r=>({...r,address_id:Number(a)}))},ot=t=>{t.preventDefault(),s.user_id?be(!0):g.error("Please select the user to add address")},lt=t=>{t.preventDefault(),fe(!0)},it=()=>{Q(`/order/${I}`)},ct=async()=>{const t=[];if(s.total||t.push("item total"),s.username||t.push("customer name"),t.length>0){g.error(`Please add required fields: ${t.join(", ")}`);return}const a={amount:s.total,currency:"INR",user_id:s.user_id,customer:{name:s.username,contact:L==null?void 0:L.mobile_number,email:L==null?void 0:L.email}};await He(a)},dt=(t,a)=>{if(t){const r=`${t.first_name} ${t.last_name}`;E(r),q(!1),d({...s,username:r,user_id:t.user_id})}a&&d(r=>({...r,address_id:a.address_id}))},ut=t=>{t&&d(a=>({...a,address_id:t.address_id}))},mt=()=>{var a,r;const t=(r=(a=s==null?void 0:s.items)==null?void 0:a[0])==null?void 0:r.item_Total;return typeof t=="number"&&t>0?s.items.length:0},pt=()=>{var a,r,o;return Number((r=(a=s==null?void 0:s.items)==null?void 0:a[0])==null?void 0:r.item_Total)>0?(o=s==null?void 0:s.items)==null?void 0:o.reduce((u,n)=>u+Number(n.quantity||0),0):0},ht=t=>{if(!s.sub_total){g.error("Please add items first");return}if(k&&!re){if(s.normal_delivery_charges&&d(n=>({...n,normal_delivery_charges:null})),!t){d(n=>({...n,total:n.total-n.express_delivery_charges,express_delivery_hour:null,express_delivery_charges:null,normal_delivery_charges:null}));return}const a=`express_delivery_${t}hrs`,r=k[a],o=Number(r)/100;if(isNaN(o)){g.error("Invalid delivery charge percentage!");return}const u=Math.floor(s.sub_total*o);d(n=>({...n,express_delivery_hour:t,express_delivery_charges:u,total:n.sub_total+u}))}else g("Settings data not found!")};i.useEffect(()=>{if(s.express_delivery_hour&&k&&!re&&s.sub_total>0){const t=`express_delivery_${s.express_delivery_hour}hrs`,a=k[t],r=Number(a)/100;if(!isNaN(r)){const o=Math.floor(s.sub_total*r);d(u=>({...u,express_delivery_charges:o,total:u.sub_total+o}))}}},[s.sub_total]),i.useEffect(()=>{if(!U&&(O!=null&&O.length)&&ue&&!Ne){const t=ue.user_branch||[];if(t.length){const a=O.find(r=>r.branch_id===t[0]);a&&d(r=>({...r,branch_id:a.branch_id}))}else d(a=>({...a,branch_id:O[0].branch_id}))}},[U,O,ue,Ne]),i.useEffect(()=>{if(!xe&&M.length>0&&!U){const t=M.find(a=>a.gst_percentage===6);t&&d({...s,company_id:t.company_id})}},[M]);const _t=async()=>{const t=["men","women","kids","household"],a=[...v].sort((u,n)=>{const N=t.indexOf(u.name.toLowerCase()),h=t.indexOf(n.name.toLowerCase());return(N===-1?1/0:N)-(h===-1?1/0:h)})[0];if(!a)return;const r=a==null?void 0:a.category_id;d(u=>{const n=[...u.items];return n[0]={...n[0],category_id:r},{...u,items:n}});let o=z[r];o||(o=await j(r),le(u=>({...u,[r]:o})))};i.useEffect(()=>{Z.pathname==="/order/add"&&(v!=null&&v.length)&&!y&&_t()},[v]);const xt=({express_delivery_charges:t,express_delivery_hour:a})=>{if(re||!(k!=null&&k.estimate_delivery_normal_day))return null;const r=Number(k==null?void 0:k.estimate_delivery_normal_day);return t&&a?Ee().add(a,"hour").format("DD/MM/YYYY"):Ee().add(r,"day").format("DD/MM/YYYY")};i.useEffect(()=>{const t=xt({express_delivery_charges:s==null?void 0:s.express_delivery_charges,express_delivery_hour:s==null?void 0:s.express_delivery_hour});Ie(t||null)},[s==null?void 0:s.express_delivery_charges,s==null?void 0:s.express_delivery_hour,k]);const C=(c==null?void 0:c.order_status)===11;return ze&&U?e.jsx(qe,{}):x?e.jsx(qe,{}):e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"card max-w-5xl mx-auto bg-white shadow-md lg:!p-4 xl:!p-6 sm:!p-5 p-3.5",children:[e.jsxs("div",{className:"flex",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:c?"Edit Order":"Add Order"}),!isNaN(I)&&e.jsxs("button",{className:"btn bg-gray-200 ml-4 text-gray-700 text-sm font-bold rounded-md",onClick:it,children:[e.jsx(St,{size:20}),"View Order"]})]}),e.jsxs("form",{onSubmit:Qe,children:[e.jsxs("div",{className:"grid md:grid-cols-2 cs1:gap-x-6 gap-x-4  gap-y-5 mt-4 grid-cols-1",children:[e.jsxs("div",{className:"md:!col-span-2 grid md:!grid-cols-3 cs1:gap-x-6 gap-x-4 items-start grid-cols-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"company_id",children:"Company"}),e.jsxs("select",{id:"company_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.company_id||"",onChange:t=>{d({...s,company_id:t.target.value?Number(t.target.value):null})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Company"}),xe?e.jsx("option",{children:"loading..."}):M.length>0?M.map(t=>e.jsx("option",{value:t.company_id,children:`${t.company_name} (${t.gst_percentage}%)`},t.company_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:w.company_id||" "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"branch",className:"!block text-gray-700 text-sm font-bold mb-2",children:"Branch"}),e.jsxs("select",{id:"branch",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.branch_id||"",onChange:t=>d({...s,branch_id:t.target.value?Number(t.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch"}),O.length>0?O.map(t=>e.jsx("option",{value:t.branch_id,children:t.branch_name},t.branch_id)):e.jsx("option",{children:"No Data Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.branch_id||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"delivery_by",className:"block text-gray-700 text-sm font-bold mb-2",children:"Delivery By"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"delivery_by",value:s.delivery_by||"",onChange:t=>{d({...s,delivery_by:Number(t.target.value)})},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Delivery By"}),e.jsx("option",{value:1,children:"Home"}),e.jsx("option",{value:2,children:"Shop"})]})]})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer name"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6 sm:btn-lg",onClick:lt,children:"Add Customer"})]}),e.jsx("input",{type:"text",id:"username",ref:oe,autoComplete:"off",value:f||"",onChange:We,className:"input border border-gray-300 rounded-md p-2 w-full mb-2",placeholder:"Search customer...",onFocus:()=>{$e(!0),q(!0)}}),se&&ee&&e.jsx("ul",{ref:ie,className:"absolute -mt-2 bg-white border z-10 border-gray-300 rounded-md p-2 w-full text-sm max-h-[400px] overflow-y-auto",children:se.length>0?se.map(t=>e.jsxs("li",{className:"p-2 hover:bg-gray-200 cursor-pointer rounded",onClick:()=>Xe(t),children:[t.first_name," ",t.last_name," (",t.mobile_number,")"]},t.user_id)):e.jsx("li",{className:"p-2 text-gray-500",children:"No users found"})}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.username||" "})]}),e.jsxs("div",{className:"relative col-span-1",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"address",className:"block text-gray-700 text-sm font-bold mb-2",children:"Customer address"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary -mt-6",onClick:ot,children:"Add address"})]}),e.jsxs("select",{id:"address",value:s.address_id??"",onChange:nt,className:"select border border-gray-300 rounded-md w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Address"}),F.length>0&&f?F.map(t=>{const{building_number:a,area:r,landmark:o,city:u,state:n,country:N,pincode:h}=t,S=[a,r,o,u,n,N,h].filter(Boolean).join(", ");return e.jsx("option",{value:t.address_id,children:S},t.address_id)}):e.jsx("option",{disabled:!0,children:"No Address Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.address_id||" "})]})]}),e.jsx("div",{className:"flex flex-wrap",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900 mt-6 mb-5 ml-1",children:"Item"})}),s.items.map((t,a)=>{var o,u;const r=s.items.length===1||C;return e.jsx($t.Fragment,{children:e.jsxs("div",{className:"border border-gray-200 rounded-xl mt-4 xl:!p-4 space-y-2 p-3.5 max-w-full overflow-hidden",children:[e.jsx("div",{children:e.jsxs("div",{className:"grid res-item-container",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`category${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Category"}),e.jsxs("select",{id:`category${a}`,value:t.category_id??"",onChange:n=>P(a,"category_id",n.target.value),disabled:C,className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Category"}),y?e.jsx(e.Fragment,{children:e.jsx("option",{children:"Loading..."})}):v.length>0?v.sort((n,N)=>{const h=["men","women","kids","household"],T=_=>_.trim().toLowerCase(),S=h.indexOf(T(n.name)),A=h.indexOf(T(N.name));return S===-1&&A===-1?n.name.localeCompare(N.name):(S===-1?1/0:S)-(A===-1?1/0:A)}).map(n=>e.jsx("option",{value:n.category_id,children:n.name},n.category_id)):e.jsx("option",{children:"No Category Available"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].category_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`product${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Product"}),e.jsxs("select",{id:`product${a}`,value:t.product_id??"",onChange:n=>P(a,"product_id",n.target.value),disabled:C,className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Product"}),t.category_id?b?e.jsx("option",{children:"Loading..."}):((o=z[t.category_id])==null?void 0:o.length)>0?z[t.category_id].map(n=>e.jsx("option",{value:n.product_product_id,children:n.product_name},n.product_product_id)):t.product_id?e.jsx("option",{value:t.product_id,children:t.product_name},t.product_id):e.jsx("option",{children:"No Product Available"}):e.jsx("option",{disabled:!0,children:"Please select a category"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].product_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`service${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Service"}),e.jsxs("select",{id:`service${a}`,value:t.service_id??"",onChange:n=>P(a,"service_id",n.target.value),disabled:C,className:"select border border-gray-300 rounded-md p-2 w-full text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Service"}),t.product_id?m?e.jsx("option",{children:"Loading..."}):((u=J[`${t.category_id}_${t.product_id}`])==null?void 0:u.length)>0?J[`${t.category_id}_${t.product_id}`].map(n=>e.jsx("option",{value:n.service_service_id,children:n.service_name},n.service_service_id)):t.service_id?e.jsx("option",{value:t.service_id,children:t.service_name},t.service_id):e.jsx("option",{children:"No service available"}):e.jsx("option",{disabled:!0,children:"Please select a product"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].service_id`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`price${a}`,children:"Price"}),e.jsx("input",{type:"text",id:`price${a}`,value:t.price||"",onChange:n=>P(a,"price",Number(n.target.value)),disabled:C,className:"input border rounded-md p-2 w-full border-gray-300 bg-gray-100 text-sm text-gray-600"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w[`items[${a}].price`]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`quantity${a}`,children:"Quantity"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:`quantity${a}`,autoComplete:"off",value:t.quantity??1,onChange:n=>P(a,"quantity",Number(n.target.value)),disabled:C,className:"w-full p-2 text-sm focus:outline-none input text-center"}),e.jsx("button",{type:"button",className:`absolute top-1/2 left-1.5 -translate-y-1/2 p-1 rounded hover:bg-gray-200 transition ${C?"!cursor-not-allowed":""}`,onClick:()=>P(a,"quantity",Math.max(1,(t.quantity??1)-1)),disabled:C,children:e.jsx("i",{className:`ki-filled ki-minus text-base ${C?"text-gray-300":"text-gray-500"}`})}),e.jsx("button",{type:"button",className:`absolute top-1/2 right-1.5 -translate-y-1/2 p-1 rounded hover:bg-gray-200 transition ${C?"!cursor-not-allowed":""}`,onClick:()=>P(a,"quantity",(t.quantity??1)+1),disabled:C,children:e.jsx("i",{className:`ki-filled ki-plus text-base ${C?"text-gray-300":"text-gray-500"}`})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Item total"}),e.jsx("input",{type:"text",value:t.item_Total??"",onChange:n=>P(a,"item_Total",n.target.value),min:"0",step:"0.01",disabled:C,readOnly:!0,className:"input w-full border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:!border-gray-300"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:`description_checkbox${a}`,className:"block text-gray-700 text-sm font-bold mb-2",children:"Remarks"}),e.jsx("div",{className:"h-full w-full flex items-center cs2:justify-center justify-start cs2:ml-0 lgmobile:!ml-4 ml-[9px]",children:e.jsx("input",{className:"checkbox checkbox-lg",id:`description_checkbox${a}`,"data-datatable-check":"true",type:"checkbox",checked:t.showDescription,onChange:n=>P(a,"showDescription",n.target.checked),disabled:C})})]}),e.jsxs("div",{className:"flex flex-col items-center max-w-[40px]",children:[e.jsx("label",{className:"text-gray-700 text-sm font-bold mb-2 lgmobile:block hidden",children:" "}),e.jsx("div",{className:"grow flex justify-center items-center",children:e.jsx("button",{type:"button",className:`p-2 rounded-full ${r?"bg-gray-200 !cursor-not-allowed":"bg-red-100 hover:bg-red-200"}`,onClick:()=>st(a),disabled:r,children:e.jsx(Tt,{className:`${r?"text-gray-400":"text-red-500"}`})})})]})]})}),e.jsx("div",{className:"flex justify-between sm:items-center smmobile:flex-col gap-y-2 smmobile:w-full",children:e.jsx("div",{children:t.showDescription&&e.jsx("div",{children:e.jsxs("div",{className:"flex mt-2 smmobile:w-[100%] smmobile:justify-self-start flex-col md:w-[350px] lg:w-[420px] sm:w-[300px] h-[80px] mb-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Description"}),e.jsx("textarea",{id:"description",value:t.description||"",onChange:n=>P(a,"description",n.target.value),className:"h-full input border border-gray-300 rounded-md p-2 w-full"})]})})})})]})},a)}),e.jsxs("div",{className:"flex bndesktop:!items-center justify-start cs2:gap-12 sm:!gap-8 flex-wrap bndesktop:!gap-4 gap-2 bndesktop:!flex-row flex-col items-start mb-2",children:[e.jsx("button",{type:"button",onClick:tt,className:"btn btn-primary bndesktop:!mb-6 mt-4",disabled:C,children:"Add Item"}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Items : ",mt()]}),e.jsxs("p",{className:"block text-gray-900 text-sm font-bold",children:["Total Quantity : ",pt()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 cs1:!gap-6 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:"Order Note"}),e.jsx("textarea",{rows:3,id:"description",value:s.description,onChange:t=>d({...s,description:t.target.value}),className:"h-full input border border-gray-300 rounded-md p-2 w-full"})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"coupon_code",children:"Coupon Code"}),e.jsxs("select",{id:"coupon_code",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:s.coupon_code??"",onChange:t=>{const a=H.find(r=>r.code===t.target.value);rt(a==null?void 0:a.code)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select Coupon Code"}),H&&H.length>0?H.map(t=>e.jsxs("option",{value:t.code,children:[t.code," ",s.coupon_code===t.code?"":`(min: ${t.min_cart_value||0})`]},t.coupon_id)):e.jsx("option",{children:"No Coupons available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:w.coupon_code||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Coupon Discount"}),e.jsx("input",{type:"text",value:s.coupon_discount||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.coupon_discount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Sub Total"}),e.jsx("input",{type:"text",value:s.sub_total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.sub_total||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"kasar_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Kasar amount"}),e.jsx("input",{type:"text",id:"kasar_amount",autoComplete:"off",value:s.kasar_amount||"",onChange:t=>{d({...s,kasar_amount:Number(t.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"})]}),e.jsxs("div",{className:"flex flex-col md:!col-span-2",children:[e.jsxs("div",{className:"md:!col-span-2 grid sm:!grid-cols-3 cs1:!gap-6 gap-4 grid-cols-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"exp_delivery_time",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Time"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"exp_delivery_time",value:s.express_delivery_hour||"",onChange:t=>{ht(Number(t.target.value))},children:[e.jsx("option",{value:"",children:"Select Express Delivery Time"}),e.jsx("option",{value:24,children:"24 Hrs"}),e.jsx("option",{value:48,children:"48 Hrs"}),e.jsx("option",{value:72,children:"72 Hrs"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"express_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Express Delivery Charge"}),e.jsx("input",{type:"text",id:"express_delivery_charges",autoComplete:"off",min:"0",value:s.express_delivery_charges||"",onChange:t=>De("express_delivery_charges",t.target.value),className:`${s.normal_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:s.normal_delivery_charges>0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"normal_delivery_charges",className:"block text-gray-700 text-sm font-bold mb-2",children:"Normal Delivery Charge"}),e.jsx("input",{type:"text",id:"normal_delivery_charges",min:"0",autoComplete:"off",value:s.normal_delivery_charges||"",onChange:t=>De("normal_delivery_charges",t.target.value),className:`${s.express_delivery_charges>0?"input border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed focus:outline-none":"input border border-gray-300 rounded-md p-2"}`,readOnly:s.express_delivery_charges>0})]})]}),de&&!I&&e.jsx("p",{className:"w-full text-green-500 text-sm font-medium mt-1",children:`Your order will be delivered on ${de||" "}`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Total"}),e.jsx("input",{type:"text",value:s.total||"",readOnly:!0,className:"input border border-gray-300 bg-gray-100 text-sm text-gray-600 rounded-md p-2 cursor-not-allowed focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Method"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_method",value:s.payment_type??"",onChange:t=>d({...s,payment_type:Number(t.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Type"}),e.jsx("option",{value:1,children:"Cash on Delivery"}),e.jsx("option",{value:2,children:"Online Payment"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.payment_type||" "}),!I&&s.payment_type===2&&e.jsx("div",{children:e.jsxs("button",{type:"button",className:"relative min-w-[160px] min-h-[40px] flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 border border-blue-500 rounded-lg hover:bg-blue-100 transition disabled:opacity-50",onClick:ct,disabled:Ce,children:[e.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:Ce?e.jsx(It,{}):e.jsx(Pt,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{children:"Send Payment Link"})]})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"paid_amount",className:"block text-gray-700 text-sm font-bold mb-2",children:"Paid amount"}),e.jsx("input",{type:"text",id:"paid_amount",autoComplete:"off",value:s.paid_amount||"",onChange:t=>{d({...s,paid_amount:Number(t.target.value)})},className:"input border border-gray-300 rounded-md p-2",min:"0",step:"0.01"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.paid_amount||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"payment_status",className:"block text-gray-700 text-sm font-bold mb-2",children:"Payment Status"}),e.jsxs("select",{className:"select border border-gray-300 rounded-md p-2 w-full text-sm",id:"payment_status",value:s.payment_status??"",onChange:t=>d({...s,payment_status:Number(t.target.value)}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Payment Status"}),e.jsx("option",{value:1,children:"Pending"}),e.jsx("option",{value:2,children:"Received"}),e.jsx("option",{value:3,children:"Partial Received"})]}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.payment_status}),s.payment_status===2&&Te>0&&e.jsx("p",{className:"w-full text-red-500 text-sm",children:`Remaining amount Rs ${Te}`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"transaction_id",className:"block text-gray-700 text-sm font-bold mb-2",children:"Transaction ID"}),e.jsx("input",{type:"text",id:"transaction_id",autoComplete:"off",value:s.transaction_id??"",onChange:t=>d({...s,transaction_id:t.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"})]}),e.jsxs("div",{className:"flex flex-col justify-center items-start",children:[e.jsx("label",{htmlFor:"have_gst_cb",className:"block text-gray-700 text-sm font-bold mb-2",children:"Do you have GSTIN ?"}),e.jsx("input",{className:"checkbox",id:"have_gst_cb",name:"check",type:"checkbox",checked:ye,onChange:t=>{ge(t.target.checked)}})]}),ye&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"gstin",className:"block text-gray-700 text-sm font-bold mb-2",children:"GSTIN"}),e.jsx("input",{type:"text",id:"gstin",autoComplete:"off",value:s.gstin,onChange:t=>d({...s,gstin:t.target.value}),className:"uppercase input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.gstin||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"gst_company_name",className:"block text-gray-700 text-sm font-bold mb-2",children:"Company Name"}),e.jsx("input",{type:"text",id:"gst_company_name",autoComplete:"off",value:s.gst_company_name,onChange:t=>d({...s,gst_company_name:t.target.value}),className:"input border border-gray-300 text-sm text-gray-600 rounded-md p-2 focus:outline-none"}),e.jsx("p",{className:"w-full text-red-500 text-sm",children:w.gst_company_name||" "})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${B||K?"opacity-50 cursor-not-allowed":""}`,disabled:B||K,children:B||K?B?"Adding...":"Updating...":I?"Update Order":"Add Order"}),e.jsx("button",{type:"button",onClick:et,className:"btn btn-secondary",disabled:B||K,children:"Cancel"})]})]}),e.jsx(Lt,{onAddressAdded:ut,isOpen:Ue,setIsSubmit:te,onClose:()=>be(!1),userId:s.user_id,fullname:s.username}),e.jsx(Rt,{onCustomerCreated:dt,isOpen:Be,setIsSubmit:te,onClose:()=>fe(!1)})]})})};export{rs as default};
