import{r as m,V as u,a as P,m as q,d as p,n as A,v as D,k as $,j as e,b as R}from"./index-Dj_PsRHk.js";import{u as U}from"./useGetCompanies-Bh5mHeZp.js";import{u as I}from"./useGetBranch-CB8nYIex.js";const T="http://35.154.167.170:3000",O=`${T}/branches`,L=()=>{const[a,o]=m.useState(!1);return{addBranch:async s=>{const i=localStorage.getItem("authToken");o(!0),s.company_id&&typeof s.company_id!="number"&&(s.company_id=Number(s.company_id));const l={...s,company_id:parseInt(s.company_id),branch_manager_id:parseInt(s.branch_manager_id)};try{const c=await fetch(O,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(!c.ok){const n=await c.json();return u.error(n.message,{position:"top-center"}),!1}const g=await c.json();return u.success(g.message,{position:"top-center"}),!0}catch(c){return u.error((c==null?void 0:c.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{o(!1)}},loading:a}},M=()=>{const[a,o]=m.useState(!1);return{updateBranch:async(s,i)=>{const l=localStorage.getItem("authToken"),c=`http://35.154.167.170:3000/branches/${s}`;o(!0);const g={...i,company_id:parseInt(i.company_id),branch_manager_id:parseInt(i.branch_manager_id)};try{const n=await fetch(c,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(n.ok){const f=await n.json();return u.success(f.message,{position:"top-center"}),!0}const N=await n.json();return u.error(N.message,{position:"top-center"}),!1}catch(n){return u.error((n==null?void 0:n.message)||"Network error: Failed to fetch.",{position:"top-center"}),!1}finally{o(!1)}},loading:a}},G=P().shape({branch_name:p().required("Branch name is required"),branch_address:p().required("Please add branch address"),branch_phone_number:p().nullable().test("required","Please add phone number",a=>!(a===null||a==="")).test("is-numeric","Phone number must be a positive number",a=>a?/^[0-9+\-\s()]{5,15}$/.test(a):!0).test("length","Phone number must be between 5 to 15 long",a=>a?a.length>=5&&a.length<=15:!0),branch_mobile_number:p().nullable().test("is-numeric","Phone number must be a positive number",a=>a?/^[0-9+\-\s()]{5,15}$/.test(a):!0).test("length","Phone number must be between 5 to 15 long",a=>a?a.length>=5&&a.length<=15:!0),branch_email:p().required("Email is required").email("Enter a valid email").test("required","Email is required",a=>!!a),branch_registration_number:p().nullable().test("required","Branch registration number is required",a=>!!a),company_id:q().required("Please select company").test("required","Please select company",a=>!!a)}),J=()=>{const{addBranch:a,loading:o}=L(),{updateBranch:j,loading:s}=M(),{id:i}=A(),l=i?Number(i):null,c=1e3,g=1,{branch:n,fetchBranch:N}=I(),{companies:f}=U(g,c),{users:B,fetchUsersByRole:C}=D(),v=$(),[t,y]=m.useState({branch_name:"",branch_address:"",branch_manager_id:null,branch_phone_number:"",branch_mobile_number:"",branch_email:"",branch_registration_number:"",company_id:null}),[w,k]=m.useState({branch_name:"",branch_address:"",branch_manager_id:null,branch_phone_number:"",branch_mobile_number:"",branch_email:"",branch_registration_number:"",company_id:null}),[h,F]=m.useState({});m.useEffect(()=>{l&&(async()=>await N(l))()},[l]),m.useEffect(()=>{(async()=>{await C(3)})()},[]),m.useEffect(()=>{if(n){const r={branch_name:n.branch_name,branch_address:n.branch_address,branch_manager_id:n.branch_manager_id,branch_phone_number:n.branch_phone_number,branch_mobile_number:n.branch_mobile_number,branch_email:n.branch_email,branch_registration_number:n.branch_registration_number,company_id:n.company_id};y(r),k(r)}},[n]);const _=r=>{const{name:x,value:d}=r.target;y(b=>({...b,[x]:d}))},E=async r=>{r.preventDefault();try{if(await G.validate(t,{abortEarly:!1}),!Object.keys(t).some(b=>t[b]!==w[b])){v("/branches");return}let d;l?d=await j(i,t):d=await a(t),d&&v("/branches")}catch(x){if(x instanceof R){const d={};x.inner.forEach(b=>{d[b.path||""]=b.message}),F(d)}else u.error("Failed to submit the form. Please try again.")}},S=()=>{v("/branches")};return e.jsxs("div",{className:"card max-w-4xl mx-auto p-6 bg-white shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:l?"Edit Branch":"Add Branch"}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"company_id",children:"Company"}),e.jsxs("select",{id:"company_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:t.company_id||"",onChange:r=>y({...t,company_id:r.target.value?Number(r.target.value):null}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Company"}),f.length>0?f.map(r=>e.jsx("option",{value:r.company_id,children:r.company_name},r.company_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm",children:h.company_id||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_manager_id",children:"Branch Manager"}),e.jsxs("select",{id:"branch_manager_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:t.branch_manager_id||"",onChange:r=>y({...t,branch_manager_id:r.target.value?Number(r.target.value):null}),children:[e.jsx("option",{value:"",selected:!0,children:"Select Branch Manager"}),B?B.map(r=>e.jsxs("option",{value:r.user_id,children:[r.first_name," ",r.last_name]},r.user_id)):e.jsx("option",{children:"No Data available"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_name",children:"Branch name"}),e.jsx("input",{type:"text",id:"branch_name",name:"branch_name",autoComplete:"off",value:t.branch_name||"",onChange:_,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:h.branch_name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_address",children:"Address"}),e.jsx("textarea",{id:"branch_address",name:"branch_address",value:t.branch_address||"",onChange:_,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:h.branch_address||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_phone_number",children:"Phone number 1"}),e.jsx("input",{type:"text",id:"branch_phone_number",name:"branch_phone_number",autoComplete:"off",value:t.branch_phone_number||"",onChange:_,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:h.branch_phone_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_mobile_number",children:"Phone number 2"}),e.jsx("input",{type:"text",id:"branch_mobile_number",name:"branch_mobile_number",autoComplete:"off",value:t.branch_mobile_number||"",onChange:_,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:h.branch_mobile_number||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_email",children:"Email"}),e.jsx("input",{type:"text",id:"branch_email",name:"branch_email",autoComplete:"off",value:t.branch_email||"",onChange:_,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:h.branch_email||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 font-semibold",htmlFor:"branch_registration_number",children:"Branch Registration Number"}),e.jsx("input",{type:"text",id:"branch_registration_number",name:"branch_registration_number",autoComplete:"off",value:t.branch_registration_number||"",onChange:_,className:"input border border-gray-300 rounded-md p-2"}),e.jsx("p",{className:"text-red-500 text-sm",children:h.branch_registration_number||" "})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary mt-5 ${o||s?"opacity-50 cursor-not-allowed":""}`,disabled:o||s,children:o||s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):l?"Update Branch":"Add Branch"}),e.jsx("button",{type:"button",className:"mx-5 btn btn-light mt-5",onClick:S,disabled:o||s,children:"Cancel"})]})]})]})};export{J as default};
