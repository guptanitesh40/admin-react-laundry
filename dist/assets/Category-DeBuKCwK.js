import{r as a,n as v,_ as f,c as V,a as K,j as e,V as M,G as z,u as W,F as Z,b as H,d as Q,e as X}from"./index-jKd1kMjl.js";import{S as w}from"./sweetalert2.esm.all-DwEdJQJv.js";import{u as ee}from"./useGetCategories-BDA0fUIp.js";import{T as te}from"./TableShimmer-BIB_f2x6.js";import{F as L,a as B,s as ae}from"./searchSchema-Bkc3hwST.js";const se="http://35.154.167.170:3000/admin/categories",re=()=>{const[s,l]=a.useState(!1);return{addCategory:async i=>{const o=localStorage.getItem("authToken");l(!0);try{const t=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:""},body:JSON.stringify({name:i})});if(!t.ok){const h=(await t.json()).message||"Failed to add category.";return v.error(h,{position:"top-center"}),{success:!1}}const n=await t.json();return v.success(n.message||"Category added successfully!",{position:"top-center"}),{success:!0}}catch(t){return t.name==="TypeError"&&t.message.includes("Failed to fetch")?v.error("Network error: Failed to fetch.",{position:"top-center"}):v.error("An unexpected error occurred.",{position:"top-center"}),{success:!1}}finally{l(!1)}},loading:s}},oe=s=>{const[l,u]=a.useState(!1),[i,o]=a.useState([]);return a.useEffect(()=>{(async()=>{var h;if(!s){o(null);return}const n=localStorage.getItem("authToken"),c=`http://35.154.167.170:3000/admin/categories/${s}`;u(!0);try{const d=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!d.ok){const p=await d.json();f.error(p.message,{position:"top-center"}),u(!1);return}const m=await d.json();o((h=m==null?void 0:m.data)==null?void 0:h.result)}catch(d){f.error((d==null?void 0:d.message)||"Network error: Failed to fetch.",{position:"top-center"})}finally{u(!1)}})()},[s]),{category:i,loading:l}},ne=()=>{const[s,l]=a.useState(!1),u=localStorage.getItem("authToken");return{deleteCategory:async o=>{l(!0);const t=`http://35.154.167.170:3000/admin/categories/${o}`;try{const n=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}}),c=await n.json();return n.ok?{success:!0,message:c.message}:(f.error(c.message,{position:"top-center"}),{success:!1,message:c.message})}catch(n){return f.error("An error occurred while deleting the category.",{position:"top-center"}),{success:!1,message:n.message}}finally{l(!1)}},loading:s}},ce=()=>{const[s,l]=a.useState(!1);return{updateCategory:async(i,o)=>{l(!0);const t=`http://35.154.167.170:3000/admin/categories/${i}`;try{const n=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({name:o})});if(n.ok){const c=await n.json();return f.success(c.message,{position:"top-center"}),!0}else{const c=await n.json();return f.error(c.message,{position:"top-center"}),!1}}catch(n){return f.error(n.message,{position:"top-center"}),!1}finally{l(!1)}},loading:s}},le=V().shape({name:K().required("Category name is required").max(30,"Maximum length of 30 characters exceeded")}),ie=({isOpen:s,onClose:l,setIsSubmit:u})=>{const{addCategory:i,loading:o}=re(),[t,n]=a.useState({name:""}),[c,h]=a.useState({});a.useEffect(()=>{s&&(n({name:""}),h({}))},[s]);const d=async m=>{m.preventDefault();try{await le.validate(t,{abortEarly:!1}),await i(t.name),u(!0),l()}catch(p){if(p instanceof M){const y={};p.inner.forEach(x=>{x.path&&(y[x.path]=x.message)}),h(y)}else f.error("Failed to submit the form. Please try again.")}};return s&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:l}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96 z-10 relative",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add Category"}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:t.name,onChange:m=>n({...t,name:m.target.value}),className:"input border border-gray-300 rounded-md p-2",disabled:o}),e.jsx("p",{className:"text-red-500 text-sm",children:c.name||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${o?"opacity-50 cursor-not-allowed":""}`,disabled:o,children:o?"Adding...":"Add Category"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:l,disabled:o,children:"Cancel"})]})]})]})]})};function de(s){return z({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M15.854 12.854c-0-0-0-0-0-0l-4.854-4.854 4.854-4.854c0-0 0-0 0-0 0.052-0.052 0.090-0.113 0.114-0.178 0.066-0.178 0.028-0.386-0.114-0.529l-2.293-2.293c-0.143-0.143-0.351-0.181-0.529-0.114-0.065 0.024-0.126 0.062-0.178 0.114 0 0-0 0-0 0l-4.854 4.854-4.854-4.854c-0-0-0-0-0-0-0.052-0.052-0.113-0.090-0.178-0.114-0.178-0.066-0.386-0.029-0.529 0.114l-2.293 2.293c-0.143 0.143-0.181 0.351-0.114 0.529 0.024 0.065 0.062 0.126 0.114 0.178 0 0 0 0 0 0l4.854 4.854-4.854 4.854c-0 0-0 0-0 0-0.052 0.052-0.090 0.113-0.114 0.178-0.066 0.178-0.029 0.386 0.114 0.529l2.293 2.293c0.143 0.143 0.351 0.181 0.529 0.114 0.065-0.024 0.126-0.062 0.178-0.114 0-0 0-0 0-0l4.854-4.854 4.854 4.854c0 0 0 0 0 0 0.052 0.052 0.113 0.090 0.178 0.114 0.178 0.066 0.386 0.029 0.529-0.114l2.293-2.293c0.143-0.143 0.181-0.351 0.114-0.529-0.024-0.065-0.062-0.126-0.114-0.178z"},child:[]}]})(s)}function ue(s){return z({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M13.5 2l-7.5 7.5-3.5-3.5-2.5 2.5 6 6 10-10z"},child:[]}]})(s)}const ge=({search:s,isSubmit:l,setIsSubmit:u})=>{const[i,o]=a.useState(1),[t,n]=a.useState(10),[c,h]=a.useState(null),[d,m]=a.useState(),[p,y]=W(),x=p.get("page"),b=p.get("perPage"),[j,F]=a.useState(null),[N,E]=a.useState(""),{categories:k,totalCategories:A,fetchCategories:T,loading:G}=ee(i,t,s,c,d),{category:C}=oe(j),{deleteCategory:O}=ne(),{updateCategory:R}=ce(),S=Math.ceil(A/t);a.useEffect(()=>{l&&(T(),u(!1))},[l,T]),a.useEffect(()=>{C&&E(C.name||"")},[C]);const U=r=>{F(r)},_=async()=>{if(N.trim()===""){f.error("Category name cannot be empty.",{position:"top-center"});return}if(C&&N===C.name){P();return}try{await R(j,N)&&P()}catch{f.error("An error occurred while updating the category.",{position:"top-center"})}},P=()=>{F(null),E("")},Y=async r=>{try{const{isConfirmed:g}=await w.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(g){const{success:J,message:I}=await O(r);J?(await T(),w.fire(I)):w.fire(I)}}catch(g){w.fire({title:"Error",text:g.message||"An unexpected error occurred",icon:"error"})}};a.useEffect(()=>{x&&o(Number(x)),b&&n(Number(b))},[x,b]),a.useEffect(()=>{s&&(o(1),y({search:s,page:"1",perPage:t.toString()}))},[s]);const $=r=>{c===r?m(d==="ASC"?"DESC":"ASC"):(h(r),m("ASC"))},D=r=>{r>=1&&r<=S&&(o(r),y({page:r.toString(),perPage:t.toString()}))},q=r=>{const g=Number(r.target.value);n(g),o(1),y({page:"1",perPage:g.toString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block",children:e.jsxs("div",{className:"flex mb-3 items-center gap-2",children:["Show",e.jsxs("select",{className:"select select-sm w-16",value:t,onChange:q,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),"per page"]})}),e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>$("category_id"),children:["Id",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(L,{color:c==="category_id"&&d==="ASC"?"gray":"lightgray"}),e.jsx(B,{color:c==="category_id"&&d==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"min-w-[165px]",children:e.jsxs("div",{className:"flex justify-between cursor-pointer",onClick:()=>$("name"),children:["Category Name",e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx(L,{color:c==="name"&&d==="ASC"?"gray":"lightgray"}),e.jsx(B,{color:c==="name"&&d==="DESC"?"gray":"lightgray"})]})]})}),e.jsx("th",{className:"w-[125px]",children:"Actions"})]})}),G?e.jsx(te,{}):k.length>0?e.jsx("tbody",{children:k.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.category_id}),e.jsx("td",{children:j===r.category_id?e.jsx("input",{type:"text",className:"border border-gray-300 p-2 rounded-md focus:outline-none",value:N,onChange:g=>E(g.target.value),onKeyPress:g=>{g.key==="Enter"&&_()}}):r.name}),e.jsx("td",{children:j===r.category_id?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:_,"aria-label":"Save",children:e.jsx(ue,{color:"green"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:P,"aria-label":"Cancel",children:e.jsx(de,{color:"red"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>U(r.category_id),"aria-label":"Edit",children:e.jsx(Z,{className:"text-yellow-600"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>Y(r.category_id),"aria-label":"Delete",children:e.jsx(H,{className:"text-red-500"})})]})})]},r.category_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:"No categories found."})})})]})})})})}),A>t&&e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",k.length," of ",A," Branches"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:i===1,onClick:()=>D(i-1),className:`btn ${i===1?"disabled":""}`,children:e.jsx(Q,{})}),Array.from({length:S}).map((r,g)=>e.jsx("button",{className:`btn ${i===g+1?"active":""}`,onClick:()=>D(g+1),children:g+1},g)),e.jsx("button",{disabled:i===S,onClick:()=>D(i+1),className:`btn ${i===S?"disabled":""}`,children:e.jsx(X,{})})]})]})]})},ye=()=>{const[s,l]=a.useState(null),[u,i]=a.useState(""),[o,t]=a.useState(!1),[n,c]=a.useState(!1),[h,d]=a.useState(!1),[m,p]=a.useState(""),y=()=>{c(!1),t(!0)},x=async b=>{b.preventDefault();try{await ae.validate({search:u},{abortEarly:!1}),l(u),p("")}catch(j){j instanceof M&&p(j.errors[0])}};return e.jsxs("div",{className:"container-fixed relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Categories"}),e.jsxs("button",{onClick:y,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Category"]})]}),e.jsxs("div",{className:"absolute top-11 right-[2.5rem] mt-2",children:[e.jsxs("form",{onSubmit:x,className:"w-64 relative flex",children:[e.jsx("input",{type:"search",value:u,onChange:b=>{i(b.target.value),b.target.value===""&&l("")},className:"peer block min-h-[auto] w-full rounded border bg-transparent px-3 py-[0.32rem] leading-[1.6] text-gray-700 outline-none focus:border-gray-500 focus:bg-white border-gray-500",placeholder:"Search"}),e.jsx("button",{type:"submit",className:"relative z-[2] -ml-0.5 flex items-center rounded-e bg-gray-500 px-5 text-xs font-medium uppercase leading-normal text-white",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]}),e.jsx("p",{className:"absolute top-8 right-[0.2rem] mt-2 text-red-500 text-sm w-80",children:m||" "})]}),e.jsx(ge,{search:s,isSubmit:h,setIsSubmit:d}),e.jsx(ie,{setIsSubmit:d,isOpen:o,onClose:()=>t(!1)})]})};export{ye as default};
