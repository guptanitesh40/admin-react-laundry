import{r as a,B as I,V as C,u as R,j as e,T as Y,k as z,P as B,s as U,b as V}from"./index-jH0FXJnR.js";const D=(h=1,c=10,t="",p,g)=>{const[u,o]=a.useState(),[v,d]=a.useState(0),[S,x]=a.useState(!1),j=async()=>{var f,N;const m=localStorage.getItem("authToken"),n=new URLSearchParams;h&&n.append("page_number",h.toString()),c&&n.append("per_page",c.toString()),t&&n.append("search",t),p&&n.append("sort_by",p),g&&n.append("order",g),x(!0);try{const b=await fetch(`${I}/user/login-logs?${n}`,{method:"GET",headers:{Authorization:m?`Bearer ${m}`:""}}),r=await b.json();b.ok||(C.error(r.message,{position:"top-center"}),x(!1)),o(((f=r==null?void 0:r.data)==null?void 0:f.userLogs)||[]),d((N=r==null?void 0:r.data)==null?void 0:N.count)}catch{C.error("Network Error: Failed to fetch customer log data")}finally{x(!1)}};return a.useEffect(()=>{j()},[h,c,t,p,g]),{customerLogData:u,count:v,fetchCustomerLog:j,loading:S}},G=()=>{const[h,c]=a.useState(1),[t,p]=a.useState(10),[g,u]=R(),[o,v]=a.useState(null),[d,S]=a.useState(null),x=g.get("page"),j=g.get("perPage"),[m,n]=a.useState(""),[f,N]=a.useState(""),[b,r]=a.useState(""),{customerLogData:l,count:P,loading:y}=D(h,t,m,o,d),_=Math.ceil(P/t);a.useEffect(()=>{x&&c(Number(x)),j&&p(Number(j))},[x,j]);const E=async s=>{s.preventDefault();try{await U.validate({search:f},{abortEarly:!1}),n(f),r("")}catch(i){i instanceof V&&r(i.errors[0])}};a.useEffect(()=>{c(1),u(m!==""?{search:m,page:"1",perPage:t.toString()}:{})},[m]);const k=s=>{s>=1&&s<=_&&(c(s),u({page:s.toString(),perPage:t.toString()}))},A=s=>{const i=Number(s.target.value);p(i),c(1),u({page:"1",perPage:i.toString()})},w=s=>{o===s?S(d==="ASC"?"DESC":"ASC"):(v(s),S("ASC"))};return y?e.jsx(Y,{isFilters:!0,isPagination:!0,columns:4,records:10}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:t,onChange:A,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("form",{onSubmit:E,className:"flex items-center gap-2 self-end",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:f,onChange:s=>{N(s.target.value),s.target.value===""&&n("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),b&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:b||"Â "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[100px] min-w-[75px]",children:e.jsxs("span",{className:`sort ${o==="login_id"?d==="ASC"?"asc":"desc":""}`,onClick:()=>w("login_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsxs("th",{className:"min-w-[200px] max-w-[300px] flex-grow",children:[e.jsxs("span",{className:`sort ${o==="first_name"?d==="ASC"?"asc":"desc":""}`,onClick:()=>w("first_name"),children:[e.jsx("span",{className:"sort-label",children:"User name"}),e.jsx("span",{className:"sort-icon"})]}),e.jsx("span",{className:"inline-block h-[22.5px] w-[22.5px] bg-transparent rounded-sm text-right"})]}),e.jsx("th",{className:"min-w-[200px] max-w-[300px] flex-grow",children:e.jsxs("span",{className:`sort ${o==="created_at"?d==="ASC"?"asc":"desc":""}`,onClick:()=>w("created_at"),children:[e.jsx("span",{className:"sort-label",children:"Last login time"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px] max-w-[300px] flex-grow",children:e.jsx("span",{className:"sort-label",children:"Device"})})]})}),(l==null?void 0:l.length)>0?e.jsx("tbody",{children:l==null?void 0:l.map(s=>{const{login_id:i,user:L,created_at:M,type:$}=s,{first_name:T,last_name:F}=L;return e.jsxs("tr",{children:[e.jsx("td",{children:i}),e.jsxs("td",{children:[T+" "+F,e.jsx("span",{className:"inline-block h-[22.5px] w-[22.5px] bg-transparent rounded-sm text-right"})]}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:z(M).format("DD-MM-YYYY, hh:mm A")})}),e.jsx("td",{children:$==="null"?"WebSite":"Mobile"})]},i)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"No data available"})})})]})}),e.jsx(B,{count:P,currentPage:h,totalRecords:l==null?void 0:l.length,perPage:t,onPageChange:k,label:"records"})]})})]})},W=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Logs"})})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(G,{})})})})]});export{W as default};
