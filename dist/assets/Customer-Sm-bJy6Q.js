import{r as c,B as k,V as g,u as X,k as z,e as R,j as e,T as Z,p as ee,F as se,f as te,g as ae,h as re,s as oe,b as ie,a6 as D,a7 as _}from"./index-6J7qaUxy.js";import{G as E}from"./enums-CdakGUf3.js";import{u as ne,a as le}from"./useDeleteUser-p4_AOjp9.js";import{S as w}from"./sweetalert2.esm.all-B0Dix5B2.js";import{M as ce}from"./MultiSelect-BEOuPAXF.js";import"./orderStatusClasses-HfHBGnti.js";const de=()=>{const[r,n]=c.useState(),[t,i]=c.useState(!1);return{customerActivityData:r,loading:t,fetchCustomerActivityData:async(h,m)=>{const d=localStorage.getItem("authToken"),a=new URLSearchParams;h&&a.append("startDate",h),m&&a.append("endDate",m),i(!0);try{const o=await fetch(`${k}/report/customer-activity?${a}`,{method:"GET",headers:{Authorization:`Bearer ${d}`}}),p=await o.json();if(!o.ok){g.error(p.message,{position:"top-center"}),i(!1);return}n(p)}catch{g.error("Network error: Failed to fetch customer activity data.")}finally{i(!1)}}}},me=()=>{const[r,n]=c.useState(),[t,i]=c.useState(!1);return{customerData:r,loading:t,fetchNewCustomerData:async(h,m)=>{const d=localStorage.getItem("authToken"),a=new URLSearchParams;h&&a.append("startDate",h),m&&a.append("endDate",m),i(!0);try{const o=await fetch(`${k}/report/new-customer-acquisition-report?${a}`,{method:"GET",headers:{Authorization:`Bearer ${d}`}}),p=await o.json();if(!o.ok){g.error(p.message,{position:"top-center"}),i(!1);return}n(p)}catch{g.error("Network error: Failed to fetch customer data.")}finally{i(!1)}}}},he=()=>{const[r,n]=c.useState(),[t,i]=c.useState(!1);return{customerData:r,loading:t,fetchInActiveCustomerData:async(h,m)=>{const d=localStorage.getItem("authToken"),a=new URLSearchParams;h&&a.append("startDate",h),m&&a.append("endDate",m),i(!0);try{const o=await fetch(`${k}/report/inactive-customer-report?${a}`,{method:"GET",headers:{Authorization:`Bearer ${d}`}}),p=await o.json();if(!o.ok){g.error(p.message,{position:"top-center"}),i(!1);return}n(p)}catch{g.error("Failed to fetch in active customer data.")}finally{i(!1)}}}},pe=()=>{const[r,n]=c.useState(1),[t,i]=c.useState(10),[x,h]=c.useState(null),[m,d]=c.useState(),[a,o]=X(),[p,A]=c.useState([]),N=a.get("page"),v=a.get("perPage"),[j,P]=c.useState(""),[B,L]=c.useState(""),[M,F]=c.useState(""),$=z();let G=5;const{users:f,loading:I,count:C,fetchUsers:U}=ne(r,t,j,x,m,p,G),{deleteUser:V}=le(),{hasPermission:u}=R(),W=Object.entries(E).filter(([s,l])=>typeof l=="number").map(([s,l])=>({label:s,value:l})),y=Math.ceil(C/t);c.useEffect(()=>{N&&n(Number(N)),v&&i(Number(v))},[N,v]),c.useEffect(()=>{j&&(n(1),o({search:j,page:"1",perPage:t.toString()}))},[j]);const q=async s=>{s.preventDefault();try{await oe.validate({search:j},{abortEarly:!1}),P(B),F("")}catch(l){l instanceof ie&&F(l.errors[0])}},b=s=>{x===s?d(m==="ASC"?"DESC":"ASC"):(h(s),d("ASC"))},S=s=>{s>=1&&s<=y&&(n(s),o({page:s.toString(),perPage:t.toString()}))},O=s=>{const l=Number(s.target.value);i(l),n(1),o({page:"1",perPage:l.toString()})},K=async s=>{$(`/customer/${s}`)},Y=s=>{$(`/customer/edit/${s}`)},H=async s=>{try{const{isConfirmed:l}=await w.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(l){const{success:J,message:T}=await V(s);J?(f.filter(Q=>Q.user_id!==s).length===0&&r>1&&(n(r-1),o({page:(r-1).toString(),perPage:t.toString()})),await U(),w.fire(T)):w.fire(T)}}catch(l){w.fire({title:"Error",text:l.message,icon:"error"})}};if(f)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:t,onChange:O,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(ce,{options:W,displayValue:"label",placeholder:"Select Gender",selectedValues:p,onSelect:s=>A(s.map(l=>l.value)),onRemove:s=>A(s.map(l=>l.value)),className:"lgscreen:min-w-[230px] mini:min-w-[250px]",sliceCount:2})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:q,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:B,onChange:s=>{L(s.target.value),s.target.value===""&&P("")},placeholder:"Search...",className:"mini:min-w-[185px] lgscreen:min-w-[150px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:M||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[70px]",children:e.jsxs("span",{className:`sort ${x==="user_id"?m==="ASC"?"asc":"desc":""}`,onClick:()=>b("user_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${x==="first_name"?m==="ASC"?"asc":"desc":""}`,onClick:()=>b("first_name"),children:[e.jsx("span",{className:"sort-label",children:"Full name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${x==="email"?m==="ASC"?"asc":"desc":""}`,onClick:()=>b("email"),children:[e.jsx("span",{className:"sort-label",children:"Email"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[190px]",children:e.jsxs("span",{className:`sort ${x==="mobile_number"?m==="ASC"?"asc":"desc":""}`,onClick:()=>b("mobile_number"),children:[e.jsx("span",{className:"sort-label",children:"Mobile no"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[80px]",children:"Gender"}),e.jsx("th",{className:"min-w-[150px]",children:"Total Pending Amount"}),(u(8,"read")||u(8,"update")||u(8,"delete"))&&e.jsx("th",{className:"min-w-[180px]",children:"Actions"})]})}),I?e.jsx(Z,{}):f.length>0?e.jsx("tbody",{children:f==null?void 0:f.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:s.user_id})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[s.first_name," ",s.last_name]})}),e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-1.5",children:s.mobile_number})}),e.jsx("td",{children:E[s.gender]}),e.jsx("td",{children:s.total_due_amount}),(u(8,"read")||u(8,"update")||u(8,"delete"))&&e.jsxs("td",{className:"space-x-3",children:[u(8,"read")&&e.jsx("button",{className:"bg-yellow-100 hover:bg-yellow-200 p-[9px] rounded-full",style:{marginBottom:"-30px"},onClick:()=>K(s.user_id),children:e.jsx(ee,{size:18,className:"text-gray-600"})}),u(8,"update")&&e.jsx("button",{className:"bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>Y(s.user_id),children:e.jsx(se,{className:"text-yellow-600"})}),u(8,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>H(s.user_id),children:e.jsx(te,{className:"text-red-500"})})]})]},s.user_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No customer available"})})})]})}),C>t&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",f.length," of ",C," customers"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:r===1,onClick:()=>S(r-1),className:`btn ${r===1?"disabled":""}`,children:e.jsx(ae,{})}),Array.from({length:y}).map((s,l)=>e.jsx("button",{className:`btn ${r===l+1?"active":""}`,onClick:()=>S(l+1),children:l+1},l)),e.jsx("button",{disabled:r===y,onClick:()=>S(r+1),className:`btn ${r===y?"disabled":""}`,children:e.jsx(re,{})})]})]})})]})})]})},{RangePicker:xe}=D,ue=()=>{const[r,n]=c.useState({start_time:"",end_time:""}),{customerActivityData:t,fetchCustomerActivityData:i}=de();c.useEffect(()=>{r.start_time&&r.end_time?i(r.start_time,r.end_time):i()},[r]);const x=(a,o)=>{n(a?{start_time:o[0],end_time:o[1]}:{start_time:"",end_time:""})},h=(t==null?void 0:t.map(a=>a.month.split("-")[0]))||[],d={series:[{name:"Login Count",data:(t==null?void 0:t.map(a=>a.login_count))||[]}],options:{chart:{type:"area",height:240,toolbar:{show:!1}},dataLabels:{enabled:!1},colors:["#4154f1"],fill:{gradient:{enabled:!0,opacityFrom:.25,opacityTo:.1}},grid:{borderColor:"rgba(0, 0, 0, 0)",strokeDashArray:5,padding:{top:0,right:0,bottom:20,left:8}},stroke:{curve:"smooth",show:!0,width:3,colors:["#4154f1"]},legend:{show:!1},xaxis:{type:"category",categories:h,labels:{show:!0,style:{colors:"#6B7280",fontSize:"12px",fontWeight:500}},axisTicks:{show:!0,color:"#D1D5DB",height:6},axisBorder:{show:!0,color:"#D1D5DB"},crosshairs:{position:"front",stroke:{color:"#3B82F6",width:1,dashArray:3}}},markers:{colors:"#4154f1",strokeColors:"#4154f1",strokeWidth:4,hover:{size:5}},yaxis:{min:0,tickAmount:1,axisTicks:{show:!1},labels:{style:{colors:"var(--tw-gray-500)",fontSize:"12px"},formatter:a=>a>=1e3?`₹${(a/1e3).toFixed(0)}K`:a.toString()}},responsive:[{breakpoint:480,options:{legend:{position:"bottom"}}}],tooltip:{x:{format:"MMM yyyy"}}}};return e.jsxs("div",{className:"card w-full pb-2.5 max-h-[300px] rounded-md",children:[e.jsx("div",{className:"self-end p-3 sm:mt-0",children:e.jsx(xe,{className:"min-w-[80px] sm:w-[250px]",dropdownClassName:"custom-rangepicker-dropdown",onChange:x})}),e.jsx("div",{className:"flex justify-between ml-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"card-title text-lg",children:"Activity"}),e.jsx("span",{className:"text-gray-500 font-medium",children:"Customer Login Count"})]})}),e.jsx("div",{className:"card-body flex flex-col justify-end items-stretch grow px-0 py-1",children:e.jsx(_,{options:d.options,series:d.series,type:d.options.chart.type,height:200})})]})},{RangePicker:fe}=D,ge=()=>{const[r,n]=c.useState({start_time:"",end_time:""}),{customerData:t,fetchNewCustomerData:i}=me();c.useEffect(()=>{r.start_time&&r.end_time?i(r.start_time,r.end_time):i()},[r]);const x=(o,p)=>{n(o?{start_time:p[0],end_time:p[1]}:{start_time:"",end_time:""})},h=(t==null?void 0:t.map(o=>o.month.split("-")[0]))||[],m=(t==null?void 0:t.map(o=>o.customer_count))||[],d=t==null?void 0:t.reduce((o,p)=>o+Number(p.customer_count),0),a={series:[{name:"New Customer",data:m}],options:{chart:{fontFamily:"inherit",type:"bar",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"40%",borderRadius:5}},legend:{show:!1},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:"blue"},xaxis:{type:"category",categories:h,labels:{show:!0,style:{colors:"#6B7280",fontSize:"12px",fontWeight:500}},axisTicks:{show:!0,color:"#D1D5DB",height:6},axisBorder:{show:!0,color:"#D1D5DB"},crosshairs:{position:"front",stroke:{color:"#3B82F6",width:1,dashArray:3}}},yaxis:{min:0,tickAmount:5,axisTicks:{show:!1},labels:{style:{colors:"var(--tw-gray-500)",fontSize:"12px"},formatter:o=>o>=1e3?`₹${(o/1e3).toFixed(0)}K`:o.toString()}},fill:{opacity:1},states:{normal:{filter:{type:"none",value:0}},hover:{filter:{type:"none",value:0}},active:{allowMultipleDataPointsSelection:!1,filter:{type:"none",value:0}}},tooltip:{style:{fontSize:"12px"}},colors:["#ECE852"],grid:{strokeDashArray:4,yaxis:{lines:{show:!0}}}}};return e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"card w-full rounded-md",children:[e.jsx("div",{className:"self-end p-3 sm:mt-0",children:e.jsx(fe,{className:"min-w-[80px] sm:w-[250px]",dropdownClassName:"custom-rangepicker-dropdown",onChange:x})}),e.jsxs("div",{className:"card-header pt-0  border-none",children:[e.jsx("div",{className:"flex flex-col justify-between",children:e.jsx("h3",{className:"card-title",children:"New Customer"})}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"p-3 bg-red-50 rounded-md relative text-gray-500 semibold",children:["+",d]})})]}),e.jsx("div",{className:"card-body flex flex-col justify-end items-stretch grow px-0 py-1",children:e.jsx(_,{options:a.options,series:a.series,type:a.options.chart.type,height:163})})]})})},{RangePicker:je}=D,ye=()=>{const[r,n]=c.useState({start_time:"",end_time:""}),{customerData:t,fetchInActiveCustomerData:i}=he();c.useEffect(()=>{r.start_time&&r.end_time?i(r.start_time,r.end_time):i()},[r]);const x=(a,o)=>{n(a?{start_time:o[0],end_time:o[1]}:{start_time:"",end_time:""})},h=(t==null?void 0:t.map(a=>a.month.split("-")[0]))||[],d={series:[{name:"No Active Customer",data:(t==null?void 0:t.map(a=>a.not_active_count))||[]}],options:{chart:{type:"area",height:200,toolbar:{show:!1}},dataLabels:{enabled:!1},colors:["#4154f1"],fill:{gradient:{enabled:!0,opacityFrom:.25,opacityTo:.1}},grid:{borderColor:"rgba(0, 0, 0, 0)",strokeDashArray:5,padding:{top:0,right:0,bottom:2,left:8}},stroke:{curve:"smooth",show:!0,width:3,colors:["#4154f1"]},legend:{show:!1},xaxis:{type:"category",categories:h,labels:{show:!0,style:{colors:"#6B7280",fontSize:"12px",fontWeight:500}},axisTicks:{show:!0,color:"#D1D5DB",height:6},axisBorder:{show:!0,color:"#D1D5DB"},crosshairs:{position:"front",stroke:{color:"#3B82F6",width:1,dashArray:3}}},markers:{colors:"#4154f1",strokeColors:"#4154f1",strokeWidth:4,hover:{size:5}},yaxis:{min:0,tickAmount:1,axisTicks:{show:!1},labels:{style:{colors:"var(--tw-gray-500)",fontSize:"12px"},formatter:a=>a>=1e3?`₹${(a/1e3).toFixed(0)}K`:a.toString()}},tooltip:{x:{format:"MMM yyyy"}}}};return e.jsxs("div",{className:"card w-full pb-2.5 max-h-[300px] rounded-md",children:[e.jsx("div",{className:"self-end p-3 sm:mt-0",children:e.jsx(je,{className:"min-w-[80px] sm:w-[250px]",dropdownClassName:"custom-rangepicker-dropdown",onChange:x})}),e.jsx("div",{className:"flex justify-between ml-5",children:e.jsx("div",{children:e.jsx("h3",{className:"card-title text-lg",children:"In Active Customer"})})}),e.jsx("div",{className:"card-body flex flex-col justify-end items-stretch grow px-0 py-3",children:e.jsx(_,{options:d.options,series:d.series,type:d.options.chart.type,height:d.options.chart.height})})]})},De=()=>{const r=z(),{hasPermission:n}=R(),t=()=>{r("/customer/add")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-fixed grid xl:grid-cols-3 lg:grid-cols-2 md:grid-cols-1 sm:grid-cols-1 desktop:grid-cols-1 zx:grid-cols-1 pb-8 gap-x-4 gap-y-4",children:[e.jsx(ue,{}),e.jsx(ge,{}),e.jsx(ye,{})]}),e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-4",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customers"})}),n(8,"create")&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{className:"btn btn-primary",onClick:t,children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Customer"]})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(pe,{})})})})]})};export{De as default};
