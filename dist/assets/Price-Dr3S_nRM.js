import{r,c as P,B as q,u as oe,e as K,j as e,T as de,P as ue,s as pe,b as he,t as me,v as xe,w as ge}from"./index-D24ck8V_.js";import{M as B}from"./MultiSelect-BzgsPyoZ.js";import{u as je}from"./useGetCategories-Bg9YBGMm.js";import{u as fe}from"./useGetProducts-6qSE7Jjt.js";import{u as Se}from"./useGetServices-rS6KSh_z.js";import"./orderStatusClasses-HfHBGnti.js";const be=()=>{const[c,n]=r.useState(!1);return{addPrices:async o=>{const i=localStorage.getItem("authToken");if(!i){P.error("Auth token not found");return}if(o.length===0){P("No prices to update");return}n(!0);try{const s=await fetch(`${q}/prices`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({prices:o})}),t=await s.json();if(!s.ok)throw new Error(t.message||"Failed to add prices");return P.success("Prices added successfully"),t}catch(s){P.error(s.message||"Failed to added prices")}finally{n(!1)}},loading:c}},ve=()=>{const[c,n]=r.useState([]),[p,o]=r.useState(!0),[i,s]=r.useState(0),t=async({per_page:l=500,page_number:$=1,search:m="",sort_by:S="",order:A="",filters:d={}}={})=>{var w,b,F,k,R;const _=localStorage.getItem("authToken");if(!_){P.error("Auth token not found",{position:"top-center"}),o(!1);return}o(!0);const x=new URLSearchParams({per_page:String(l),page_number:String($)});m&&x.append("search",m),S&&x.append("sort_by",S),A&&x.append("order",A),(w=d==null?void 0:d.categoryId)==null||w.forEach(h=>{x.append("category_ids",String(h))}),(b=d==null?void 0:d.productId)==null||b.forEach(h=>{x.append("product_ids",String(h))}),(F=d==null?void 0:d.serviceId)==null||F.forEach(h=>{x.append("service_ids",String(h))});try{const h=await fetch(`${q}/prices?${x}`,{method:"GET",headers:{Authorization:`Bearer ${_}`}});if(!h.ok){const v=await h.json();P.error(v.message||"Failed to fetch prices",{position:"top-center"});return}const g=await h.json();n(((k=g==null?void 0:g.data)==null?void 0:k.items)||[]),s(((R=g==null?void 0:g.data)==null?void 0:R.count)||0)}catch{P.error("Network error: Failed to fetch prices",{position:"top-center"})}finally{o(!1)}};return r.useEffect(()=>{t()},[]),{prices:c,loading:p,count:i,fetchPrices:t}},Ne=({isSave:c,setIsSave:n,setIsLoading:p,filters:o})=>{const[i,s]=r.useState(1),[t,l]=r.useState(500),[$,m]=oe(),[S,A]=r.useState(""),[d,_]=r.useState(""),[x,w]=r.useState(""),{prices:b,loading:F,count:k,fetchPrices:R}=ve(),{addPrices:h,loading:g}=be(),[v,L]=r.useState({}),[U,J]=r.useState(new Set),O=r.useRef({}),[N,H]=r.useState(null),[y,z]=r.useState(null),[E,G]=r.useState(null),[Q,W]=r.useState(!1),{hasPermission:V}=K(),X=a=>{G(a)},Y=(a,u)=>{const j=`${a.category_id}_${a.product_id}_${a.service_id}`;L(I=>({...I,[j]:{category_id:a.category_id,product_id:a.product_id,service_id:a.service_id,price:u}}))},T=a=>{N===a?z(y==="ASC"?"DESC":"ASC"):(H(a),z("ASC"))},Z=a=>{J(u=>{const j=new Set(u);return j.delete(a),j})},ee=Math.ceil(k/t),se=a=>{a>=1&&a<=ee&&(s(a),m({page:a.toString(),perPage:t.toString()}))},ae=a=>{const u=Number(a.target.value);l(u),s(1),m({page:"1",perPage:u.toString()})},te=async a=>{a.preventDefault();try{await pe.validate({search:S},{abortEarly:!1}),_(S),w("")}catch(u){u instanceof he&&w(u.errors[0])}};return r.useEffect(()=>{E&&O.current[E]&&O.current[E].focus()},[E]),r.useEffect(()=>{R({page_number:i,per_page:t,sort_by:N,order:y,search:d,filters:o})},[i,t,N,y,d,o,Q]),r.useEffect(()=>{m(d?{search:d}:{})},[d]),r.useEffect(()=>{p(!!g)},[g]),r.useEffect(()=>{if(!c)return;(async()=>{if(Object.keys(v).length===0){n(!1);return}const u=Object.values(v);await h(u)&&(W(I=>!I),L({})),n(!1)})()},[c]),F?e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(de,{isFilters:!0,columns:5,records:20,isPagination:!1})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5 mt-4",children:e.jsxs("div",{className:"card card-grid min-w-full",children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:t,onChange:ae,children:[e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:500,children:"500"}),e.jsx("option",{value:1e3,children:"1000"}),e.jsx("option",{value:1500,children:"1500"}),e.jsx("option",{value:2e3,children:"2000"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("form",{onSubmit:te,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:S,onChange:a=>{A(a.target.value),a.target.value===""&&(_(""),w(""))},placeholder:"Search...",className:"min-w-[185px]"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:x||"Â "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto scrollable-y-auto max-h-[450px]",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[40px]",children:"Id"}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${N==="category"?y==="ASC"?"asc":"desc":""}`,onClick:()=>T("category"),children:[e.jsx("span",{className:"sort-label",children:"Category"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${N==="product"?y==="ASC"?"asc":"desc":""}`,onClick:()=>T("product"),children:[e.jsx("span",{className:"sort-label",children:"Product"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${N==="service"?y==="ASC"?"asc":"desc":""}`,onClick:()=>T("service"),children:[e.jsx("span",{className:"sort-label",children:"Service"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${N==="price"?y==="ASC"?"asc":"desc":""}`,onClick:()=>T("price"),children:[e.jsx("span",{className:"sort-label",children:"Price"}),e.jsx("span",{className:"sort-icon"})]})})]})}),e.jsx("tbody",{children:b.length>0?b.map((a,u)=>{var M,D;const{price:j,category_name:I,category_id:re,product_name:ce,product_id:ne,service_name:le,service_id:ie}=a,f=`${re}_${ne}_${ie}`;return U.has(f),e.jsxs("tr",{className:`font-semibold ${j?"":"text-red-500"}`,children:[e.jsx("td",{children:(i-1)*t+u+1}),e.jsx("td",{children:I}),e.jsx("td",{children:ce}),e.jsx("td",{children:le}),e.jsx("td",{className:"relative",children:E===f?e.jsx("input",{ref:C=>O.current[f]=C,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:((M=v[f])==null?void 0:M.price)!==void 0?v[f].price:j||"",onChange:C=>Y(a,C.target.value===""?0:Number(C.target.value)),onBlur:()=>{Z(f),G(null)},onKeyDown:C=>{C.key==="Enter"&&n(!0)}}):e.jsx("span",{className:`${V(10,"update")||V(10,"create")?"cursor-pointer h-full flex":"h-full flex"}`,onClick:V(10,"update")||V(10,"create")?()=>X(f):void 0,children:((D=v[f])==null?void 0:D.price)!==void 0?v[f].price:j||"Add Price"})})]},u)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})}),e.jsx(ue,{count:k,currentPage:i,totalRecords:b==null?void 0:b.length,perPage:t,onPageChange:se,label:"prices"})]})})]})})})},ye=({filters:c,updateFilters:n})=>{const{categories:p}=je(1,1e3),{products:o}=fe(1,1e3),{services:i}=Se(1,1e3);return e.jsx("div",{className:"p-3 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(B,{options:p==null?void 0:p.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.category_id})),displayValue:"name",placeholder:"Select Category",selectedValues:c==null?void 0:c.categoryId,onSelect:s=>{const t=s.map(l=>l.value);n({...c,categoryId:t})},onRemove:s=>{const t=s.map(l=>l.value);n({...c,categoryId:t})},className:"w-full",isSearchInput:!0}),e.jsx(B,{options:o==null?void 0:o.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.product_id})),displayValue:"label",placeholder:"Select Product",selectedValues:c.productId,onSelect:s=>{const t=s.map(l=>l.value);n({...c,productId:t})},onRemove:s=>{const t=s.map(l=>l.value);n({...c,productId:t})},className:"w-full",isSearchInput:!0}),e.jsx(B,{options:i==null?void 0:i.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.service_id})),displayValue:"label",placeholder:"Select Service",selectedValues:c.serviceId,onSelect:s=>{const t=s.map(l=>l.value);n({...c,serviceId:t})},onRemove:s=>{const t=s.map(l=>l.value);n({...c,serviceId:t})},className:"w-full",isSearchInput:!0})]})})},Ie=()=>{const[c,n]=r.useState(!1),[p,o]=r.useState(!1),[i,s]=r.useState(!1),{hasPermission:t}=K(),[l,$]=r.useState({categoryId:[],productId:[],serviceId:[]}),m=S=>{$(S)};return e.jsxs("div",{className:"px-10 max-h-[calc(100vh-69px)] flex flex-col relative",children:[e.jsxs("div",{className:"pb-1 bg-white",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 py-3 ",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price"})}),e.jsx("div",{className:"flex justify-between items-start gap-3",children:(t(10,"create")||t(10,"update"))&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsx("button",{onClick:()=>n(!0),className:"btn btn-primary",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ki-filled ki-plus-squared"})," Saving"," ",e.jsx(me,{})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ki-filled ki-plus-squared"})," Save"]})})})})]}),e.jsx("div",{className:"flex flex-auto items-center justify-between gap-2.5 mb-2 shadow-none",children:e.jsxs("button",{className:"btn btn-sm btn-primary shadow-none",onClick:()=>s(!i),children:["Filters",i?e.jsx(xe,{size:23}):e.jsx(ge,{color:"skyblue",size:23})]})}),e.jsx("div",{children:i&&e.jsx(ye,{filters:l,updateFilters:m})})]}),e.jsx("div",{className:"flex-1",children:e.jsx(Ne,{isSave:c,setIsSave:n,setIsLoading:o,filters:l})})]})};export{Ie as default};
