import{r as i,c as P,V as x,j as e,a as X,b as L,d as Z,G as M,u as ee,e as O,T as ae,F as te,f as se,P as re,s as ne}from"./index-BsfZthRi.js";import{S as A}from"./sweetalert2.esm.all-B0Dix5B2.js";import{u as ie}from"./useGetCategories-CuheyqlS.js";const le="http://35.154.167.170:3000/admin/categories",oe=()=>{const[l,o]=i.useState(!1);return{addCategory:async c=>{const s=localStorage.getItem("authToken");o(!0);try{const t=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},body:JSON.stringify(c)});if(!t.ok){const u=(await t.json()).message||"Failed to add category.";return P.error(u,{position:"top-center"}),{success:!1}}const n=await t.json();return P.success(n.message||"Category added successfully!",{position:"top-center"}),{success:!0}}catch(t){return t.name==="TypeError"&&t.message.includes("Failed to fetch")?P.error("Network error: Failed to fetch.",{position:"top-center"}):P.error("An unexpected error occurred.",{position:"top-center"}),{success:!1}}finally{o(!1)}},loading:l}},ce=()=>{const[l,o]=i.useState(!1),m=localStorage.getItem("authToken");return{deleteCategory:async s=>{o(!0);const t=`http://35.154.167.170:3000/admin/categories/${s}`;try{const n=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}}),d=await n.json();return n.ok?{success:!0,message:d.message}:(x.error(d.message,{position:"top-center"}),{success:!1,message:d.message})}catch(n){return x.error("An error occurred while deleting the category.",{position:"top-center"}),{success:!1,message:n.message}}finally{o(!1)}},loading:l}},de=()=>{const[l,o]=i.useState(!1);return{updateCategory:async(c,s)=>{o(!0);const t=`http://35.154.167.170:3000/admin/categories/${c}`;try{const n=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(s)});if(n.ok){const d=await n.json();return x.success(d.message,{position:"top-center"}),!0}else{const d=await n.json();return x.error(d.message,{position:"top-center"}),!1}}catch(n){return x.error(n.message,{position:"top-center"}),!1}finally{o(!1)}},loading:l}},me=X().shape({name:Z().required("Category name is required").max(30,"Maximum length of 30 characters exceeded")}),ue=({isOpen:l,onClose:o,setIsSubmit:m})=>{const{addCategory:c,loading:s}=oe(),[t,n]=i.useState({name:"",name_hindi:"",name_gujarati:""}),[d,u]=i.useState({});i.useEffect(()=>{l&&(n({name:"",name_hindi:"",name_gujarati:""}),u({}))},[l]);const w=async h=>{h.preventDefault();try{await me.validate(t,{abortEarly:!1}),u({}),await c(t),m(!0),o()}catch(j){if(j instanceof L){const b={};j.inner.forEach(p=>{p.path&&(b[p.path]=p.message)}),u(b)}else x.error("Failed to submit the form. Please try again.")}};return l&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:o}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg min-w-96 z-10 zx:min-w-[85%] relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:o,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Add Category"}),e.jsxs("form",{onSubmit:w,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name",children:"English Name"}),e.jsx("input",{type:"text",id:"name",name:"name",autoComplete:"off",value:t.name,onChange:h=>n({...t,name:h.target.value}),className:"input border border-gray-300 rounded-md p-2",disabled:s}),d.name&&e.jsx("p",{className:"text-red-500 text-sm",children:d.name||" "})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name_gujarati",children:"Gujarati Name"}),e.jsx("input",{type:"text",id:"name_gujarati",name:"name_gujarati",autoComplete:"off",value:t.name_gujarati,onChange:h=>n({...t,name_gujarati:h.target.value}),className:"input border border-gray-300 rounded-md p-2",disabled:s})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"name_hindi",children:"Hindi Name"}),e.jsx("input",{type:"text",id:"name_hindi",name:"name_hindi",autoComplete:"off",value:t.name_hindi,onChange:h=>n({...t,name_hindi:h.target.value}),className:"input border border-gray-300 rounded-md p-2",disabled:s})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${s?"opacity-50 cursor-not-allowed":""}`,disabled:s,children:s?"Adding...":"Add Category"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:o,disabled:s,children:"Cancel"})]})]})]})]})};function he(l){return M({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M15.854 12.854c-0-0-0-0-0-0l-4.854-4.854 4.854-4.854c0-0 0-0 0-0 0.052-0.052 0.090-0.113 0.114-0.178 0.066-0.178 0.028-0.386-0.114-0.529l-2.293-2.293c-0.143-0.143-0.351-0.181-0.529-0.114-0.065 0.024-0.126 0.062-0.178 0.114 0 0-0 0-0 0l-4.854 4.854-4.854-4.854c-0-0-0-0-0-0-0.052-0.052-0.113-0.090-0.178-0.114-0.178-0.066-0.386-0.029-0.529 0.114l-2.293 2.293c-0.143 0.143-0.181 0.351-0.114 0.529 0.024 0.065 0.062 0.126 0.114 0.178 0 0 0 0 0 0l4.854 4.854-4.854 4.854c-0 0-0 0-0 0-0.052 0.052-0.090 0.113-0.114 0.178-0.066 0.178-0.029 0.386 0.114 0.529l2.293 2.293c0.143 0.143 0.351 0.181 0.529 0.114 0.065-0.024 0.126-0.062 0.178-0.114 0-0 0-0 0-0l4.854-4.854 4.854 4.854c0 0 0 0 0 0 0.052 0.052 0.113 0.090 0.178 0.114 0.178 0.066 0.386 0.029 0.529-0.114l2.293-2.293c0.143-0.143 0.181-0.351 0.114-0.529-0.024-0.065-0.062-0.126-0.114-0.178z"},child:[]}]})(l)}function ge(l){return M({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M13.5 2l-7.5 7.5-3.5-3.5-2.5 2.5 6 6 10-10z"},child:[]}]})(l)}const xe=({isSubmit:l,setIsSubmit:o})=>{const[m,c]=i.useState(1),[s,t]=i.useState(10),[n,d]=i.useState(null),[u,w]=i.useState(),[h,j]=ee(),b=h.get("page"),p=h.get("perPage"),[y,T]=i.useState(null),[C,N]=i.useState({name:"",name_gujarati:"",name_hindi:""}),[v,D]=i.useState(""),[F,G]=i.useState(""),[R,I]=i.useState(""),{categories:S,count:$,fetchCategories:_,loading:U}=ie(m,s,v,n,u),{deleteCategory:Y}=ce(),{updateCategory:q}=de(),{hasPermission:f}=O(),K=Math.ceil($/s);i.useEffect(()=>{l&&(_(),o(!1))},[l,_]);const V=(a,r,g,k)=>{T(a),N({name:r,name_gujarati:g,name_hindi:k})},E=async()=>{if(C.name.trim()===""){x.error("Category name cannot be empty.",{position:"top-center"});return}try{await q(y,C)&&(z(),_())}catch{x.error("An error occurred while updating the category.",{position:"top-center"})}},z=()=>{T(null),N({name:"",name_gujarati:"",name_hindi:""})},H=async a=>{try{const{isConfirmed:r}=await A.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(r){const{success:g,message:k}=await Y(a);g?(await _(),A.fire(k)):A.fire(k)}}catch(r){A.fire({title:"Error",text:r.message||"An unexpected error occurred",icon:"error"})}};i.useEffect(()=>{b&&c(Number(b)),p&&t(Number(p))},[b,p]),i.useEffect(()=>{v&&(c(1),j({search:v,page:"1",perPage:s.toString()}))},[v]);const J=async a=>{a.preventDefault();try{await ne.validate({search:v},{abortEarly:!1}),D(F),I("")}catch(r){r instanceof L&&I(r.errors[0])}},B=a=>{n===a?w(u==="ASC"?"DESC":"ASC"):(d(a),w("ASC"))},Q=a=>{a>=1&&a<=K&&(c(a),j({page:a.toString(),perPage:s.toString()}))},W=a=>{const r=Number(a.target.value);t(r),c(1),j({page:"1",perPage:r.toString()})};return U?e.jsx(ae,{isFilters:!0,isPagination:!1,columns:3,records:5}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:s,onChange:W,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-4 flex-1 justify-end",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("form",{onSubmit:J,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:F,onChange:a=>{G(a.target.value),a.target.value===""&&D("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:R||" "})]})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[30px]",children:e.jsxs("span",{className:`sort ${n==="category_id"?u==="ASC"?"asc":"desc":""}`,onClick:()=>B("category_id"),children:[e.jsx("span",{className:"sort-label",children:"Id"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[260px]",children:e.jsxs("span",{className:`sort ${n==="name"?u==="ASC"?"asc":"desc":""}`,onClick:()=>B("name"),children:[e.jsx("span",{className:"sort-label",children:"English name"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[260px]",children:e.jsx("span",{className:"sort-label",children:"Gujarati name"})}),e.jsx("th",{className:"min-w-[260px]",children:e.jsx("span",{className:"sort-label",children:"Hindi name"})}),(f(5,"update")||f(5,"delete"))&&e.jsx("th",{className:"min-w-[125px]",children:"Actions"})]})}),S.length>0?e.jsx("tbody",{children:S.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-2.5",children:a.category_id})}),e.jsx("td",{children:y===a.category_id?e.jsx("input",{type:"text",className:"border border-gray-300 p-2 rounded-md focus:outline-none",value:C.name,onChange:r=>N(g=>({...g,name:r.target.value})),onKeyPress:r=>{r.key==="Enter"&&E()}}):a.name}),e.jsx("td",{children:y===a.category_id?e.jsx("input",{type:"text",className:"border border-gray-300 p-2 rounded-md focus:outline-none",value:C.name_gujarati,onChange:r=>N(g=>({...g,name_gujarati:r.target.value})),onKeyPress:r=>{r.key==="Enter"&&E()}}):a.name_gujarati}),e.jsx("td",{children:y===a.category_id?e.jsx("input",{type:"text",className:"border border-gray-300 p-2 rounded-md focus:outline-none",value:C.name_hindi,onChange:r=>N(g=>({...g,name_hindi:r.target.value})),onKeyPress:r=>{r.key==="Enter"&&E()}}):a.name_hindi}),(f(5,"update")||f(5,"delete"))&&e.jsx("td",{children:y===a.category_id?f(5,"update")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:E,"aria-label":"Save",children:e.jsx(ge,{color:"green"})}),e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:z,"aria-label":"Cancel",children:e.jsx(he,{color:"red"})})]}):e.jsxs(e.Fragment,{children:[f(5,"update")&&e.jsx("button",{className:"mr-3 bg-yellow-100 hover:bg-yellow-200 p-3 rounded-full",onClick:()=>V(a.category_id,a.name,a.name_gujarati,a.name_hindi),"aria-label":"Edit",children:e.jsx(te,{className:"text-yellow-600"})}),f(5,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-3 rounded-full",onClick:()=>H(a.category_id),"aria-label":"Delete",children:e.jsx(se,{className:"text-red-500"})})]})})]},a.category_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Category available"})})})]})}),e.jsx(re,{count:$,currentPage:m,totalRecords:S==null?void 0:S.length,perPage:s,onPageChange:Q,label:"category"})]})})]})},be=()=>{const[l,o]=i.useState(!1),[m,c]=i.useState(!1),{hasPermission:s}=O(),t=()=>{o(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 pb-7.5",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Category"})}),s(5,"create")&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("button",{onClick:t,className:"btn btn-primary",children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Category"]})})]})}),e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(xe,{isSubmit:m,setIsSubmit:c})})})}),e.jsx(ue,{setIsSubmit:c,isOpen:l,onClose:()=>o(!1)})]})};export{be as default};
