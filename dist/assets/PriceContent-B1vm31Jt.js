import{r as l,B as y,V as p,a as $,p as A,I as _,d as F,j as e,b as I,e as k,T as D,F as B,f as L}from"./index-D24ck8V_.js";import{M as U}from"./index-CNuX_7kJ.js";import{u as z}from"./useGetServices-rS6KSh_z.js";import{M}from"./ModelLoadingTag-CxGgq7PF.js";import{S as C}from"./sweetalert2.esm.all-B0Dix5B2.js";const q=()=>{const[r,s]=l.useState([]),[c,o]=l.useState(!1),d=async()=>{const t=localStorage.getItem("authToken");o(!0);try{const a=await fetch(`${y}/price-content`,{method:"GET",headers:{Authorization:t?`Bearer ${t}`:""}}),n=await a.json();if(!a.ok){p.error(n.message,{position:"top-center"}),o(!1);return}s(n==null?void 0:n.data)}catch{p.error("Network Error : Failed to fetch prices")}finally{o(!1)}};return l.useEffect(()=>{d()},[]),{priceContents:r,loading:c,fetchPriceContents:d}},G=()=>{const[r,s]=l.useState(),[c,o]=l.useState(!1);return{priceContent:r,loading:c,fetchPriceContent:async t=>{const a=localStorage.getItem("authToken");o(!0);try{const n=await fetch(`${y}/price-content/${t}`,{method:"GET",headers:{Authorization:a?`Bearer ${a}`:""}}),h=await n.json();if(!n.ok){p.error(h.message,{position:"top-center"}),o(!1);return}s(h==null?void 0:h.data)}catch{p.error("Network Error : Failed to fetch data")}finally{o(!1)}}}},V=()=>{const[r,s]=l.useState(!1);return{addPriceContent:async o=>{const d=localStorage.getItem("authToken");s(!0);try{const t=await fetch(`${y}/price-content`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(o)}),a=await t.json();return t.ok?(p.success(a.message,{position:"top-center"}),!0):(p.error(a.message,{position:"top-center"}),!1)}catch{p.error("Error adding Price content",{position:"top-center"})}finally{s(!1)}},loading:r}},O=()=>{const[r,s]=l.useState(!1);return{updatePriceContent:async(o,d)=>{const t=localStorage.getItem("authToken");s(!0);try{const a=await fetch(`${y}/price-content/${o}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(d)}),n=await a.json();return a.ok?(p.success(n.message,{position:"top-center"}),!0):(p.error(n.message,{position:"top-center"}),!1)}catch{return p.error("Error Updating price content",{position:"top-center"}),!1}finally{s(!1)}},loading:r}},R=()=>{const[r,s]=l.useState(!1);return{deletePriceContent:async o=>{const d=localStorage.getItem("authToken");s(!0);try{const t=await fetch(`${y}/price-content/${o}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}}),a=await t.json();return t.ok?{success:!0,message:a.message}:(p.error(a.message,{position:"top-center"}),{success:!1,message:a.message})}catch(t){return p.error(t.message,{position:"top-center"}),{success:!1,message:t.message}}finally{s(!1)}},loading:r}},J=$().shape({category_name:F().required("Category is required"),service_names:_().min(1,"Please select service name").required("Please select servuce name"),price:A().typeError("Maximum usage per user must be a number").required("Please enter price")}),Y=({isOpen:r,onClose:s,price_content_id:c,setIsSubmit:o})=>{const{services:d}=z(1,1e3),{priceContent:t,fetchPriceContent:a,loading:n}=G(),{addPriceContent:h,loading:i}=V(),{updatePriceContent:b,loading:g}=O(),[u,x]=l.useState({category_name:"",service_names:[],price:null}),[E,v]=l.useState({category_name:"",service_names:[],price:null}),[N,P]=l.useState({}),w=d.map(m=>({name:m.name}));l.useEffect(()=>{r&&c&&a(c)},[r,c]),l.useEffect(()=>{if(r&&t&&c){const m={category_name:t.category_name,service_names:t.service_names,price:t.price};x(m),v(m)}else x({category_name:"",service_names:[],price:null}),v({category_name:"",service_names:[],price:null}),P({})},[r,t,c]);const T=async m=>{m.preventDefault();try{if(await J.validate(u,{abortEarly:!1}),!Object.keys(u).some(j=>u[j]!==E[j])){s();return}c?await b(c,u):await h(u),o(!0),s()}catch(f){if(f instanceof I){const j={};f.inner.forEach(S=>{j[S.path||""]=S.message}),P(j)}else p.error("Failed to submit the form. Please try again.")}};return r?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:s}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[480px] ban:w-[85%] z-10 relative",children:[c&&n&&r&&e.jsx(M,{}),e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default","data-modal-dismiss":"true",onClick:s,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:c?"Update Price":"Add Price"}),e.jsx("form",{onSubmit:T,children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"category",className:"mb-1 block text-gray-700 font-semibold",children:"Category name"}),e.jsx("input",{type:"text",id:"category",name:"category",autoComplete:"off",className:"input border border-gray-300 rounded-md p-2 w-full",value:u.category_name??"",onChange:m=>x({...u,category_name:m.target.value})}),e.jsx("p",{className:"text-red-500 text-sm",children:N.category_name||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"service",className:"mb-1 block text-gray-700 font-semibold",children:"Service name"}),e.jsx(U,{options:w,displayValue:"name",selectedValues:w.filter(m=>u.service_names.includes(m.name)),onSelect:m=>{x({...u,service_names:m.map(f=>f.name)})},onRemove:m=>{x({...u,service_names:m.map(f=>f.name)})},isObject:!0}),e.jsx("p",{className:"text-red-500 text-sm",children:N.service_names||" "})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"price",className:"mb-1 block text-gray-700 font-semibold",children:"Price"}),e.jsx("input",{type:"text",id:"price",name:"price",autoComplete:"off",className:"input border border-gray-300 rounded-md p-2 w-full",value:u.price??"",onChange:m=>x({...u,price:Number(m.target.value)})}),e.jsx("p",{className:"text-red-500 text-sm",children:N.price||" "})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${i||g?"opacity-50 cursor-not-allowed":""}`,disabled:i||g,children:i||g?i?"Adding...":"Updating...":c?"Update Price":"Add Price"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:s,disabled:i||g,children:"Cancel"})]})]})})]})]}):null},H=({isSubmit:r,setIsSubmit:s,setUpdateItem:c})=>{const{priceContents:o,fetchPriceContents:d,loading:t}=q(),{deletePriceContent:a}=R(),{hasPermission:n}=k();l.useEffect(()=>{(async()=>{r&&(d(),s(!1))})()},[r]);const h=async i=>{try{const{isConfirmed:b}=await C.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel"});if(b){const{success:g,message:u}=await a(i);g?(d(),C.fire(u)):C.fire(u)}}catch(b){C.fire({title:"Error",text:b.message,icon:"error"})}};return t?e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(D,{isFilters:!1,columns:4,records:4,isPagination:!1})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-5 lg:gap-5.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[30px]",children:"Id"}),e.jsx("th",{className:"min-w-[120px]",children:"Category"}),e.jsx("th",{className:"min-w-[120px]",children:"Service"}),e.jsx("th",{className:"min-w-[60px]",children:"Price"}),(n(11,"update")||n(11,"delete"))&&e.jsx("th",{className:"w-[50px]",children:"Actions"})]})}),o.length>0?e.jsx("tbody",{children:o.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.price_content_id}),e.jsx("td",{children:i.category_name}),e.jsx("td",{children:i.service_names.join(", ")}),e.jsx("td",{children:i.price}),(n(11,"update")||n(11,"delete"))&&e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[n(11,"update")&&e.jsx("button",{className:"bg-yellow-100 hover:bg-yellow-200 p-2 rounded-full",onClick:()=>c(i.price_content_id),children:e.jsx(B,{className:"text-yellow-600"})}),n(11,"delete")&&e.jsx("button",{className:"bg-red-100 hover:bg-red-200 p-2 rounded-full",onClick:()=>h(i.price_content_id),children:e.jsx(L,{className:"text-red-500"})})]})})]},i.price_content_id))}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No price data available"})})})]})})})})})})},ee=()=>{const[r,s]=l.useState(!1),[c,o]=l.useState(null),[d,t]=l.useState(!1),{hasPermission:a}=k(),n=()=>{s(!0),o(null)},h=i=>{o(i),s(!0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container-fixed",children:[e.jsxs("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:[e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price Content"}),a(11,"create")&&e.jsxs("button",{className:"btn btn-primary",onClick:n,children:[e.jsx("i",{className:"ki-filled ki-plus-squared"}),"Add Price"]})]}),e.jsx(H,{isSubmit:d,setIsSubmit:t,setUpdateItem:h}),r&&e.jsx(Y,{isOpen:r,onClose:()=>s(!1),price_content_id:c,setIsSubmit:t})]})})};export{ee as default};
