import{r as c,V as p,B as P,t as F,j as e,a as D,b as E,m as T,q as O}from"./index-C7xw036H.js";import{u as L}from"./useGetWorkshops-B8XMwVG6.js";const W="http://35.154.167.170:3000/admin/orders/assign-pickup",z=()=>{const[i,s]=c.useState(!1);return{assignPickupBoy:async b=>{const d=localStorage.getItem("authToken");s(!0);try{const t=await fetch(W,{method:"PATCH",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(b)}),r=await t.json();return t.ok?(p.success(r.message,{position:"top-center"}),!0):(p.error(r.message,{position:"top-center"}),!1)}catch(t){return p.error((t==null?void 0:t.message)||"Error assignning pickupboy",{position:"top-center"}),!1}finally{s(!1)}},loading:i}},R=()=>{const[i,s]=c.useState(!1);return{assignWorkshop:async(b,d)=>{const t=localStorage.getItem("authToken");s(!0);try{const r=await fetch(`${P}/admin/orders/assign-workshop`,{method:"PATCH",headers:{Authorization:t?`Bearer ${t}`:"","Content-Type":"application/json"},body:JSON.stringify({order_ids:b,workshop_id:d})}),f=await r.json();return r.ok?(p.success(f.message,{position:"top-center"}),!0):(p.error(f.message,{position:"top-center"}),!1)}catch{return p.error("Failed to assign workshop"),!1}finally{s(!1)}},loading:i}},U=()=>{const[i,s]=c.useState(!1);return{assignBranch:async(b,d)=>{const t=localStorage.getItem("authToken");s(!0);try{const r=await fetch(`${P}/admin/orders/assign-branch`,{method:"PATCH",headers:{Authorization:t?`Bearer ${t}`:"","Content-Type":"application/json"},body:JSON.stringify({order_id:b,branch_id:d})}),f=await r.json();return r.ok?(p.success(f.message,{position:"top-center"}),!0):(p.error(f.message,{position:"top-center"}),!1)}catch{return p.error("Failed to assign branch"),!1}finally{s(!1)}},loading:i}},M="http://35.154.167.170:3000/admin/orders/assign-delivery",q=()=>{const[i,s]=c.useState(!1);return{assignDeliveryBoy:async b=>{const d=localStorage.getItem("authToken");s(!0);try{const t=await fetch(M,{method:"PATCH",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(b)}),r=await t.json();return t.ok?(p.success(r.message,{position:"top-center"}),!0):(p.error(r.message,{position:"top-center"}),!1)}catch(t){return p.error((t==null?void 0:t.message)||"Error assigning delivery boy",{position:"top-center"}),!1}finally{s(!1)}},loading:i}},I=D().shape({pickup_boy_id:T().required("Please enter name to assign")}),Y=({orderId:i,modelOpen:s,onClose:h,setAssigned:b,orderStatus:d})=>{const{assignPickupBoy:t,loading:r}=z(),{assignDeliveryBoy:f,loading:j}=q(),{users:v,fetchUsersByRole:_}=F(),[a,n]=c.useState(""),[x,g]=c.useState(!0),[l,u]=c.useState({order_ids:i,pickup_boy_id:null,comment:""}),[o,y]=c.useState(""),k=c.useRef(null),S=c.useRef(null),[B,C]=c.useState(!1);c.useEffect(()=>{(async()=>{B&&(!a||a.trim()==="")?await _(4):a&&x&&await _(4,a)})()},[B,a,x]);const A=m=>{n(m.target.value),g(!0),m.target.value===""&&u({...l,pickup_boy_id:null})},w=m=>{const N=`${m.first_name} ${m.last_name}`;n(N),g(!1),u({...l,pickup_boy_id:m.user_id})};c.useEffect(()=>{const m=N=>{k.current&&!k.current.contains(N.target)&&S.current&&!S.current.contains(N.target)&&(g(!1),C(!1))};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[]),c.useEffect(()=>{s||(n(""),u({order_ids:i,pickup_boy_id:null,comment:""}),y(""))},[s,i]);const $=async m=>{m.preventDefault();try{if(await I.validate(l,{abortEarly:!1}),d==="Assign Delivery boy"){const N={order_ids:l.order_ids,delivery_boy_id:l.pickup_boy_id};await f(N)}else await t(l);b(!0),h()}catch(N){N instanceof E&&y(N.errors[0])}};return s?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:h}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[400px] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:h,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:d}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"relative flex flex-col flex-[0_0_40%]",children:[e.jsx("label",{htmlFor:"username",className:"block text-gray-700 text-sm font-bold mb-1",children:"Name"}),e.jsx("input",{type:"text",id:"username",ref:S,autoComplete:"off",value:a||"",onChange:A,className:"input border border-gray-300 rounded-md p-2 w-full",placeholder:"Search name...",onFocus:()=>{C(!0),g(!0)}}),v&&x&&e.jsx("ul",{ref:k,className:"absolute mt-[64px] bg-white z-10 border border-gray-300 rounded-md p-2 w-full text-sm",children:v.length>0?v.map(m=>e.jsxs("li",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>w(m),children:[m.first_name," ",m.last_name," (",m.mobile_number,")"]},m.user_id)):e.jsx("li",{className:"p-2 text-gray-500",children:"No users found"})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o||" "})]}),d==="Assign Pickup Boy"&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-1",htmlFor:"comment",children:"Comment"}),e.jsx("textarea",{id:"comment",name:"comment",className:"h-20 input border border-gray-300 rounded-md p-2",rows:5,value:l.comment,onChange:m=>u({...l,comment:m.target.value})})]}),e.jsxs("div",{className:"flex mt-4",children:[e.jsx("button",{type:"submit",className:"btn btn-primary mr-2",disabled:r||j,children:"Assign"}),e.jsx("button",{type:"button",onClick:h,className:"btn btn-light",children:"Cancel"})]})]})]})]}):null},G=D().shape({option:T().required("Please select option")}),K=({orderIds:i,workshopModalOpen:s,onClose:h,setAssigned:b,orderStatus:d})=>{const{workshops:f}=L(1,1e3),{branches:j}=O(1,1e3),{assignWorkshop:v,loading:_}=R(),{assignBranch:a}=U(),[n,x]=c.useState(),[g,l]=c.useState("");c.useEffect(()=>{s||(x(null),l(""))},[s,i]);const u=async o=>{o.preventDefault();try{await G.validate({option:n},{abortEarly:!1}),d==="Assign Workshop"?await v(i,n):await a(i,n),h(),b(!0)}catch(y){y instanceof E&&l(y.errors[0])}};return s?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:h}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[400px] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:h,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:d==="Assign Workshop"?"Assign Workshop":"Assign Branch"}),e.jsxs("form",{onSubmit:u,children:[d==="Assign Workshop"?e.jsxs("div",{className:"relative flex flex-col flex-[0_0_40%]",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"workshop_id",children:"Workshop"}),e.jsxs("select",{id:"workshop_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n??"",onChange:o=>x(Number(o.target.value)),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Workshop"}),(f==null?void 0:f.length)>0?f.map(o=>e.jsx("option",{value:o.workshop_id,children:o.workshop_name},o.workshop_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g||" "})]}):e.jsxs("div",{className:"relative flex flex-col flex-[0_0_40%]",children:[e.jsx("label",{className:"mb-2 font-semibold",htmlFor:"branch_id",children:"Branch"}),e.jsxs("select",{id:"branch_id",className:"select border border-gray-300 rounded-md p-2 w-full text-sm",value:n??"",onChange:o=>x(Number(o.target.value)),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Branch"}),(j==null?void 0:j.length)>0?j.map(o=>e.jsx("option",{value:o.branch_id,children:o.branch_name},o.branch_id)):e.jsx("option",{children:"No Data available"})]}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g||" "})]}),e.jsxs("div",{className:"flex mt-4",children:[e.jsx("button",{type:"submit",className:"btn btn-primary mr-2",disabled:_,children:"Assign"}),e.jsx("button",{type:"button",onClick:h,className:"btn btn-light",children:"Cancel"})]})]})]})]}):!1},J=()=>{const[i,s]=c.useState(!1);return{payDue:async b=>{const d=localStorage.getItem("authToken");if(!d)return p.error("Authentication token is missing!",{position:"top-center"}),{success:!1};s(!0);try{const t=await fetch(`${P}/orders/payments/pay-due`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({orders:b})}),r=await t.json();if(!t.ok)throw new Error((r==null?void 0:r.message)||"Failed to process payment.");return p.success("Order status updated successfully",{position:"top-center"}),{success:!0,data:r}}catch(t){return p.error(t.message,{position:"top-center"}),{success:!1,error:t.message}}finally{s(!1)}},loading:i}},Q=({orders:i,onClose:s,onSuccess:h})=>{const{payDue:b,loading:d}=J(),[t,r]=c.useState([]),[f,j]=c.useState({}),v=async()=>{if(Object.keys(f).length>0){p.error("Please fix errors before submitting.");return}const a=11,n=t.map(({order_id:g,current_paid:l,payment_status:u,kasar_amount:o,user_id:y})=>({order_id:g,paid_amount:l,payment_status:u,kasar_amount:o,order_status:a,user_id:y}));await b(n)&&h(!0)},_=(a,n,x)=>{r(g=>g.map(l=>{if(l.order_id!==a)return l;const u={...l,[n]:x},o=u.current_paid+u.kasar_amount+u.paid_amount;return o>u.total?j(y=>({...y,[a]:"Paid amount cannot exceed total amount."})):j(y=>{const k={...y};return delete k[a],k}),o===u.total?u.payment_status=2:o>0?u.payment_status=3:u.payment_status=1,u}))};if(c.useEffect(()=>{i.length>0&&r(i.map(a=>{var n,x;return{user:a.user,user_id:a.user_id,order_id:a.order_id,total:a.total,paid_amount:a.paid_amount,kasar_amount:a.kasar_amount,current_paid:0,payment_status:a.payment_status,total_items:((n=a.items)==null?void 0:n.length)||0,total_quantity:((x=a.items)==null?void 0:x.reduce((g,l)=>g+l.quantity,0))||"NULL"}}))},[i]),c.useEffect(()=>{console.log("FormData : ",t)},[t]),!i.length){p.error("Order not found."),s();return}return e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:s}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[700px] z-10 relative",children:[e.jsx("button",{className:"btn btn-sm btn-icon btn-light btn-outline absolute top-0 right-0 mr-5 mt-5 lg:mr-5 shadow-default",onClick:s,children:e.jsx("i",{className:"ki-filled ki-cross"})}),e.jsx("h2",{className:"text-xl font-bold mb-6",children:"Order Due Summary"}),e.jsx("div",{className:"flex flex-col gap-4 max-h-[500px] overflow-y-auto",children:t.map(a=>{const{order_id:n,user:x,total:g,paid_amount:l,total_items:u,total_quantity:o,kasar_amount:y,current_paid:k,payment_status:S}=a,{first_name:B,last_name:C,mobile_number:A}=x;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"py-2 px-4 border-b border-gray-200 flex justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("a",{href:`/order/${n}`,target:"__blank",className:"text-base font-bold link",children:["#",n]}),e.jsx("h4",{className:"text-gray-700 text-sm font-bold",children:`${B} ${C} (${A})`})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"form-label !text-red-500 !font-bold",children:"Total Due Amount"}),e.jsx("p",{className:"form-label justify-center !text-red-500 !font-bold",children:g-l-y})]})]}),e.jsx("div",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-stretch gap-3",children:[e.jsxs("div",{className:"basis-[225px] grid grid-cols-2 gap-y-2 items-center gap-x-4",children:[e.jsx("p",{className:"form-label",children:"Total Amount"}),e.jsx("p",{className:"form-label justify-center",children:g}),e.jsx("p",{className:"form-label",children:"Paid Amount"}),e.jsx("p",{className:"form-label justify-center",children:l}),e.jsx("p",{className:"form-label",children:"Total Items"}),e.jsx("p",{className:"form-label justify-center",children:u}),e.jsx("p",{className:"form-label",children:"Total Quantity"}),e.jsx("p",{className:"form-label justify-center",children:o})]}),e.jsxs("div",{className:"grow grid grid-cols-2 gap-y-2 items-center",children:[e.jsx("label",{htmlFor:"kasar_amount",className:"form-label",children:"Kasar Amount"}),e.jsx("input",{id:"kasar_amount",className:"form-control border border-gray-400 rounded px-3 py-2 input",type:"text",value:y,autoComplete:"off",onChange:w=>_(n,"kasar_amount",Number(w.target.value))}),e.jsx("label",{htmlFor:"current_paid_amount",className:"form-label",children:"Current Paid"}),e.jsx("div",{children:e.jsx("input",{id:"current_paid_amount",className:"form-control border border-gray-400 rounded px-3 py-2 input",type:"text",value:k,autoComplete:"off",onChange:w=>_(n,"current_paid",Number(w.target.value))})}),e.jsx("label",{htmlFor:"payement_status",className:"form-label",children:"Payment Status"}),e.jsxs("select",{id:"payement_status",className:"form-select border border-gray-400 rounded px-3 py-2 select",value:S,onChange:w=>_(n,"payment_status",Number(w.target.value)),children:[e.jsx("option",{value:1,children:"Pending"}),e.jsx("option",{value:2,children:"Received"}),e.jsx("option",{value:3,children:"Partial received"})]})]})]}),e.jsx("div",{children:f[n]&&e.jsx("p",{className:"text-red-500 text-sm mt-1 text-right",children:f[n]})})]})})]},n)})}),e.jsxs("div",{className:"mt-4 space-x-4",children:[e.jsx("button",{type:"button",className:"btn btn-primary relative",disabled:d,onClick:v,children:d?"loading...":"Submit"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:s,children:"Cancel"})]})]})]})};export{Q as D,Y as P,K as W,q as a,z as u};
