import{r as i,V as N,u as H,e as O,j as e,T as Q,q as W,t as X,v as Y,s as Z,b as ee}from"./index-DF9T0g0D.js";import{u as z}from"./useGetCategories-DzCuJxgE.js";import{u as G}from"./useGetProducts-CBLqX2WG.js";import{u as M}from"./useGetServices-ISAn6u2Z.js";import{u as se}from"./useGetPrice-Dgmx_6bG.js";import{M as V}from"./MultiSelect-DysElDnV.js";import"./orderStatusClasses-HfHBGnti.js";const ae="http://35.154.167.170:3000/prices",te=()=>{const[n,d]=i.useState(!1);return{addPrice:async u=>{const o=localStorage.getItem("authToken");if(u.length===0)return N.error("No changes detected. Please provide a price to save.",{position:"top-center"}),!1;d(!0);try{const s={prices:u},c=await fetch(ae,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(s)});if(!c.ok){const j=(await c.json()).message;return N.error(j,{position:"top-center"}),!1}const l=await c.json();return N.success(l.message,{position:"top-center"}),!0}catch(s){return s.name==="TypeError"&&s.message.includes("Failed to fetch")?N.error("Network error: Failed to fetch.",{position:"top-center"}):N.error("An unexpected error occurred.",{position:"top-center"}),!1}finally{d(!1)}},loading:n}},re=({isSave:n,setIsSave:d,setIsLoading:g,search:u,filters:o})=>{const{categories:s}=z(1,1e3),{products:c}=G(1,1e3),{services:l}=M(1,1e3),{prices:S,loading:j,fetchPrices:y}=se(),{addPrice:_,loading:C}=te(),[p,P]=i.useState({}),[b,w]=i.useState(new Set),f=i.useRef({}),[A,R]=H(),[m,q]=i.useState(null),[v,F]=i.useState(null),{hasPermission:k}=O(),I=i.useCallback((t,r,a,h)=>{const x=[];return t.forEach($=>{r.forEach(L=>{a.forEach(T=>{const K=`${$.category_id}_${L.product_id}_${T.service_id}`;x.push({category:$,product:L,service:T,price:h[K]||0})})})}),x},[s,c,l,S])(s,c,l,S),D=I.filter(t=>{const r=(u||"").trim().toLowerCase(),a=t.category.name.toLowerCase().includes(r)||t.product.name.toLowerCase().includes(r)||t.service.name.toLowerCase().includes(r),h=o.categoryId.length===0||o.categoryId.includes(t.category.category_id),x=o.productId.length===0||o.productId.includes(t.product.product_id),$=o.serviceId.length===0||o.serviceId.includes(t.service.service_id);return a&&h&&x&&$}).sort((t,r)=>["category","product","service"].includes(m)?v==="ASC"?t[m].name.localeCompare(r[m].name):r[m].name.localeCompare(t[m].name):m==="price"?v==="ASC"?t.price-r.price:r.price-t.price:0);i.useEffect(()=>{if(n){if(!I.some(a=>{const h=`${a.category.category_id}_${a.product.product_id}_${a.service.service_id}`;return p[h]!==void 0&&p[h]!==a.price})){d(!1);return}const r=I.map(a=>{const h=`${a.category.category_id}_${a.product.product_id}_${a.service.service_id}`;return{category_id:a.category.category_id,product_id:a.product.product_id,service_id:a.service.service_id,price:p[h]!==void 0?p[h]:a.price}}).filter(a=>a.price>0);try{_(r).then(()=>{y().then(()=>{P({}),w(new Set)})})}catch{N.error("Failed to save prices.")}}d(!1)},[n,_,I,p]),i.useEffect(()=>{var r;const t=Array.from(b);if(t.length>0){const a=t[0];f.current[a]&&((r=f.current[a])==null||r.focus())}},[b]),i.useEffect(()=>{R(u?{search:u}:{})},[u]),i.useEffect(()=>{g(!!C)},[C]);const B=t=>{w(r=>{const a=new Set(r);return a.add(t),a})},U=(t,r)=>{P(a=>({...a,[t]:r}))},E=t=>{m===t?F(v==="ASC"?"DESC":"ASC"):(q(t),F("ASC"))},J=t=>{w(r=>{const a=new Set(r);return a.delete(t),a})};return j?e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(Q,{isFilters:!0,columns:5,records:20,isPagination:!1})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5 mt-4",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{"data-datatable":"true","data-datatable-page-size":"10",children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border","data-datatable-table":"true",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[40px]",children:"Id"}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${m==="category"?v==="ASC"?"asc":"desc":""}`,onClick:()=>E("category"),children:[e.jsx("span",{className:"sort-label",children:"Category"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${m==="product"?v==="ASC"?"asc":"desc":""}`,onClick:()=>E("product"),children:[e.jsx("span",{className:"sort-label",children:"Product"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[250px]",children:e.jsxs("span",{className:`sort ${m==="service"?v==="ASC"?"asc":"desc":""}`,onClick:()=>E("service"),children:[e.jsx("span",{className:"sort-label",children:"Service"}),e.jsx("span",{className:"sort-icon"})]})}),e.jsx("th",{className:"min-w-[200px]",children:e.jsxs("span",{className:`sort ${m==="price"?v==="ASC"?"asc":"desc":""}`,onClick:()=>E("price"),children:[e.jsx("span",{className:"sort-label",children:"Price"}),e.jsx("span",{className:"sort-icon"})]})})]})}),e.jsx("tbody",{children:D.length>0?D.map((t,r)=>{const a=`${t.category.category_id}_${t.product.product_id}_${t.service.service_id}`,h=b.has(a);return e.jsxs("tr",{className:`font-semibold ${t.price?"":"text-red-500"}`,children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:t.category.name}),e.jsx("td",{children:t.product.name}),e.jsx("td",{children:t.service.name}),e.jsx("td",{className:"relative",children:h?e.jsx("input",{ref:x=>f.current[a]=x,type:"text",className:"w-full h-full absolute inset-0 input input-bordered",value:p[a]!==void 0?p[a]:t.price||"",onChange:x=>U(a,x.target.value===""?0:Number(x.target.value)),onBlur:()=>J(a),onKeyDown:x=>{x.key==="Enter"&&d(!0)}}):e.jsx("span",{className:`${k(10,"update")||k(10,"create")?"cursor-pointer h-full flex":"h-full flex"}`,onClick:k(10,"update")||k(10,"create")?()=>B(a):void 0,children:p[a]!==void 0?p[a]:t.price||"Add Price"})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No data available"})})})]})})})})})})})},ce=({filters:n,updateFilters:d})=>{const{categories:g}=z(1,1e3),{products:u}=G(1,1e3),{services:o}=M(1,1e3);return e.jsx("div",{className:"p-3 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(V,{options:g==null?void 0:g.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.category_id})),displayValue:"name",placeholder:"Select Category",selectedValues:n==null?void 0:n.categoryId,onSelect:s=>{const c=s.map(l=>l.value);d({...n,categoryId:c})},onRemove:s=>{const c=s.map(l=>l.value);d({...n,categoryId:c})},className:"w-full",isSearchInput:!0}),e.jsx(V,{options:u==null?void 0:u.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.product_id})),displayValue:"label",placeholder:"Select Product",selectedValues:n.productId,onSelect:s=>{const c=s.map(l=>l.value);d({...n,productId:c})},onRemove:s=>{const c=s.map(l=>l.value);d({...n,productId:c})},className:"w-full",isSearchInput:!0}),e.jsx(V,{options:o==null?void 0:o.map(s=>({label:s==null?void 0:s.name,value:s==null?void 0:s.service_id})),displayValue:"label",placeholder:"Select Service",selectedValues:n.serviceId,onSelect:s=>{const c=s.map(l=>l.value);d({...n,serviceId:c})},onRemove:s=>{const c=s.map(l=>l.value);d({...n,serviceId:c})},className:"w-full",isSearchInput:!0})]})})},he=()=>{const[n,d]=i.useState(!1),[g,u]=i.useState(!1),[o,s]=i.useState(""),[c,l]=i.useState(""),[S,j]=i.useState(""),[y,_]=i.useState(!1),{hasPermission:C}=O(),[p,P]=i.useState({categoryId:[],productId:[],serviceId:[]}),b=f=>{P(f)},w=async f=>{f.preventDefault();try{await Z.validate({search:o},{abortEarly:!1}),l(o),j("")}catch(A){A instanceof ee&&j(A.errors[0])}};return e.jsxs("div",{className:"px-10 max-h-[calc(100vh-69px)] flex flex-col relative",children:[e.jsxs("div",{className:"sticky-save-header pb-1 bg-white",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-5 py-3 ",children:[e.jsx("div",{className:"flex flex-col justify-center gap-2",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Price"})}),e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("form",{onSubmit:w,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:o,onChange:f=>{s(f.target.value),f.target.value===""&&(l(""),j(""))},placeholder:"Search...",className:"min-w-[185px]"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),S&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:S||"Â "})]}),(C(10,"create")||C(10,"update"))&&e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsx("button",{onClick:()=>d(!0),className:"btn btn-primary",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ki-filled ki-plus-squared"})," Saving"," ",e.jsx(W,{})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ki-filled ki-plus-squared"})," Save"]})})})]})]}),e.jsx("div",{className:"flex flex-auto items-center justify-between gap-2.5 mb-2 shadow-none",children:e.jsxs("button",{className:"btn btn-sm btn-primary shadow-none",onClick:()=>_(!y),children:["Filters",y?e.jsx(X,{size:23}):e.jsx(Y,{color:"skyblue",size:23})]})}),e.jsx("div",{children:y&&e.jsx(ce,{filters:p,updateFilters:b})})]}),e.jsx("div",{className:"flex-1 overflow-auto new-scollbar -mr-4 pr-2",children:e.jsx(re,{isSave:n,setIsSave:d,setIsLoading:u,search:c,filters:p})})]})};export{he as default};
