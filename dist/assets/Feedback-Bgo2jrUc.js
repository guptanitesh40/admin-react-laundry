import{X as J,r as n,j as e,u as K,Y as Q,Z as k,e as ee,T as se,l as T,g as ae,h as te,s as le,b as ne,V as re}from"./index-OSWh217v.js";import{M as ie}from"./MultiSelect-BdWg8PAr.js";import"./orderStatusClasses-HfHBGnti.js";const P=t=>{switch(t){case 1:return"one-star-rating";case 2:return"two-star-rating";case 3:return"three-star-rating";case 4:return"four-star-rating";case 5:return"five-star-rating";default:return"custom-rating-on"}},ce=()=>{const{customerRatingData:t,fetchCustomerRatingData:u}=J(),[c,h]=n.useState([{label:"5",count:0},{label:"4",count:0},{label:"3",count:0},{label:"2",count:0},{label:"1",count:0}]),[g,p]=n.useState(0),[v,F]=n.useState(0);n.useEffect(()=>{u()},[]),n.useEffect(()=>{if(t){const l=c.map(r=>{const o=t==null?void 0:t.find(w=>w.rating.toString()===r.label);return o?{...r,count:o.count}:r});h(l);const i=t==null?void 0:t.reduce((r,o)=>r+o.rating*o.count,0),d=t==null?void 0:t.reduce((r,o)=>r+o.count,0),j=i/d;p(j),F(d)}},[t]);const f=Math.max(...c.map(l=>l.count)),R=(l,i)=>{const d=Number(l);if(i===0)return"bg-gray-200";switch(d){case 1:return"bg-red-500";case 2:return"bg-green-500";case 3:return"bg-yellow-500";case 4:return"bg-orange-500";case 5:return"bg-blue-500";default:return"bg-gray-200"}};return e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"flex flex-wrap mt-3 justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 ml-3",children:[e.jsx("div",{children:e.jsx("img",{className:"default-logo h-[55px] max-w-none",src:"/media/app/review.png"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-2xl text-gray-700 font-bold",children:g.toFixed(2)}),e.jsxs("p",{className:"text-base font-semibold text-gray-700",children:["─ of ",v," reviews"]})]})]}),e.jsx("div",{className:"card-body flex flex-col gap-2 custom-body min-w-[250px]",children:c.map((l,i)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex justify-between text-sm font-medium text-gray-600",children:e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("span",{children:l.label}),e.jsx("div",{className:"rating-label custom-rating checked",children:e.jsx("i",{className:`${P(Number(l.label))} rating-on ki-solid ki-star text-base leading-none`})},i)]})}),e.jsx("div",{className:"w-full h-[8px] bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:`${R(l.label,l.count)} rounded-full h-full transition-all duration-500`,style:{width:`${l.count/f*100}%`}})}),e.jsx("span",{className:"font-medium text-sm text-gray-600",children:l.count})]},i))})]})})})},B=t=>{switch(t){case 1:return"badge badge-danger badge-outline";case 2:return"badge badge-info badge-outline";case 3:return"badge badge-warning badge-outline";default:return""}},oe=()=>{const[t,u]=n.useState(1),[c,h]=n.useState(10),[g,p]=K(),[v,F]=n.useState(null),[f,R]=n.useState(null),l=g.get("page"),i=g.get("perPage"),[d,j]=n.useState(""),[r,o]=n.useState(""),[w,_]=n.useState(""),[S,z]=n.useState(),[M,$]=n.useState([]),{feedbacks:x,count:y,fetchFeedbacks:D,loading:G}=Q(t,c,d,v,f,M,S),{approveFeedback:L}=k(),{hasPermission:b}=ee(),N=Math.ceil(y/c);n.useEffect(()=>{l&&u(Number(l)),i&&h(Number(i))},[l,i]);const W=async s=>{s.preventDefault();try{await le.validate({search:r},{abortEarly:!1}),j(r),_("")}catch(a){a instanceof ne&&_(a.errors[0])}},C=s=>{s>=1&&s<=N&&(u(s),p({page:s.toString(),perPage:c.toString()}))},U=s=>{const a=Number(s.target.value);h(a),u(1),p({page:"1",perPage:a.toString()})},X=s=>Array.from({length:5}).map((a,m)=>e.jsxs("div",{className:`rating-label ${m<s?"checked":""}`,children:[e.jsx("i",{className:`rating-on ki-solid ki-star text-base leading-none ${m<s?P(s):""}`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]},m)),Z=async(s,a)=>{try{await L(s,a),D()}catch{re.error("Failed to update publish status:")}},q=Array.from({length:5},(s,a)=>({label:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-1",children:a+1}),e.jsxs("div",{className:"rating-label checked mb-1",children:[e.jsx("i",{className:`rating-on ${P(a+1)} ki-solid ki-star text-base leading-none`}),e.jsx("i",{className:"rating-off ki-outline ki-star text-base leading-none"})]})]},a),value:a+1}));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-header card-header-space flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{className:"select select-sm w-16","data-datatable-size":"true",name:"perpage",value:c,onChange:U,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-5 mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsx(ie,{options:q,displayValue:"label",placeholder:"Select Rating",selectedValues:M,onSelect:s=>$(s.map(a=>a.value)),onRemove:s=>$(s.map(a=>a.value)),className:"lgmobile:min-w-[250px] vsmobile:min-w-[235px]",sliceCount:3,isSearchInput:!1})}),e.jsx("div",{className:"flex flex-wrap gap-2.5",children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${B(S)}`,value:S,onChange:s=>z(Number(s.target.value)),children:[e.jsx("option",{value:"",children:"Publish Status"}),e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})}),e.jsxs("div",{className:"flex",children:[e.jsx("form",{onSubmit:W,className:"flex items-center gap-2",children:e.jsxs("label",{className:"input input-sm h-10 flex items-center gap-2",children:[e.jsx("input",{type:"search",value:r,onChange:s=>{o(s.target.value),s.target.value===""&&j("")},placeholder:"Search...",className:"min-w-[185px] flex-grow"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-icon",children:e.jsx("i",{className:"ki-filled ki-magnifier"})})]})}),e.jsx("p",{className:"text-red-500 text-sm mt-1",children:w||" "})]})]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{"data-datatable":"true","data-datatable-page-size":"10",children:[e.jsx("div",{className:"scrollable-x-auto",children:e.jsxs("table",{className:"table table-auto table-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[70px]",children:"Order Id"}),e.jsx("th",{className:"min-w-[250px]",children:"Customer name"}),e.jsx("th",{className:"min-w-[250px]",children:"Email"}),e.jsx("th",{className:"min-w-[130px]",children:"Mobile no"}),e.jsx("th",{className:"min-w-[100px]",children:"Rating"}),e.jsx("th",{className:"min-w-[300px]",children:"Comment"}),e.jsx("th",{className:"min-w-[120px]",children:"Date"}),(b(17,"create")||b(17,"update"))&&e.jsx("th",{className:"min-w-[140px]",children:"Publish"})]})}),G?e.jsx(se,{}):(x==null?void 0:x.length)>0?e.jsx("tbody",{children:x.map(s=>{var a,m,A,E,V,Y,I,O;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsxs("td",{children:[(m=(a=s==null?void 0:s.order)==null?void 0:a.user)==null?void 0:m.first_name," ",(E=(A=s==null?void 0:s.order)==null?void 0:A.user)==null?void 0:E.last_name]}),e.jsx("td",{children:(Y=(V=s==null?void 0:s.order)==null?void 0:V.user)==null?void 0:Y.email}),e.jsx("td",{children:(O=(I=s==null?void 0:s.order)==null?void 0:I.user)==null?void 0:O.mobile_number}),e.jsx("td",{children:e.jsx("div",{className:"rating",children:X(s.rating)})}),e.jsx("td",{children:s.comment}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[T(s.created_at).format("DD-MM-YYYY"),e.jsx("br",{}),T(s.created_at).format("hh:mm:ss A")]})}),(b(17,"create")||b(17,"update"))&&e.jsx("td",{children:e.jsxs("select",{className:`select select-lg w-[170px] text-sm ${B(s.is_publish)}`,value:s.is_publish,onChange:H=>Z(s.feedback_id,H.target.value),children:[e.jsx("option",{value:"1",className:"badge-danger badge-outline",children:"None"}),e.jsx("option",{value:"2",className:"badge-info badge-outline",children:"Website"}),e.jsx("option",{value:"3",className:"badge-warning badge-outline",children:"Mobile App"}),e.jsx("option",{value:"4",className:"badge-secondary badge-outline",children:"Both"})]})})]},s.feedback_id)})}):e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Feedbacks data available"})})})]})}),y>c&&e.jsx("div",{className:"card-footer justify-center md:justify-between flex-col md:flex-row gap-5 text-gray-600 text-2sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-700",children:["Showing ",x.length," of ",y," Users"]}),e.jsxs("div",{className:"pagination","data-datatable-pagination":"true",children:[e.jsx("button",{disabled:t===1,onClick:()=>C(t-1),className:`btn ${t===1?"disabled":""}`,children:e.jsx(ae,{})}),Array.from({length:N}).map((s,a)=>e.jsx("button",{className:`btn ${t===a+1?"active":""}`,onClick:()=>C(a+1),children:a+1},a)),e.jsx("button",{disabled:t===N,onClick:()=>C(t+1),className:`btn ${t===N?"disabled":""}`,children:e.jsx(te,{})})]})]})})]})})]})},xe=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"container-fixed",children:e.jsx("div",{className:"flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5",children:e.jsx("h1",{className:"text-xl font-semibold leading-none text-gray-900",children:"Customer Feedback And Rating"})})}),e.jsx("div",{className:"container-fixed",children:e.jsx(ce,{})}),e.jsx("div",{className:"container-fixed mt-5",children:e.jsx("div",{className:"grid gap-5 lg:gap-7.5",children:e.jsx("div",{className:"card card-grid min-w-full",children:e.jsx(oe,{})})})})]});export{xe as default};
